import{c as be,r as mt,t as $e,a as Le,u as Ye,b as te,s as Wn,d as Eo,e as ac,f as oc,j as E,g as lc,h as Zr,i as Vn,k as es,l as dc,m as st,n as Po,o as ft,p as uc,q as Co,v as ts,w as Io,x as Do,y as Ao,z as cc,A as hc,B as fc,C as mc,D as pc,E as gc,F as Hn,G as yc,H as _c,I as Oo,J as vc,K as bc,L as Sc,N as Tc,O as wc,P as xc,Q as Lo,R as Ec,S as Pc,T as Cc,U as Ic,V as Dc,W as Ac,X as Oc,Y as Lc,Z as Mc,_ as kc,$ as Rc,a0 as Uc,a1 as Bc,a2 as Nc,a3 as bn,a4 as jc,a5 as $c,a6 as Fc,a7 as qc}from"./index.Bc3DWSdj.js";import{B as vt,g as we,h as Un,G as wt,b as Wi,T as rt,a as zn,R as G,S as xt,i as Wc,M as yt,j as Vc,r as X,N as Mo,A as Ze,d as Hc,F as ko,I as ha,J as zc,P as je,K as Gc,E as Fi,O as Bn,Q as fa,V as Qc,D as Yc,W as Xc}from"./mantine.DuT6zjM5.js";import{I as Ro,P as Kc,C as is,a as Jc}from"./Clip.XNMSw-57.js";import{I as Zc}from"./IconRefresh.YHLrjoGq.js";import{v as H,_ as Qe,w as V,a as eh,D as th,b as ma,c as Ni,m as pr,p as Rt,d as ht,i as ih,g as ns,e as nh,f as Zt,h as rh,t as sh,s as Uo,j as ah,k as Bo,P as oh,l as lh,n as rs,o as Nn,q as dh,u as uh,x as ch,y as hh,z as fh,A as mh,B as ph}from"./videojs.NeURMMHm.js";import{r as at,g as No,a as jo}from"./vendor.NHdFJPub.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=[["path",{d:"M8 12a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-0"}],["path",{d:"M14 12a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M15.5 17c0 1 1.5 3 2 3c1.5 0 2.833 -1.667 3.5 -3c.667 -1.667 .5 -5.833 -1.5 -11.5c-1.457 -1.015 -3 -1.34 -4.5 -1.5l-.972 1.923a11.913 11.913 0 0 0 -4.053 0l-.975 -1.923c-1.5 .16 -3.043 .485 -4.5 1.5c-2 5.667 -2.167 9.833 -1.5 11.5c.667 1.333 2 3 3.5 3c.5 0 2 -2 2 -3",key:"svg-2"}],["path",{d:"M7 16.5c3.5 1 6.5 1 10 0",key:"svg-3"}]],yh=be("outline","brand-discord","BrandDiscord",gh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=[["path",{d:"M3 12h1m8 -9v1m8 8h1m-15.4 -6.4l.7 .7m12.1 -.7l-.7 .7",key:"svg-0"}],["path",{d:"M9 16a5 5 0 1 1 6 0a3.5 3.5 0 0 0 -1 3a2 2 0 0 1 -4 0a3.5 3.5 0 0 0 -1 -3",key:"svg-1"}],["path",{d:"M9.7 17l4.6 0",key:"svg-2"}]],$o=be("outline","bulb","Bulb",_h);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const vh=[["path",{d:"M3 13a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M15 9a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M9 5a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20h14",key:"svg-3"}]],bh=be("outline","chart-bar","ChartBar",vh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]],Th=be("outline","chevron-left","ChevronLeft",Sh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const wh=[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]],xh=be("outline","chevron-right","ChevronRight",wh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]],Ph=be("outline","chevron-up","ChevronUp",Eh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=[["path",{d:"M18 18h-13l-1.865 -9.327a.25 .25 0 0 1 .4 -.244l4.465 3.571l1.6 -2.4m1.596 -2.394l.804 -1.206l4 6l4.464 -3.571a.25 .25 0 0 1 .401 .244l-1.363 6.818",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]],Ih=be("outline","crown-off","CrownOff",Ch);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dh=[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]],Ah=be("outline","external-link","ExternalLink",Dh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oh=[["path",{d:"M13 5h8",key:"svg-0"}],["path",{d:"M13 9h5",key:"svg-1"}],["path",{d:"M13 15h8",key:"svg-2"}],["path",{d:"M13 19h5",key:"svg-3"}],["path",{d:"M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-4"}],["path",{d:"M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-5"}]],Lh=be("outline","list-details","ListDetails",Oh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mh=[["path",{d:"M15 15h-1a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25a9 9 0 0 1 -6.372 -15.356",key:"svg-0"}],["path",{d:"M8 4c1.236 -.623 2.569 -1 4 -1c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828a4.516 4.516 0 0 1 -1.127 .73",key:"svg-1"}],["path",{d:"M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}],["path",{d:"M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-4"}],["path",{d:"M3 3l18 18",key:"svg-5"}]],kh=be("outline","palette-off","PaletteOff",Mh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rh=[["path",{d:"M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25",key:"svg-0"}],["path",{d:"M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}]],Uh=be("outline","palette","Palette",Rh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bh=[["path",{d:"M4 5v14l12 -7z",key:"svg-0"}],["path",{d:"M20 5l0 14",key:"svg-1"}]],Nh=be("outline","player-skip-forward","PlayerSkipForward",Bh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const jh=[["path",{d:"M3 5v14l8 -7z",key:"svg-0"}],["path",{d:"M14 5v14l8 -7z",key:"svg-1"}]],$h=be("outline","player-track-next","PlayerTrackNext",jh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fh=[["path",{d:"M21 5v14l-8 -7z",key:"svg-0"}],["path",{d:"M10 5v14l-8 -7z",key:"svg-1"}]],qh=be("outline","player-track-prev","PlayerTrackPrev",Fh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wh=[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]],Vh=be("outline","plus","Plus",Wh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hh=[["path",{d:"M3 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M17 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M5 11v-3a3 3 0 0 1 3 -3h8a3 3 0 0 1 3 3v3",key:"svg-3"}],["path",{d:"M16.5 8.5l2.5 2.5l2.5 -2.5",key:"svg-4"}]],zh=be("outline","reorder","Reorder",Hh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gh=[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]],Fo=be("outline","search","Search",Gh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qh=[["path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z",key:"svg-0"}]],Yh=be("outline","star","Star",Qh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xh=[["path",{d:"M6 5l0 14",key:"svg-0"}],["path",{d:"M10 5l0 14",key:"svg-1"}],["path",{d:"M14 5l0 14",key:"svg-2"}],["path",{d:"M18 5l0 14",key:"svg-3"}],["path",{d:"M3 17l18 -10",key:"svg-4"}]],Kh=be("outline","tallymarks","Tallymarks",Xh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=[["path",{d:"M7 13v-6m-3 -3a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 1 0 4 0v-3m2 -2h1a2 2 0 0 0 2 -2l-1 -5c-.295 -1.26 -1.11 -2.076 -2 -2h-7c-.57 0 -1.102 .159 -1.556 .434",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]],Zh=be("outline","thumb-down-off","ThumbDownOff",Jh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ef=[["path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3",key:"svg-0"}]],tf=be("outline","thumb-down","ThumbDown",ef);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const nf=[["path",{d:"M4 7h16",key:"svg-0"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-1"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-2"}],["path",{d:"M10 12l4 4m0 -4l-4 4",key:"svg-3"}]],rf=be("outline","trash-x","TrashX",nf);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const sf=[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4",key:"svg-1"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-2"}]],af=be("outline","user-check","UserCheck",sf);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const of=[["path",{d:"M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-0"}],["path",{d:"M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2",key:"svg-1"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"svg-2"}],["path",{d:"M21 21v-2a4 4 0 0 0 -3 -3.85",key:"svg-3"}]],lf=be("outline","users","Users",of);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const df=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],ss=be("outline","x","X",df);function uf(i){if(i===null||i===!0||i===!1)return NaN;var e=Number(i);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function pa(i){var e=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()));return e.setUTCFullYear(i.getFullYear()),i.getTime()-e.getTime()}function kn(i,e){mt(2,arguments);var t=$e(i),n=$e(e),r=t.getTime()-n.getTime();return r<0?-1:r>0?1:r}var qo=6e4,Wo=36e5;function cf(i,e){mt(2,arguments);var t=$e(i),n=$e(e),r=t.getFullYear()-n.getFullYear(),s=t.getMonth()-n.getMonth();return r*12+s}function hf(i,e){return mt(2,arguments),$e(i).getTime()-$e(e).getTime()}var ff={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(i){return i<0?Math.ceil(i):Math.floor(i)}},mf="trunc";function pf(i){return ff[mf]}function gf(i){mt(1,arguments);var e=$e(i);return e.setHours(23,59,59,999),e}function yf(i){mt(1,arguments);var e=$e(i),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function _f(i){mt(1,arguments);var e=$e(i);return gf(e).getTime()===yf(e).getTime()}function vf(i,e){mt(2,arguments);var t=$e(i),n=$e(e),r=kn(t,n),s=Math.abs(cf(t,n)),o;if(s<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*s);var d=kn(t,n)===-r;_f($e(i))&&s===1&&kn(i,n)===1&&(d=!1),o=r*(s-Number(d))}return o===0?0:o}function bf(i,e,t){mt(2,arguments);var n=hf(i,e)/1e3;return pf()(n)}var Sf={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Tf=function(i,e,t){var n,r=Sf[i];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function gr(i){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):i.defaultWidth,n=i.formats[t]||i.formats[i.defaultWidth];return n}}var wf={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xf={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Ef={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Pf={date:gr({formats:wf,defaultWidth:"full"}),time:gr({formats:xf,defaultWidth:"full"}),dateTime:gr({formats:Ef,defaultWidth:"full"})},Cf={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},If=function(i,e,t,n){return Cf[i]};function Ai(i){return function(e,t){var n=t||{},r=n.context?String(n.context):"standalone",s;if(r==="formatting"&&i.formattingValues){var o=i.defaultFormattingWidth||i.defaultWidth,d=n.width?String(n.width):o;s=i.formattingValues[d]||i.formattingValues[o]}else{var f=i.defaultWidth,h=n.width?String(n.width):i.defaultWidth;s=i.values[h]||i.values[f]}var p=i.argumentCallback?i.argumentCallback(e):e;return s[p]}}var Df={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Af={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Of={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Lf={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Mf={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},kf={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Rf=function(i,e){var t=Number(i),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Uf={ordinalNumber:Rf,era:Ai({values:Df,defaultWidth:"wide"}),quarter:Ai({values:Af,defaultWidth:"wide",argumentCallback:function(i){return i-1}}),month:Ai({values:Of,defaultWidth:"wide"}),day:Ai({values:Lf,defaultWidth:"wide"}),dayPeriod:Ai({values:Mf,defaultWidth:"wide",formattingValues:kf,defaultFormattingWidth:"wide"})};function Oi(i){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,r=n&&i.matchPatterns[n]||i.matchPatterns[i.defaultMatchWidth],s=e.match(r);if(!s)return null;var o=s[0],d=n&&i.parsePatterns[n]||i.parsePatterns[i.defaultParseWidth],f=Array.isArray(d)?Nf(d,function(y){return y.test(o)}):Bf(d,function(y){return y.test(o)}),h;h=i.valueCallback?i.valueCallback(f):f,h=t.valueCallback?t.valueCallback(h):h;var p=e.slice(o.length);return{value:h,rest:p}}}function Bf(i,e){for(var t in i)if(i.hasOwnProperty(t)&&e(i[t]))return t}function Nf(i,e){for(var t=0;t<i.length;t++)if(e(i[t]))return t}function jf(i){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(i.matchPattern);if(!n)return null;var r=n[0],s=e.match(i.parsePattern);if(!s)return null;var o=i.valueCallback?i.valueCallback(s[0]):s[0];o=t.valueCallback?t.valueCallback(o):o;var d=e.slice(r.length);return{value:o,rest:d}}}var $f=/^(\d+)(th|st|nd|rd)?/i,Ff=/\d+/i,qf={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Wf={any:[/^b/i,/^(a|c)/i]},Vf={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Hf={any:[/1/i,/2/i,/3/i,/4/i]},zf={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Gf={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Qf={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Yf={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Xf={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Kf={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Jf={ordinalNumber:jf({matchPattern:$f,parsePattern:Ff,valueCallback:function(i){return parseInt(i,10)}}),era:Oi({matchPatterns:qf,defaultMatchWidth:"wide",parsePatterns:Wf,defaultParseWidth:"any"}),quarter:Oi({matchPatterns:Vf,defaultMatchWidth:"wide",parsePatterns:Hf,defaultParseWidth:"any",valueCallback:function(i){return i+1}}),month:Oi({matchPatterns:zf,defaultMatchWidth:"wide",parsePatterns:Gf,defaultParseWidth:"any"}),day:Oi({matchPatterns:Qf,defaultMatchWidth:"wide",parsePatterns:Yf,defaultParseWidth:"any"}),dayPeriod:Oi({matchPatterns:Xf,defaultMatchWidth:"any",parsePatterns:Kf,defaultParseWidth:"any"})},Zf={code:"en-US",formatDistance:Tf,formatLong:Pf,formatRelative:If,localize:Uf,match:Jf,options:{weekStartsOn:0,firstWeekContainsDate:1}};function em(i,e){if(i==null)throw new TypeError("assign requires that input parameter not be null or undefined");e=e||{};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t]);return i}function tm(i){return em({},i)}var ga=1440,im=2520,yr=43200,nm=86400;function rm(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};mt(2,arguments);var n=t.locale||Zf;if(!n.formatDistance)throw new RangeError("locale must contain formatDistance property");var r=kn(i,e);if(isNaN(r))throw new RangeError("Invalid time value");var s=tm(t);s.addSuffix=!!t.addSuffix,s.comparison=r;var o,d;r>0?(o=$e(e),d=$e(i)):(o=$e(i),d=$e(e));var f=bf(d,o),h=(pa(d)-pa(o))/1e3,p=Math.round((f-h)/60),y;if(p<2)return t.includeSeconds?f<5?n.formatDistance("lessThanXSeconds",5,s):f<10?n.formatDistance("lessThanXSeconds",10,s):f<20?n.formatDistance("lessThanXSeconds",20,s):f<40?n.formatDistance("halfAMinute",null,s):f<60?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",1,s):p===0?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",p,s);if(p<45)return n.formatDistance("xMinutes",p,s);if(p<90)return n.formatDistance("aboutXHours",1,s);if(p<ga){var w=Math.round(p/60);return n.formatDistance("aboutXHours",w,s)}else{if(p<im)return n.formatDistance("xDays",1,s);if(p<yr){var P=Math.round(p/ga);return n.formatDistance("xDays",P,s)}else if(p<nm)return y=Math.round(p/yr),n.formatDistance("aboutXMonths",y,s)}if(y=vf(d,o),y<12){var _=Math.round(p/yr);return n.formatDistance("xMonths",_,s)}else{var v=y%12,b=Math.floor(y/12);return v<3?n.formatDistance("aboutXYears",b,s):v<9?n.formatDistance("overXYears",b,s):n.formatDistance("almostXYears",b+1,s)}}function sm(i,e){return mt(1,arguments),rm(i,Date.now(),e)}function am(i,e){mt(1,arguments);var t={},n=t.additionalDigits==null?2:uf(t.additionalDigits);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof i=="string"||Object.prototype.toString.call(i)==="[object String]"))return new Date(NaN);var r=um(i),s;if(r.date){var o=cm(r.date,n);s=hm(o.restDateString,o.year)}if(!s||isNaN(s.getTime()))return new Date(NaN);var d=s.getTime(),f=0,h;if(r.time&&(f=fm(r.time),isNaN(f)))return new Date(NaN);if(r.timezone){if(h=mm(r.timezone),isNaN(h))return new Date(NaN)}else{var p=new Date(d+f),y=new Date(0);return y.setFullYear(p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()),y.setHours(p.getUTCHours(),p.getUTCMinutes(),p.getUTCSeconds(),p.getUTCMilliseconds()),y}return new Date(d+f+h)}var Sn={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},om=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,lm=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,dm=/^([+-])(\d{2})(?::?(\d{2}))?$/;function um(i){var e={},t=i.split(Sn.dateTimeDelimiter),n;if(t.length>2)return e;if(/:/.test(t[0])?n=t[0]:(e.date=t[0],n=t[1],Sn.timeZoneDelimiter.test(e.date)&&(e.date=i.split(Sn.timeZoneDelimiter)[0],n=i.substr(e.date.length,i.length))),n){var r=Sn.timezone.exec(n);r?(e.time=n.replace(r[1],""),e.timezone=r[1]):e.time=n}return e}function cm(i,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=i.match(t);if(!n)return{year:NaN,restDateString:""};var r=n[1]?parseInt(n[1]):null,s=n[2]?parseInt(n[2]):null;return{year:s===null?r:s*100,restDateString:i.slice((n[1]||n[2]).length)}}function hm(i,e){if(e===null)return new Date(NaN);var t=i.match(om);if(!t)return new Date(NaN);var n=!!t[4],r=Li(t[1]),s=Li(t[2])-1,o=Li(t[3]),d=Li(t[4]),f=Li(t[5])-1;if(n)return vm(e,d,f)?pm(e,d,f):new Date(NaN);var h=new Date(0);return!ym(e,s,o)||!_m(e,r)?new Date(NaN):(h.setUTCFullYear(e,s,Math.max(r,o)),h)}function Li(i){return i?parseInt(i):1}function fm(i){var e=i.match(lm);if(!e)return NaN;var t=_r(e[1]),n=_r(e[2]),r=_r(e[3]);return bm(t,n,r)?t*Wo+n*qo+r*1e3:NaN}function _r(i){return i&&parseFloat(i.replace(",","."))||0}function mm(i){if(i==="Z")return 0;var e=i.match(dm);if(!e)return 0;var t=e[1]==="+"?-1:1,n=parseInt(e[2]),r=e[3]&&parseInt(e[3])||0;return Sm(n,r)?t*(n*Wo+r*qo):NaN}function pm(i,e,t){var n=new Date(0);n.setUTCFullYear(i,0,4);var r=n.getUTCDay()||7,s=(e-1)*7+t+1-r;return n.setUTCDate(n.getUTCDate()+s),n}var gm=[31,null,31,30,31,30,31,31,30,31,30,31];function Vo(i){return i%400===0||i%4===0&&i%100!==0}function ym(i,e,t){return e>=0&&e<=11&&t>=1&&t<=(gm[e]||(Vo(i)?29:28))}function _m(i,e){return e>=1&&e<=(Vo(i)?366:365)}function vm(i,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function bm(i,e,t){return i===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&i>=0&&i<25}function Sm(i,e){return e>=0&&e<=59}function Tm(){const i=Le.c(16),e=Ye(),t=te(Wn),n=te(Eo);if(!t||!t.submitters||t.submitters.length===0)return null;let r,s;if(i[0]!==t.submitters||i[1]!==n){r=t.submitters.map(wm);let w;i[4]!==n?(w=P=>n.includes(P),i[4]=n,i[5]=w):w=i[5],s=r.some(w),i[0]=t.submitters,i[1]=n,i[2]=r,i[3]=s}else r=i[2],s=i[3];const o=s;let d;i[6]!==e||i[7]!==o||i[8]!==r?(d=()=>{r.forEach(w=>{e(o?ac(w):oc(w))})},i[6]=e,i[7]=o,i[8]=r,i[9]=d):d=i[9];const f=d,h=o?"Unfavorite submitter":"Favorite submitter";let p;i[10]!==o?(p=o?E.jsx(Ro,{size:16}):E.jsx(Yh,{size:16}),i[10]=o,i[11]=p):p=i[11];let y;return i[12]!==f||i[13]!==h||i[14]!==p?(y=E.jsx(vt,{size:"xs",variant:"default",px:8,onClick:f,title:h,children:p}),i[12]=f,i[13]=h,i[14]=p,i[15]=y):y=i[15],y}function wm(i){return i.toLowerCase()}function Ho(i){const e=Le.c(35),{className:t}=i,n=Ye(),r=te(lc),s=te(Zr),o=te(Vn),d=te(es),f=te(dc),h=te(Wn);let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p={flexShrink:0,marginLeft:"auto"},e[0]=p):p=e[0];let y;e[1]===Symbol.for("react.memo_cache_sentinel")?(y={display:"flex",alignItems:"center"},e[1]=y):y=e[1];let w;e[2]!==n?(w=j=>{n(st({set:!1})),n(Po(j.currentTarget.checked))},e[2]=n,e[3]=w):w=e[3];let P;e[4]!==d||e[5]!==w?(P=E.jsx(we,{className:"autoplay-toggle-inline",sx:y,children:E.jsx(Un,{size:"xs",label:"Autoplay",checked:d,onChange:w})}),e[4]=d,e[5]=w,e[6]=P):P=e[6];let _;e[7]===Symbol.for("react.memo_cache_sentinel")?(_=E.jsx(Tm,{}),e[7]=_):_=e[7];let v;e[8]!==h?(v=h&&E.jsx(vt,{size:"xs",variant:"default",px:8,onClick:()=>{const j=ft.getUrl(h.id)||h.url;j&&window.open(j,"_blank","noopener,noreferrer")},title:"Open",children:E.jsx(Ah,{size:16})}),e[8]=h,e[9]=v):v=e[9];let b;e[10]!==o||e[11]!==r||e[12]!==n?(b=o&&E.jsx(vt,{size:"xs",variant:"default",rightIcon:E.jsx(Nh,{}),onClick:()=>{n(st({set:!1})),n(uc())},disabled:!r,children:"Skip"}),e[10]=o,e[11]=r,e[12]=n,e[13]=b):b=e[13];let T;e[14]!==P||e[15]!==v||e[16]!==b?(T=E.jsxs(wt,{align:"center",spacing:4,children:[P,_,v,b]}),e[14]=P,e[15]=v,e[16]=b,e[17]=T):T=e[17];let C;e[18]===Symbol.for("react.memo_cache_sentinel")?(C=E.jsx(qh,{}),e[18]=C):C=e[18];let M;e[19]!==n?(M=()=>{n(st({set:!1})),n(Co())},e[19]=n,e[20]=M):M=e[20];const L=!f;let k;e[21]!==M||e[22]!==L?(k=E.jsx(vt,{size:"xs",leftIcon:C,onClick:M,disabled:L,children:"Prev"}),e[21]=M,e[22]=L,e[23]=k):k=e[23];let R;e[24]===Symbol.for("react.memo_cache_sentinel")?(R=E.jsx($h,{}),e[24]=R):R=e[24];let A;e[25]!==n?(A=()=>{n(st({set:!1})),n(ts())},e[25]=n,e[26]=A):A=e[26];const O=!r&&!s;let B;e[27]!==A||e[28]!==O?(B=E.jsx(vt,{size:"xs",rightIcon:R,onClick:A,disabled:O,children:"Next"}),e[27]=A,e[28]=O,e[29]=B):B=e[29];let N;return e[30]!==t||e[31]!==k||e[32]!==B||e[33]!==T?(N=E.jsxs(wt,{align:"center",className:t,sx:p,children:[T,k,B]}),e[30]=t,e[31]=k,e[32]=B,e[33]=T,e[34]=N):N=e[34],N}const ya=E.jsx(E.Fragment,{children:" "});function Gn(i){const e=Le.c(36),{className:t}=i,n=te(Wn),r=Wi(),s=n?.submitters?.[0];let o;e[0]!==s?(o=J=>s?J.chatUsers[s.toLowerCase()]:void 0,e[0]=s,e[1]=o):o=e[1];const d=te(o);let f;e[2]===Symbol.for("react.memo_cache_sentinel")?(f=Io(3),e[2]=f):f=e[2];const h=te(f),p=s?h.findIndex(J=>J.username===s.toLowerCase()):-1,y=p>=0?`chip-anim-${p}`:void 0,w=te(xm),P=te(Eo);let _;e[3]!==P||e[4]!==s?(_=s?P.includes(s.toLowerCase()):!1,e[3]=P,e[4]=s,e[5]=_):_=e[5];const v=_,b=w&&y?y:void 0;let T;e:{if(!w){T=void 0;break e}if(v){let se;e[6]===Symbol.for("react.memo_cache_sentinel")?(se={background:"linear-gradient(90deg, #FFD700, #FFA500, #FFD700)",backgroundSize:"200% auto",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},e[6]=se):se=e[6],T=se;break e}if(y||!d){T=void 0;break e}const J=d.broadcaster?r.colors.red[6]:d.vip?r.colors.pink[6]:d.mod?r.colors.green[6]:void 0;let Z;e[7]!==J?(Z=J?{color:J}:void 0,e[7]=J,e[8]=Z):Z=e[8],T=Z}const C=T;let M;e[9]===Symbol.for("react.memo_cache_sentinel")?(M={strong:{fontWeight:600},flex:1,minWidth:0,overflow:"hidden"},e[9]=M):M=e[9];const L=n?.title??ya;let k;e[10]!==L?(k=E.jsx(rt,{size:"xl",weight:700,lineClamp:1,children:L}),e[10]=L,e[11]=k):k=e[11];let R;e[12]===Symbol.for("react.memo_cache_sentinel")?(R={display:"flex",alignItems:"center",gap:".25rem"},e[12]=R):R=e[12];const A=n?.Platform;let O;e[13]!==A?(O=E.jsx(Kc,{platform:A}),e[13]=A,e[14]=O):O=e[14];const B=n?.author??ya;let N;e[15]!==B?(N=E.jsx("strong",{children:B}),e[15]=B,e[16]=N):N=e[16];let j;e[17]!==n?.category?(j=n?.category&&E.jsxs(E.Fragment,{children:[" (",E.jsx("strong",{children:n?.category}),")"]}),e[17]=n?.category,e[18]=j):j=e[18];let W;e[19]!==n||e[20]!==v||e[21]!==b||e[22]!==C?(W=n?.submitters[0]&&E.jsxs(E.Fragment,{children:[", submitted by"," ",E.jsxs("strong",{className:b,style:C,children:[v&&E.jsx(Ro,{size:11,style:{display:"inline",marginRight:2}}),n?.submitters[0]]}),n?.submitters.length>1&&E.jsxs(E.Fragment,{children:[" and ",n.submitters.length-1," other(s)"]})]}),e[19]=n,e[20]=v,e[21]=b,e[22]=C,e[23]=W):W=e[23];let F;e[24]!==n?.createdAt?(F=n?.createdAt&&E.jsxs(E.Fragment,{children:[", created ",sm(am(n?.createdAt))," ago"]}),e[24]=n?.createdAt,e[25]=F):F=e[25];let z;e[26]!==O||e[27]!==N||e[28]!==j||e[29]!==W||e[30]!==F?(z=E.jsxs(rt,{sx:R,color:"dimmed",size:"sm",lineClamp:1,children:[O,N,j,W,F]}),e[26]=O,e[27]=N,e[28]=j,e[29]=W,e[30]=F,e[31]=z):z=e[31];let K;return e[32]!==t||e[33]!==z||e[34]!==k?(K=E.jsxs(we,{className:t,sx:M,children:[k,z]}),e[32]=t,e[33]=z,e[34]=k,e[35]=K):K=e[35],K}function xm(i){return i.clipQueue.coloredSubmitterNames!==!1}function as(i){const e=Le.c(17),{wrapper:t,card:n,filteredClips:r}=i,s=Ye(),o=te(Do),d=r??o,f=t??Em;let h;e[0]!==s?(h=v=>()=>s(Ao(v)),e[0]=s,e[1]=h):h=e[1];const p=h;let y;e[2]!==s?(y=v=>()=>s(cc(v)),e[2]=s,e[3]=y):y=e[3];const w=y;let P;if(e[4]!==f||e[5]!==n||e[6]!==d||e[7]!==p||e[8]!==w){let v;e[10]!==f||e[11]!==n||e[12]!==p||e[13]!==w?(v=b=>E.jsx(f,{children:E.jsx(is,{platform:b.Platform||void 0,clipId:b.id,card:n,queueIndex:b.seq,onClick:p(b.id),onCrossClick:w(b.id)},b.id)},b.id),e[10]=f,e[11]=n,e[12]=p,e[13]=w,e[14]=v):v=e[14],P=d.map(v),e[4]=f,e[5]=n,e[6]=d,e[7]=p,e[8]=w,e[9]=P}else P=e[9];let _;return e[15]!==P?(_=E.jsx(E.Fragment,{children:P}),e[15]=P,e[16]=_):_=e[16],_}function Em(i){const{children:e}=i;return E.jsx(E.Fragment,{children:e})}function zo(){const i=zn(),e=Ye(),[t,n]=G.useState(""),[r,s]=G.useState(null),o=()=>i.closeAll(),d=()=>{let f=[];try{const h=JSON.parse(t);if(Array.isArray(h))for(const p of h)typeof p=="string"?f.push({url:p}):p&&typeof p.url=="string"&&f.push({url:p.url,submitter:p.submitter});else typeof h=="string"?f.push({url:h}):h&&typeof h.url=="string"&&f.push({url:h.url,submitter:h.submitter})}catch{const p=t.split(/[,\n\r]+/).map(y=>y.trim()).filter(Boolean);for(const y of p)f.push({url:y})}if(f.length===0){s("No URLs found in the provided input");return}for(const h of f){const p={username:h.submitter??"import*"};e(hc({url:h.url,userstate:p}))}o()};return E.jsxs(xt,{children:[E.jsxs(rt,{size:"sm",children:["Paste JSON array of strings or objects with a ",E.jsx("code",{children:"url"})," property. You can also paste a list of urls separated by commas or new lines."]}),E.jsx(Wc,{placeholder:`[
  { "url": "https://youtu.be/dQw4w9WgXcQ", "submitter": "alice" },
  { "url": "https://www.tiktok.com/@user/video/987654321", "submitter": "charlie" }
]`,autosize:!0,minRows:6,value:t,onChange:f=>n(f.currentTarget.value)}),r&&E.jsx(rt,{color:"red",size:"sm",children:r}),E.jsxs(wt,{position:"right",children:[E.jsx(vt,{variant:"outline",onClick:o,children:"Cancel"}),E.jsx(vt,{onClick:d,children:"Import"})]})]})}function Pm(i){const e=Le.c(16),{onSubmit:t}=i,n=Ye(),r=te(Vn),[s,o]=X.useState(r);let d;e[0]!==n||e[1]!==t||e[2]!==s?(d=C=>{n(Hn({clipLimit:s||null})),t(),C.preventDefault()},e[0]=n,e[1]=t,e[2]=s,e[3]=d):d=e[3];const f=d;let h;e[4]===Symbol.for("react.memo_cache_sentinel")?(h=E.jsx("em",{children:"Skip"}),e[4]=h):h=e[4];let p;e[5]===Symbol.for("react.memo_cache_sentinel")?(p=E.jsx("em",{children:"Next"}),e[5]=p):p=e[5];let y;e[6]===Symbol.for("react.memo_cache_sentinel")?(y=E.jsxs(E.Fragment,{children:["Max number of clips in the queue. Afterwards new clips will not be accepted, current clips can be boosted to the top of the queue. You can ",h," a clip instead of ",p,"-ing it to free a spot.",E.jsx("br",{}),"Leave empty or 0 to disable."]}),e[6]=y):y=e[6];const w=s??void 0;let P;e[7]===Symbol.for("react.memo_cache_sentinel")?(P=C=>o(C),e[7]=P):P=e[7];let _;e[8]!==w?(_=E.jsx(Mo,{placeholder:"Clip limit",description:y,min:0,step:1,value:w,onChange:P}),e[8]=w,e[9]=_):_=e[9];let v;e[10]===Symbol.for("react.memo_cache_sentinel")?(v=E.jsx(vt,{type:"submit",children:"Save"}),e[10]=v):v=e[10];let b;e[11]!==_?(b=E.jsxs(xt,{children:[_,v]}),e[11]=_,e[12]=b):b=e[12];let T;return e[13]!==f||e[14]!==b?(T=E.jsx("form",{onSubmit:f,children:b}),e[13]=f,e[14]=b,e[15]=T):T=e[15],T}function Cm(){const i=Le.c(40),e=zn(),t=Ye(),n=te(Vn),r=te(fc),s=te(mc);let o;i[0]!==e?(o=()=>{const j=e.openModal({title:"Set clip limit",children:E.jsx(Pm,{onSubmit:()=>e.closeModal(j)})})},i[0]=e,i[1]=o):o=i[1];const d=o;let f;i[2]!==e?(f=()=>{e.openModal({title:"Import links",children:E.jsx(zo,{}),size:"lg"})},i[2]=e,i[3]=f):f=i[3];const h=f;let p;i[4]===Symbol.for("react.memo_cache_sentinel")?(p=E.jsx(Kh,{size:14}),i[4]=p):p=i[4];const y=n??"off";let w;i[5]!==y?(w=E.jsx(Vc,{color:"indigo",children:y}),i[5]=y,i[6]=w):w=i[6];let P;i[7]!==d?(P=()=>d(),i[7]=d,i[8]=P):P=i[8];let _;i[9]!==w||i[10]!==P?(_=E.jsx(yt.Item,{icon:p,rightSection:w,onClick:P,children:"Set queue limit"}),i[9]=w,i[10]=P,i[11]=_):_=i[11];let v;i[12]===Symbol.for("react.memo_cache_sentinel")?(v=E.jsx($o,{size:14}),i[12]=v):v=i[12];let b;i[13]!==h?(b=E.jsx(yt.Item,{icon:v,onClick:()=>h(),children:"Import links"}),i[13]=h,i[14]=b):b=i[14];let T;i[15]!==s?(T=s?E.jsx(Uh,{size:14}):E.jsx(kh,{size:14}),i[15]=s,i[16]=T):T=i[16];let C;i[17]!==t?(C=()=>t(gc()),i[17]=t,i[18]=C):C=i[18];let M;i[19]!==s||i[20]!==C?(M=E.jsx(Un,{size:"sm",checked:s,onChange:C}),i[19]=s,i[20]=C,i[21]=M):M=i[21];let L;i[22]!==M||i[23]!==T?(L=E.jsx(yt.Item,{icon:T,rightSection:M,children:"Gradient paint"}),i[22]=M,i[23]=T,i[24]=L):L=i[24];let k;i[25]===Symbol.for("react.memo_cache_sentinel")?(k=E.jsx(zh,{size:14}),i[25]=k):k=i[25];let R;i[26]!==t?(R=j=>t(Hn({reorderOnDuplicate:j.currentTarget.checked})),i[26]=t,i[27]=R):R=i[27];let A;i[28]!==r||i[29]!==R?(A=E.jsx(yt.Item,{icon:k,rightSection:E.jsx(Un,{size:"sm",checked:r,onChange:R}),children:"Popularity sort"}),i[28]=r,i[29]=R,i[30]=A):A=i[30];let O;i[31]===Symbol.for("react.memo_cache_sentinel")?(O=E.jsx(rf,{size:14}),i[31]=O):O=i[31];let B;i[32]!==t?(B=E.jsx(yt.Item,{icon:O,color:"red",onClick:()=>t(pc()),children:"Clear queue"}),i[32]=t,i[33]=B):B=i[33];let N;return i[34]!==L||i[35]!==A||i[36]!==B||i[37]!==_||i[38]!==b?(N=E.jsx("div",{className:"queue-quick-menu-container",children:E.jsxs(yt,{withinPortal:!0,zIndex:2200,position:"bottom",placement:"end",closeOnItemClick:!0,children:[_,b,L,A,B]})}),i[34]=L,i[35]=A,i[36]=B,i[37]=_,i[38]=b,i[39]=N):N=i[39],N}const Im=i=>{const e=Le.c(23),{count:t}=i,n=t===void 0?3:t,r=Ye(),s=Wi();let o;e[0]!==n?(o=Io(n),e[0]=n,e[1]=o):o=e[1];const d=te(o),f=te(Dm);let h;e[2]!==r?(h=()=>{r(yc())},e[2]=r,e[3]=h):h=e[3];const p=h;let y;e:{if(!d||d.length===0){y=null;break e}let A;e[4]!==f||e[5]!==d?(A=[],d.forEach((O,B)=>{B>0&&A.push(E.jsx("span",{className:"chip-sep",children:"•"},`sep-${B}`)),A.push(E.jsxs("span",{className:`top-submitter-chip ${f?`chip-anim-${B%3}`:""}`,children:[E.jsx("span",{className:"name",children:O.username}),E.jsx("span",{className:"count",children:O.count})]},O.username))}),e[4]=f,e[5]=d,e[6]=A):A=e[6],y=A}const w=y;if(!w||w.length===0)return null;const P=`1px solid ${s.colorScheme==="dark"?"#2b2b2b":"#e9ecef"}`;let _;e[7]!==P?(_={overflow:"hidden",width:"100%",mt:8,borderRadius:8,padding:"6px 10px",border:P},e[7]=P,e[8]=_):_=e[8];let v;e[9]===Symbol.for("react.memo_cache_sentinel")?(v={display:"flex",alignItems:"center",gap:8},e[9]=v):v=e[9];let b;e[10]===Symbol.for("react.memo_cache_sentinel")?(b={overflowX:"hidden",overflowY:"hidden",flex:1,minWidth:0,"&::-webkit-scrollbar":{height:0}},e[10]=b):b=e[10];let T;e[11]===Symbol.for("react.memo_cache_sentinel")?(T={display:"inline-block"},e[11]=T):T=e[11];let C;e[12]!==w?(C=E.jsx(we,{sx:b,children:E.jsx("span",{className:"top-submitters-marquee",style:T,children:w})}),e[12]=w,e[13]=C):C=e[13];let M;e[14]===Symbol.for("react.memo_cache_sentinel")?(M=E.jsx(Zc,{size:14}),e[14]=M):M=e[14];let L;e[15]!==p?(L=E.jsx(Ze,{className:"top-submitters-refresh",size:"sm",variant:"light",onClick:p,title:"Reset",children:M}),e[15]=p,e[16]=L):L=e[16];let k;e[17]!==C||e[18]!==L?(k=E.jsxs(we,{sx:v,children:[C,L]}),e[17]=C,e[18]=L,e[19]=k):k=e[19];let R;return e[20]!==k||e[21]!==_?(R=E.jsx(we,{sx:_,children:k}),e[20]=k,e[21]=_,e[22]=R):R=e[22],R};function Dm(i){return i.clipQueue.coloredSubmitterNames!==!1}class Am{static normalizeQuery(e){return e.toLowerCase().trim()}static getClipSearchText(e){const t=[];return e.title&&t.push(e.title),e.author&&t.push(e.author),e.submitters&&t.push(...e.submitters),t.join(" ").toLowerCase()}static filterClips(e,t){const n=this.normalizeQuery(t);return n?e.filter(r=>this.getClipSearchText(r).includes(n)):e}}function Om({closeModal:i}){const[e,t]=X.useState(""),n=Ye(),r=te(Do),s=X.useMemo(()=>Am.filterClips(r,e),[r,e]),o=X.useCallback(d=>{n(Ao(d)),i()},[n,i]);return E.jsxs(xt,{spacing:"md",sx:{maxHeight:"80vh"},children:[E.jsx(Hc,{placeholder:"Search queue by title, author, or submitter...",icon:E.jsx(Fo,{size:16}),value:e,onChange:d=>t(d.currentTarget.value),autoFocus:!0,size:"md",rightSection:E.jsx(Ze,{size:"sm",variant:"transparent",onClick:i,"aria-label":"Close search",children:E.jsx(ss,{size:16})})}),E.jsx(ko,{style:{height:"60vh",maxHeight:"60vh"},children:E.jsx(xt,{spacing:"xs",children:s.length===0?E.jsx("div",{style:{textAlign:"center",padding:"2rem",opacity:.6},children:e?"No matches":"Queue is empty"}):s.map(d=>E.jsx("div",{onClick:()=>o(d.id),style:{cursor:"pointer"},children:E.jsx(is,{platform:d.Platform||void 0,clipId:d.id,queueIndex:d.seq,onClick:()=>o(d.id)})},d.id))})})]})}const Lm=()=>{const i=Le.c(2),e=zn();let t;return i[0]!==e?(t={openQueueSearchModal:()=>{const r=e.openModal({children:E.jsx(Om,{closeModal:()=>e.closeModal(r)}),closeOnClickOutside:!0,closeOnEscape:!0,size:"lg",withCloseButton:!1})}},i[0]=e,i[1]=t):t=i[1],t},os=i=>{const e=Le.c(62),{className:t}=i,n=Ye(),{openQueueSearchModal:r}=Lm(),s=te(_c),o=te(Oo),d=te(vc),f=te(bc),h=te(Vn),p=te(Sc),y=te(Tc).length;let w;e[0]!==n?(w=()=>{n(wc())},e[0]=n,e[1]=w):w=e[1];const P=w;let _;e[2]!==n?(_=()=>{n(xc())},e[2]=n,e[3]=_):_=e[3];const v=_;let b;e[4]!==n||e[5]!==f?(b=()=>{n(Hn({subOnlyMode:!f}))},e[4]=n,e[5]=f,e[6]=b):b=e[6];const T=b;let C;e[7]!==n?(C=()=>{n(Lo())},e[7]=n,e[8]=C):C=e[8];const M=C,L=`${y}/${p}${h?`/${h}`:""}`;let k;e[9]===Symbol.for("react.memo_cache_sentinel")?(k={marginTop:"-0.5rem"},e[9]=k):k=e[9];let R;e[10]===Symbol.for("react.memo_cache_sentinel")?(R={width:"100%"},e[10]=R):R=e[10];let A;e[11]===Symbol.for("react.memo_cache_sentinel")?(A={flex:1,margin:0,padding:0},e[11]=A):A=e[11];let O;e[12]===Symbol.for("react.memo_cache_sentinel")?(O={margin:0,padding:0},e[12]=O):O=e[12];let B;e[13]!==L?(B=E.jsx(rt,{size:"md",weight:700,sx:O,children:L}),e[13]=L,e[14]=B):B=e[14];let N;e[15]===Symbol.for("react.memo_cache_sentinel")?(N=E.jsx(Lh,{size:18,style:{marginTop:2}}),e[15]=N):N=e[15];let j;e[16]!==B?(j=E.jsxs(wt,{spacing:6,align:"center",sx:A,children:[B,N]}),e[16]=B,e[17]=j):j=e[17];let W;e[18]===Symbol.for("react.memo_cache_sentinel")?(W={alignItems:"center",margin:4},e[18]=W):W=e[18];let F;e[19]===Symbol.for("react.memo_cache_sentinel")?(F=E.jsx(Fo,{size:18}),e[19]=F):F=e[19];let z;e[20]!==r?(z=E.jsx(Ze,{size:"sm",variant:"light",onClick:r,title:"Search queue","aria-label":"Search queue",children:F}),e[20]=r,e[21]=z):z=e[21];const K=o?"filled":"light",J=o?"green":void 0,Z=o?"Disable poll":"Enable poll";let se;e[22]===Symbol.for("react.memo_cache_sentinel")?(se=E.jsx(bh,{size:18}),e[22]=se):se=e[22];let ae;e[23]!==M||e[24]!==K||e[25]!==J||e[26]!==Z?(ae=E.jsx(Ze,{size:"sm",variant:K,color:J,onClick:M,title:Z,"aria-label":"Toggle poll",children:se}),e[23]=M,e[24]=K,e[25]=J,e[26]=Z,e[27]=ae):ae=e[27];const ce=d?"Disable skip voting":"Enable skip voting";let fe;e[28]!==d?(fe=d?E.jsx(tf,{size:18}):E.jsx(Zh,{size:18}),e[28]=d,e[29]=fe):fe=e[29];let ee;e[30]!==P||e[31]!==ce||e[32]!==fe?(ee=E.jsx(Ze,{size:"sm",variant:"light",onClick:P,title:ce,"aria-label":"Toggle skip voting",children:fe}),e[30]=P,e[31]=ce,e[32]=fe,e[33]=ee):ee=e[33];const ye=f?"Disable subscriber-only mode":"Enable subscriber-only mode";let ge;e[34]!==f?(ge=f?E.jsx(af,{size:18}):E.jsx(lf,{size:18}),e[34]=f,e[35]=ge):ge=e[35];let oe;e[36]!==T||e[37]!==ye||e[38]!==ge?(oe=E.jsx(Ze,{size:"sm",variant:"light",onClick:T,title:ye,"aria-label":"Toggle subscriber-only mode",children:ge}),e[36]=T,e[37]=ye,e[38]=ge,e[39]=oe):oe=e[39];const xe=s?"Hide top submitters":"Show top submitters";let ke;e[40]!==s?(ke=s?E.jsx(Ec,{size:18}):E.jsx(Ih,{size:18}),e[40]=s,e[41]=ke):ke=e[41];let de;e[42]!==v||e[43]!==xe||e[44]!==ke?(de=E.jsx(Ze,{size:"sm",variant:"light",onClick:v,title:xe,children:ke}),e[42]=v,e[43]=xe,e[44]=ke,e[45]=de):de=e[45];let he;e[46]===Symbol.for("react.memo_cache_sentinel")?(he=E.jsx(Cm,{}),e[46]=he):he=e[46];let Ee;e[47]!==z||e[48]!==ae||e[49]!==ee||e[50]!==oe||e[51]!==de?(Ee=E.jsxs(wt,{spacing:6,align:"center",sx:W,children:[z,ae,ee,oe,de,he]}),e[47]=z,e[48]=ae,e[49]=ee,e[50]=oe,e[51]=de,e[52]=Ee):Ee=e[52];let De;e[53]!==j||e[54]!==Ee?(De=E.jsxs(wt,{position:"apart",align:"center",sx:R,mt:0,children:[j,Ee]}),e[53]=j,e[54]=Ee,e[55]=De):De=e[55];let re;e[56]!==s?(re=s&&E.jsx(Im,{count:3}),e[56]=s,e[57]=re):re=e[57];let Ae;return e[58]!==t||e[59]!==De||e[60]!==re?(Ae=E.jsxs(xt,{spacing:0,className:t,sx:k,children:[De,re]}),e[58]=t,e[59]=De,e[60]=re,e[61]=Ae):Ae=e[61],Ae};function Mm(i){const e=Le.c(35),{visible:t,onCancel:n}=i,r=te(Pc),s=te(Zr),o=t&&!!s,[d,f]=X.useState(0),h=X.useRef(null),p=Wi(),y=p.colors.blue?.[4],w=p.colorScheme==="light"?p.white:void 0,P=te(Cc);let _;if(e[0]!==P||e[1]!==s){let F;e[3]!==s?(F=z=>z.id===s,e[3]=s,e[4]=F):F=e[4],_=P.find(F),e[0]=P,e[1]=s,e[2]=_}else _=e[2];const v=_;let b,T;if(e[5]!==r||e[6]!==o?(b=()=>{if(!o){f(0),h.current&&(cancelAnimationFrame(h.current),h.current=null);return}if(!r||r<=0){f(100);return}const F=performance.now(),z=K=>{const J=K-F,Z=Math.min(100,J/r*100);f(Z),Z<100?h.current=requestAnimationFrame(z):h.current=null};return h.current=requestAnimationFrame(z),()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)}},T=[o,r],e[5]=r,e[6]=o,e[7]=b,e[8]=T):(b=e[7],T=e[8]),X.useEffect(b,T),!o)return null;const C=!o;let M;e[9]!==y||e[10]!==d?(M=[{value:d,color:y}],e[9]=y,e[10]=d,e[11]=M):M=e[11];let L;e[12]!==n||e[13]!==w?(L=n&&E.jsx(ha,{children:E.jsx(vt,{compact:!0,size:"md",variant:"subtle",color:"dark",onClick:n,sx:{color:w},children:"Cancel"})}),e[12]=n,e[13]=w,e[14]=L):L=e[14];let k;e[15]!==M||e[16]!==L?(k=E.jsx(ha,{children:E.jsx(zc,{size:120,thickness:14,sections:M,label:L})}),e[15]=M,e[16]=L,e[17]=k):k=e[17];let R;e[18]!==w?(R=E.jsx(rt,{size:"lg",weight:700,align:"center",sx:{color:w},children:"Next up"}),e[18]=w,e[19]=R):R=e[19];let A;e[20]!==w?(A={maxWidth:420,width:"100%",color:w},e[20]=w,e[21]=A):A=e[21];const O=v?.Platform||void 0;let B;e[22]!==s||e[23]!==O?(B=E.jsx(is,{platform:O,clipId:s}),e[22]=s,e[23]=O,e[24]=B):B=e[24];let N;e[25]!==B||e[26]!==A?(N=E.jsx(we,{sx:A,children:B}),e[25]=B,e[26]=A,e[27]=N):N=e[27];let j;e[28]!==N||e[29]!==k||e[30]!==R?(j=E.jsxs(xt,{spacing:"sm",align:"center",children:[k,R,N]}),e[28]=N,e[29]=k,e[30]=R,e[31]=j):j=e[31];let W;return e[32]!==j||e[33]!==C?(W=E.jsx(we,{sx:km,"aria-hidden":C,children:j}),e[32]=j,e[33]=C,e[34]=W):W=e[34],W}function km(){return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.6)",zIndex:2,padding:24,pointerEvents:"auto"}}/*! @name @videojs/http-streaming @version 3.17.2 @license Apache-2.0 */const Je=eh,jn=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,ot=i=>H.log.debug?H.log.debug.bind(H,"VHS:",`${i} >`):function(){};function le(...i){const e=H.obj||H;return(e.merge||e.mergeOptions).apply(e,i)}function Be(...i){const e=H.time||H;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}function Rm(i){if(i.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<i.length;t++){const n=i.start(t),r=i.end(t);e+=`${n} --> ${r}. Duration (${r-n})
`}return e}const bt=1/30,St=bt*3,Go=function(i,e){const t=[];let n;if(i&&i.length)for(n=0;n<i.length;n++)e(i.start(n),i.end(n))&&t.push([i.start(n),i.end(n)]);return Be(t)},ai=function(i,e){return Go(i,function(t,n){return t-St<=e&&n+St>=e})},Tn=function(i,e){return Go(i,function(t){return t-bt>=e})},Um=function(i){if(i.length<2)return Be();const e=[];for(let t=1;t<i.length;t++){const n=i.end(t-1),r=i.start(t);e.push([n,r])}return Be(e)},Bm=function(i,e){let t=null,n=null,r=0;const s=[],o=[];if(!i||!i.length||!e||!e.length)return Be();let d=i.length;for(;d--;)s.push({time:i.start(d),type:"start"}),s.push({time:i.end(d),type:"end"});for(d=e.length;d--;)s.push({time:e.start(d),type:"start"}),s.push({time:e.end(d),type:"end"});for(s.sort(function(f,h){return f.time-h.time}),d=0;d<s.length;d++)s[d].type==="start"?(r++,r===2&&(t=s[d].time)):s[d].type==="end"&&(r--,r===1&&(n=s[d].time)),t!==null&&n!==null&&(o.push([t,n]),t=null,n=null);return Be(o)},Qo=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},Nm=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},ei=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},jm=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},vr=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},ls=function(i,e){let t=0;if(!i||!i.length)return t;for(let n=0;n<i.length;n++){const r=i.start(n),s=i.end(n);if(!(e>s)){if(e>r&&e<=s){t+=s-e;continue}t+=s-r}}return t},ds=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(n){t+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(t+=i.partTargetDuration)}),t},jr=i=>(i.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(r,s){e.push({duration:r.duration,segmentIndex:n,partIndex:s,part:r,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),Yo=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},Xo=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let n=(t||[]).reduce((r,s)=>r+(s.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},Ko=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=Yo(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},$m=function(i,e){let t=0,n=e-i.mediaSequence,r=i.segments[n];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=i.segments[n],typeof r.end<"u")return{result:t+r.end,precise:!0};if(t+=ds(i,r),typeof r.start<"u")return{result:t+r.start,precise:!0}}return{result:t,precise:!1}},Fm=function(i,e){let t=0,n,r=e-i.mediaSequence;for(;r<i.segments.length;r++){if(n=i.segments[r],typeof n.start<"u")return{result:n.start-t,precise:!0};if(t+=ds(i,n),typeof n.end<"u")return{result:n.end-t,precise:!0}}return{result:-1,precise:!1}},Jo=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const n=$m(i,e);if(n.precise)return n.result;const r=Fm(i,e);return r.precise?r.result:n.result+t},Zo=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return V.Infinity}return Jo(i,e,t)},ji=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:n}){let r=0;if(t>n&&([t,n]=[n,t]),t<0){for(let s=t;s<Math.min(0,n);s++)r+=i;t=0}for(let s=t;s<n;s++)r+=e[s].duration;return r},el=function(i,e,t,n){if(!i||!i.segments)return null;if(i.endList)return Zo(i);if(e===null)return null;e=e||0;let r=Jo(i,i.mediaSequence+i.segments.length,e);return t&&(n=typeof n=="number"?n:Ko(null,i),r-=n),Math.max(0,r)},qm=function(i,e,t){const r=e||0;let s=el(i,e,!0,t);return s===null?Be():(s<r&&(s=r),Be(r,s))},Wm=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:n,startTime:r,exactManifestTimings:s}){let o=e-r;const d=jr(i);let f=0;for(let h=0;h<d.length;h++){const p=d[h];if(t===p.segmentIndex&&!(typeof n=="number"&&typeof p.partIndex=="number"&&n!==p.partIndex)){f=h;break}}if(o<0){if(f>0)for(let h=f-1;h>=0;h--){const p=d[h];if(o+=p.duration,s){if(o<0)continue}else if(o+bt<=0)continue;return{partIndex:p.partIndex,segmentIndex:p.segmentIndex,startTime:r-ji({defaultDuration:i.targetDuration,durationList:d,startIndex:f,endIndex:h})}}return{partIndex:d[0]&&d[0].partIndex||null,segmentIndex:d[0]&&d[0].segmentIndex||0,startTime:e}}if(f<0){for(let h=f;h<0;h++)if(o-=i.targetDuration,o<0)return{partIndex:d[0]&&d[0].partIndex||null,segmentIndex:d[0]&&d[0].segmentIndex||0,startTime:e};f=0}for(let h=f;h<d.length;h++){const p=d[h];o-=p.duration;const y=p.duration>bt,w=o===0,P=y&&o+bt>=0;if(!((w||P)&&h!==d.length-1)){if(s){if(o>0)continue}else if(o-bt>=0)continue;return{partIndex:p.partIndex,segmentIndex:p.segmentIndex,startTime:r+ji({defaultDuration:i.targetDuration,durationList:d,startIndex:f,endIndex:h})}}}return{segmentIndex:d[d.length-1].segmentIndex,partIndex:d[d.length-1].partIndex,startTime:e}},tl=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},us=function(i){return i.excludeUntil&&i.excludeUntil===1/0},Qn=function(i){const e=tl(i);return!i.disabled&&!e},Vm=function(i){return i.disabled},Hm=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},il=function(i,e){return e.attributes&&e.attributes[i]},zm=function(i,e,t,n=0){return il("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-n*8)/e:NaN},$r=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(n=>Qn(n)?(n.attributes.BANDWIDTH||0)<t:!1).length===0},cs=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),_a=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let n=!1;for(const r in t){for(const s in t[r])if(n=e(t[r][s]),n)break;if(n)break}return!!n},Vi=i=>{if(!i||!i.playlists||!i.playlists.length)return _a(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],n=t.attributes&&t.attributes.CODECS;if(!(n&&n.split(",").every(s=>ih(s))||_a(i,s=>cs(t,s))))return!1}return!0};var et={liveEdgeDelay:Ko,duration:Zo,seekable:qm,getMediaInfoForTime:Wm,isEnabled:Qn,isDisabled:Vm,isExcluded:tl,isIncompatible:us,playlistEnd:el,isAes:Hm,hasAttribute:il,estimateSegmentRequestTime:zm,isLowestEnabledRendition:$r,isAudioOnly:Vi,playlistMatch:cs,segmentDurationWithParts:ds};const{log:nl}=H,li=(i,e)=>`${i}-${e}`,rl=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,Gm=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:n=[],customTagMappers:r=[],llhls:s})=>{const o=new oh;i&&o.on("warn",i),e&&o.on("info",e),n.forEach(h=>o.addParser(h)),r.forEach(h=>o.addTagMapper(h)),o.push(t),o.end();const d=o.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(h){d.hasOwnProperty(h)&&delete d[h]}),d.segments&&d.segments.forEach(function(h){["parts","preloadHints"].forEach(function(p){h.hasOwnProperty(p)&&delete h[p]})})),!d.targetDuration){let h=10;d.segments&&d.segments.length&&(h=d.segments.reduce((p,y)=>Math.max(p,y.duration),0)),i&&i({message:`manifest has no targetDuration defaulting to ${h}`}),d.targetDuration=h}const f=Yo(d);if(f.length&&!d.partTargetDuration){const h=f.reduce((p,y)=>Math.max(p,y.duration),0);i&&(i({message:`manifest has no partTargetDuration defaulting to ${h}`}),nl.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),d.partTargetDuration=h}return d},fi=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const n in i.mediaGroups[t])for(const r in i.mediaGroups[t][n]){const s=i.mediaGroups[t][n][r];e(s,t,n,r)}})},sl=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},Qm=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];sl({playlist:t,id:li(e,t.uri)}),t.resolvedUri=Je(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||nl.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},Ym=i=>{fi(i,e=>{e.uri&&(e.resolvedUri=Je(i.uri,e.uri))})},Xm=(i,e)=>{const t=li(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:V.location.href,resolvedUri:V.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return n.playlists[t]=n.playlists[0],n.playlists[e]=n.playlists[0],n},al=(i,e,t=rl)=>{i.uri=e;for(let r=0;r<i.playlists.length;r++)if(!i.playlists[r].uri){const s=`placeholder-uri-${r}`;i.playlists[r].uri=s}const n=Vi(i);fi(i,(r,s,o,d)=>{if(!r.playlists||!r.playlists.length){if(n&&s==="AUDIO"&&!r.uri)for(let f=0;f<i.playlists.length;f++){const h=i.playlists[f];if(h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===o)return}r.playlists=[Qe({},r)]}r.playlists.forEach(function(f,h){const p=t(s,o,d,f),y=li(h,p);f.uri?f.resolvedUri=f.resolvedUri||Je(i.uri,f.uri):(f.uri=h===0?p:y,f.resolvedUri=f.uri),f.id=f.id||y,f.attributes=f.attributes||{},i.playlists[f.id]=f,i.playlists[f.uri]=f})}),Qm(i),Ym(i)};class va{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((r,s)=>(r.set(s.id,s),r),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,r)=>{if(!this.processedDateRanges_.has(r)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),!!n.class))if(e[n.class]){const s=e[n.class].push(n);n.classListIndex=s-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const r=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&r[n.classListIndex+1]?n.endTime=r[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((n,r)=>{n.startDate.getTime()<e&&this.processedDateRanges_.delete(r)})}}const ol=22,ti=({requestType:i,request:e,error:t,parseFailure:n})=>{const r=e.status<200||e.status>299,s=e.status>=400&&e.status<=499,o={uri:e.uri,requestType:i},d=r&&!s||n;if(t&&s)o.error=Qe({},t),o.errorType=H.Error.NetworkRequestFailed;else if(e.aborted)o.errorType=H.Error.NetworkRequestAborted;else if(e.timedout)o.errorType=H.Error.NetworkRequestTimeout;else if(d){const f=n?H.Error.NetworkBodyParserFailed:H.Error.NetworkBadStatus;o.errorType=f,o.status=e.status,o.headers=e.headers}return o},Km=ot("CodecUtils"),ll=function(i){const e=i.attributes||{};if(e.CODECS)return Rt(e.CODECS)},dl=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},Jm=(i,e)=>{if(!dl(i,e))return!0;const t=e.attributes||{},n=i.mediaGroups.AUDIO[t.AUDIO];for(const r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1},qi=function(i){const e={};return i.forEach(({mediaType:t,type:n,details:r})=>{e[t]=e[t]||[],e[t].push(sh(`${n}${r}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){Km(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},ba=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},$i=function(i,e){const t=e.attributes||{},n=qi(ll(e)||[]);if(dl(i,e)&&!n.audio&&!Jm(i,e)){const r=qi(rh(i,t.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},{EventTarget:Zm}=H,ep=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let r=e.mediaSequence+e.segments.length;if(n){const s=n.parts||[],o=Xo(e)-1;o>-1&&o!==s.length-1&&(t._HLS_part=o),(o>-1||s.length)&&r--}t._HLS_msn=r}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const n=new V.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(r){t.hasOwnProperty(r)&&n.searchParams.set(r,t[r])}),i=n.toString()}return i},tp=(i,e)=>{if(!i)return e;const t=le(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let n=0;n<e.parts.length;n++)i.parts&&i.parts[n]&&(t.parts[n]=le(i.parts[n],e.parts[n]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},ip=(i,e,t)=>{const n=i.slice(),r=e.slice();t=t||0;const s=[];let o;for(let d=0;d<r.length;d++){const f=n[d+t],h=r[d];f?(o=f.map||o,s.push(tp(f,h))):(o&&!h.map&&(h.map=o),s.push(h))}return s},ul=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=Je(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=Je(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=Je(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=Je(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Je(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Je(e,t.uri))})},cl=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let n=0;n<t.preloadHints.length;n++)if(t.preloadHints[n].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},hl=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,Fr=(i,e,t=hl)=>{const n=le(i,{}),r=n.playlists[e.id];if(!r||t(r,e))return null;e.segments=cl(e);const s=le(r,e);if(s.preloadSegment&&!e.preloadSegment&&delete s.preloadSegment,r.segments){if(e.skip){e.segments=e.segments||[];for(let o=0;o<e.skip.skippedSegments;o++)e.segments.unshift({skipped:!0})}s.segments=ip(r.segments,e.segments,e.mediaSequence-r.mediaSequence)}s.segments.forEach(o=>{ul(o,s.resolvedUri)});for(let o=0;o<n.playlists.length;o++)n.playlists[o].id===e.id&&(n.playlists[o]=s);return n.playlists[e.id]=s,n.playlists[e.uri]=s,fi(i,(o,d,f,h)=>{if(o.playlists)for(let p=0;p<o.playlists.length;p++)e.id===o.playlists[p].id&&(o.playlists[p]=s)}),n},qr=(i,e)=>{const t=i.segments||[],n=t[t.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return e&&s?s*1e3:(i.partTargetDuration||i.targetDuration||10)*500},Sa=(i,e,t)=>{if(!i)return;const n=[];return i.forEach(r=>{if(!r.attributes)return;const{BANDWIDTH:s,RESOLUTION:o,CODECS:d}=r.attributes;n.push({id:r.id,bandwidth:s,resolution:o,codecs:d})}),{type:e,isLive:t,renditions:n}};class oi extends Zm{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=ot("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const s=t.options_;this.customTagParsers=s&&s.customTagParsers||[],this.customTagMappers=s&&s.customTagMappers||[],this.llhls=s&&s.llhls,this.dateRangesStorage_=new va,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Je(this.main.uri,e.uri);this.llhls&&(t=ep(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(n,r)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,n){const{uri:r,id:s}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[s],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:ti({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const n=Gm({onwarn:({message:r})=>this.logger_(`m3u8-parser warn for ${e}: ${r}`),oninfo:({message:r})=>this.logger_(`m3u8-parser info for ${e}: ${r}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return!n.playlists||!n.playlists.length||this.excludeAudioOnlyVariants(n.playlists),n}catch(n){this.error=n,this.error.metadata={errorType:H.Error.StreamingHlsPlaylistParserError,error:n}}}excludeAudioOnlyVariants(e){const t=n=>{const r=n.attributes||{},{width:s,height:o}=r.RESOLUTION||{};if(s&&o)return!0;const d=ll(n)||[];return!!qi(d).video};e.some(t)&&e.forEach(n=>{t(n)||(n.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const s={playlistInfo:{type:"media",uri:n}};this.trigger({type:"playlistparsestart",metadata:s});const o=t||this.parseManifest_({url:n,manifestString:e});o.lastRequest=Date.now(),sl({playlist:o,uri:n,id:r});const d=Fr(this.main,o);this.targetDuration=o.partTargetDuration||o.targetDuration,this.pendingMedia_=null,d?(this.main=d,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(qr(this.media(),!!d)),s.parsedPlaylist=Sa(this.main.playlists,s.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:s}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),V.clearTimeout(this.mediaUpdateTimeout),V.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new va,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(V.clearTimeout(this.finalRenditionTimeout),t){const d=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=V.setTimeout(this.media.bind(this,e,!1),d);return}const n=this.state,r=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(qr(e,!0)),!r)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const o={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:o}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(d,f)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=jn(e.resolvedUri,f),d)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:o}),this.haveMetadata({playlistString:f.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const n=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=V.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=V.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=V.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:n.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:n.responseText,code:2,metadata:ti({requestType:n.requestType,request:n,error:t})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=jn(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const r=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=Sa(r.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(r)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,al(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=cl(n),n.segments.forEach(r=>{ul(r,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||V.location.href;this.main=Xm(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,r=e.ID;let s=n.playlists.length;for(;s--;){const o=n.playlists[s];if(o.attributes["PATHWAY-ID"]===r){const d=o.resolvedUri,f=o.id;if(t){const h=this.createCloneURI_(o.resolvedUri,e),p=li(r,h),y=this.createCloneAttributes_(r,o.attributes),w=this.createClonePlaylist_(o,p,e,y);n.playlists[s]=w,n.playlists[p]=w,n.playlists[h]=w}else n.playlists.splice(s,1);delete n.playlists[f],delete n.playlists[d]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,r=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{if(!(!n.mediaGroups[s]||!n.mediaGroups[s][r])){for(const o in n.mediaGroups[s])if(o===r){for(const d in n.mediaGroups[s][o])n.mediaGroups[s][o][d].playlists.forEach((h,p)=>{const y=n.playlists[h.id],w=y.id,P=y.resolvedUri;delete n.playlists[w],delete n.playlists[P]});delete n.mediaGroups[s][o]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,r=n.playlists.length,s=this.createCloneURI_(t.resolvedUri,e),o=li(e.ID,s),d=this.createCloneAttributes_(e.ID,t.attributes),f=this.createClonePlaylist_(t,o,e,d);n.playlists[r]=f,n.playlists[o]=f,n.playlists[s]=f,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],r=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{if(!(!r.mediaGroups[s]||r.mediaGroups[s][t]))for(const o in r.mediaGroups[s]){if(o===n)r.mediaGroups[s][t]={};else continue;for(const d in r.mediaGroups[s][o]){const f=r.mediaGroups[s][o][d];r.mediaGroups[s][t][d]=Qe({},f);const h=r.mediaGroups[s][t][d],p=this.createCloneURI_(f.resolvedUri,e);h.resolvedUri=p,h.uri=p,h.playlists=[],f.playlists.forEach((y,w)=>{const P=r.playlists[y.id],_=rl(s,t,d),v=li(t,_);if(P&&!r.playlists[v]){const b=this.createClonePlaylist_(P,v,e),T=b.resolvedUri;r.playlists[v]=b,r.playlists[T]=b}h.playlists[w]=this.createClonePlaylist_(y,v,e)})}}})}createClonePlaylist_(e,t,n,r){const s=this.createCloneURI_(e.resolvedUri,n),o={resolvedUri:s,uri:s,id:t};return e.segments&&(o.segments=[]),r&&(o.attributes=r),le(e,o)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const r=t["URI-REPLACEMENT"].PARAMS;for(const s of Object.keys(r))n.searchParams.set(s,r[s]);return n.href}createCloneAttributes_(e,t){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{t[r]&&(n[r]=e)}),n}getKeyIdSet(e){const t=new Set;if(!e||!e.contentProtection)return t;for(const n in e.contentProtection)if(e.contentProtection[n]&&e.contentProtection[n].attributes&&e.contentProtection[n].attributes.keyId){const r=e.contentProtection[n].attributes.keyId;t.add(r.toLowerCase())}return t}}const Wr=function(i,e,t,n){const r=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&r&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=r.byteLength||r.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(r||i.responseText)))),n(e,i)},np=(i,e)=>{if(!i||!i.size)return;let t=e;return i.forEach(n=>{t=n(t)}),t},rp=(i,e,t,n)=>{!i||!i.size||i.forEach(r=>{r(e,t,n)})},fl=function(){const i=function e(t,n){t=le({timeout:45e3},t);const r=e.beforeRequest||H.Vhs.xhr.beforeRequest,s=e._requestCallbackSet||H.Vhs.xhr._requestCallbackSet||new Set,o=e._responseCallbackSet||H.Vhs.xhr._responseCallbackSet;r&&typeof r=="function"&&(H.log.warn("beforeRequest is deprecated, use onRequest instead."),s.add(r));const d=H.Vhs.xhr.original===!0?H.xhr:H.Vhs.xhr,f=np(s,t);s.delete(r);const h=d(f||t,function(y,w){return rp(o,h,y,w),Wr(h,y,w,n)}),p=h.abort;return h.abort=function(){return h.aborted=!0,p.apply(h,arguments)},h.uri=t.uri,h.requestType=t.requestType,h.requestTime=Date.now(),h};return i.original=!0,i},sp=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=V.BigInt(i.offset)+V.BigInt(i.length)-V.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},Vr=function(i){const e={};return i.byterange&&(e.Range=sp(i.byterange)),e},ap=function(i,e){return i.start(e)+"-"+i.end(e)},op=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},lp=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},ml=function(i){const e={};return Object.keys(i).forEach(t=>{const n=i[t];lh(n)?e[t]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[t]=n}),e},$n=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},pl=function(i){return i.resolvedUri},gl=i=>{const e=Array.prototype.slice.call(i),t=16;let n="",r,s;for(let o=0;o<e.length/t;o++)r=e.slice(o*t,o*t+t).map(op).join(""),s=e.slice(o*t,o*t+t).map(lp).join(""),n+=r+" "+s+`
`;return n},dp=({bytes:i})=>gl(i),up=i=>{let e="",t;for(t=0;t<i.length;t++)e+=ap(i,t)+" ";return e};var cp=Object.freeze({__proto__:null,createTransferableMessage:ml,initSegmentId:$n,segmentKeyId:pl,hexDump:gl,tagDump:dp,textRanges:up});const yl=.25,hp=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,r=e.videoTimingInfo.transmuxedPresentationStart+t,s=i-r;return new Date(e.dateTimeObject.getTime()+s*1e3)},fp=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,mp=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(t<new Date(n.dateTimeObject))return null;for(let f=0;f<e.segments.length-1;f++){n=e.segments[f];const h=new Date(e.segments[f+1].dateTimeObject);if(t<h)break}const r=e.segments[e.segments.length-1],s=r.dateTimeObject,o=r.videoTimingInfo?fp(r.videoTimingInfo):r.duration+r.duration*yl,d=new Date(s.getTime()+o*1e3);return t>d?null:(t>new Date(s)&&(n=r),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:et.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},pp=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,n;for(let s=0;s<e.segments.length&&(n=e.segments[s],t=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:t+n.duration,!(i<=t));s++);const r=e.segments[e.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+r.duration*yl)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:t-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},gp=(i,e)=>{let t,n;try{t=new Date(i),n=new Date(e)}catch{}const r=t.getTime();return(n.getTime()-r)/1e3},yp=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},_p=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const n=pp(e,i);if(!n)return t({message:"valid programTime was not found"});if(n.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const r={mediaSeconds:e},s=hp(e,n.segment);return s&&(r.programDateTime=s.toISOString()),t(null,r)},_l=({programTime:i,playlist:e,retryCount:t=2,seekTo:n,pauseAfterSeek:r=!0,tech:s,callback:o})=>{if(!o)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!n)return o({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!s.hasStarted_)return o({message:"player must be playing a live stream to start buffering"});if(!yp(e))return o({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const d=mp(i,e);if(!d)return o({message:`${i} was not found in the stream`});const f=d.segment,h=gp(f.dateTimeObject,i);if(d.type==="estimate"){if(t===0)return o({message:`${i} is not buffered yet. Try again`});n(d.estimatedStart+h),s.one("seeked",()=>{_l({programTime:i,playlist:e,retryCount:t-1,seekTo:n,pauseAfterSeek:r,tech:s,callback:o})});return}const p=f.start+h,y=()=>o(null,s.currentTime());s.one("seeked",y),r&&s.pause(),n(p)},br=(i,e)=>{if(i.readyState===4)return e()},vp=(i,e,t,n)=>{let r=[],s,o=!1;const d=function(y,w,P,_){return w.abort(),o=!0,t(y,w,P,_)},f=function(y,w){if(o)return;if(y)return y.metadata=ti({requestType:n,request:w,error:y}),d(y,w,"",r);const P=w.responseText.substring(r&&r.byteLength||0,w.responseText.length);if(r=dh(r,uh(P,!0)),s=s||ch(r),r.length<10||s&&r.length<s+2)return br(w,()=>d(y,w,"",r));const _=rs(r);return _==="ts"&&r.length<188?br(w,()=>d(y,w,"",r)):!_&&r.length<376?br(w,()=>d(y,w,"",r)):d(null,w,_,r)},p=e({uri:i,beforeSend(y){y.overrideMimeType("text/plain; charset=x-user-defined"),y.addEventListener("progress",function({total:w,loaded:P}){return Wr(y,null,{statusCode:y.status},f)})}},function(y,w){return Wr(p,y,w,f)});return p},{EventTarget:bp}=H,Ta=function(i,e){if(!hl(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const n=i.segments[t],r=e.segments[t];if(n.uri!==r.uri)return!1;if(!n.byterange&&!r.byterange)continue;const s=n.byterange,o=r.byterange;if(s&&!o||!s&&o||s.offset!==o.offset||s.length!==o.length)return!1}return!0},Sp=(i,e,t,n)=>{const r=n.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${r}`},Tp=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:n,previousManifest:r})=>{const s=ah(i,{manifestUri:e,clientOffset:t,sidxMapping:n,previousManifest:r});return al(s,e,Sp),s},wp=(i,e)=>{fi(i,(t,n,r,s)=>{(!e.mediaGroups[n][r]||!(s in e.mediaGroups[n][r]))&&delete i.mediaGroups[n][r][s]})},xp=(i,e,t)=>{let n=!0,r=le(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let s=0;s<e.playlists.length;s++){const o=e.playlists[s];if(o.sidx){const f=ns(o.sidx);t&&t[f]&&t[f].sidx&&Bo(o,t[f].sidx,o.sidx.resolvedUri)}const d=Fr(r,o,Ta);d&&(r=d,n=!1)}return fi(e,(s,o,d,f)=>{if(s.playlists&&s.playlists.length){const h=s.playlists[0].id,p=Fr(r,s.playlists[0],Ta);p&&(r=p,f in r.mediaGroups[o][d]||(r.mediaGroups[o][d][f]=s),r.mediaGroups[o][d][f].playlists[0]=r.playlists[h],n=!1)}}),wp(r,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(n=!1),n?null:r},Ep=(i,e)=>(!i.map&&!e.map||!!(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,wa=(i,e)=>{const t={};for(const n in i){const s=i[n].sidx;if(s){const o=ns(s);if(!e[o])break;const d=e[o].sidxInfo;Ep(d,s)&&(t[o]=e[o])}}return t},Pp=(i,e)=>{let n=wa(i.playlists,e);return fi(i,(r,s,o,d)=>{if(r.playlists&&r.playlists.length){const f=r.playlists;n=le(n,wa(f,e))}}),n};class Hr extends bp{constructor(e,t,n={},r){super(),this.isPaused_=!0,this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:s=!1}=n;if(this.vhs_=t,this.withCredentials=s,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=ot("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,t,n){const r=e.sidx&&ns(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r]){V.clearTimeout(this.mediaRequest_),this.mediaRequest_=V.setTimeout(()=>n(!1),0);return}const s=jn(e.sidx.resolvedUri),o=(f,h)=>{if(this.requestErrored_(f,h,t))return;const p=this.mainPlaylistLoader_.sidxMapping_,{requestType:y}=h;let w;try{w=fh(mh(h.response).subarray(8))}catch(P){P.metadata=ti({requestType:y,request:h,parseFailure:!0}),this.requestErrored_(P,h,t);return}return p[r]={sidxInfo:e.sidx,sidx:w},Bo(e,w,e.sidx.resolvedUri),n(!0)},d="dash-sidx";this.request=vp(s,this.vhs_.xhr,(f,h,p,y)=>{if(f)return o(f,h);if(!p||p!=="mp4"){const _=p||"unknown";return o({status:h.status,message:`Unsupported ${_} container type for sidx segment at URL: ${s}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},h)}const{offset:w,length:P}=e.sidx.byterange;if(y.length>=P+w)return o(f,{response:y.subarray(w,w+P),status:h.status,uri:h.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",requestType:"dash-sidx",headers:Vr({byterange:e.sidx.byterange})},o)},d)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},V.clearTimeout(this.minimumUpdatePeriodTimeout_),V.clearTimeout(this.mediaRequest_),V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,r=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,V.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(V.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){this.isPaused_=!1,V.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const n=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=V.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){V.clearTimeout(this.mediaRequest_),this.mediaRequest_=V.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,r)=>{if(n){const{requestType:o}=r;n.metadata=ti({requestType:o,request:r,error:n})}if(this.requestErrored_(n,r)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:t});const s=r.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=r.responseText,r.responseHeaders&&r.responseHeaders.date?this.mainLoaded_=Date.parse(r.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=jn(this.mainPlaylistLoader_.srcUrl,r),s){this.handleMain_(),this.syncClientServerClock_(()=>e(r,s));return}return e(r,s)})}syncClientServerClock_(e){const t=nh(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Je(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,r)=>{if(!this.request)return;if(n){const{requestType:o}=r;return this.error.metadata=ti({requestType:o,request:r,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let s;t.method==="HEAD"?!r.responseHeaders||!r.responseHeaders.date?s=this.mainLoaded_:s=Date.parse(r.responseHeaders.date):s=Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=s-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){V.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:t});let n;try{n=Tp({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(s){this.error=s,this.error.metadata={errorType:H.Error.StreamingDashManifestParserError,error:s},this.trigger("error")}e&&(n=xp(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const r=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(r&&r!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=r),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:s,endList:o}=n,d=[];n.playlists.forEach(h=>{d.push({id:h.id,bandwidth:h.attributes.BANDWIDTH,resolution:h.attributes.RESOLUTION,codecs:h.attributes.CODECS})});const f={duration:s,isLive:!o,renditions:d};t.parsedManifest=f,this.trigger({type:"manifestparsecomplete",metadata:t})}return!!n}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(V.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=V.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=Pp(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const r=()=>{this.media().endList||(this.mediaUpdateTimeout=V.setTimeout(()=>{this.trigger("mediaupdatetimeout"),r()},qr(this.media(),!!n)))};r()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(n=>({cueTime:n.start,frames:[{data:n.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const r=e.contentProtection[n].attributes["cenc:default_KID"];r&&t.add(r.replace(/-/g,"").toLowerCase())}return t}}}var Ue={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const Cp=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},vl=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},Ip=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},bl=function(i){return function(){const e=Ip(i),t=vl(new Worker(e));t.objURL=e;const n=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},t}},Sl=function(i){return`var browserWorkerPolyFill = ${vl.toString()};
browserWorkerPolyFill(self);
`+i},Tl=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},Dp=Sl(Tl(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=function(){this.init=function(){var a={};this.on=function(l,c){a[l]||(a[l]=[]),a[l]=a[l].concat(c)},this.off=function(l,c){var u;return a[l]?(u=a[l].indexOf(c),a[l]=a[l].slice(),a[l].splice(u,1),u>-1):!1},this.trigger=function(l){var c,u,m,g;if(c=a[l],!!c)if(arguments.length===2)for(m=c.length,u=0;u<m;++u)c[u].call(this,arguments[1]);else{for(g=[],u=arguments.length,u=1;u<arguments.length;++u)g.push(arguments[u]);for(m=c.length,u=0;u<m;++u)c[u].apply(this,g)}},this.dispose=function(){a={}}}};e.prototype.pipe=function(a){return this.on("data",function(l){a.push(l)}),this.on("done",function(l){a.flush(l)}),this.on("partialdone",function(l){a.partialFlush(l)}),this.on("endedtimeline",function(l){a.endTimeline(l)}),this.on("reset",function(l){a.reset(l)}),a},e.prototype.push=function(a){this.trigger("data",a)},e.prototype.flush=function(a){this.trigger("done",a)},e.prototype.partialFlush=function(a){this.trigger("partialdone",a)},e.prototype.endTimeline=function(a){this.trigger("endedtimeline",a)},e.prototype.reset=function(a){this.trigger("reset",a)};var t=e,n=Math.pow(2,32),r=function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),c;return l.getBigUint64?(c=l.getBigUint64(0),c<Number.MAX_SAFE_INTEGER?Number(c):c):l.getUint32(0)*n+l.getUint32(4)},s={getUint64:r,MAX_UINT32:n},o=s.MAX_UINT32,d,f,h,p,y,w,P,_,v,b,T,C,M,L,k,R,A,O,B,N,j,W,F,z,K,J,Z,se,ae,ce,fe,ee,ye,ge,oe,xe;(function(){var a;if(F={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(a in F)F.hasOwnProperty(a)&&(F[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);z=new Uint8Array([105,115,111,109]),J=new Uint8Array([97,118,99,49]),K=new Uint8Array([0,0,0,1]),Z=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),se=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ae={video:Z,audio:se},ee=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),fe=new Uint8Array([0,0,0,0,0,0,0,0]),ye=new Uint8Array([0,0,0,0,0,0,0,0]),ge=ye,oe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),xe=ye,ce=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),d=function(a){var l=[],c=0,u,m,g;for(u=1;u<arguments.length;u++)l.push(arguments[u]);for(u=l.length;u--;)c+=l[u].byteLength;for(m=new Uint8Array(c+8),g=new DataView(m.buffer,m.byteOffset,m.byteLength),g.setUint32(0,m.byteLength),m.set(a,4),u=0,c=8;u<l.length;u++)m.set(l[u],c),c+=l[u].byteLength;return m},f=function(){return d(F.dinf,d(F.dref,ee))},h=function(a){return d(F.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,a.audioobjecttype<<3|a.samplingfrequencyindex>>>1,a.samplingfrequencyindex<<7|a.channelcount<<3,6,1,2]))},p=function(){return d(F.ftyp,z,K,z,J)},R=function(a){return d(F.hdlr,ae[a])},y=function(a){return d(F.mdat,a)},k=function(a){var l=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,a.duration>>>24&255,a.duration>>>16&255,a.duration>>>8&255,a.duration&255,85,196,0,0]);return a.samplerate&&(l[12]=a.samplerate>>>24&255,l[13]=a.samplerate>>>16&255,l[14]=a.samplerate>>>8&255,l[15]=a.samplerate&255),d(F.mdhd,l)},L=function(a){return d(F.mdia,k(a),R(a.type),P(a))},w=function(a){return d(F.mfhd,new Uint8Array([0,0,0,0,(a&4278190080)>>24,(a&16711680)>>16,(a&65280)>>8,a&255]))},P=function(a){return d(F.minf,a.type==="video"?d(F.vmhd,ce):d(F.smhd,fe),f(),O(a))},_=function(a,l){for(var c=[],u=l.length;u--;)c[u]=N(l[u]);return d.apply(null,[F.moof,w(a)].concat(c))},v=function(a){for(var l=a.length,c=[];l--;)c[l]=C(a[l]);return d.apply(null,[F.moov,T(4294967295)].concat(c).concat(b(a)))},b=function(a){for(var l=a.length,c=[];l--;)c[l]=j(a[l]);return d.apply(null,[F.mvex].concat(c))},T=function(a){var l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(a&4278190080)>>24,(a&16711680)>>16,(a&65280)>>8,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d(F.mvhd,l)},A=function(a){var l=a.samples||[],c=new Uint8Array(4+l.length),u,m;for(m=0;m<l.length;m++)u=l[m].flags,c[m+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return d(F.sdtp,c)},O=function(a){return d(F.stbl,B(a),d(F.stts,xe),d(F.stsc,ge),d(F.stsz,oe),d(F.stco,ye))},(function(){var a,l;B=function(c){return d(F.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),c.type==="video"?a(c):l(c))},a=function(c){var u=c.sps||[],m=c.pps||[],g=[],S=[],x,I;for(x=0;x<u.length;x++)g.push((u[x].byteLength&65280)>>>8),g.push(u[x].byteLength&255),g=g.concat(Array.prototype.slice.call(u[x]));for(x=0;x<m.length;x++)S.push((m[x].byteLength&65280)>>>8),S.push(m[x].byteLength&255),S=S.concat(Array.prototype.slice.call(m[x]));if(I=[F.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(c.width&65280)>>8,c.width&255,(c.height&65280)>>8,c.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d(F.avcC,new Uint8Array([1,c.profileIdc,c.profileCompatibility,c.levelIdc,255].concat([u.length],g,[m.length],S))),d(F.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],c.sarRatio){var D=c.sarRatio[0],U=c.sarRatio[1];I.push(d(F.pasp,new Uint8Array([(D&4278190080)>>24,(D&16711680)>>16,(D&65280)>>8,D&255,(U&4278190080)>>24,(U&16711680)>>16,(U&65280)>>8,U&255])))}return d.apply(null,I)},l=function(c){return d(F.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(c.channelcount&65280)>>8,c.channelcount&255,(c.samplesize&65280)>>8,c.samplesize&255,0,0,0,0,(c.samplerate&65280)>>8,c.samplerate&255,0,0]),h(c))}})(),M=function(a){var l=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,0,(a.duration&4278190080)>>24,(a.duration&16711680)>>16,(a.duration&65280)>>8,a.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(a.width&65280)>>8,a.width&255,0,0,(a.height&65280)>>8,a.height&255,0,0]);return d(F.tkhd,l)},N=function(a){var l,c,u,m,g,S,x;return l=d(F.tfhd,new Uint8Array([0,0,0,58,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),S=Math.floor(a.baseMediaDecodeTime/o),x=Math.floor(a.baseMediaDecodeTime%o),c=d(F.tfdt,new Uint8Array([1,0,0,0,S>>>24&255,S>>>16&255,S>>>8&255,S&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255])),g=92,a.type==="audio"?(u=W(a,g),d(F.traf,l,c,u)):(m=A(a),u=W(a,m.length+g),d(F.traf,l,c,u,m))},C=function(a){return a.duration=a.duration||4294967295,d(F.trak,M(a),L(a))},j=function(a){var l=new Uint8Array([0,0,0,0,(a.id&4278190080)>>24,(a.id&16711680)>>16,(a.id&65280)>>8,a.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return a.type!=="video"&&(l[l.length-1]=0),d(F.trex,l)},(function(){var a,l,c;c=function(u,m){var g=0,S=0,x=0,I=0;return u.length&&(u[0].duration!==void 0&&(g=1),u[0].size!==void 0&&(S=2),u[0].flags!==void 0&&(x=4),u[0].compositionTimeOffset!==void 0&&(I=8)),[0,0,g|S|x|I,1,(u.length&4278190080)>>>24,(u.length&16711680)>>>16,(u.length&65280)>>>8,u.length&255,(m&4278190080)>>>24,(m&16711680)>>>16,(m&65280)>>>8,m&255]},l=function(u,m){var g,S,x,I,D,U;for(I=u.samples||[],m+=20+16*I.length,x=c(I,m),S=new Uint8Array(x.length+I.length*16),S.set(x),g=x.length,U=0;U<I.length;U++)D=I[U],S[g++]=(D.duration&4278190080)>>>24,S[g++]=(D.duration&16711680)>>>16,S[g++]=(D.duration&65280)>>>8,S[g++]=D.duration&255,S[g++]=(D.size&4278190080)>>>24,S[g++]=(D.size&16711680)>>>16,S[g++]=(D.size&65280)>>>8,S[g++]=D.size&255,S[g++]=D.flags.isLeading<<2|D.flags.dependsOn,S[g++]=D.flags.isDependedOn<<6|D.flags.hasRedundancy<<4|D.flags.paddingValue<<1|D.flags.isNonSyncSample,S[g++]=D.flags.degradationPriority&61440,S[g++]=D.flags.degradationPriority&15,S[g++]=(D.compositionTimeOffset&4278190080)>>>24,S[g++]=(D.compositionTimeOffset&16711680)>>>16,S[g++]=(D.compositionTimeOffset&65280)>>>8,S[g++]=D.compositionTimeOffset&255;return d(F.trun,S)},a=function(u,m){var g,S,x,I,D,U;for(I=u.samples||[],m+=20+8*I.length,x=c(I,m),g=new Uint8Array(x.length+I.length*8),g.set(x),S=x.length,U=0;U<I.length;U++)D=I[U],g[S++]=(D.duration&4278190080)>>>24,g[S++]=(D.duration&16711680)>>>16,g[S++]=(D.duration&65280)>>>8,g[S++]=D.duration&255,g[S++]=(D.size&4278190080)>>>24,g[S++]=(D.size&16711680)>>>16,g[S++]=(D.size&65280)>>>8,g[S++]=D.size&255;return d(F.trun,g)},W=function(u,m){return u.type==="audio"?a(u,m):l(u,m)}})();var ke={ftyp:p,mdat:y,moof:_,moov:v,initSegment:function(a){var l=p(),c=v(a),u;return u=new Uint8Array(l.byteLength+c.byteLength),u.set(l),u.set(c,l.byteLength),u}},de=function(a){var l,c,u=[],m=[];for(m.byteLength=0,m.nalCount=0,m.duration=0,u.byteLength=0,l=0;l<a.length;l++)c=a[l],c.nalUnitType==="access_unit_delimiter_rbsp"?(u.length&&(u.duration=c.dts-u.dts,m.byteLength+=u.byteLength,m.nalCount+=u.length,m.duration+=u.duration,m.push(u)),u=[c],u.byteLength=c.data.byteLength,u.pts=c.pts,u.dts=c.dts):(c.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(u.keyFrame=!0),u.duration=c.dts-u.dts,u.byteLength+=c.data.byteLength,u.push(c));return m.length&&(!u.duration||u.duration<=0)&&(u.duration=m[m.length-1].duration),m.byteLength+=u.byteLength,m.nalCount+=u.length,m.duration+=u.duration,m.push(u),m},he=function(a){var l,c,u=[],m=[];for(u.byteLength=0,u.nalCount=0,u.duration=0,u.pts=a[0].pts,u.dts=a[0].dts,m.byteLength=0,m.nalCount=0,m.duration=0,m.pts=a[0].pts,m.dts=a[0].dts,l=0;l<a.length;l++)c=a[l],c.keyFrame?(u.length&&(m.push(u),m.byteLength+=u.byteLength,m.nalCount+=u.nalCount,m.duration+=u.duration),u=[c],u.nalCount=c.length,u.byteLength=c.byteLength,u.pts=c.pts,u.dts=c.dts,u.duration=c.duration):(u.duration+=c.duration,u.nalCount+=c.length,u.byteLength+=c.byteLength,u.push(c));return m.length&&u.duration<=0&&(u.duration=m[m.length-1].duration),m.byteLength+=u.byteLength,m.nalCount+=u.nalCount,m.duration+=u.duration,m.push(u),m},Ee=function(a){var l;return!a[0][0].keyFrame&&a.length>1&&(l=a.shift(),a.byteLength-=l.byteLength,a.nalCount-=l.nalCount,a[0][0].dts=l.dts,a[0][0].pts=l.pts,a[0][0].duration+=l.duration),a},De=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},re=function(a,l){var c=De();return c.dataOffset=l,c.compositionTimeOffset=a.pts-a.dts,c.duration=a.duration,c.size=4*a.length,c.size+=a.byteLength,a.keyFrame&&(c.flags.dependsOn=2,c.flags.isNonSyncSample=0),c},Ae=function(a,l){var c,u,m,g,S,x=l||0,I=[];for(c=0;c<a.length;c++)for(g=a[c],u=0;u<g.length;u++)S=g[u],m=re(S,x),x+=m.size,I.push(m);return I},Ne=function(a){var l,c,u,m,g,S,x=0,I=a.byteLength,D=a.nalCount,U=I+4*D,$=new Uint8Array(U),Q=new DataView($.buffer);for(l=0;l<a.length;l++)for(m=a[l],c=0;c<m.length;c++)for(g=m[c],u=0;u<g.length;u++)S=g[u],Q.setUint32(x,S.data.byteLength),x+=4,$.set(S.data,x),x+=S.data.byteLength;return $},Me=function(a,l){var c,u=l||0,m=[];return c=re(a,u),m.push(c),m},Bt=function(a){var l,c,u=0,m=a.byteLength,g=a.length,S=m+4*g,x=new Uint8Array(S),I=new DataView(x.buffer);for(l=0;l<a.length;l++)c=a[l],I.setUint32(u,c.data.byteLength),u+=4,x.set(c.data,u),u+=c.data.byteLength;return x},Se={groupNalsIntoFrames:de,groupFramesIntoGops:he,extendFirstKeyFrame:Ee,generateSampleTable:Ae,concatenateNalData:Ne,generateSampleTableForFrame:Me,concatenateNalDataForFrame:Bt},me=[33,16,5,32,164,27],Oe=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ne=function(a){for(var l=[];a--;)l.push(0);return l},Xn=function(a){return Object.keys(a).reduce(function(l,c){return l[c]=new Uint8Array(a[c].reduce(function(u,m){return u.concat(m)},[])),l},{})},Ce,Xe=function(){if(!Ce){var a={96e3:[me,[227,64],ne(154),[56]],88200:[me,[231],ne(170),[56]],64e3:[me,[248,192],ne(240),[56]],48e3:[me,[255,192],ne(268),[55,148,128],ne(54),[112]],44100:[me,[255,192],ne(268),[55,163,128],ne(84),[112]],32e3:[me,[255,192],ne(268),[55,234],ne(226),[112]],24e3:[me,[255,192],ne(268),[55,255,128],ne(268),[111,112],ne(126),[224]],16e3:[me,[255,192],ne(268),[55,255,128],ne(268),[111,255],ne(269),[223,108],ne(195),[1,192]],12e3:[Oe,ne(268),[3,127,248],ne(268),[6,255,240],ne(268),[13,255,224],ne(268),[27,253,128],ne(259),[56]],11025:[Oe,ne(268),[3,127,248],ne(268),[6,255,240],ne(268),[13,255,224],ne(268),[27,255,192],ne(268),[55,175,128],ne(108),[112]],8e3:[Oe,ne(268),[3,121,16],ne(47),[7]]};Ce=Xn(a)}return Ce},Fe=9e4,pt,Kn,Hi,Jn,_s,vs,bs;pt=function(a){return a*Fe},Kn=function(a,l){return a*l},Hi=function(a){return a/Fe},Jn=function(a,l){return a/l},_s=function(a,l){return pt(Jn(a,l))},vs=function(a,l){return Kn(Hi(a),l)},bs=function(a,l,c){return Hi(c?a:a-l)};var _e={ONE_SECOND_IN_TS:Fe,secondsToVideoTs:pt,secondsToAudioTs:Kn,videoTsToSeconds:Hi,audioTsToSeconds:Jn,audioTsToVideoTs:_s,videoTsToAudioTs:vs,metadataTsToSeconds:bs},Jl=Xe,zi=_e,Zl=function(a){var l,c,u=0;for(l=0;l<a.length;l++)c=a[l],u+=c.data.byteLength;return u},ed=function(a,l,c,u){var m,g=0,S=0,x=0,I=0,D,U,$;if(l.length&&(m=zi.audioTsToVideoTs(a.baseMediaDecodeTime,a.samplerate),g=Math.ceil(zi.ONE_SECOND_IN_TS/(a.samplerate/1024)),c&&u&&(S=m-Math.max(c,u),x=Math.floor(S/g),I=x*g),!(x<1||I>zi.ONE_SECOND_IN_TS/2))){for(D=Jl()[a.samplerate],D||(D=l[0].data),U=0;U<x;U++)$=l[0],l.splice(0,0,{data:D,dts:$.dts-g,pts:$.pts-g});return a.baseMediaDecodeTime-=Math.floor(zi.videoTsToAudioTs(I,a.samplerate)),I}},td=function(a,l,c){return l.minSegmentDts>=c?a:(l.minSegmentDts=1/0,a.filter(function(u){return u.dts>=c?(l.minSegmentDts=Math.min(l.minSegmentDts,u.dts),l.minSegmentPts=l.minSegmentDts,!0):!1}))},id=function(a){var l,c,u=[];for(l=0;l<a.length;l++)c=a[l],u.push({size:c.data.byteLength,duration:1024});return u},nd=function(a){var l,c,u=0,m=new Uint8Array(Zl(a));for(l=0;l<a.length;l++)c=a[l],m.set(c.data,u),u+=c.data.byteLength;return m},rd={prefixWithSilence:ed,trimAdtsFramesByEarliestDts:td,generateSampleTable:id,concatenateFrameData:nd},sd=_e.ONE_SECOND_IN_TS,ad=function(a,l){typeof l.pts=="number"&&(a.timelineStartInfo.pts===void 0&&(a.timelineStartInfo.pts=l.pts),a.minSegmentPts===void 0?a.minSegmentPts=l.pts:a.minSegmentPts=Math.min(a.minSegmentPts,l.pts),a.maxSegmentPts===void 0?a.maxSegmentPts=l.pts:a.maxSegmentPts=Math.max(a.maxSegmentPts,l.pts)),typeof l.dts=="number"&&(a.timelineStartInfo.dts===void 0&&(a.timelineStartInfo.dts=l.dts),a.minSegmentDts===void 0?a.minSegmentDts=l.dts:a.minSegmentDts=Math.min(a.minSegmentDts,l.dts),a.maxSegmentDts===void 0?a.maxSegmentDts=l.dts:a.maxSegmentDts=Math.max(a.maxSegmentDts,l.dts))},od=function(a){delete a.minSegmentDts,delete a.maxSegmentDts,delete a.minSegmentPts,delete a.maxSegmentPts},ld=function(a,l){var c,u,m=a.minSegmentDts;return l||(m-=a.timelineStartInfo.dts),c=a.timelineStartInfo.baseMediaDecodeTime,c+=m,c=Math.max(0,c),a.type==="audio"&&(u=a.samplerate/sd,c*=u,c=Math.floor(c)),c},dd={clearDtsInfo:od,calculateTrackBaseMediaDecodeTime:ld,collectDtsInfo:ad},Ss=4,ud=128,cd=function(a){for(var l=0,c={payloadType:-1,payloadSize:0},u=0,m=0;l<a.byteLength&&a[l]!==ud;){for(;a[l]===255;)u+=255,l++;for(u+=a[l++];a[l]===255;)m+=255,l++;if(m+=a[l++],!c.payload&&u===Ss){var g=String.fromCharCode(a[l+3],a[l+4],a[l+5],a[l+6]);if(g==="GA94"){c.payloadType=u,c.payloadSize=m,c.payload=a.subarray(l,l+m);break}else c.payload=void 0}l+=m,u=0,m=0}return c},hd=function(a){return a.payload[0]!==181||(a.payload[1]<<8|a.payload[2])!==49||String.fromCharCode(a.payload[3],a.payload[4],a.payload[5],a.payload[6])!=="GA94"||a.payload[7]!==3?null:a.payload.subarray(8,a.payload.length-1)},fd=function(a,l){var c=[],u,m,g,S;if(!(l[0]&64))return c;for(m=l[0]&31,u=0;u<m;u++)g=u*3,S={type:l[g+2]&3,pts:a},l[g+2]&4&&(S.ccData=l[g+3]<<8|l[g+4],c.push(S));return c},md=function(a){for(var l=a.byteLength,c=[],u=1,m,g;u<l-2;)a[u]===0&&a[u+1]===0&&a[u+2]===3?(c.push(u+2),u+=2):u++;if(c.length===0)return a;m=l-c.length,g=new Uint8Array(m);var S=0;for(u=0;u<m;S++,u++)S===c[0]&&(S++,c.shift()),g[u]=a[S];return g},Ts={parseSei:cd,parseUserData:hd,parseCaptionPackets:fd,discardEmulationPreventionBytes:md,USER_DATA_REGISTERED_ITU_T_T35:Ss},Zn=t,Gi=Ts,Ke=function(a){a=a||{},Ke.prototype.init.call(this),this.parse708captions_=typeof a.parse708captions=="boolean"?a.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Te(0,0),new Te(0,1),new Te(1,0),new Te(1,1)],this.parse708captions_&&(this.cc708Stream_=new pe({captionServices:a.captionServices})),this.reset(),this.ccStreams_.forEach(function(l){l.on("data",this.trigger.bind(this,"data")),l.on("partialdone",this.trigger.bind(this,"partialdone")),l.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Ke.prototype=new Zn,Ke.prototype.push=function(a){var l,c,u;if(a.nalUnitType==="sei_rbsp"&&(l=Gi.parseSei(a.escapedRBSP),!!l.payload&&l.payloadType===Gi.USER_DATA_REGISTERED_ITU_T_T35&&(c=Gi.parseUserData(l),!!c))){if(a.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(a.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}u=Gi.parseCaptionPackets(a.pts,c),this.captionPackets_=this.captionPackets_.concat(u),this.latestDts_!==a.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=a.dts}},Ke.prototype.flushCCStreams=function(a){this.ccStreams_.forEach(function(l){return a==="flush"?l.flush():l.partialFlush()},this)},Ke.prototype.flushStream=function(a){if(!this.captionPackets_.length){this.flushCCStreams(a);return}this.captionPackets_.forEach(function(l,c){l.presortIndex=c}),this.captionPackets_.sort(function(l,c){return l.pts===c.pts?l.presortIndex-c.presortIndex:l.pts-c.pts}),this.captionPackets_.forEach(function(l){l.type<2?this.dispatchCea608Packet(l):this.dispatchCea708Packet(l)},this),this.captionPackets_.length=0,this.flushCCStreams(a)},Ke.prototype.flush=function(){return this.flushStream("flush")},Ke.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Ke.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(a){a.reset()})},Ke.prototype.dispatchCea608Packet=function(a){this.setsTextOrXDSActive(a)?this.activeCea608Channel_[a.type]=null:this.setsChannel1Active(a)?this.activeCea608Channel_[a.type]=0:this.setsChannel2Active(a)&&(this.activeCea608Channel_[a.type]=1),this.activeCea608Channel_[a.type]!==null&&this.ccStreams_[(a.type<<1)+this.activeCea608Channel_[a.type]].push(a)},Ke.prototype.setsChannel1Active=function(a){return(a.ccData&30720)===4096},Ke.prototype.setsChannel2Active=function(a){return(a.ccData&30720)===6144},Ke.prototype.setsTextOrXDSActive=function(a){return(a.ccData&28928)===256||(a.ccData&30974)===4138||(a.ccData&30974)===6186},Ke.prototype.dispatchCea708Packet=function(a){this.parse708captions_&&this.cc708Stream_.push(a)};var pd={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},gd=function(a){var l=pd[a]||a;return a&4096&&a===l?"":String.fromCharCode(l)},Qi=function(a){return 32<=a&&a<=127||160<=a&&a<=255},Ct=function(a){this.windowNum=a,this.reset()};Ct.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Ct.prototype.getText=function(){return this.rows.join(`
`)},Ct.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Ct.prototype.newLine=function(a){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(a),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Ct.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Ct.prototype.addText=function(a){this.rows[this.rowIdx]+=a},Ct.prototype.backspace=function(){if(!this.isEmpty()){var a=this.rows[this.rowIdx];this.rows[this.rowIdx]=a.substr(0,a.length-1)}};var Yi=function(a,l,c){this.serviceNum=a,this.text="",this.currentWindow=new Ct(-1),this.windows=[],this.stream=c,typeof l=="string"&&this.createTextDecoder(l)};Yi.prototype.init=function(a,l){this.startPts=a;for(var c=0;c<8;c++)this.windows[c]=new Ct(c),typeof l=="function"&&(this.windows[c].beforeRowOverflow=l)},Yi.prototype.setCurrentWindow=function(a){this.currentWindow=this.windows[a]},Yi.prototype.createTextDecoder=function(a){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(a)}catch(l){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+a+" encoding. "+l})}};var pe=function(a){a=a||{},pe.prototype.init.call(this);var l=this,c=a.captionServices||{},u={},m;Object.keys(c).forEach(g=>{m=c[g],/^SERVICE/.test(g)&&(u[g]=m.encoding)}),this.serviceEncodings=u,this.current708Packet=null,this.services={},this.push=function(g){g.type===3?(l.new708Packet(),l.add708Bytes(g)):(l.current708Packet===null&&l.new708Packet(),l.add708Bytes(g))}};pe.prototype=new Zn,pe.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},pe.prototype.add708Bytes=function(a){var l=a.ccData,c=l>>>8,u=l&255;this.current708Packet.ptsVals.push(a.pts),this.current708Packet.data.push(c),this.current708Packet.data.push(u)},pe.prototype.push708Packet=function(){var a=this.current708Packet,l=a.data,c=null,u=null,m=0,g=l[m++];for(a.seq=g>>6,a.sizeCode=g&63;m<l.length;m++)g=l[m++],c=g>>5,u=g&31,c===7&&u>0&&(g=l[m++],c=g),this.pushServiceBlock(c,m,u),u>0&&(m+=u-1)},pe.prototype.pushServiceBlock=function(a,l,c){var u,m=l,g=this.current708Packet.data,S=this.services[a];for(S||(S=this.initService(a,m));m<l+c&&m<g.length;m++)u=g[m],Qi(u)?m=this.handleText(m,S):u===24?m=this.multiByteCharacter(m,S):u===16?m=this.extendedCommands(m,S):128<=u&&u<=135?m=this.setCurrentWindow(m,S):152<=u&&u<=159?m=this.defineWindow(m,S):u===136?m=this.clearWindows(m,S):u===140?m=this.deleteWindows(m,S):u===137?m=this.displayWindows(m,S):u===138?m=this.hideWindows(m,S):u===139?m=this.toggleWindows(m,S):u===151?m=this.setWindowAttributes(m,S):u===144?m=this.setPenAttributes(m,S):u===145?m=this.setPenColor(m,S):u===146?m=this.setPenLocation(m,S):u===143?S=this.reset(m,S):u===8?S.currentWindow.backspace():u===12?S.currentWindow.clearText():u===13?S.currentWindow.pendingNewLine=!0:u===14?S.currentWindow.clearText():u===141&&m++},pe.prototype.extendedCommands=function(a,l){var c=this.current708Packet.data,u=c[++a];return Qi(u)&&(a=this.handleText(a,l,{isExtended:!0})),a},pe.prototype.getPts=function(a){return this.current708Packet.ptsVals[Math.floor(a/2)]},pe.prototype.initService=function(a,l){var u="SERVICE"+a,c=this,u,m;return u in this.serviceEncodings&&(m=this.serviceEncodings[u]),this.services[a]=new Yi(a,m,c),this.services[a].init(this.getPts(l),function(g){c.flushDisplayed(g,c.services[a])}),this.services[a]},pe.prototype.handleText=function(a,l,c){var u=c&&c.isExtended,m=c&&c.isMultiByte,g=this.current708Packet.data,S=u?4096:0,x=g[a],I=g[a+1],D=l.currentWindow,U,$;function Q(q){return q.map(Y=>("0"+(Y&255).toString(16)).slice(-2)).join("")}if(m?($=[x,I],a++):$=[x],l.textDecoder_&&!u)U=l.textDecoder_.decode(new Uint8Array($));else if(m){const q=Q($);U=String.fromCharCode(parseInt(q,16))}else U=gd(S|x);return D.pendingNewLine&&!D.isEmpty()&&D.newLine(this.getPts(a)),D.pendingNewLine=!1,D.addText(U),a},pe.prototype.multiByteCharacter=function(a,l){var c=this.current708Packet.data,u=c[a+1],m=c[a+2];return Qi(u)&&Qi(m)&&(a=this.handleText(++a,l,{isMultiByte:!0})),a},pe.prototype.setCurrentWindow=function(a,l){var c=this.current708Packet.data,u=c[a],m=u&7;return l.setCurrentWindow(m),a},pe.prototype.defineWindow=function(a,l){var c=this.current708Packet.data,u=c[a],m=u&7;l.setCurrentWindow(m);var g=l.currentWindow;return u=c[++a],g.visible=(u&32)>>5,g.rowLock=(u&16)>>4,g.columnLock=(u&8)>>3,g.priority=u&7,u=c[++a],g.relativePositioning=(u&128)>>7,g.anchorVertical=u&127,u=c[++a],g.anchorHorizontal=u,u=c[++a],g.anchorPoint=(u&240)>>4,g.rowCount=u&15,u=c[++a],g.columnCount=u&63,u=c[++a],g.windowStyle=(u&56)>>3,g.penStyle=u&7,g.virtualRowCount=g.rowCount+1,a},pe.prototype.setWindowAttributes=function(a,l){var c=this.current708Packet.data,u=c[a],m=l.currentWindow.winAttr;return u=c[++a],m.fillOpacity=(u&192)>>6,m.fillRed=(u&48)>>4,m.fillGreen=(u&12)>>2,m.fillBlue=u&3,u=c[++a],m.borderType=(u&192)>>6,m.borderRed=(u&48)>>4,m.borderGreen=(u&12)>>2,m.borderBlue=u&3,u=c[++a],m.borderType+=(u&128)>>5,m.wordWrap=(u&64)>>6,m.printDirection=(u&48)>>4,m.scrollDirection=(u&12)>>2,m.justify=u&3,u=c[++a],m.effectSpeed=(u&240)>>4,m.effectDirection=(u&12)>>2,m.displayEffect=u&3,a},pe.prototype.flushDisplayed=function(a,l){for(var c=[],u=0;u<8;u++)l.windows[u].visible&&!l.windows[u].isEmpty()&&c.push(l.windows[u].getText());l.endPts=a,l.text=c.join(`

`),this.pushCaption(l),l.startPts=a},pe.prototype.pushCaption=function(a){a.text!==""&&(this.trigger("data",{startPts:a.startPts,endPts:a.endPts,text:a.text,stream:"cc708_"+a.serviceNum}),a.text="",a.startPts=a.endPts)},pe.prototype.displayWindows=function(a,l){var c=this.current708Packet.data,u=c[++a],m=this.getPts(a);this.flushDisplayed(m,l);for(var g=0;g<8;g++)u&1<<g&&(l.windows[g].visible=1);return a},pe.prototype.hideWindows=function(a,l){var c=this.current708Packet.data,u=c[++a],m=this.getPts(a);this.flushDisplayed(m,l);for(var g=0;g<8;g++)u&1<<g&&(l.windows[g].visible=0);return a},pe.prototype.toggleWindows=function(a,l){var c=this.current708Packet.data,u=c[++a],m=this.getPts(a);this.flushDisplayed(m,l);for(var g=0;g<8;g++)u&1<<g&&(l.windows[g].visible^=1);return a},pe.prototype.clearWindows=function(a,l){var c=this.current708Packet.data,u=c[++a],m=this.getPts(a);this.flushDisplayed(m,l);for(var g=0;g<8;g++)u&1<<g&&l.windows[g].clearText();return a},pe.prototype.deleteWindows=function(a,l){var c=this.current708Packet.data,u=c[++a],m=this.getPts(a);this.flushDisplayed(m,l);for(var g=0;g<8;g++)u&1<<g&&l.windows[g].reset();return a},pe.prototype.setPenAttributes=function(a,l){var c=this.current708Packet.data,u=c[a],m=l.currentWindow.penAttr;return u=c[++a],m.textTag=(u&240)>>4,m.offset=(u&12)>>2,m.penSize=u&3,u=c[++a],m.italics=(u&128)>>7,m.underline=(u&64)>>6,m.edgeType=(u&56)>>3,m.fontStyle=u&7,a},pe.prototype.setPenColor=function(a,l){var c=this.current708Packet.data,u=c[a],m=l.currentWindow.penColor;return u=c[++a],m.fgOpacity=(u&192)>>6,m.fgRed=(u&48)>>4,m.fgGreen=(u&12)>>2,m.fgBlue=u&3,u=c[++a],m.bgOpacity=(u&192)>>6,m.bgRed=(u&48)>>4,m.bgGreen=(u&12)>>2,m.bgBlue=u&3,u=c[++a],m.edgeRed=(u&48)>>4,m.edgeGreen=(u&12)>>2,m.edgeBlue=u&3,a},pe.prototype.setPenLocation=function(a,l){var c=this.current708Packet.data,u=c[a],m=l.currentWindow.penLoc;return l.currentWindow.pendingNewLine=!0,u=c[++a],m.row=u&15,u=c[++a],m.column=u&63,a},pe.prototype.reset=function(a,l){var c=this.getPts(a);return this.flushDisplayed(c,l),this.initService(l.serviceNum,a)};var yd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Xi=function(a){return a===null?"":(a=yd[a]||a,String.fromCharCode(a))},Ki=14,_d=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Ht=function(){for(var a=[],l=Ki+1;l--;)a.push({text:"",indent:0,offset:0});return a},Te=function(a,l){Te.prototype.init.call(this),this.field_=a||0,this.dataChannel_=l||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(c){var u,m,g,S,x;if(u=c.ccData&32639,u===this.lastControlCode_){this.lastControlCode_=null;return}if((u&61440)===4096?this.lastControlCode_=u:u!==this.PADDING_&&(this.lastControlCode_=null),g=u>>>8,S=u&255,u!==this.PADDING_)if(u===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(u===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(c.pts),this.flushDisplayed(c.pts),m=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=m,this.startPts_=c.pts;else if(u===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(c.pts);else if(u===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(c.pts);else if(u===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(c.pts);else if(u===this.CARRIAGE_RETURN_)this.clearFormatting(c.pts),this.flushDisplayed(c.pts),this.shiftRowsUp_(),this.startPts_=c.pts;else if(u===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(u===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(c.pts),this.displayed_=Ht();else if(u===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Ht();else if(u===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(c.pts),this.displayed_=Ht()),this.mode_="paintOn",this.startPts_=c.pts;else if(this.isSpecialCharacter(g,S))g=(g&3)<<8,x=Xi(g|S),this[this.mode_](c.pts,x),this.column_++;else if(this.isExtCharacter(g,S))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),g=(g&3)<<8,x=Xi(g|S),this[this.mode_](c.pts,x),this.column_++;else if(this.isMidRowCode(g,S))this.clearFormatting(c.pts),this[this.mode_](c.pts," "),this.column_++,(S&14)===14&&this.addFormatting(c.pts,["i"]),(S&1)===1&&this.addFormatting(c.pts,["u"]);else if(this.isOffsetControlCode(g,S)){const D=S&3;this.nonDisplayed_[this.row_].offset=D,this.column_+=D}else if(this.isPAC(g,S)){var I=_d.indexOf(u&7968);if(this.mode_==="rollUp"&&(I-this.rollUpRows_+1<0&&(I=this.rollUpRows_-1),this.setRollUp(c.pts,I)),I!==this.row_&&I>=0&&I<=14&&(this.clearFormatting(c.pts),this.row_=I),S&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(c.pts,["u"]),(u&16)===16){const D=(u&14)>>1;this.column_=D*4,this.nonDisplayed_[this.row_].indent+=D}this.isColorPAC(S)&&(S&14)===14&&this.addFormatting(c.pts,["i"])}else this.isNormalChar(g)&&(S===0&&(S=null),x=Xi(g),x+=Xi(S),this[this.mode_](c.pts,x),this.column_+=x.length)}};Te.prototype=new Zn,Te.prototype.flushDisplayed=function(a){const l=u=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+u+"."})},c=[];this.displayed_.forEach((u,m)=>{if(u&&u.text&&u.text.length){try{u.text=u.text.trim()}catch{l(m)}u.text.length&&c.push({text:u.text,line:m+1,position:10+Math.min(70,u.indent*10)+u.offset*2.5})}else u==null&&l(m)}),c.length&&this.trigger("data",{startPts:this.startPts_,endPts:a,content:c,stream:this.name_})},Te.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Ht(),this.nonDisplayed_=Ht(),this.lastControlCode_=null,this.column_=0,this.row_=Ki,this.rollUpRows_=2,this.formatting_=[]},Te.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Te.prototype.isSpecialCharacter=function(a,l){return a===this.EXT_&&l>=48&&l<=63},Te.prototype.isExtCharacter=function(a,l){return(a===this.EXT_+1||a===this.EXT_+2)&&l>=32&&l<=63},Te.prototype.isMidRowCode=function(a,l){return a===this.EXT_&&l>=32&&l<=47},Te.prototype.isOffsetControlCode=function(a,l){return a===this.OFFSET_&&l>=33&&l<=35},Te.prototype.isPAC=function(a,l){return a>=this.BASE_&&a<this.BASE_+8&&l>=64&&l<=127},Te.prototype.isColorPAC=function(a){return a>=64&&a<=79||a>=96&&a<=127},Te.prototype.isNormalChar=function(a){return a>=32&&a<=127},Te.prototype.setRollUp=function(a,l){if(this.mode_!=="rollUp"&&(this.row_=Ki,this.mode_="rollUp",this.flushDisplayed(a),this.nonDisplayed_=Ht(),this.displayed_=Ht()),l!==void 0&&l!==this.row_)for(var c=0;c<this.rollUpRows_;c++)this.displayed_[l-c]=this.displayed_[this.row_-c],this.displayed_[this.row_-c]={text:"",indent:0,offset:0};l===void 0&&(l=this.row_),this.topRow_=l-this.rollUpRows_+1},Te.prototype.addFormatting=function(a,l){this.formatting_=this.formatting_.concat(l);var c=l.reduce(function(u,m){return u+"<"+m+">"},"");this[this.mode_](a,c)},Te.prototype.clearFormatting=function(a){if(this.formatting_.length){var l=this.formatting_.reverse().reduce(function(c,u){return c+"</"+u+">"},"");this.formatting_=[],this[this.mode_](a,l)}},Te.prototype.popOn=function(a,l){var c=this.nonDisplayed_[this.row_].text;c+=l,this.nonDisplayed_[this.row_].text=c},Te.prototype.rollUp=function(a,l){var c=this.displayed_[this.row_].text;c+=l,this.displayed_[this.row_].text=c},Te.prototype.shiftRowsUp_=function(){var a;for(a=0;a<this.topRow_;a++)this.displayed_[a]={text:"",indent:0,offset:0};for(a=this.row_+1;a<Ki+1;a++)this.displayed_[a]={text:"",indent:0,offset:0};for(a=this.topRow_;a<this.row_;a++)this.displayed_[a]=this.displayed_[a+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Te.prototype.paintOn=function(a,l){var c=this.displayed_[this.row_].text;c+=l,this.displayed_[this.row_].text=c};var ws={CaptionStream:Ke,Cea608Stream:Te,Cea708Stream:pe},Ji={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},vd=t,bd=8589934592,Sd=4294967296,xs="shared",er=function(a,l){var c=1;for(a>l&&(c=-1);Math.abs(l-a)>Sd;)a+=c*bd;return a},tr=function(a){var l,c;tr.prototype.init.call(this),this.type_=a||xs,this.push=function(u){if(u.type==="metadata"){this.trigger("data",u);return}this.type_!==xs&&u.type!==this.type_||(c===void 0&&(c=u.dts),u.dts=er(u.dts,c),u.pts=er(u.pts,c),l=u.dts,this.trigger("data",u))},this.flush=function(){c=l,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){c=void 0,l=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};tr.prototype=new vd;var Es={TimestampRolloverStream:tr,handleRollover:er},Td=(a,l,c)=>{if(!a)return-1;for(var u=c;u<a.length;u++)if(a[u]===l)return u;return-1},wd={typedArrayIndexOf:Td},Zi=wd.typedArrayIndexOf,en={Utf8:3},Ps=function(a,l,c){var u,m="";for(u=l;u<c;u++)m+="%"+("00"+a[u].toString(16)).slice(-2);return m},mi=function(a,l,c){return decodeURIComponent(Ps(a,l,c))},pi=function(a,l,c){return unescape(Ps(a,l,c))},gi=function(a){return a[0]<<21|a[1]<<14|a[2]<<7|a[3]},yi={APIC:function(a){var l=1,c,u,m="-->";a.data[0]===en.Utf8&&(c=Zi(a.data,0,l),!(c<0)&&(a.mimeType=pi(a.data,l,c),l=c+1,a.pictureType=a.data[l],l++,u=Zi(a.data,0,l),!(u<0)&&(a.description=mi(a.data,l,u),l=u+1,a.mimeType===m?a.url=pi(a.data,l,a.data.length):a.pictureData=a.data.subarray(l,a.data.length))))},"T*":function(a){a.data[0]===en.Utf8&&(a.value=mi(a.data,1,a.data.length).replace(/\0*$/,""),a.values=a.value.split("\0"))},TXXX:function(a){var l;a.data[0]===en.Utf8&&(l=Zi(a.data,0,1),l!==-1&&(a.description=mi(a.data,1,l),a.value=mi(a.data,l+1,a.data.length).replace(/\0*$/,""),a.data=a.value))},"W*":function(a){a.url=pi(a.data,0,a.data.length).replace(/\0.*$/,"")},WXXX:function(a){var l;a.data[0]===en.Utf8&&(l=Zi(a.data,0,1),l!==-1&&(a.description=mi(a.data,1,l),a.url=pi(a.data,l+1,a.data.length).replace(/\0.*$/,"")))},PRIV:function(a){var l;for(l=0;l<a.data.length;l++)if(a.data[l]===0){a.owner=pi(a.data,0,l);break}a.privateData=a.data.subarray(l+1),a.data=a.privateData}},xd=function(a){var l,c,u=10,m=0,g=[];if(!(a.length<10||a[0]!==73||a[1]!==68||a[2]!==51)){m=gi(a.subarray(6,10)),m+=10;var S=a[5]&64;S&&(u+=4,u+=gi(a.subarray(10,14)),m-=gi(a.subarray(16,20)));do{if(l=gi(a.subarray(u+4,u+8)),l<1)break;c=String.fromCharCode(a[u],a[u+1],a[u+2],a[u+3]);var x={id:c,data:a.subarray(u+10,u+l+10)};x.key=x.id,yi[x.id]?yi[x.id](x):x.id[0]==="T"?yi["T*"](x):x.id[0]==="W"&&yi["W*"](x),g.push(x),u+=10,u+=l}while(u<m);return g}},Cs={parseId3Frames:xd,parseSyncSafeInteger:gi,frameParsers:yi},Ed=t,Pd=Ji,Nt=Cs,tn;tn=function(a){var l={descriptor:a&&a.descriptor},c=0,u=[],m=0,g;if(tn.prototype.init.call(this),this.dispatchType=Pd.METADATA_STREAM_TYPE.toString(16),l.descriptor)for(g=0;g<l.descriptor.length;g++)this.dispatchType+=("00"+l.descriptor[g].toString(16)).slice(-2);this.push=function(S){var x,I,D,U,$,Q;if(S.type==="timed-metadata"){if(S.dataAlignmentIndicator&&(m=0,u.length=0),u.length===0&&(S.data.length<10||S.data[0]!==73||S.data[1]!==68||S.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(u.push(S),m+=S.data.byteLength,u.length===1&&(c=Nt.parseSyncSafeInteger(S.data.subarray(6,10)),c+=10),!(m<c)){for(x={data:new Uint8Array(c),frames:[],pts:u[0].pts,dts:u[0].dts},$=0;$<c;)x.data.set(u[0].data.subarray(0,c-$),$),$+=u[0].data.byteLength,m-=u[0].data.byteLength,u.shift();I=10,x.data[5]&64&&(I+=4,I+=Nt.parseSyncSafeInteger(x.data.subarray(10,14)),c-=Nt.parseSyncSafeInteger(x.data.subarray(16,20)));do{if(D=Nt.parseSyncSafeInteger(x.data.subarray(I+4,I+8)),D<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(Q=String.fromCharCode(x.data[I],x.data[I+1],x.data[I+2],x.data[I+3]),U={id:Q,data:x.data.subarray(I+10,I+D+10)},U.key=U.id,Nt.frameParsers[U.id]?Nt.frameParsers[U.id](U):U.id[0]==="T"?Nt.frameParsers["T*"](U):U.id[0]==="W"&&Nt.frameParsers["W*"](U),U.owner==="com.apple.streaming.transportStreamTimestamp"){var q=U.data,Y=(q[3]&1)<<30|q[4]<<22|q[5]<<14|q[6]<<6|q[7]>>>2;Y*=4,Y+=q[7]&3,U.timeStamp=Y,x.pts===void 0&&x.dts===void 0&&(x.pts=U.timeStamp,x.dts=U.timeStamp),this.trigger("timestamp",U)}x.frames.push(U),I+=10,I+=D}while(I<c);this.trigger("data",x)}}}},tn.prototype=new Ed;var Cd=tn,ir=t,nr=ws,dt=Ji,Id=Es.TimestampRolloverStream,nn,_i,rn,ii=188,rr=71;nn=function(){var a=new Uint8Array(ii),l=0;nn.prototype.init.call(this),this.push=function(c){var u=0,m=ii,g;for(l?(g=new Uint8Array(c.byteLength+l),g.set(a.subarray(0,l)),g.set(c,l),l=0):g=c;m<g.byteLength;){if(g[u]===rr&&g[m]===rr){this.trigger("data",g.subarray(u,m)),u+=ii,m+=ii;continue}u++,m++}u<g.byteLength&&(a.set(g.subarray(u),0),l=g.byteLength-u)},this.flush=function(){l===ii&&a[0]===rr&&(this.trigger("data",a),l=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){l=0,this.trigger("reset")}},nn.prototype=new ir,_i=function(){var a,l,c,u;_i.prototype.init.call(this),u=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,a=function(m,g){var S=0;g.payloadUnitStartIndicator&&(S+=m[S]+1),g.type==="pat"?l(m.subarray(S),g):c(m.subarray(S),g)},l=function(m,g){g.section_number=m[7],g.last_section_number=m[8],u.pmtPid=(m[10]&31)<<8|m[11],g.pmtPid=u.pmtPid},c=function(m,g){var S,x,I,D;if(m[5]&1){for(u.programMapTable={video:null,audio:null,"timed-metadata":{}},S=(m[1]&15)<<8|m[2],x=3+S-4,I=(m[10]&15)<<8|m[11],D=12+I;D<x;){var U=m[D],$=(m[D+1]&31)<<8|m[D+2];U===dt.H264_STREAM_TYPE&&u.programMapTable.video===null?u.programMapTable.video=$:U===dt.ADTS_STREAM_TYPE&&u.programMapTable.audio===null?u.programMapTable.audio=$:U===dt.METADATA_STREAM_TYPE&&(u.programMapTable["timed-metadata"][$]=U),D+=((m[D+3]&15)<<8|m[D+4])+5}g.programMapTable=u.programMapTable}},this.push=function(m){var g={},S=4;if(g.payloadUnitStartIndicator=!!(m[1]&64),g.pid=m[1]&31,g.pid<<=8,g.pid|=m[2],(m[3]&48)>>>4>1&&(S+=m[S]+1),g.pid===0)g.type="pat",a(m.subarray(S),g),this.trigger("data",g);else if(g.pid===this.pmtPid)for(g.type="pmt",a(m.subarray(S),g),this.trigger("data",g);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([m,S,g]):this.processPes_(m,S,g)},this.processPes_=function(m,g,S){S.pid===this.programMapTable.video?S.streamType=dt.H264_STREAM_TYPE:S.pid===this.programMapTable.audio?S.streamType=dt.ADTS_STREAM_TYPE:S.streamType=this.programMapTable["timed-metadata"][S.pid],S.type="pes",S.data=m.subarray(g),this.trigger("data",S)}},_i.prototype=new ir,_i.STREAM_TYPES={h264:27,adts:15},rn=function(){var a=this,l=!1,c={data:[],size:0},u={data:[],size:0},m={data:[],size:0},g,S=function(I,D){var U;const $=I[0]<<16|I[1]<<8|I[2];D.data=new Uint8Array,$===1&&(D.packetLength=6+(I[4]<<8|I[5]),D.dataAlignmentIndicator=(I[6]&4)!==0,U=I[7],U&192&&(D.pts=(I[9]&14)<<27|(I[10]&255)<<20|(I[11]&254)<<12|(I[12]&255)<<5|(I[13]&254)>>>3,D.pts*=4,D.pts+=(I[13]&6)>>>1,D.dts=D.pts,U&64&&(D.dts=(I[14]&14)<<27|(I[15]&255)<<20|(I[16]&254)<<12|(I[17]&255)<<5|(I[18]&254)>>>3,D.dts*=4,D.dts+=(I[18]&6)>>>1)),D.data=I.subarray(9+I[8]))},x=function(I,D,U){var $=new Uint8Array(I.size),Q={type:D},q=0,Y=0,ie=!1,Re;if(!(!I.data.length||I.size<9)){for(Q.trackId=I.data[0].pid,q=0;q<I.data.length;q++)Re=I.data[q],$.set(Re.data,Y),Y+=Re.data.byteLength;S($,Q),ie=D==="video"||Q.packetLength<=I.size,(U||ie)&&(I.size=0,I.data.length=0),ie&&a.trigger("data",Q)}};rn.prototype.init.call(this),this.push=function(I){({pat:function(){},pes:function(){var D,U;switch(I.streamType){case dt.H264_STREAM_TYPE:D=c,U="video";break;case dt.ADTS_STREAM_TYPE:D=u,U="audio";break;case dt.METADATA_STREAM_TYPE:D=m,U="timed-metadata";break;default:return}I.payloadUnitStartIndicator&&x(D,U,!0),D.data.push(I),D.size+=I.data.byteLength},pmt:function(){var D={type:"metadata",tracks:[]};g=I.programMapTable,g.video!==null&&D.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+g.video,codec:"avc",type:"video"}),g.audio!==null&&D.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+g.audio,codec:"adts",type:"audio"}),l=!0,a.trigger("data",D)}})[I.type]()},this.reset=function(){c.size=0,c.data.length=0,u.size=0,u.data.length=0,this.trigger("reset")},this.flushStreams_=function(){x(c,"video"),x(u,"audio"),x(m,"timed-metadata")},this.flush=function(){if(!l&&g){var I={type:"metadata",tracks:[]};g.video!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+g.video,codec:"avc",type:"video"}),g.audio!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+g.audio,codec:"adts",type:"audio"}),a.trigger("data",I)}l=!1,this.flushStreams_(),this.trigger("done")}},rn.prototype=new ir;var Is={PAT_PID:0,MP2T_PACKET_LENGTH:ii,TransportPacketStream:nn,TransportParseStream:_i,ElementaryStream:rn,TimestampRolloverStream:Id,CaptionStream:nr.CaptionStream,Cea608Stream:nr.Cea608Stream,Cea708Stream:nr.Cea708Stream,MetadataStream:Cd};for(var sr in dt)dt.hasOwnProperty(sr)&&(Is[sr]=dt[sr]);var Dd=Is,Ad=t,Od=_e.ONE_SECOND_IN_TS,sn,Ds=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];sn=function(a){var l,c=0;sn.prototype.init.call(this),this.skipWarn_=function(u,m){this.trigger("log",{level:"warn",message:`adts skiping bytes ${u} to ${m} in frame ${c} outside syncword`})},this.push=function(u){var m=0,g,S,x,I,D;if(a||(c=0),u.type==="audio"){l&&l.length?(x=l,l=new Uint8Array(x.byteLength+u.data.byteLength),l.set(x),l.set(u.data,x.byteLength)):l=u.data;for(var U;m+7<l.length;){if(l[m]!==255||(l[m+1]&246)!==240){typeof U!="number"&&(U=m),m++;continue}if(typeof U=="number"&&(this.skipWarn_(U,m),U=null),S=(~l[m+1]&1)*2,g=(l[m+3]&3)<<11|l[m+4]<<3|(l[m+5]&224)>>5,I=((l[m+6]&3)+1)*1024,D=I*Od/Ds[(l[m+2]&60)>>>2],l.byteLength-m<g)break;this.trigger("data",{pts:u.pts+c*D,dts:u.dts+c*D,sampleCount:I,audioobjecttype:(l[m+2]>>>6&3)+1,channelcount:(l[m+2]&1)<<2|(l[m+3]&192)>>>6,samplerate:Ds[(l[m+2]&60)>>>2],samplingfrequencyindex:(l[m+2]&60)>>>2,samplesize:16,data:l.subarray(m+7+S,m+g)}),c++,m+=g}typeof U=="number"&&(this.skipWarn_(U,m),U=null),l=l.subarray(m)}},this.flush=function(){c=0,this.trigger("done")},this.reset=function(){l=void 0,this.trigger("reset")},this.endTimeline=function(){l=void 0,this.trigger("endedtimeline")}},sn.prototype=new Ad;var Ld=sn,As;As=function(a){var l=a.byteLength,c=0,u=0;this.length=function(){return 8*l},this.bitsAvailable=function(){return 8*l+u},this.loadWord=function(){var m=a.byteLength-l,g=new Uint8Array(4),S=Math.min(4,l);if(S===0)throw new Error("no bytes available");g.set(a.subarray(m,m+S)),c=new DataView(g.buffer).getUint32(0),u=S*8,l-=S},this.skipBits=function(m){var g;u>m?(c<<=m,u-=m):(m-=u,g=Math.floor(m/8),m-=g*8,l-=g,this.loadWord(),c<<=m,u-=m)},this.readBits=function(m){var g=Math.min(u,m),S=c>>>32-g;return u-=g,u>0?c<<=g:l>0&&this.loadWord(),g=m-g,g>0?S<<g|this.readBits(g):S},this.skipLeadingZeros=function(){var m;for(m=0;m<u;++m)if((c&2147483648>>>m)!==0)return c<<=m,u-=m,m;return this.loadWord(),m+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var m=this.skipLeadingZeros();return this.readBits(m+1)-1},this.readExpGolomb=function(){var m=this.readUnsignedExpGolomb();return 1&m?1+m>>>1:-1*(m>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var Md=As,Os=t,kd=Md,an,on,Ls;on=function(){var a=0,l,c;on.prototype.init.call(this),this.push=function(u){var m;c?(m=new Uint8Array(c.byteLength+u.data.byteLength),m.set(c),m.set(u.data,c.byteLength),c=m):c=u.data;for(var g=c.byteLength;a<g-3;a++)if(c[a+2]===1){l=a+5;break}for(;l<g;)switch(c[l]){case 0:if(c[l-1]!==0){l+=2;break}else if(c[l-2]!==0){l++;break}a+3!==l-2&&this.trigger("data",c.subarray(a+3,l-2));do l++;while(c[l]!==1&&l<g);a=l-2,l+=3;break;case 1:if(c[l-1]!==0||c[l-2]!==0){l+=3;break}this.trigger("data",c.subarray(a+3,l-2)),a=l-2,l+=3;break;default:l+=3;break}c=c.subarray(a),l-=a,a=0},this.reset=function(){c=null,a=0,this.trigger("reset")},this.flush=function(){c&&c.byteLength>3&&this.trigger("data",c.subarray(a+3)),c=null,a=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},on.prototype=new Os,Ls={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},an=function(){var a=new on,l,c,u,m,g,S,x;an.prototype.init.call(this),l=this,this.push=function(I){I.type==="video"&&(c=I.trackId,u=I.pts,m=I.dts,a.push(I))},a.on("data",function(I){var D={trackId:c,pts:u,dts:m,data:I,nalUnitTypeCode:I[0]&31};switch(D.nalUnitTypeCode){case 5:D.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:D.nalUnitType="sei_rbsp",D.escapedRBSP=g(I.subarray(1));break;case 7:D.nalUnitType="seq_parameter_set_rbsp",D.escapedRBSP=g(I.subarray(1)),D.config=S(D.escapedRBSP);break;case 8:D.nalUnitType="pic_parameter_set_rbsp";break;case 9:D.nalUnitType="access_unit_delimiter_rbsp";break}l.trigger("data",D)}),a.on("done",function(){l.trigger("done")}),a.on("partialdone",function(){l.trigger("partialdone")}),a.on("reset",function(){l.trigger("reset")}),a.on("endedtimeline",function(){l.trigger("endedtimeline")}),this.flush=function(){a.flush()},this.partialFlush=function(){a.partialFlush()},this.reset=function(){a.reset()},this.endTimeline=function(){a.endTimeline()},x=function(I,D){var U=8,$=8,Q,q;for(Q=0;Q<I;Q++)$!==0&&(q=D.readExpGolomb(),$=(U+q+256)%256),U=$===0?U:$},g=function(I){for(var D=I.byteLength,U=[],$=1,Q,q;$<D-2;)I[$]===0&&I[$+1]===0&&I[$+2]===3?(U.push($+2),$+=2):$++;if(U.length===0)return I;Q=D-U.length,q=new Uint8Array(Q);var Y=0;for($=0;$<Q;Y++,$++)Y===U[0]&&(Y++,U.shift()),q[$]=I[Y];return q},S=function(I){var D=0,U=0,$=0,Q=0,q,Y,ie,Re,tt,$t,Ei,Pi,Ci,Ii,vn,ve=[1,1],Di,ct;if(q=new kd(I),Y=q.readUnsignedByte(),Re=q.readUnsignedByte(),ie=q.readUnsignedByte(),q.skipUnsignedExpGolomb(),Ls[Y]&&(tt=q.readUnsignedExpGolomb(),tt===3&&q.skipBits(1),q.skipUnsignedExpGolomb(),q.skipUnsignedExpGolomb(),q.skipBits(1),q.readBoolean()))for(vn=tt!==3?8:12,ct=0;ct<vn;ct++)q.readBoolean()&&(ct<6?x(16,q):x(64,q));if(q.skipUnsignedExpGolomb(),$t=q.readUnsignedExpGolomb(),$t===0)q.readUnsignedExpGolomb();else if($t===1)for(q.skipBits(1),q.skipExpGolomb(),q.skipExpGolomb(),Ei=q.readUnsignedExpGolomb(),ct=0;ct<Ei;ct++)q.skipExpGolomb();if(q.skipUnsignedExpGolomb(),q.skipBits(1),Pi=q.readUnsignedExpGolomb(),Ci=q.readUnsignedExpGolomb(),Ii=q.readBits(1),Ii===0&&q.skipBits(1),q.skipBits(1),q.readBoolean()&&(D=q.readUnsignedExpGolomb(),U=q.readUnsignedExpGolomb(),$=q.readUnsignedExpGolomb(),Q=q.readUnsignedExpGolomb()),q.readBoolean()&&q.readBoolean()){switch(Di=q.readUnsignedByte(),Di){case 1:ve=[1,1];break;case 2:ve=[12,11];break;case 3:ve=[10,11];break;case 4:ve=[16,11];break;case 5:ve=[40,33];break;case 6:ve=[24,11];break;case 7:ve=[20,11];break;case 8:ve=[32,11];break;case 9:ve=[80,33];break;case 10:ve=[18,11];break;case 11:ve=[15,11];break;case 12:ve=[64,33];break;case 13:ve=[160,99];break;case 14:ve=[4,3];break;case 15:ve=[3,2];break;case 16:ve=[2,1];break;case 255:{ve=[q.readUnsignedByte()<<8|q.readUnsignedByte(),q.readUnsignedByte()<<8|q.readUnsignedByte()];break}}ve&&ve[0]/ve[1]}return{profileIdc:Y,levelIdc:ie,profileCompatibility:Re,width:(Pi+1)*16-D*2-U*2,height:(2-Ii)*(Ci+1)*16-$*2-Q*2,sarRatio:ve}}},an.prototype=new Os;var Rd={H264Stream:an},Ud=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ms=function(a,l){var c=a[l+6]<<21|a[l+7]<<14|a[l+8]<<7|a[l+9],u=a[l+5],m=(u&16)>>4;return c=c>=0?c:0,m?c+20:c+10},ks=function(a,l){return a.length-l<10||a[l]!==73||a[l+1]!==68||a[l+2]!==51?l:(l+=Ms(a,l),ks(a,l))},Bd=function(a){var l=ks(a,0);return a.length>=l+2&&(a[l]&255)===255&&(a[l+1]&240)===240&&(a[l+1]&22)===16},Rs=function(a){return a[0]<<21|a[1]<<14|a[2]<<7|a[3]},Nd=function(a,l,c){var u,m="";for(u=l;u<c;u++)m+="%"+("00"+a[u].toString(16)).slice(-2);return m},jd=function(a,l,c){return unescape(Nd(a,l,c))},$d=function(a,l){var c=(a[l+5]&224)>>5,u=a[l+4]<<3,m=a[l+3]&6144;return m|u|c},Fd=function(a,l){return a[l]===73&&a[l+1]===68&&a[l+2]===51?"timed-metadata":a[l]&!0&&(a[l+1]&240)===240?"audio":null},qd=function(a){for(var l=0;l+5<a.length;){if(a[l]!==255||(a[l+1]&246)!==240){l++;continue}return Ud[(a[l+2]&60)>>>2]}return null},Wd=function(a){var l,c,u,m;l=10,a[5]&64&&(l+=4,l+=Rs(a.subarray(10,14)));do{if(c=Rs(a.subarray(l+4,l+8)),c<1)return null;if(m=String.fromCharCode(a[l],a[l+1],a[l+2],a[l+3]),m==="PRIV"){u=a.subarray(l+10,l+c+10);for(var g=0;g<u.byteLength;g++)if(u[g]===0){var S=jd(u,0,g);if(S==="com.apple.streaming.transportStreamTimestamp"){var x=u.subarray(g+1),I=(x[3]&1)<<30|x[4]<<22|x[5]<<14|x[6]<<6|x[7]>>>2;return I*=4,I+=x[7]&3,I}break}}l+=10,l+=c}while(l<a.byteLength);return null},ar={isLikelyAacData:Bd,parseId3TagSize:Ms,parseAdtsSize:$d,parseType:Fd,parseSampleRate:qd,parseAacTimestamp:Wd},Vd=t,Us=ar,ln;ln=function(){var a=new Uint8Array,l=0;ln.prototype.init.call(this),this.setTimestamp=function(c){l=c},this.push=function(c){var u=0,m=0,g,S,x,I;for(a.length?(I=a.length,a=new Uint8Array(c.byteLength+I),a.set(a.subarray(0,I)),a.set(c,I)):a=c;a.length-m>=3;){if(a[m]===73&&a[m+1]===68&&a[m+2]===51){if(a.length-m<10||(u=Us.parseId3TagSize(a,m),m+u>a.length))break;S={type:"timed-metadata",data:a.subarray(m,m+u)},this.trigger("data",S),m+=u;continue}else if((a[m]&255)===255&&(a[m+1]&240)===240){if(a.length-m<7||(u=Us.parseAdtsSize(a,m),m+u>a.length))break;x={type:"audio",data:a.subarray(m,m+u),pts:l,dts:l},this.trigger("data",x),m+=u;continue}m++}g=a.length-m,g>0?a=a.subarray(m):a=new Uint8Array},this.reset=function(){a=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){a=new Uint8Array,this.trigger("endedtimeline")}},ln.prototype=new Vd;var Hd=ln,zd=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Gd=zd,Qd=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Yd=Qd,dn=t,vi=ke,bi=Se,un=rd,ut=dd,It=Dd,cn=_e,Bs=Ld,Xd=Rd.H264Stream,Kd=Hd,Jd=ar.isLikelyAacData,Zd=_e.ONE_SECOND_IN_TS,Ns=Gd,js=Yd,hn,Si,fn,zt,eu=function(a,l){l.stream=a,this.trigger("log",l)},$s=function(a,l){for(var c=Object.keys(l),u=0;u<c.length;u++){var m=c[u];m==="headOfPipeline"||!l[m].on||l[m].on("log",eu.bind(a,m))}},Fs=function(a,l){var c;if(a.length!==l.length)return!1;for(c=0;c<a.length;c++)if(a[c]!==l[c])return!1;return!0},qs=function(a,l,c,u,m,g){var S=c-l,x=u-l,I=m-c;return{start:{dts:a,pts:a+S},end:{dts:a+x,pts:a+I},prependedContentDuration:g,baseMediaDecodeTime:a}};Si=function(a,l){var c=[],u,m=0,g=0,S=1/0;l=l||{},u=l.firstSequenceNumber||0,Si.prototype.init.call(this),this.push=function(x){ut.collectDtsInfo(a,x),a&&Ns.forEach(function(I){a[I]=x[I]}),c.push(x)},this.setEarliestDts=function(x){m=x},this.setVideoBaseMediaDecodeTime=function(x){S=x},this.setAudioAppendStart=function(x){g=x},this.flush=function(){var x,I,D,U,$,Q,q;if(c.length===0){this.trigger("done","AudioSegmentStream");return}x=un.trimAdtsFramesByEarliestDts(c,a,m),a.baseMediaDecodeTime=ut.calculateTrackBaseMediaDecodeTime(a,l.keepOriginalTimestamps),q=un.prefixWithSilence(a,x,g,S),a.samples=un.generateSampleTable(x),D=vi.mdat(un.concatenateFrameData(x)),c=[],I=vi.moof(u,[a]),U=new Uint8Array(I.byteLength+D.byteLength),u++,U.set(I),U.set(D,I.byteLength),ut.clearDtsInfo(a),$=Math.ceil(Zd*1024/a.samplerate),x.length&&(Q=x.length*$,this.trigger("segmentTimingInfo",qs(cn.audioTsToVideoTs(a.baseMediaDecodeTime,a.samplerate),x[0].dts,x[0].pts,x[0].dts+Q,x[0].pts+Q,q||0)),this.trigger("timingInfo",{start:x[0].pts,end:x[0].pts+Q})),this.trigger("data",{track:a,boxes:U}),this.trigger("done","AudioSegmentStream")},this.reset=function(){ut.clearDtsInfo(a),c=[],this.trigger("reset")}},Si.prototype=new dn,hn=function(a,l){var c,u=[],m=[],g,S;l=l||{},c=l.firstSequenceNumber||0,hn.prototype.init.call(this),delete a.minPTS,this.gopCache_=[],this.push=function(x){ut.collectDtsInfo(a,x),x.nalUnitType==="seq_parameter_set_rbsp"&&!g&&(g=x.config,a.sps=[x.data],js.forEach(function(I){a[I]=g[I]},this)),x.nalUnitType==="pic_parameter_set_rbsp"&&!S&&(S=x.data,a.pps=[x.data]),u.push(x)},this.flush=function(){for(var x,I,D,U,$,Q,q=0,Y,ie;u.length&&u[0].nalUnitType!=="access_unit_delimiter_rbsp";)u.shift();if(u.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(x=bi.groupNalsIntoFrames(u),D=bi.groupFramesIntoGops(x),D[0][0].keyFrame||(I=this.getGopForFusion_(u[0],a),I?(q=I.duration,D.unshift(I),D.byteLength+=I.byteLength,D.nalCount+=I.nalCount,D.pts=I.pts,D.dts=I.dts,D.duration+=I.duration):D=bi.extendFirstKeyFrame(D)),m.length){var Re;if(l.alignGopsAtEnd?Re=this.alignGopsAtEnd_(D):Re=this.alignGopsAtStart_(D),!Re){this.gopCache_.unshift({gop:D.pop(),pps:a.pps,sps:a.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),u=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}ut.clearDtsInfo(a),D=Re}ut.collectDtsInfo(a,D),a.samples=bi.generateSampleTable(D),$=vi.mdat(bi.concatenateNalData(D)),a.baseMediaDecodeTime=ut.calculateTrackBaseMediaDecodeTime(a,l.keepOriginalTimestamps),this.trigger("processedGopsInfo",D.map(function(tt){return{pts:tt.pts,dts:tt.dts,byteLength:tt.byteLength}})),Y=D[0],ie=D[D.length-1],this.trigger("segmentTimingInfo",qs(a.baseMediaDecodeTime,Y.dts,Y.pts,ie.dts+ie.duration,ie.pts+ie.duration,q)),this.trigger("timingInfo",{start:D[0].pts,end:D[D.length-1].pts+D[D.length-1].duration}),this.gopCache_.unshift({gop:D.pop(),pps:a.pps,sps:a.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),u=[],this.trigger("baseMediaDecodeTime",a.baseMediaDecodeTime),this.trigger("timelineStartInfo",a.timelineStartInfo),U=vi.moof(c,[a]),Q=new Uint8Array(U.byteLength+$.byteLength),c++,Q.set(U),Q.set($,U.byteLength),this.trigger("data",{track:a,boxes:Q}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),u=[],this.gopCache_.length=0,m.length=0,this.trigger("reset")},this.resetStream_=function(){ut.clearDtsInfo(a),g=void 0,S=void 0},this.getGopForFusion_=function(x){var I=45e3,D=1/0,U,$,Q,q,Y;for(Y=0;Y<this.gopCache_.length;Y++)q=this.gopCache_[Y],Q=q.gop,!(!(a.pps&&Fs(a.pps[0],q.pps[0]))||!(a.sps&&Fs(a.sps[0],q.sps[0])))&&(Q.dts<a.timelineStartInfo.dts||(U=x.dts-Q.dts-Q.duration,U>=-1e4&&U<=I&&(!$||D>U)&&($=q,D=U)));return $?$.gop:null},this.alignGopsAtStart_=function(x){var I,D,U,$,Q,q,Y,ie;for(Q=x.byteLength,q=x.nalCount,Y=x.duration,I=D=0;I<m.length&&D<x.length&&(U=m[I],$=x[D],U.pts!==$.pts);){if($.pts>U.pts){I++;continue}D++,Q-=$.byteLength,q-=$.nalCount,Y-=$.duration}return D===0?x:D===x.length?null:(ie=x.slice(D),ie.byteLength=Q,ie.duration=Y,ie.nalCount=q,ie.pts=ie[0].pts,ie.dts=ie[0].dts,ie)},this.alignGopsAtEnd_=function(x){var I,D,U,$,Q,q;for(I=m.length-1,D=x.length-1,Q=null,q=!1;I>=0&&D>=0;){if(U=m[I],$=x[D],U.pts===$.pts){q=!0;break}if(U.pts>$.pts){I--;continue}I===m.length-1&&(Q=D),D--}if(!q&&Q===null)return null;var Y;if(q?Y=D:Y=Q,Y===0)return x;var ie=x.slice(Y),Re=ie.reduce(function(tt,$t){return tt.byteLength+=$t.byteLength,tt.duration+=$t.duration,tt.nalCount+=$t.nalCount,tt},{byteLength:0,duration:0,nalCount:0});return ie.byteLength=Re.byteLength,ie.duration=Re.duration,ie.nalCount=Re.nalCount,ie.pts=ie[0].pts,ie.dts=ie[0].dts,ie},this.alignGopsWith=function(x){m=x}},hn.prototype=new dn,zt=function(a,l){this.numberOfTracks=0,this.metadataStream=l,a=a||{},typeof a.remux<"u"?this.remuxTracks=!!a.remux:this.remuxTracks=!0,typeof a.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=a.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,zt.prototype.init.call(this),this.push=function(c){if(c.content||c.text)return this.pendingCaptions.push(c);if(c.frames)return this.pendingMetadata.push(c);this.pendingTracks.push(c.track),this.pendingBytes+=c.boxes.byteLength,c.track.type==="video"&&(this.videoTrack=c.track,this.pendingBoxes.push(c.boxes)),c.track.type==="audio"&&(this.audioTrack=c.track,this.pendingBoxes.unshift(c.boxes))}},zt.prototype=new dn,zt.prototype.flush=function(a){var l=0,c={captions:[],captionStreams:{},metadata:[],info:{}},u,m,g,S=0,x;if(this.pendingTracks.length<this.numberOfTracks){if(a!=="VideoSegmentStream"&&a!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(S=this.videoTrack.timelineStartInfo.pts,js.forEach(function(I){c.info[I]=this.videoTrack[I]},this)):this.audioTrack&&(S=this.audioTrack.timelineStartInfo.pts,Ns.forEach(function(I){c.info[I]=this.audioTrack[I]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?c.type=this.pendingTracks[0].type:c.type="combined",this.emittedTracks+=this.pendingTracks.length,g=vi.initSegment(this.pendingTracks),c.initSegment=new Uint8Array(g.byteLength),c.initSegment.set(g),c.data=new Uint8Array(this.pendingBytes),x=0;x<this.pendingBoxes.length;x++)c.data.set(this.pendingBoxes[x],l),l+=this.pendingBoxes[x].byteLength;for(x=0;x<this.pendingCaptions.length;x++)u=this.pendingCaptions[x],u.startTime=cn.metadataTsToSeconds(u.startPts,S,this.keepOriginalTimestamps),u.endTime=cn.metadataTsToSeconds(u.endPts,S,this.keepOriginalTimestamps),c.captionStreams[u.stream]=!0,c.captions.push(u);for(x=0;x<this.pendingMetadata.length;x++)m=this.pendingMetadata[x],m.cueTime=cn.metadataTsToSeconds(m.pts,S,this.keepOriginalTimestamps),c.metadata.push(m);for(c.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",c),x=0;x<c.captions.length;x++)u=c.captions[x],this.trigger("caption",u);for(x=0;x<c.metadata.length;x++)m=c.metadata[x],this.trigger("id3Frame",m)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},zt.prototype.setRemux=function(a){this.remuxTracks=a},fn=function(a){var l=this,c=!0,u,m;fn.prototype.init.call(this),a=a||{},this.baseMediaDecodeTime=a.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var g={};this.transmuxPipeline_=g,g.type="aac",g.metadataStream=new It.MetadataStream,g.aacStream=new Kd,g.audioTimestampRolloverStream=new It.TimestampRolloverStream("audio"),g.timedMetadataTimestampRolloverStream=new It.TimestampRolloverStream("timed-metadata"),g.adtsStream=new Bs,g.coalesceStream=new zt(a,g.metadataStream),g.headOfPipeline=g.aacStream,g.aacStream.pipe(g.audioTimestampRolloverStream).pipe(g.adtsStream),g.aacStream.pipe(g.timedMetadataTimestampRolloverStream).pipe(g.metadataStream).pipe(g.coalesceStream),g.metadataStream.on("timestamp",function(S){g.aacStream.setTimestamp(S.timeStamp)}),g.aacStream.on("data",function(S){S.type!=="timed-metadata"&&S.type!=="audio"||g.audioSegmentStream||(m=m||{timelineStartInfo:{baseMediaDecodeTime:l.baseMediaDecodeTime},codec:"adts",type:"audio"},g.coalesceStream.numberOfTracks++,g.audioSegmentStream=new Si(m,a),g.audioSegmentStream.on("log",l.getLogTrigger_("audioSegmentStream")),g.audioSegmentStream.on("timingInfo",l.trigger.bind(l,"audioTimingInfo")),g.adtsStream.pipe(g.audioSegmentStream).pipe(g.coalesceStream),l.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!u}))}),g.coalesceStream.on("data",this.trigger.bind(this,"data")),g.coalesceStream.on("done",this.trigger.bind(this,"done")),$s(this,g)},this.setupTsPipeline=function(){var g={};this.transmuxPipeline_=g,g.type="ts",g.metadataStream=new It.MetadataStream,g.packetStream=new It.TransportPacketStream,g.parseStream=new It.TransportParseStream,g.elementaryStream=new It.ElementaryStream,g.timestampRolloverStream=new It.TimestampRolloverStream,g.adtsStream=new Bs,g.h264Stream=new Xd,g.captionStream=new It.CaptionStream(a),g.coalesceStream=new zt(a,g.metadataStream),g.headOfPipeline=g.packetStream,g.packetStream.pipe(g.parseStream).pipe(g.elementaryStream).pipe(g.timestampRolloverStream),g.timestampRolloverStream.pipe(g.h264Stream),g.timestampRolloverStream.pipe(g.adtsStream),g.timestampRolloverStream.pipe(g.metadataStream).pipe(g.coalesceStream),g.h264Stream.pipe(g.captionStream).pipe(g.coalesceStream),g.elementaryStream.on("data",function(S){var x;if(S.type==="metadata"){for(x=S.tracks.length;x--;)!u&&S.tracks[x].type==="video"?(u=S.tracks[x],u.timelineStartInfo.baseMediaDecodeTime=l.baseMediaDecodeTime):!m&&S.tracks[x].type==="audio"&&(m=S.tracks[x],m.timelineStartInfo.baseMediaDecodeTime=l.baseMediaDecodeTime);u&&!g.videoSegmentStream&&(g.coalesceStream.numberOfTracks++,g.videoSegmentStream=new hn(u,a),g.videoSegmentStream.on("log",l.getLogTrigger_("videoSegmentStream")),g.videoSegmentStream.on("timelineStartInfo",function(I){m&&!a.keepOriginalTimestamps&&(m.timelineStartInfo=I,g.audioSegmentStream.setEarliestDts(I.dts-l.baseMediaDecodeTime))}),g.videoSegmentStream.on("processedGopsInfo",l.trigger.bind(l,"gopInfo")),g.videoSegmentStream.on("segmentTimingInfo",l.trigger.bind(l,"videoSegmentTimingInfo")),g.videoSegmentStream.on("baseMediaDecodeTime",function(I){m&&g.audioSegmentStream.setVideoBaseMediaDecodeTime(I)}),g.videoSegmentStream.on("timingInfo",l.trigger.bind(l,"videoTimingInfo")),g.h264Stream.pipe(g.videoSegmentStream).pipe(g.coalesceStream)),m&&!g.audioSegmentStream&&(g.coalesceStream.numberOfTracks++,g.audioSegmentStream=new Si(m,a),g.audioSegmentStream.on("log",l.getLogTrigger_("audioSegmentStream")),g.audioSegmentStream.on("timingInfo",l.trigger.bind(l,"audioTimingInfo")),g.audioSegmentStream.on("segmentTimingInfo",l.trigger.bind(l,"audioSegmentTimingInfo")),g.adtsStream.pipe(g.audioSegmentStream).pipe(g.coalesceStream)),l.trigger("trackinfo",{hasAudio:!!m,hasVideo:!!u})}}),g.coalesceStream.on("data",this.trigger.bind(this,"data")),g.coalesceStream.on("id3Frame",function(S){S.dispatchType=g.metadataStream.dispatchType,l.trigger("id3Frame",S)}),g.coalesceStream.on("caption",this.trigger.bind(this,"caption")),g.coalesceStream.on("done",this.trigger.bind(this,"done")),$s(this,g)},this.setBaseMediaDecodeTime=function(g){var S=this.transmuxPipeline_;a.keepOriginalTimestamps||(this.baseMediaDecodeTime=g),m&&(m.timelineStartInfo.dts=void 0,m.timelineStartInfo.pts=void 0,ut.clearDtsInfo(m),S.audioTimestampRolloverStream&&S.audioTimestampRolloverStream.discontinuity()),u&&(S.videoSegmentStream&&(S.videoSegmentStream.gopCache_=[]),u.timelineStartInfo.dts=void 0,u.timelineStartInfo.pts=void 0,ut.clearDtsInfo(u),S.captionStream.reset()),S.timestampRolloverStream&&S.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(g){m&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(g)},this.setRemux=function(g){var S=this.transmuxPipeline_;a.remux=g,S&&S.coalesceStream&&S.coalesceStream.setRemux(g)},this.alignGopsWith=function(g){u&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(g)},this.getLogTrigger_=function(g){var S=this;return function(x){x.stream=g,S.trigger("log",x)}},this.push=function(g){if(c){var S=Jd(g);S&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!S&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),c=!1}this.transmuxPipeline_.headOfPipeline.push(g)},this.flush=function(){c=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},fn.prototype=new dn;var tu={Transmuxer:fn},iu=function(a){return a>>>0},nu=function(a){return("00"+a.toString(16)).slice(-2)},mn={toUnsigned:iu,toHexString:nu},ru=function(a){var l="";return l+=String.fromCharCode(a[0]),l+=String.fromCharCode(a[1]),l+=String.fromCharCode(a[2]),l+=String.fromCharCode(a[3]),l},Ws=ru,su=mn.toUnsigned,au=Ws,Vs=function(a,l){var c=[],u,m,g,S,x;if(!l.length)return null;for(u=0;u<a.byteLength;)m=su(a[u]<<24|a[u+1]<<16|a[u+2]<<8|a[u+3]),g=au(a.subarray(u+4,u+8)),S=m>1?u+m:a.byteLength,g===l[0]&&(l.length===1?c.push(a.subarray(u+8,S)):(x=Vs(a.subarray(u+8,S),l.slice(1)),x.length&&(c=c.concat(x)))),u=S;return c},or=Vs,ou=mn.toUnsigned,lu=s.getUint64,du=function(a){var l={version:a[0],flags:new Uint8Array(a.subarray(1,4))};return l.version===1?l.baseMediaDecodeTime=lu(a.subarray(4)):l.baseMediaDecodeTime=ou(a[4]<<24|a[5]<<16|a[6]<<8|a[7]),l},lr=du,uu=function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),c={version:a[0],flags:new Uint8Array(a.subarray(1,4)),trackId:l.getUint32(4)},u=c.flags[2]&1,m=c.flags[2]&2,g=c.flags[2]&8,S=c.flags[2]&16,x=c.flags[2]&32,I=c.flags[0]&65536,D=c.flags[0]&131072,U;return U=8,u&&(U+=4,c.baseDataOffset=l.getUint32(12),U+=4),m&&(c.sampleDescriptionIndex=l.getUint32(U),U+=4),g&&(c.defaultSampleDuration=l.getUint32(U),U+=4),S&&(c.defaultSampleSize=l.getUint32(U),U+=4),x&&(c.defaultSampleFlags=l.getUint32(U)),I&&(c.durationIsEmpty=!0),!u&&D&&(c.baseDataOffsetIsMoof=!0),c},Hs=uu,cu=function(a){return{isLeading:(a[0]&12)>>>2,dependsOn:a[0]&3,isDependedOn:(a[1]&192)>>>6,hasRedundancy:(a[1]&48)>>>4,paddingValue:(a[1]&14)>>>1,isNonSyncSample:a[1]&1,degradationPriority:a[2]<<8|a[3]}},hu=cu,zs=hu,fu=function(a){var l={version:a[0],flags:new Uint8Array(a.subarray(1,4)),samples:[]},c=new DataView(a.buffer,a.byteOffset,a.byteLength),u=l.flags[2]&1,m=l.flags[2]&4,g=l.flags[1]&1,S=l.flags[1]&2,x=l.flags[1]&4,I=l.flags[1]&8,D=c.getUint32(4),U=8,$;for(u&&(l.dataOffset=c.getInt32(U),U+=4),m&&D&&($={flags:zs(a.subarray(U,U+4))},U+=4,g&&($.duration=c.getUint32(U),U+=4),S&&($.size=c.getUint32(U),U+=4),I&&(l.version===1?$.compositionTimeOffset=c.getInt32(U):$.compositionTimeOffset=c.getUint32(U),U+=4),l.samples.push($),D--);D--;)$={},g&&($.duration=c.getUint32(U),U+=4),S&&($.size=c.getUint32(U),U+=4),x&&($.flags=zs(a.subarray(U,U+4)),U+=4),I&&(l.version===1?$.compositionTimeOffset=c.getInt32(U):$.compositionTimeOffset=c.getUint32(U),U+=4),l.samples.push($);return l},Gs=fu,Qs={tfdt:lr,trun:Gs},Ys={parseTfdt:Qs.tfdt,parseTrun:Qs.trun},mu=function(a){for(var l=0,c=String.fromCharCode(a[l]),u="";c!=="\0";)u+=c,l++,c=String.fromCharCode(a[l]);return u+=c,u},pu={uint8ToCString:mu},pn=pu.uint8ToCString,gu=s.getUint64,yu=function(a){var l=4,c=a[0],u,m,g,S,x,I,D,U;if(c===0){u=pn(a.subarray(l)),l+=u.length,m=pn(a.subarray(l)),l+=m.length;var $=new DataView(a.buffer);g=$.getUint32(l),l+=4,x=$.getUint32(l),l+=4,I=$.getUint32(l),l+=4,D=$.getUint32(l),l+=4}else if(c===1){var $=new DataView(a.buffer);g=$.getUint32(l),l+=4,S=gu(a.subarray(l)),l+=8,I=$.getUint32(l),l+=4,D=$.getUint32(l),l+=4,u=pn(a.subarray(l)),l+=u.length,m=pn(a.subarray(l)),l+=m.length}U=new Uint8Array(a.subarray(l,a.byteLength));var Q={scheme_id_uri:u,value:m,timescale:g||1,presentation_time:S,presentation_time_delta:x,event_duration:I,id:D,message_data:U};return vu(c,Q)?Q:void 0},_u=function(a,l,c,u){return a||a===0?a/l:u+c/l},vu=function(a,l){var c=l.scheme_id_uri!=="\0",u=a===0&&Xs(l.presentation_time_delta)&&c,m=a===1&&Xs(l.presentation_time)&&c;return!(a>1)&&u||m},Xs=function(a){return a!==void 0||a!==null},bu={parseEmsgBox:yu,scaleTime:_u},Ti;typeof window<"u"?Ti=window:typeof i<"u"?Ti=i:typeof self<"u"?Ti=self:Ti={};var Ks=Ti,gn=mn.toUnsigned,wi=mn.toHexString,Ie=or,ni=Ws,dr=bu,Su=Hs,Tu=Gs,wu=lr,xu=s.getUint64,Js,Zs,ea,ta,ia,ur,na,cr=Ks,Eu=Cs.parseId3Frames;Js=function(a){var l={},c=Ie(a,["moov","trak"]);return c.reduce(function(u,m){var g,S,x,I,D;return g=Ie(m,["tkhd"])[0],!g||(S=g[0],x=S===0?12:20,I=gn(g[x]<<24|g[x+1]<<16|g[x+2]<<8|g[x+3]),D=Ie(m,["mdia","mdhd"])[0],!D)?null:(S=D[0],x=S===0?12:20,u[I]=gn(D[x]<<24|D[x+1]<<16|D[x+2]<<8|D[x+3]),u)},l)},Zs=function(a,l){var c;c=Ie(l,["moof","traf"]);var u=c.reduce(function(m,g){var S=Ie(g,["tfhd"])[0],x=gn(S[4]<<24|S[5]<<16|S[6]<<8|S[7]),I=a[x]||9e4,D=Ie(g,["tfdt"])[0],U=new DataView(D.buffer,D.byteOffset,D.byteLength),$;D[0]===1?$=xu(D.subarray(4,12)):$=U.getUint32(4);let Q;return typeof $=="bigint"?Q=$/cr.BigInt(I):typeof $=="number"&&!isNaN($)&&(Q=$/I),Q<Number.MAX_SAFE_INTEGER&&(Q=Number(Q)),Q<m&&(m=Q),m},1/0);return typeof u=="bigint"||isFinite(u)?u:0},ea=function(a,l){var c=Ie(l,["moof","traf"]),u=0,m=0,g;if(c&&c.length){var S=Ie(c[0],["tfhd"])[0],x=Ie(c[0],["trun"])[0],I=Ie(c[0],["tfdt"])[0];if(S){var D=Su(S);g=D.trackId}if(I){var U=wu(I);u=U.baseMediaDecodeTime}if(x){var $=Tu(x);$.samples&&$.samples.length&&(m=$.samples[0].compositionTimeOffset||0)}}var Q=a[g]||9e4;typeof u=="bigint"&&(m=cr.BigInt(m),Q=cr.BigInt(Q));var q=(u+m)/Q;return typeof q=="bigint"&&q<Number.MAX_SAFE_INTEGER&&(q=Number(q)),q},ta=function(a){var l=Ie(a,["moov","trak"]),c=[];return l.forEach(function(u){var m=Ie(u,["mdia","hdlr"]),g=Ie(u,["tkhd"]);m.forEach(function(S,x){var I=ni(S.subarray(8,12)),D=g[x],U,$,Q;I==="vide"&&(U=new DataView(D.buffer,D.byteOffset,D.byteLength),$=U.getUint8(0),Q=$===0?U.getUint32(12):U.getUint32(20),c.push(Q))})}),c},ur=function(a){var l=a[0],c=l===0?12:20;return gn(a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3])},ia=function(a){var l=Ie(a,["moov","trak"]),c=[];return l.forEach(function(u){var m={},g=Ie(u,["tkhd"])[0],S,x;g&&(S=new DataView(g.buffer,g.byteOffset,g.byteLength),x=S.getUint8(0),m.id=x===0?S.getUint32(12):S.getUint32(20));var I=Ie(u,["mdia","hdlr"])[0];if(I){var D=ni(I.subarray(8,12));D==="vide"?m.type="video":D==="soun"?m.type="audio":m.type=D}var U=Ie(u,["mdia","minf","stbl","stsd"])[0];if(U){var $=U.subarray(8);m.codec=ni($.subarray(4,8));var Q=Ie($,[m.codec])[0],q,Y;Q&&(/^[asm]vc[1-9]$/i.test(m.codec)?(q=Q.subarray(78),Y=ni(q.subarray(4,8)),Y==="avcC"&&q.length>11?(m.codec+=".",m.codec+=wi(q[9]),m.codec+=wi(q[10]),m.codec+=wi(q[11])):m.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(m.codec)?(q=Q.subarray(28),Y=ni(q.subarray(4,8)),Y==="esds"&&q.length>20&&q[19]!==0?(m.codec+="."+wi(q[19]),m.codec+="."+wi(q[20]>>>2&63).replace(/^0/,"")):m.codec="mp4a.40.2"):m.codec=m.codec.toLowerCase())}var ie=Ie(u,["mdia","mdhd"])[0];ie&&(m.timescale=ur(ie)),c.push(m)}),c},na=function(a,l=0){var c=Ie(a,["emsg"]);return c.map(u=>{var m=dr.parseEmsgBox(new Uint8Array(u)),g=Eu(m.message_data);return{cueTime:dr.scaleTime(m.presentation_time,m.timescale,m.presentation_time_delta,l),duration:dr.scaleTime(m.event_duration,m.timescale),frames:g}})};var xi={findBox:Ie,parseType:ni,timescale:Js,startTime:Zs,compositionStartTime:ea,videoTrackIds:ta,tracks:ia,getTimescaleFromMediaHeader:ur,getEmsgID3:na};const{parseTrun:Pu}=Ys,{findBox:ra}=xi;var sa=Ks,Cu=function(a){var l=ra(a,["moof","traf"]),c=ra(a,["mdat"]),u=[];return c.forEach(function(m,g){var S=l[g];u.push({mdat:m,traf:S})}),u},Iu=function(a,l,c){var u=l,m=c.defaultSampleDuration||0,g=c.defaultSampleSize||0,S=c.trackId,x=[];return a.forEach(function(I){var D=Pu(I),U=D.samples;U.forEach(function($){$.duration===void 0&&($.duration=m),$.size===void 0&&($.size=g),$.trackId=S,$.dts=u,$.compositionTimeOffset===void 0&&($.compositionTimeOffset=0),typeof u=="bigint"?($.pts=u+sa.BigInt($.compositionTimeOffset),u+=sa.BigInt($.duration)):($.pts=u+$.compositionTimeOffset,u+=$.duration)}),x=x.concat(U)}),x},aa={getMdatTrafPairs:Cu,parseSamples:Iu},Du=Ts.discardEmulationPreventionBytes,Au=ws.CaptionStream,hr=or,Ou=lr,Lu=Hs,{getMdatTrafPairs:Mu,parseSamples:ku}=aa,Ru=function(a,l){for(var c=a,u=0;u<l.length;u++){var m=l[u];if(c<m.size)return m;c-=m.size}return null},Uu=function(a,l,c){var u=new DataView(a.buffer,a.byteOffset,a.byteLength),m={logs:[],seiNals:[]},g,S,x,I;for(S=0;S+4<a.length;S+=x)if(x=u.getUint32(S),S+=4,!(x<=0))switch(a[S]&31){case 6:var D=a.subarray(S+1,S+1+x),U=Ru(S,l);if(g={nalUnitType:"sei_rbsp",size:x,data:D,escapedRBSP:Du(D),trackId:c},U)g.pts=U.pts,g.dts=U.dts,I=U;else if(I)g.pts=I.pts,g.dts=I.dts;else{m.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+S+" for trackId "+c+". See mux.js#223."});break}m.seiNals.push(g);break}return m},Bu=function(a,l){var c={},u=Mu(a);return u.forEach(function(m){var g=m.mdat,S=m.traf,x=hr(S,["tfhd"]),I=Lu(x[0]),D=I.trackId,U=hr(S,["tfdt"]),$=U.length>0?Ou(U[0]).baseMediaDecodeTime:0,Q=hr(S,["trun"]),q,Y;l===D&&Q.length>0&&(q=ku(Q,$,I),Y=Uu(g,q,D),c[D]||(c[D]={seiNals:[],logs:[]}),c[D].seiNals=c[D].seiNals.concat(Y.seiNals),c[D].logs=c[D].logs.concat(Y.logs))}),c},Nu=function(a,l,c){var u;if(l===null)return null;u=Bu(a,l);var m=u[l]||{};return{seiNals:m.seiNals,logs:m.logs,timescale:c}},ju=function(){var a=!1,l,c,u,m,g,S;this.isInitialized=function(){return a},this.init=function(x){l=new Au,a=!0,S=x?x.isPartial:!1,l.on("data",function(I){I.startTime=I.startPts/m,I.endTime=I.endPts/m,g.captions.push(I),g.captionStreams[I.stream]=!0}),l.on("log",function(I){g.logs.push(I)})},this.isNewInit=function(x,I){return x&&x.length===0||I&&typeof I=="object"&&Object.keys(I).length===0?!1:u!==x[0]||m!==I[u]},this.parse=function(x,I,D){var U;if(this.isInitialized()){if(!I||!D)return null;if(this.isNewInit(I,D))u=I[0],m=D[u];else if(u===null||!m)return c.push(x),null}else return null;for(;c.length>0;){var $=c.shift();this.parse($,I,D)}return U=Nu(x,u,m),U&&U.logs&&(g.logs=g.logs.concat(U.logs)),U===null||!U.seiNals?g.logs.length?{logs:g.logs,captions:[],captionStreams:[]}:null:(this.pushNals(U.seiNals),this.flushStream(),g)},this.pushNals=function(x){if(!this.isInitialized()||!x||x.length===0)return null;x.forEach(function(I){l.push(I)})},this.flushStream=function(){if(!this.isInitialized())return null;S?l.partialFlush():l.flush()},this.clearParsedCaptions=function(){g.captions=[],g.captionStreams={},g.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;l.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){c=[],u=null,m=null,g?this.clearParsedCaptions():g={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},$u=ju;const{parseTfdt:Fu}=Ys,jt=or,{getTimescaleFromMediaHeader:qu}=xi,{parseSamples:Wu,getMdatTrafPairs:Vu}=aa;var oa=function(){let a=9e4;this.init=function(l){const c=jt(l,["moov","trak","mdia","mdhd"])[0];c&&(a=qu(c))},this.parseSegment=function(l){const c=[],u=Vu(l);let m=0;return u.forEach(function(g){const S=g.mdat,x=g.traf,I=jt(x,["tfdt"])[0],D=jt(x,["tfhd"])[0],U=jt(x,["trun"]);if(I&&(m=Fu(I).baseMediaDecodeTime),U.length&&D){const $=Wu(U,m,D);let Q=0;$.forEach(function(q){const Y="utf-8",ie=new TextDecoder(Y),Re=S.slice(Q,Q+q.size);if(jt(Re,["vtte"])[0]){Q+=q.size;return}jt(Re,["vttc"]).forEach(function(Ei){const Pi=jt(Ei,["payl"])[0],Ci=jt(Ei,["sttg"])[0],Ii=q.pts/a,vn=(q.pts+q.duration)/a;let ve,Di;if(Pi)try{ve=ie.decode(Pi)}catch(ct){console.error(ct)}if(Ci)try{Di=ie.decode(Ci)}catch(ct){console.error(ct)}q.duration&&ve&&c.push({cueText:ve,start:Ii,end:vn,settings:Di})}),Q+=q.size})}}),c}},fr=Ji,la=function(a){var l=a[1]&31;return l<<=8,l|=a[2],l},yn=function(a){return!!(a[1]&64)},_n=function(a){var l=0;return(a[3]&48)>>>4>1&&(l+=a[4]+1),l},Hu=function(a,l){var c=la(a);return c===0?"pat":c===l?"pmt":l?"pes":null},zu=function(a){var l=yn(a),c=4+_n(a);return l&&(c+=a[c]+1),(a[c+10]&31)<<8|a[c+11]},Gu=function(a){var l={},c=yn(a),u=4+_n(a);if(c&&(u+=a[u]+1),!!(a[u+5]&1)){var m,g,S;m=(a[u+1]&15)<<8|a[u+2],g=3+m-4,S=(a[u+10]&15)<<8|a[u+11];for(var x=12+S;x<g;){var I=u+x;l[(a[I+1]&31)<<8|a[I+2]]=a[I],x+=((a[I+3]&15)<<8|a[I+4])+5}return l}},Qu=function(a,l){var c=la(a),u=l[c];switch(u){case fr.H264_STREAM_TYPE:return"video";case fr.ADTS_STREAM_TYPE:return"audio";case fr.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Yu=function(a){var l=yn(a);if(!l)return null;var c=4+_n(a);if(c>=a.byteLength)return null;var u=null,m;return m=a[c+7],m&192&&(u={},u.pts=(a[c+9]&14)<<27|(a[c+10]&255)<<20|(a[c+11]&254)<<12|(a[c+12]&255)<<5|(a[c+13]&254)>>>3,u.pts*=4,u.pts+=(a[c+13]&6)>>>1,u.dts=u.pts,m&64&&(u.dts=(a[c+14]&14)<<27|(a[c+15]&255)<<20|(a[c+16]&254)<<12|(a[c+17]&255)<<5|(a[c+18]&254)>>>3,u.dts*=4,u.dts+=(a[c+18]&6)>>>1)),u},mr=function(a){switch(a){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Xu=function(a){for(var l=4+_n(a),c=a.subarray(l),u=0,m=0,g=!1,S;m<c.byteLength-3;m++)if(c[m+2]===1){u=m+5;break}for(;u<c.byteLength;)switch(c[u]){case 0:if(c[u-1]!==0){u+=2;break}else if(c[u-2]!==0){u++;break}m+3!==u-2&&(S=mr(c[m+3]&31),S==="slice_layer_without_partitioning_rbsp_idr"&&(g=!0));do u++;while(c[u]!==1&&u<c.length);m=u-2,u+=3;break;case 1:if(c[u-1]!==0||c[u-2]!==0){u+=3;break}S=mr(c[m+3]&31),S==="slice_layer_without_partitioning_rbsp_idr"&&(g=!0),m=u-2,u+=3;break;default:u+=3;break}return c=c.subarray(m),u-=m,m=0,c&&c.byteLength>3&&(S=mr(c[m+3]&31),S==="slice_layer_without_partitioning_rbsp_idr"&&(g=!0)),g},Ku={parseType:Hu,parsePat:zu,parsePmt:Gu,parsePayloadUnitStartIndicator:yn,parsePesType:Qu,parsePesTime:Yu,videoPacketContainsKeyFrame:Xu},da=Ji,ri=Es.handleRollover,ue={};ue.ts=Ku,ue.aac=ar;var Gt=_e.ONE_SECOND_IN_TS,qe=188,gt=71,Ju=function(a,l){for(var c=0,u=qe,m,g;u<a.byteLength;){if(a[c]===gt&&a[u]===gt){switch(m=a.subarray(c,u),g=ue.ts.parseType(m,l.pid),g){case"pat":l.pid=ue.ts.parsePat(m);break;case"pmt":var S=ue.ts.parsePmt(m);l.table=l.table||{},Object.keys(S).forEach(function(x){l.table[x]=S[x]});break}c+=qe,u+=qe;continue}c++,u++}},ua=function(a,l,c){for(var u=0,m=qe,g,S,x,I,D,U=!1;m<=a.byteLength;){if(a[u]===gt&&(a[m]===gt||m===a.byteLength)){switch(g=a.subarray(u,m),S=ue.ts.parseType(g,l.pid),S){case"pes":x=ue.ts.parsePesType(g,l.table),I=ue.ts.parsePayloadUnitStartIndicator(g),x==="audio"&&I&&(D=ue.ts.parsePesTime(g),D&&(D.type="audio",c.audio.push(D),U=!0));break}if(U)break;u+=qe,m+=qe;continue}u++,m++}for(m=a.byteLength,u=m-qe,U=!1;u>=0;){if(a[u]===gt&&(a[m]===gt||m===a.byteLength)){switch(g=a.subarray(u,m),S=ue.ts.parseType(g,l.pid),S){case"pes":x=ue.ts.parsePesType(g,l.table),I=ue.ts.parsePayloadUnitStartIndicator(g),x==="audio"&&I&&(D=ue.ts.parsePesTime(g),D&&(D.type="audio",c.audio.push(D),U=!0));break}if(U)break;u-=qe,m-=qe;continue}u--,m--}},Zu=function(a,l,c){for(var u=0,m=qe,g,S,x,I,D,U,$,Q,q=!1,Y={data:[],size:0};m<a.byteLength;){if(a[u]===gt&&a[m]===gt){switch(g=a.subarray(u,m),S=ue.ts.parseType(g,l.pid),S){case"pes":if(x=ue.ts.parsePesType(g,l.table),I=ue.ts.parsePayloadUnitStartIndicator(g),x==="video"&&(I&&!q&&(D=ue.ts.parsePesTime(g),D&&(D.type="video",c.video.push(D),q=!0)),!c.firstKeyFrame)){if(I&&Y.size!==0){for(U=new Uint8Array(Y.size),$=0;Y.data.length;)Q=Y.data.shift(),U.set(Q,$),$+=Q.byteLength;if(ue.ts.videoPacketContainsKeyFrame(U)){var ie=ue.ts.parsePesTime(U);ie?(c.firstKeyFrame=ie,c.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Y.size=0}Y.data.push(g),Y.size+=g.byteLength}break}if(q&&c.firstKeyFrame)break;u+=qe,m+=qe;continue}u++,m++}for(m=a.byteLength,u=m-qe,q=!1;u>=0;){if(a[u]===gt&&a[m]===gt){switch(g=a.subarray(u,m),S=ue.ts.parseType(g,l.pid),S){case"pes":x=ue.ts.parsePesType(g,l.table),I=ue.ts.parsePayloadUnitStartIndicator(g),x==="video"&&I&&(D=ue.ts.parsePesTime(g),D&&(D.type="video",c.video.push(D),q=!0));break}if(q)break;u-=qe,m-=qe;continue}u--,m--}},ec=function(a,l){if(a.audio&&a.audio.length){var c=l;(typeof c>"u"||isNaN(c))&&(c=a.audio[0].dts),a.audio.forEach(function(g){g.dts=ri(g.dts,c),g.pts=ri(g.pts,c),g.dtsTime=g.dts/Gt,g.ptsTime=g.pts/Gt})}if(a.video&&a.video.length){var u=l;if((typeof u>"u"||isNaN(u))&&(u=a.video[0].dts),a.video.forEach(function(g){g.dts=ri(g.dts,u),g.pts=ri(g.pts,u),g.dtsTime=g.dts/Gt,g.ptsTime=g.pts/Gt}),a.firstKeyFrame){var m=a.firstKeyFrame;m.dts=ri(m.dts,u),m.pts=ri(m.pts,u),m.dtsTime=m.dts/Gt,m.ptsTime=m.pts/Gt}}},tc=function(a){for(var l=!1,c=0,u=null,m=null,g=0,S=0,x;a.length-S>=3;){var I=ue.aac.parseType(a,S);switch(I){case"timed-metadata":if(a.length-S<10){l=!0;break}if(g=ue.aac.parseId3TagSize(a,S),g>a.length){l=!0;break}m===null&&(x=a.subarray(S,S+g),m=ue.aac.parseAacTimestamp(x)),S+=g;break;case"audio":if(a.length-S<7){l=!0;break}if(g=ue.aac.parseAdtsSize(a,S),g>a.length){l=!0;break}u===null&&(x=a.subarray(S,S+g),u=ue.aac.parseSampleRate(x)),c++,S+=g;break;default:S++;break}if(l)return null}if(u===null||m===null)return null;var D=Gt/u,U={audio:[{type:"audio",dts:m,pts:m},{type:"audio",dts:m+c*1024*D,pts:m+c*1024*D}]};return U},ic=function(a){var l={pid:null,table:null},c={};Ju(a,l);for(var u in l.table)if(l.table.hasOwnProperty(u)){var m=l.table[u];switch(m){case da.H264_STREAM_TYPE:c.video=[],Zu(a,l,c),c.video.length===0&&delete c.video;break;case da.ADTS_STREAM_TYPE:c.audio=[],ua(a,l,c),c.audio.length===0&&delete c.audio;break}}return c},nc=function(a,l){var c=ue.aac.isLikelyAacData(a),u;return c?u=tc(a):u=ic(a),!u||!u.audio&&!u.video?null:(ec(u,l),u)},rc={inspect:nc,parseAudioPes_:ua};const sc=function(a,l){l.on("data",function(c){const u=c.initSegment;c.initSegment={data:u.buffer,byteOffset:u.byteOffset,byteLength:u.byteLength};const m=c.data;c.data=m.buffer,a.postMessage({action:"data",segment:c,byteOffset:m.byteOffset,byteLength:m.byteLength},[c.data])}),l.on("done",function(c){a.postMessage({action:"done"})}),l.on("gopInfo",function(c){a.postMessage({action:"gopInfo",gopInfo:c})}),l.on("videoSegmentTimingInfo",function(c){const u={start:{decode:_e.videoTsToSeconds(c.start.dts),presentation:_e.videoTsToSeconds(c.start.pts)},end:{decode:_e.videoTsToSeconds(c.end.dts),presentation:_e.videoTsToSeconds(c.end.pts)},baseMediaDecodeTime:_e.videoTsToSeconds(c.baseMediaDecodeTime)};c.prependedContentDuration&&(u.prependedContentDuration=_e.videoTsToSeconds(c.prependedContentDuration)),a.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:u})}),l.on("audioSegmentTimingInfo",function(c){const u={start:{decode:_e.videoTsToSeconds(c.start.dts),presentation:_e.videoTsToSeconds(c.start.pts)},end:{decode:_e.videoTsToSeconds(c.end.dts),presentation:_e.videoTsToSeconds(c.end.pts)},baseMediaDecodeTime:_e.videoTsToSeconds(c.baseMediaDecodeTime)};c.prependedContentDuration&&(u.prependedContentDuration=_e.videoTsToSeconds(c.prependedContentDuration)),a.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:u})}),l.on("id3Frame",function(c){a.postMessage({action:"id3Frame",id3Frame:c})}),l.on("caption",function(c){a.postMessage({action:"caption",caption:c})}),l.on("trackinfo",function(c){a.postMessage({action:"trackinfo",trackInfo:c})}),l.on("audioTimingInfo",function(c){a.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:_e.videoTsToSeconds(c.start),end:_e.videoTsToSeconds(c.end)}})}),l.on("videoTimingInfo",function(c){a.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:_e.videoTsToSeconds(c.start),end:_e.videoTsToSeconds(c.end)}})}),l.on("log",function(c){a.postMessage({action:"log",log:c})})};class ca{constructor(l,c){this.options=c||{},this.self=l,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new tu.Transmuxer(this.options),sc(this.self,this.transmuxer)}pushMp4Captions(l){this.captionParser||(this.captionParser=new $u,this.captionParser.init());const c=new Uint8Array(l.data,l.byteOffset,l.byteLength),u=this.captionParser.parse(c,l.trackIds,l.timescales);this.self.postMessage({action:"mp4Captions",captions:u&&u.captions||[],logs:u&&u.logs||[],data:c.buffer},[c.buffer])}initMp4WebVttParser(l){this.webVttParser||(this.webVttParser=new oa);const c=new Uint8Array(l.data,l.byteOffset,l.byteLength);this.webVttParser.init(c)}getMp4WebVttText(l){this.webVttParser||(this.webVttParser=new oa);const c=new Uint8Array(l.data,l.byteOffset,l.byteLength),u=this.webVttParser.parseSegment(c);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:u||[],data:c.buffer},[c.buffer])}probeMp4StartTime({timescales:l,data:c}){const u=xi.startTime(l,c);this.self.postMessage({action:"probeMp4StartTime",startTime:u,data:c},[c.buffer])}probeMp4Tracks({data:l}){const c=xi.tracks(l);this.self.postMessage({action:"probeMp4Tracks",tracks:c,data:l},[l.buffer])}probeEmsgID3({data:l,offset:c}){const u=xi.getEmsgID3(l,c);this.self.postMessage({action:"probeEmsgID3",id3Frames:u,emsgData:l},[l.buffer])}probeTs({data:l,baseStartTime:c}){const u=typeof c=="number"&&!isNaN(c)?c*_e.ONE_SECOND_IN_TS:void 0,m=rc.inspect(l,u);let g=null;m&&(g={hasVideo:m.video&&m.video.length===2||!1,hasAudio:m.audio&&m.audio.length===2||!1},g.hasVideo&&(g.videoStart=m.video[0].ptsTime),g.hasAudio&&(g.audioStart=m.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:g,data:l},[l.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(l){const c=new Uint8Array(l.data,l.byteOffset,l.byteLength);this.transmuxer.push(c)}reset(){this.transmuxer.reset()}setTimestampOffset(l){const c=l.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(_e.secondsToVideoTs(c)))}setAudioAppendStart(l){this.transmuxer.setAudioAppendStart(Math.ceil(_e.secondsToVideoTs(l.appendStart)))}setRemux(l){this.transmuxer.setRemux(l.remux)}flush(l){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(l){this.transmuxer.alignGopsWith(l.gopsToAlignWith.slice())}}self.onmessage=function(a){if(a.data.action==="init"&&a.data.options){this.messageHandlers=new ca(self,a.data.options);return}this.messageHandlers||(this.messageHandlers=new ca(self)),a.data&&a.data.action&&a.data.action!=="init"&&this.messageHandlers[a.data.action]&&this.messageHandlers[a.data.action](a.data)}}));var Ap=bl(Dp);const Op=(i,e,t)=>{const{type:n,initSegment:r,captions:s,captionStreams:o,metadata:d,videoFrameDtsTime:f,videoFramePtsTime:h}=i.data.segment;e.buffer.push({captions:s,captionStreams:o,metadata:d});const p=i.data.segment.boxes||{data:i.data.segment.data},y={type:n,data:new Uint8Array(p.data,p.data.byteOffset,p.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};typeof f<"u"&&(y.videoFrameDtsTime=f),typeof h<"u"&&(y.videoFramePtsTime=h),t(y)},Lp=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},Mp=(i,e)=>{e.gopInfo=i.data.gopInfo},wl=i=>{const{transmuxer:e,bytes:t,audioAppendStart:n,gopsToAlignWith:r,remux:s,onData:o,onTrackInfo:d,onAudioTimingInfo:f,onVideoTimingInfo:h,onVideoSegmentTimingInfo:p,onAudioSegmentTimingInfo:y,onId3:w,onCaptions:P,onDone:_,onEndedTimeline:v,onTransmuxerLog:b,isEndOfTimeline:T,segment:C,triggerSegmentEventFn:M}=i,L={buffer:[]};let k=T;const R=O=>{e.currentTransmux===i&&(O.data.action==="data"&&Op(O,L,o),O.data.action==="trackinfo"&&d(O.data.trackInfo),O.data.action==="gopInfo"&&Mp(O,L),O.data.action==="audioTimingInfo"&&f(O.data.audioTimingInfo),O.data.action==="videoTimingInfo"&&h(O.data.videoTimingInfo),O.data.action==="videoSegmentTimingInfo"&&p(O.data.videoSegmentTimingInfo),O.data.action==="audioSegmentTimingInfo"&&y(O.data.audioSegmentTimingInfo),O.data.action==="id3Frame"&&w([O.data.id3Frame],O.data.id3Frame.dispatchType),O.data.action==="caption"&&P(O.data.caption),O.data.action==="endedtimeline"&&(k=!1,v()),O.data.action==="log"&&b(O.data.log),O.data.type==="transmuxed"&&(k||(e.onmessage=null,Lp({transmuxedData:L,callback:_}),xl(e))))},A=()=>{const O={message:"Received an error message from the transmuxer worker",metadata:{errorType:H.Error.StreamingFailedToTransmuxSegment,segmentInfo:Jt({segment:C})}};_(null,O)};if(e.onmessage=R,e.onerror=A,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof s<"u"&&e.postMessage({action:"setRemux",remux:s}),t.byteLength){const O=t instanceof ArrayBuffer?t:t.buffer,B=t instanceof ArrayBuffer?0:t.byteOffset;M({type:"segmenttransmuxingstart",segment:C}),e.postMessage({action:"push",data:O,byteOffset:B,byteLength:t.byteLength},[O])}T&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},xl=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():wl(i.currentTransmux))},xa=(i,e)=>{i.postMessage({action:e}),xl(i)},El=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,xa(e,i);return}e.transmuxQueue.push(xa.bind(null,e,i))},kp=i=>{El("reset",i)},Rp=i=>{El("endTimeline",i)},Pl=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,wl(i);return}i.transmuxer.transmuxQueue.push(i)},Up=i=>{const e=new Ap;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e};var Sr={reset:kp,endTimeline:Rp,transmux:Pl,createTransmuxer:Up};const di=function(i){const e=i.transmuxer,t=i.endAction||i.action,n=i.callback,r=Qe({},i,{endAction:null,transmuxer:null,callback:null}),s=o=>{o.data.action===t&&(e.removeEventListener("message",s),o.data.data&&(o.data.data=new Uint8Array(o.data.data,i.byteOffset||0,i.byteLength||o.data.data.byteLength),i.data&&(i.data=o.data.data)),n(o.data))};if(e.addEventListener("message",s),i.data){const o=i.data instanceof ArrayBuffer;r.byteOffset=o?0:i.data.byteOffset,r.byteLength=i.data.byteLength;const d=[o?i.data:i.data.buffer];e.postMessage(r,d)}else e.postMessage(r)},Tt={FAILURE:2,TIMEOUT:-101,ABORTED:-102},Cl="wvtt",zr=i=>{i.forEach(e=>{e.abort()})},Bp=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),Np=i=>{const e=i.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=i.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},hs=(i,e)=>{const{requestType:t}=e,n=ti({requestType:t,request:e,error:i});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:Tt.TIMEOUT,xhr:e,metadata:n}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:Tt.ABORTED,xhr:e,metadata:n}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:Tt.FAILURE,xhr:e,metadata:n}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:Tt.FAILURE,xhr:e,metadata:n}:null},Ea=(i,e,t,n)=>(r,s)=>{const o=s.response,d=hs(r,s);if(d)return t(d,i);if(o.byteLength!==16)return t({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:Tt.FAILURE,xhr:s},i);const f=new DataView(o),h=new Uint32Array([f.getUint32(0),f.getUint32(4),f.getUint32(8),f.getUint32(12)]);for(let y=0;y<e.length;y++)e[y].bytes=h;const p={uri:s.uri};return n({type:"segmentkeyloadcomplete",segment:i,keyInfo:p}),t(null,i)},jp=(i,e)=>{e===Cl&&i.transmuxer.postMessage({action:"initMp4WebVttParser",data:i.map.bytes})},$p=(i,e,t)=>{e===Cl&&di({action:"getMp4WebVttText",data:i.bytes,transmuxer:i.transmuxer,callback:({data:n,mp4VttCues:r})=>{i.bytes=n,t(null,i,{mp4VttCues:r})}})},Il=(i,e)=>{const t=rs(i.map.bytes);if(t!=="mp4"){const n=i.map.resolvedUri||i.map.uri,r=t||"unknown";return e({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${n}`,code:Tt.FAILURE,metadata:{mediaType:r}})}di({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:n,data:r})=>(i.map.bytes=r,n.forEach(function(s){i.map.tracks=i.map.tracks||{},!i.map.tracks[s.type]&&(i.map.tracks[s.type]=s,typeof s.id=="number"&&s.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[s.id]=s.timescale),s.type==="text"&&jp(i,s.codec))}),e(null))})},Fp=({segment:i,finishProcessingFn:e,triggerSegmentEventFn:t})=>(n,r)=>{const s=hs(n,r);if(s)return e(s,i);const o=new Uint8Array(r.response);if(t({type:"segmentloaded",segment:i}),i.map.key)return i.map.encryptedBytes=o,e(null,i);i.map.bytes=o,Il(i,function(d){if(d)return d.xhr=r,d.status=r.status,e(d,i);e(null,i)})},qp=({segment:i,finishProcessingFn:e,responseType:t,triggerSegmentEventFn:n})=>(r,s)=>{const o=hs(r,s);if(o)return e(o,i);n({type:"segmentloaded",segment:i});const d=t==="arraybuffer"||!s.responseText?s.response:Cp(s.responseText.substring(i.lastReachedChar||0));return i.stats=Bp(s),i.key?i.encryptedBytes=new Uint8Array(d):i.bytes=new Uint8Array(d),e(null,i)},Wp=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})=>{const _=i.map&&i.map.tracks||{},v=!!(_.audio&&_.video);let b=n.bind(null,i,"audio","start");const T=n.bind(null,i,"audio","end");let C=n.bind(null,i,"video","start");const M=n.bind(null,i,"video","end"),L=()=>Pl({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:v,onData:k=>{k.type=k.type==="combined"?"video":k.type,p(i,k)},onTrackInfo:k=>{t&&(v&&(k.isMuxed=!0),t(i,k))},onAudioTimingInfo:k=>{b&&typeof k.start<"u"&&(b(k.start),b=null),T&&typeof k.end<"u"&&T(k.end)},onVideoTimingInfo:k=>{C&&typeof k.start<"u"&&(C(k.start),C=null),M&&typeof k.end<"u"&&M(k.end)},onVideoSegmentTimingInfo:k=>{const R={pts:{start:k.start.presentation,end:k.end.presentation},dts:{start:k.start.decode,end:k.end.decode}};P({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:R}),r(k)},onAudioSegmentTimingInfo:k=>{const R={pts:{start:k.start.pts,end:k.end.pts},dts:{start:k.start.dts,end:k.end.dts}};P({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:R}),s(k)},onId3:(k,R)=>{o(i,k,R)},onCaptions:k=>{d(i,[k])},isEndOfTimeline:f,onEndedTimeline:()=>{h()},onTransmuxerLog:w,onDone:(k,R)=>{y&&(k.type=k.type==="combined"?"video":k.type,P({type:"segmenttransmuxingcomplete",segment:i}),y(R,i,k))},segment:i,triggerSegmentEventFn:P});di({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:k=>{i.bytes=e=k.data;const R=k.result;R&&(t(i,{hasAudio:R.hasAudio,hasVideo:R.hasVideo,isMuxed:v}),t=null),L()}})},Dl=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})=>{let _=new Uint8Array(e);if(hh(_)){i.isFmp4=!0;const{tracks:v}=i.map;if(v.text&&(!v.audio||!v.video)){p(i,{data:_,type:"text"}),$p(i,v.text.codec,y);return}const T={isFmp4:!0,hasVideo:!!v.video,hasAudio:!!v.audio};v.audio&&v.audio.codec&&v.audio.codec!=="enca"&&(T.audioCodec=v.audio.codec),v.video&&v.video.codec&&v.video.codec!=="encv"&&(T.videoCodec=v.video.codec),v.video&&v.audio&&(T.isMuxed=!0),t(i,T);const C=(M,L)=>{p(i,{data:_,type:T.hasAudio&&!T.isMuxed?"audio":"video"}),L&&L.length&&o(i,L),M&&M.length&&d(i,M),y(null,i,{})};di({action:"probeMp4StartTime",timescales:i.map.timescales,data:_,transmuxer:i.transmuxer,callback:({data:M,startTime:L})=>{e=M.buffer,i.bytes=_=M,T.hasAudio&&!T.isMuxed&&n(i,"audio","start",L),T.hasVideo&&n(i,"video","start",L),di({action:"probeEmsgID3",data:_,transmuxer:i.transmuxer,offset:L,callback:({emsgData:k,id3Frames:R})=>{if(e=k.buffer,i.bytes=_=k,!v.video||!k.byteLength||!i.transmuxer){C(void 0,R);return}di({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:_,timescales:i.map.timescales,trackIds:[v.video.id],callback:A=>{e=A.data.buffer,i.bytes=_=A.data,A.logs.forEach(function(O){w(le(O,{stream:"mp4CaptionParser"}))}),C(A.captions,R)}})}})}});return}if(!i.transmuxer){y(null,i,{});return}if(typeof i.container>"u"&&(i.container=rs(_)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),y(null,i,{});return}Wp({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})},Al=function({id:i,key:e,encryptedBytes:t,decryptionWorker:n,segment:r,doneFn:s},o){const d=h=>{if(h.data.source===i){n.removeEventListener("message",d);const p=h.data.decrypted;o(new Uint8Array(p.bytes,p.byteOffset,p.byteLength))}};n.onerror=()=>{const h="An error occurred in the decryption worker",p=Jt({segment:r}),y={message:h,metadata:{error:new Error(h),errorType:H.Error.StreamingFailedToDecryptSegment,segmentInfo:p,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};s(y,r)},n.addEventListener("message",d);let f;e.bytes.slice?f=e.bytes.slice():f=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(ml({source:i,encrypted:t,key:f,iv:e.iv}),[t.buffer,f.buffer])},Vp=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})=>{P({type:"segmentdecryptionstart"}),Al({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i,segment:e,doneFn:y},_=>{e.bytes=_,P({type:"segmentdecryptioncomplete",segment:e}),Dl({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})})},Hp=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})=>{let _=0,v=!1;return(b,T)=>{if(!v){if(b)return v=!0,zr(i),y(b,T);if(_+=1,_===i.length){const C=function(){if(T.encryptedBytes)return Vp({decryptionWorker:e,segment:T,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P});Dl({segment:T,bytes:T.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p,doneFn:y,onTransmuxerLog:w,triggerSegmentEventFn:P})};if(T.endOfAllRequests=Date.now(),T.map&&T.map.encryptedBytes&&!T.map.bytes)return P({type:"segmentdecryptionstart",segment:T}),Al({decryptionWorker:e,id:T.requestId+"-init",encryptedBytes:T.map.encryptedBytes,key:T.map.key,segment:T,doneFn:y},M=>{T.map.bytes=M,P({type:"segmentdecryptioncomplete",segment:T}),Il(T,L=>{if(L)return zr(i),y(L,T);C()})});C()}}}},zp=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},Gp=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:o,captionsFn:d,isEndOfTimeline:f,endedTimelineFn:h,dataFn:p})=>y=>{if(!y.target.aborted)return i.stats=le(i.stats,Np(y)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(y,i)},Qp=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:n,abortFn:r,progressFn:s,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:f,audioSegmentTimingInfoFn:h,id3Fn:p,captionsFn:y,isEndOfTimeline:w,endedTimelineFn:P,dataFn:_,doneFn:v,onTransmuxerLog:b,triggerSegmentEventFn:T})=>{const C=[],M=Hp({activeXhrs:C,decryptionWorker:t,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:f,audioSegmentTimingInfoFn:h,id3Fn:p,captionsFn:y,isEndOfTimeline:w,endedTimelineFn:P,dataFn:_,doneFn:v,onTransmuxerLog:b,triggerSegmentEventFn:T});if(n.key&&!n.key.bytes){const O=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&O.push(n.map.key);const B=le(e,{uri:n.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),N=Ea(n,O,M,T),j={uri:n.key.resolvedUri};T({type:"segmentkeyloadstart",segment:n,keyInfo:j});const W=i(B,N);C.push(W)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const W=le(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),F=Ea(n,[n.map.key],M,T),z={uri:n.map.key.resolvedUri};T({type:"segmentkeyloadstart",segment:n,keyInfo:z});const K=i(W,F);C.push(K)}const B=le(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:Vr(n.map),requestType:"segment-media-initialization"}),N=Fp({segment:n,finishProcessingFn:M,triggerSegmentEventFn:T});T({type:"segmentloadstart",segment:n});const j=i(B,N);C.push(j)}const L=le(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:Vr(n),requestType:"segment"}),k=qp({segment:n,finishProcessingFn:M,responseType:L.responseType,triggerSegmentEventFn:T});T({type:"segmentloadstart",segment:n});const R=i(L,k);R.addEventListener("progress",Gp({segment:n,progressFn:s,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:f,audioSegmentTimingInfoFn:h,id3Fn:p,captionsFn:y,isEndOfTimeline:w,endedTimelineFn:P,dataFn:_})),C.push(R);const A={};return C.forEach(O=>{O.addEventListener("loadend",zp({loadendState:A,abortFn:r}))}),()=>zr(C)},wn=ot("PlaylistSelector"),Pa=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},ui=function(i,e){if(!i)return"";const t=V.getComputedStyle(i);return t?t[e]:""},ci=function(i,e){const t=i.slice();i.sort(function(n,r){const s=e(n,r);return s===0?t.indexOf(n)-t.indexOf(r):s})},fs=function(i,e){let t,n;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||V.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||V.Number.MAX_VALUE,t-n},Yp=function(i,e){let t,n;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||V.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||V.Number.MAX_VALUE,t===n&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-n};let Ol=function(i){const{main:e,bandwidth:t,playerWidth:n,playerHeight:r,playerObjectFit:s,limitRenditionByPlayerDimensions:o,playlistController:d}=i;if(!e)return;const f={bandwidth:t,width:n,height:r,limitRenditionByPlayerDimensions:o};let h=e.playlists;et.isAudioOnly(e)&&(h=d.getAudioTrackPlaylists_(),f.audioOnly=!0);let p=h.map(A=>{let O;const B=A.attributes&&A.attributes.RESOLUTION&&A.attributes.RESOLUTION.width,N=A.attributes&&A.attributes.RESOLUTION&&A.attributes.RESOLUTION.height;return O=A.attributes&&A.attributes.BANDWIDTH,O=O||V.Number.MAX_VALUE,{bandwidth:O,width:B,height:N,playlist:A}});ci(p,(A,O)=>A.bandwidth-O.bandwidth),p=p.filter(A=>!et.isIncompatible(A.playlist));let y=p.filter(A=>et.isEnabled(A.playlist));y.length||(y=p.filter(A=>!et.isDisabled(A.playlist)));const w=y.filter(A=>A.bandwidth*Ue.BANDWIDTH_VARIANCE<t);let P=w[w.length-1];const _=w.filter(A=>A.bandwidth===P.bandwidth)[0];if(o===!1){const A=_||y[0]||p[0];if(A&&A.playlist){let O="sortedPlaylistReps";return _&&(O="bandwidthBestRep"),y[0]&&(O="enabledPlaylistReps"),wn(`choosing ${Pa(A)} using ${O} with options`,f),A.playlist}return wn("could not choose a playlist with options",f),null}const v=w.filter(A=>A.width&&A.height);ci(v,(A,O)=>A.width-O.width);const b=v.filter(A=>A.width===n&&A.height===r);P=b[b.length-1];const T=b.filter(A=>A.bandwidth===P.bandwidth)[0];let C,M,L;T||(C=v.filter(A=>s==="cover"?A.width>n&&A.height>r:A.width>n||A.height>r),M=C.filter(A=>A.width===C[0].width&&A.height===C[0].height),P=M[M.length-1],L=M.filter(A=>A.bandwidth===P.bandwidth)[0]);let k;if(d.leastPixelDiffSelector){const A=v.map(O=>(O.pixelDiff=Math.abs(O.width-n)+Math.abs(O.height-r),O));ci(A,(O,B)=>O.pixelDiff===B.pixelDiff?B.bandwidth-O.bandwidth:O.pixelDiff-B.pixelDiff),k=A[0]}const R=k||L||T||_||y[0]||p[0];if(R&&R.playlist){let A="sortedPlaylistReps";return k?A="leastPixelDiffRep":L?A="resolutionPlusOneRep":T?A="resolutionBestRep":_?A="bandwidthBestRep":y[0]&&(A="enabledPlaylistReps"),wn(`choosing ${Pa(R)} using ${A} with options`,f),R.playlist}return wn("could not choose a playlist with options",f),null};const Ca=function(){let i=this.useDevicePixelRatio&&V.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),Ol({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(ui(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(ui(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?ui(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},Xp=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let n=this.useDevicePixelRatio&&V.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),Ol({main:this.playlists.main,bandwidth:e,playerWidth:parseInt(ui(this.tech_.el(),"width"),10)*n,playerHeight:parseInt(ui(this.tech_.el(),"height"),10)*n,playerObjectFit:this.usePlayerObjectFit?ui(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},Kp=function(i){const{main:e,currentTime:t,bandwidth:n,duration:r,segmentDuration:s,timeUntilRebuffer:o,currentTimeline:d,syncController:f}=i,h=e.playlists.filter(_=>!et.isIncompatible(_));let p=h.filter(et.isEnabled);p.length||(p=h.filter(_=>!et.isDisabled(_)));const w=p.filter(et.hasAttribute.bind(null,"BANDWIDTH")).map(_=>{const b=f.getSyncPoint(_,r,d,t)?1:2,C=et.estimateSegmentRequestTime(s,n,_)*b-o;return{playlist:_,rebufferingImpact:C}}),P=w.filter(_=>_.rebufferingImpact<=0);return ci(P,(_,v)=>fs(v.playlist,_.playlist)),P.length?P[0]:(ci(w,(_,v)=>_.rebufferingImpact-v.rebufferingImpact),w[0]||null)},Jp=function(){const i=this.playlists.main.playlists.filter(et.isEnabled);return ci(i,(t,n)=>fs(t,n)),i.filter(t=>!!$i(this.playlists.main,t).video)[0]||null},Zp=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(n=>{t.set(n,e),e+=n.byteLength})),t};function Ll(i){try{return new URL(i).pathname.split("/").slice(-2).join("/")}catch{return""}}const eg=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let n=t;/^cc708_/.test(t)&&(n="SERVICE"+t.split("_")[1]);const r=e.textTracks().getTrackById(n);if(r)i[t]=r;else{const s=e.options_.vhs&&e.options_.vhs.captionServices||{};let o=t,d=t,f=!1;const h=s[n];h&&(o=h.label,d=h.language,f=h.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:n,default:f,label:o,language:d},!1).track}}},tg=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const n=V.WebKitDataCue||V.VTTCue;e.forEach(r=>{const s=r.stream;r.content?r.content.forEach(o=>{const d=new n(r.startTime+t,r.endTime+t,o.text);d.line=o.line,d.align="left",d.position=o.position,d.positionAlign="line-left",i[s].addCue(d)}):i[s].addCue(new n(r.startTime+t,r.endTime+t,r.text))})},ig=function(i){Object.defineProperties(i.frame,{id:{get(){return H.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return H.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return H.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},ng=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:n})=>{if(!e)return;const r=V.WebKitDataCue||V.VTTCue,s=i.metadataTrack_;if(!s||(e.forEach(p=>{const y=p.cueTime+t;typeof y!="number"||V.isNaN(y)||y<0||!(y<1/0)||!p.frames||!p.frames.length||p.frames.forEach(w=>{const P=new r(y,y,w.value||w.url||w.data||"");P.frame=w,P.value=w,ig(P),s.addCue(P)})}),!s.cues||!s.cues.length))return;const o=s.cues,d=[];for(let p=0;p<o.length;p++)o[p]&&d.push(o[p]);const f=d.reduce((p,y)=>{const w=p[y.startTime]||[];return w.push(y),p[y.startTime]=w,p},{}),h=Object.keys(f).sort((p,y)=>Number(p)-Number(y));h.forEach((p,y)=>{const w=f[p],P=isFinite(n)?n:p,_=Number(h[y+1])||P;w.forEach(v=>{v.endTime=_})})},rg={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},sg=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),ag=({inbandTextTracks:i,dateRanges:e})=>{const t=i.metadataTrack_;if(!t)return;const n=V.WebKitDataCue||V.VTTCue;e.forEach(r=>{for(const s of Object.keys(r)){if(sg.has(s))continue;const o=new n(r.startTime,r.endTime,"");o.id=r.id,o.type="com.apple.quicktime.HLS",o.value={key:rg[s],data:r[s]},(s==="scte35Out"||s==="scte35In")&&(o.value.data=new Uint8Array(o.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(o)}r.processDateRange()})},Ia=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,H.browser.IS_ANY_SAFARI||(i.metadataTrack_.inBandMetadataTrackDispatchType=e))},Ui=function(i,e,t){let n,r;if(t&&t.cues)for(n=t.cues.length;n--;)r=t.cues[n],r.startTime>=i&&r.endTime<=e&&t.removeCue(r)},og=function(i){const e=i.cues;if(!e)return;const t={};for(let n=e.length-1;n>=0;n--){const r=e[n],s=`${r.startTime}-${r.endTime}-${r.text}`;t[s]?i.removeCue(r):t[s]=r}},lg=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const n=Math.ceil((e-t+3)*Zt.ONE_SECOND_IN_TS);let r;for(r=0;r<i.length&&!(i[r].pts>n);r++);return i.slice(r)},dg=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const n=e[0].pts;let r=0;for(r;r<i.length&&!(i[r].pts>=n);r++);return i.slice(0,r).concat(e)},ug=(i,e,t,n)=>{const r=Math.ceil((e-n)*Zt.ONE_SECOND_IN_TS),s=Math.ceil((t-n)*Zt.ONE_SECOND_IN_TS),o=i.slice();let d=i.length;for(;d--&&!(i[d].pts<=s););if(d===-1)return o;let f=d+1;for(;f--&&!(i[f].pts<=r););return f=Math.max(f,0),o.splice(f,d-f+1),o},cg=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),n=Object.keys(e).sort();if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(s!==n[r]||i[s]!==e[s])return!1}return!0},hg=function(i,e,t){e=e||[];const n=[];let r=0;for(let s=0;s<e.length;s++){const o=e[s];if(i===o.timeline&&(n.push(s),r+=o.duration,r>t))return s}return n.length===0?0:n[n.length-1]},Mi=1,fg=500,Da=i=>typeof i=="number"&&isFinite(i),xn=1/60,mg=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,pg=(i,e,t)=>{let n=e-Ue.BACK_BUFFER_LENGTH;i.length&&(n=Math.max(n,i.start(0)));const r=e-t;return Math.min(r,n)},si=i=>{const{startOfSegment:e,duration:t,segment:n,part:r,playlist:{mediaSequence:s,id:o,segments:d=[]},mediaIndex:f,partIndex:h,timeline:p}=i,y=d.length-1;let w="mediaIndex/partIndex increment";i.getMediaInfoForTime?w=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(w="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(w+=` with independent ${i.independent}`);const P=typeof h=="number",_=i.segment.uri?"segment":"pre-segment",v=P?Xo({preloadSegment:n})-1:0;return`${_} [${s+f}/${s+y}]`+(P?` part [${h}/${v}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(P?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${p}] selected by [${w}] playlist [${o}]`},Aa=i=>`${i}TimingInfo`,gg=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:n,overrideCheck:r})=>!r&&i===e?null:i<e?t:n.length?n.end(n.length-1):t,Gr=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:n,audioDisabled:r})=>{if(e===t)return!1;if(n==="audio"){const s=i.lastTimelineChange({type:"main"});return!s||s.to!==t}if(n==="main"&&r){const s=i.pendingTimelineChange({type:"audio"});return!(s&&s.to===t)}return!1},yg=i=>{if(!i)return!1;const e=i.pendingTimelineChange({type:"audio"}),t=i.pendingTimelineChange({type:"main"}),n=e&&t,r=n&&e.to!==t.to;return!!(n&&e.from!==-1&&t.from!==-1&&r)},_g=i=>{const e=i.timelineChangeController_.pendingTimelineChange({type:"audio"}),t=i.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&t&&e.to<t.to},Ft=i=>{const e=i.pendingSegment_;if(!e)return;if(Gr({timelineChangeController:i.timelineChangeController_,currentTimeline:i.currentTimeline_,segmentTimeline:e.timeline,loaderType:i.loaderType_,audioDisabled:i.audioDisabled_})&&yg(i.timelineChangeController_)){if(_g(i)){i.timelineChangeController_.trigger("audioTimelineBehind");return}i.timelineChangeController_.trigger("fixBadTimelineChange")}},vg=i=>{let e=0;return["video","audio"].forEach(function(t){const n=i[`${t}TimingInfo`];if(!n)return;const{start:r,end:s}=n;let o;typeof r=="bigint"||typeof s=="bigint"?o=V.BigInt(s)-V.BigInt(r):typeof r=="number"&&typeof s=="number"&&(o=s-r),typeof o<"u"&&o>e&&(e=o)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},Oa=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+bt:!1,bg=(i,e)=>{if(e!=="hls")return null;const t=vg({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const n=i.playlist.targetDuration,r=Oa({segmentDuration:t,maxDuration:n*2}),s=Oa({segmentDuration:t,maxDuration:n}),o=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:o}:null},Jt=({type:i,segment:e})=>{if(!e)return;const t=!!(e.key||e.map&&e.map.ke),n=!!(e.map&&!e.map.bytes),r=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:i||e.type,uri:e.resolvedUri||e.uri,start:r,duration:e.duration,isEncrypted:t,isMediaInitialization:n}};class Qr extends H.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=ot(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ft(this)}),this.sourceUpdater_.on("codecschange",n=>{this.trigger(Qe({type:"codecschange"},n))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ft(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",n=>{this.trigger(Qe({type:"timelinechange"},n)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():Ft(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ft(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return Sr.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&V.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null),this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,V.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&Sr.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return Be();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=$n(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=pl(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const s={resolvedUri:(r||e).resolvedUri};return r&&(s.bytes=r.bytes),s}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e||this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let s=null;if(n&&(n.id?s=n.id:n.uri&&(s=n.uri)),this.logger_(`playlist update [${s} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${vr(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const o=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${o}]`),this.mediaIndex!==null)if(this.mediaIndex-=o,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const d=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!d.parts||!d.parts.length||!d.parts[this.partIndex])){const f=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=f}}r&&(r.mediaIndex-=o,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(V.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&Sr.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},r=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let s=1;const o=()=>{s--,s===0&&n()};(r||!this.audioDisabled_)&&(s++,this.sourceUpdater_.removeAudio(e,t,o)),(r||this.loaderType_==="main")&&(this.gopBuffer_=ug(this.gopBuffer_,e,t,this.timeMapping_),s++,this.sourceUpdater_.removeVideo(e,t,o));for(const d in this.inbandTextTracks_)Ui(e,t,this.inbandTextTracks_[d]);Ui(e,t,this.segmentMetadataTrack_),o()}monitorBuffer_(){this.checkBufferTimeout_&&V.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=V.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&V.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=V.setTimeout(this.monitorBufferTick_.bind(this),fg)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:Jt({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r=typeof e=="number"&&t.segments[e],s=e+1===t.segments.length,o=!r||!r.parts||n+1===r.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&s&&o}chooseNextRequest_(){const e=this.buffered_(),t=vr(e)||0,n=ls(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,s=n>=this.goalBufferLength_(),o=this.playlist_.segments;if(!o.length||r||s)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const d={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(d.isSyncRequest)d.mediaIndex=hg(this.currentTimeline_,o,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${d.mediaIndex}`);else if(this.mediaIndex!==null){const w=o[this.mediaIndex],P=typeof this.partIndex=="number"?this.partIndex:-1;d.startOfSegment=w.end?w.end:t,w.parts&&w.parts[P+1]?(d.mediaIndex=this.mediaIndex,d.partIndex=P+1):d.mediaIndex=this.mediaIndex+1}else{let w,P,_;const v=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${v}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const b=this.getSyncInfoFromMediaSequenceSync_(v);if(!b){const T="No sync info found while using media sequence sync";return this.error({message:T,metadata:{errorType:H.Error.StreamingFailedToSelectNextSegment,error:new Error(T)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${b.start} --> ${b.end})`),w=b.segmentIndex,P=b.partIndex,_=b.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const b=et.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:v,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});w=b.segmentIndex,P=b.partIndex,_=b.startTime}d.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${v}`:`currentTime ${v}`,d.mediaIndex=w,d.startOfSegment=_,d.partIndex=P,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${d.mediaIndex} `)}const f=o[d.mediaIndex];let h=f&&typeof d.partIndex=="number"&&f.parts&&f.parts[d.partIndex];if(!f||typeof d.partIndex=="number"&&!h)return null;typeof d.partIndex!="number"&&f.parts&&(d.partIndex=0,h=f.parts[0]);const p=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&h&&!p&&!h.independent)if(d.partIndex===0){const w=o[d.mediaIndex-1],P=w.parts&&w.parts.length&&w.parts[w.parts.length-1];P&&P.independent&&(d.mediaIndex-=1,d.partIndex=w.parts.length-1,d.independent="previous segment")}else f.parts[d.partIndex-1].independent&&(d.partIndex-=1,d.independent="previous part");const y=this.mediaSource_&&this.mediaSource_.readyState==="ended";return d.mediaIndex>=o.length-1&&y&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,d.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(d))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const r=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return r?(r.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),r):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:s,isSyncRequest:o,partIndex:d,forceTimestampOffset:f,getMediaInfoForTime:h}=e,p=n.segments[r],y=typeof d=="number"&&p.parts[d],w={requestId:"segment-loader-"+Math.random(),uri:y&&y.resolvedUri||p.resolvedUri,mediaIndex:r,partIndex:y?d:null,isSyncRequest:o,startOfSegment:s,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:p.timeline,duration:y&&y.duration||p.duration,segment:p,part:y,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:h,independent:t},P=typeof f<"u"?f:this.isPendingTimestampOffset_;w.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:p.timeline,currentTimeline:this.currentTimeline_,startOfSegment:s,buffered:this.buffered_(),overrideCheck:P});const _=vr(this.sourceUpdater_.audioBuffered());return typeof _=="number"&&(w.audioAppendStart=_-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(w.gopsToAlignWith=lg(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),w}timestampOffsetForSegment_(e){return gg(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,s=et.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),o=Nm(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(s<=o)return;const d=Kp({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:o,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!d)return;const h=s-o-d.rebufferingImpact;let p=.5;o<=bt&&(p=1),!(!d.playlist||d.playlist.uri===this.playlist_.uri||h<p)&&(this.bandwidth=d.playlist.attributes.BANDWIDTH*Ue.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${si(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:n,hasVideo:r}=t,s={segmentInfo:Jt({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:r}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:s}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},cg(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ft(this))))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const s=this.pendingSegment_,o=Aa(t);s[o]=s[o]||{},s[o][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():Ft(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const r=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),s={};t.forEach(o=>{s[o.stream]=s[o.stream]||{startTime:1/0,captions:[],endTime:0};const d=s[o.stream];d.startTime=Math.min(d.startTime,o.startTime+r),d.endTime=Math.max(d.endTime,o.endTime+r),d.captions.push(o)}),Object.keys(s).forEach(o=>{const{startTime:d,endTime:f,captions:h}=s[o],p=this.inbandTextTracks_;this.logger_(`adding cues from ${d} -> ${f} for ${o}`),eg(p,this.vhs_.tech_,o),Ui(d,f,p[o]),tg({captionArray:h,inbandTextTracks:p,timestampOffset:r})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));return}this.addMetadataToTextTrack(n,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!Gr({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:s}=t;return!(r&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!s&&!e.audioTimingInfo||Gr({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){Ft(this),this.callQueue_.push(this.handleData_.bind(this,e,t));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[Aa(t.type)].start;else{const r=this.getCurrentMediaInfo_(),s=this.loaderType_==="main"&&r&&r.hasVideo;let o;s&&(o=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:s,firstVideoFrameTimeForData:o,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const r=this.chooseNextRequest_();if(r.mediaIndex!==n.mediaIndex||r.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const s=$n(n);if(this.activeInitSegmentId_===s)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=s}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const s=this.sourceUpdater_.audioBuffered(),o=this.sourceUpdater_.videoBuffered();s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+ei(s).join(", ")),o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+ei(o).join(", "));const d=s.length?s.start(0):0,f=s.length?s.end(s.length-1):0,h=o.length?o.start(0):0,p=o.length?o.end(o.length-1):0;if(f-d<=Mi&&p-h<=Mi){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${ei(s).join(", ")}, video buffer: ${ei(o).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const w=this.currentTime_()-Mi;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${w}`),this.remove(0,w,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Mi}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=V.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Mi*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){if(r){if(r.code===ol){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error({message:`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:H.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:s}){if(!s){const d=[r];let f=r.byteLength;n&&(d.unshift(n),f+=n.byteLength),s=Zp({bytes:f,segments:d})}const o={segmentInfo:Jt({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:o}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:s},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:s}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,s=`${e}TimingInfo`;r[s]||(r[s]={}),r[s].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[s].transmuxedPresentationStart=n.start.presentation,r[s].transmuxedDecodeStart=n.start.decode,r[s].transmuxedPresentationEnd=n.end.presentation,r[s].transmuxedDecodeEnd=n.end.decode,r[s].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength||n==="audio"&&this.audioDisabled_)return;const s=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:s,data:r})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){Ft(this),this.loadQueue_.push(()=>{const t=Qe({},e,{forceTimestampOffset:!0});Qe(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=this.mediaIndex!==null,s=e.timeline!==this.currentTimeline_&&e.timeline>0,o=n||r&&s;this.logger_(`Requesting
${Ll(e.uri)}
${si(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=Qp({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:o,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:d,level:f,stream:h})=>{this.logger_(`${si(e)} logged from transmuxer stream ${h} as a ${f}: ${d}`)},triggerSegmentEventFn:({type:d,segment:f,keyInfo:h,trackInfo:p,timingInfo:y})=>{const P={segmentInfo:Jt({segment:f})};h&&(P.keyInfo=h),p&&(P.trackInfo=p),y&&(P.timingInfo=y),this.trigger({type:d,metadata:P})}})}trimBackBuffer_(e){const t=pg(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r=e.segment.key||e.segment.map&&e.segment.map.key,s=e.segment.map&&!e.segment.map.bytes,o={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:r,isMediaInitialization:s},d=e.playlist.segments[e.mediaIndex-1];if(d&&d.timeline===t.timeline&&(d.videoTimingInfo?o.baseStartTime=d.videoTimingInfo.transmuxedDecodeEnd:d.audioTimingInfo&&(o.baseStartTime=d.audioTimingInfo.transmuxedDecodeEnd)),t.key){const f=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);o.key=this.segmentKey(t.key),o.key.iv=f}return t.map&&(o.map=this.initSegmentForMap(t.map)),o}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<xn){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${xn}`);return}const n={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===Tt.ABORTED)return;if(this.pause(),e.code===Tt.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=dg(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:s,useVideoTimingInfo:o,videoTimingInfo:d,audioTimingInfo:f}){if(typeof e<"u")return e;if(!o)return f.start;const h=t.segments[n-1];return n===0||!h||typeof h.start>"u"||h.end!==r+s?r:d.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:n,hasVideo:r,isMuxed:s}=t,o=this.loaderType_==="main"&&r,d=!this.audioDisabled_&&n&&!s;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}o&&e.waitingOnAppends++,d&&e.waitingOnAppends++,o&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),d&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=mg(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),r=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;r&&(e.timingInfo.end=typeof r.end=="number"?r.end:r.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const f={segmentInfo:Jt({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:f})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=bg(e,this.sourceType_);if(t&&(t.severity==="warn"?H.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${si(e)}`);return}this.logger_(`Appended ${si(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,s=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,o=r&&r.end&&this.currentTime_()-r.end>e.playlist.partTargetDuration*3;if(s||o){this.logger_(`bad ${s?"segment":"part"} ${si(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<xn){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${xn}`);return}const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!Da(n)||!Da(r))return;Ui(n,r,this.segmentMetadataTrack_);const s=V.WebKitDataCue||V.VTTCue,o={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},d=JSON.stringify(o),f=new s(n,r,d);f.value=o,this.segmentMetadataTrack_.addCue(f)}}function Ut(){}const Ml=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},Sg=["video","audio"],Yr=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},Tg=(i,e)=>{for(let t=0;t<e.length;t++){const n=e[t];if(n.type==="mediaSource")return null;if(n.type===i)return t}return null},hi=(i,e)=>{if(e.queue.length===0)return;let t=0,n=e.queue[t];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),hi("audio",e),hi("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||Yr(i,e))){if(n.type!==i){if(t=Tg(i,e.queue),t===null)return;n=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=n,n.action(i,e),!n.doneFn){e.queuePending[i]=null,hi(i,e);return}}},kl=(i,e)=>{const t=e[`${i}Buffer`],n=Ml(i);t&&(t.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),t.removeEventListener("error",e[`on${n}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},_t=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,it={appendBuffer:(i,e,t)=>(n,r)=>{const s=r[`${n}Buffer`];if(_t(r.mediaSource,s)){r.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${n}Buffer`);try{s.appendBuffer(i)}catch(o){r.logger_(`Error with code ${o.code} `+(o.code===ol?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),r.queuePending[n]=null,t(o)}}},remove:(i,e)=>(t,n)=>{const r=n[`${t}Buffer`];if(_t(n.mediaSource,r)){n.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{r.remove(i,e)}catch{n.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const n=t[`${e}Buffer`];_t(t.mediaSource,n)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),n.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){H.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){H.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(_t(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(n){H.log.warn(`Failed to abort on ${i}Buffer`,n)}}},addSourceBuffer:(i,e)=>t=>{const n=Ml(i),r=Nn(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const s=t.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",t[`on${n}UpdateEnd_`]),s.addEventListener("error",t[`on${n}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=s},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(kl(i,e),!!_t(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(n){H.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,n)}}},changeType:i=>(e,t)=>{const n=t[`${e}Buffer`],r=Nn(i);if(!_t(t.mediaSource,n))return;const s=i.substring(0,i.indexOf(".")),o=t.codecs[e];if(o.substring(0,o.indexOf("."))===s)return;const f={codecsChangeInfo:{from:o,to:i}};t.trigger({type:"codecschange",metadata:f}),t.logger_(`changing ${e}Buffer codec from ${o} to ${i}`);try{n.changeType(r),t.codecs[e]=i}catch(h){f.errorType=H.Error.StreamingCodecsChangeError,f.error=h,h.metadata=f,t.error_=h,t.trigger("error"),H.log.warn(`Failed to changeType on ${e}Buffer`,h)}}},nt=({type:i,sourceUpdater:e,action:t,doneFn:n,name:r})=>{e.queue.push({type:i,action:t,doneFn:n,name:r}),hi(i,e)},La=(i,e)=>t=>{const n=e[`${i}Buffered`](),r=Rm(n);if(e.logger_(`received "updateend" event for ${i} Source Buffer: `,r),e.queuePending[i]){const s=e.queuePending[i].doneFn;e.queuePending[i]=null,s&&s(e[`${i}Error_`])}hi(i,e)};class Rl extends H.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>hi("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=ot("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=La("video",this),this.onAudioUpdateEnd_=La("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){nt({type:"mediaSource",sourceUpdater:this,action:it.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){nt({type:e,sourceUpdater:this,action:it.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){H.log.error("removeSourceBuffer is not supported!");return}nt({type:"mediaSource",sourceUpdater:this,action:it.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!H.browser.IS_FIREFOX&&V.MediaSource&&V.MediaSource.prototype&&typeof V.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return V.SourceBuffer&&V.SourceBuffer.prototype&&typeof V.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){H.log.error("changeType is not supported!");return}nt({type:e,sourceUpdater:this,action:it.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:s}=e;if(this.processedAppend_=!0,r==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${s.length} until video append`);return}const o=t;if(nt({type:r,sourceUpdater:this,action:it.appendBuffer(s,n||{mediaIndex:-1},o),doneFn:t,name:"appendBuffer"}),r==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const d=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${d.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,d.forEach(f=>{this.appendBuffer.apply(this,f)})}}audioBuffered(){return _t(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:Be()}videoBuffered(){return _t(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:Be()}buffered(){const e=_t(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=_t(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():Bm(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Ut){nt({type:"mediaSource",sourceUpdater:this,action:it.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Ut){typeof e!="string"&&(e=void 0),nt({type:"mediaSource",sourceUpdater:this,action:it.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=Ut){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}nt({type:"audio",sourceUpdater:this,action:it.remove(e,t),doneFn:n,name:"remove"})}removeVideo(e,t,n=Ut){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}nt({type:"video",sourceUpdater:this,action:it.remove(e,t),doneFn:n,name:"remove"})}updating(){return!!(Yr("audio",this)||Yr("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(nt({type:"audio",sourceUpdater:this,action:it.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(nt({type:"video",sourceUpdater:this,action:it.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&nt({type:"audio",sourceUpdater:this,action:it.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&nt({type:"video",sourceUpdater:this,action:it.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),Sg.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>kl(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Ma=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),wg=i=>{const e=new Uint8Array(i);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},ka=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class xg extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class Eg extends Qr{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return Be();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return Be([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=$n(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const s=ka.byteLength+e.bytes.byteLength,o=new Uint8Array(s);o.set(e.bytes),o.set(ka,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:o}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){Ui(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===Tt.TIMEOUT&&this.handleTimeout_(),e.code===Tt.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const r=this.pendingSegment_,s=n.mp4VttCues&&n.mp4VttCues.length;s&&(r.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const o=r.segment;if(o.map&&(o.map.bytes=t.map.bytes),r.bytes=t.bytes,typeof V.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));return}o.requested=!0;try{this.parseVTTCues_(r)}catch(d){this.stopForError({message:d.message,metadata:{errorType:H.Error.StreamingVttParserError,error:d}});return}if(s||this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=o.duration,r.cues.forEach(d=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new V.VTTCue(d.startTime,d.endTime,d.text):d)}),og(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const n=e&&e.type==="vtt",r=t&&t.type==="text";n&&r&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const r=n.start+t,s=n.end+t,o=new V.VTTCue(r,s,n.cueText);n.settings&&n.settings.split(" ").forEach(d=>{const f=d.split(":"),h=f[0],p=f[1];o[h]=isNaN(p)?p:Number(p)}),e.cues.push(o)})}parseVTTCues_(e){let t,n=!1;if(typeof V.WebVTT!="function")throw new xg;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues){this.parseMp4VttCues_(e);return}typeof V.TextDecoder=="function"?t=new V.TextDecoder("utf8"):(t=V.WebVTT.StringDecoder(),n=!0);const r=new V.WebVTT.Parser(V,V.vttjs,t);if(r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=o=>{e.timestampmap=o},r.onparsingerror=o=>{H.log.warn("Error encountered when parsing cues: "+o.message)},e.segment.map){let o=e.segment.map.bytes;n&&(o=Ma(o)),r.parse(o)}let s=e.bytes;n&&(s=Ma(s)),r.parse(s),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length){r.empty=!0;return}const{MPEGTS:s,LOCAL:o}=e.timestampmap,f=s/Zt.ONE_SECOND_IN_TS-o+t.mapping;if(e.cues.forEach(h=>{const p=h.endTime-h.startTime,y=this.handleRollover_(h.startTime+f,t.time);h.startTime=Math.max(y,0),h.endTime=Math.max(y+p,0)}),!n.syncInfo){const h=e.cues[0].startTime,p=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(h,p-r.duration)}}}handleRollover_(e,t){if(t===null)return e;let n=e*Zt.ONE_SECOND_IN_TS;const r=t*Zt.ONE_SECOND_IN_TS;let s;for(r<n?s=-8589934592:s=8589934592;Math.abs(n-r)>4294967296;)n+=s;return n/Zt.ONE_SECOND_IN_TS}}const Pg=function(i,e){const t=i.cues;for(let n=0;n<t.length;n++){const r=t[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},Cg=function(i,e,t=0){if(!i.segments)return;let n=t,r;for(let s=0;s<i.segments.length;s++){const o=i.segments[s];if(r||(r=Pg(e,n+o.duration/2)),r){if("cueIn"in o){r.endTime=n,r.adEndTime=n,n+=o.duration,r=null;continue}if(n<r.endTime){n+=o.duration;continue}r.endTime+=o.duration}else if("cueOut"in o&&(r=new V.VTTCue(n,n+o.duration,o.cueOut),r.adStartTime=n,r.adEndTime=n+parseFloat(o.cueOut),e.addCue(r)),"cueOutCont"in o){const[d,f]=o.cueOutCont.split("/").map(parseFloat);r=new V.VTTCue(n,n+o.duration,""),r.adStartTime=n-d,r.adEndTime=r.adStartTime+f,e.addCue(r)}n+=o.duration}};class Ra{constructor({start:e,end:t,segmentIndex:n,partIndex:r=null,appended:s=!1}){this.start_=e,this.end_=t,this.segmentIndex_=n,this.partIndex_=r,this.appended_=s}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class Ig{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class Ul{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:r}=e;if(this.isReliable_=this.isReliablePlaylist_(n,r),!!this.isReliable_)return this.updateStorage_(r,n,this.calculateBaseTime_(n,r,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const r of n)if(r.isInRange(e))return r}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,n){const r=new Map;let s=`
`,o=n,d=t;this.start_=o,e.forEach((f,h)=>{const p=this.storage_.get(d),y=o,w=y+f.duration,P=!!(p&&p.segmentSyncInfo&&p.segmentSyncInfo.isAppended),_=new Ra({start:y,end:w,appended:P,segmentIndex:h});f.syncInfo=_;let v=o;const b=(f.parts||[]).map((T,C)=>{const M=v,L=v+T.duration,k=!!(p&&p.partsSyncInfo&&p.partsSyncInfo[C]&&p.partsSyncInfo[C].isAppended),R=new Ra({start:M,end:L,appended:k,segmentIndex:h,partIndex:C});return v=L,s+=`Media Sequence: ${d}.${C} | Range: ${M} --> ${L} | Appended: ${k}
`,T.syncInfo=R,R});r.set(d,new Ig(_,b)),s+=`${Ll(f.resolvedUri)} | Media Sequence: ${d} | Range: ${y} --> ${w} | Appended: ${P}
`,d++,o=w}),this.end_=o,this.storage_=r,this.diagnostics_=s}calculateBaseTime_(e,t,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const r=Math.min(...this.storage_.keys());if(e<r){const s=r-e;let o=this.storage_.get(r).segmentSyncInfo.start;for(let d=0;d<s;d++){const f=t[d];o-=f.duration}return o}return n}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}class Ua extends Ul{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,n){if(!this.storage_.size){const r=this.parent_.getSyncInfoForMediaSequence(e);return r?r.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,n)}}const Dg=86400,Tr=[{name:"VOD",run:(i,e,t,n,r)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(i,e,t,n,r,s)=>{const o=i.getMediaSequenceSync(s);if(!o||!o.isReliable)return null;const d=o.getSyncInfoForTime(r);return d?{time:d.start,partIndex:d.partIndex,segmentIndex:d.segmentIndex}:null}},{name:"ProgramDateTime",run:(i,e,t,n,r)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let s=null,o=null;const d=jr(e);r=r||0;for(let f=0;f<d.length;f++){const h=e.endList||r===0?f:d.length-(f+1),p=d[h],y=p.segment,w=i.timelineToDatetimeMappings[y.timeline];if(!w||!y.dateTimeObject)continue;let _=y.dateTimeObject.getTime()/1e3+w;if(y.parts&&typeof p.partIndex=="number")for(let b=0;b<p.partIndex;b++)_+=y.parts[b].duration;const v=Math.abs(r-_);if(o!==null&&(v===0||o<v))break;o=v,s={time:_,segmentIndex:p.segmentIndex,partIndex:p.partIndex}}return s}},{name:"Segment",run:(i,e,t,n,r)=>{let s=null,o=null;r=r||0;const d=jr(e);for(let f=0;f<d.length;f++){const h=e.endList||r===0?f:d.length-(f+1),p=d[h],y=p.segment,w=p.part&&p.part.start||y&&y.start;if(y.timeline===n&&typeof w<"u"){const P=Math.abs(r-w);if(o!==null&&o<P)break;(!s||o===null||o>=P)&&(o=P,s={time:w,segmentIndex:p.segmentIndex,partIndex:p.partIndex})}}return s}},{name:"Discontinuity",run:(i,e,t,n,r)=>{let s=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length){let o=null;for(let d=0;d<e.discontinuityStarts.length;d++){const f=e.discontinuityStarts[d],h=e.discontinuitySequence+d+1,p=i.discontinuities[h];if(p){const y=Math.abs(r-p.time);if(o!==null&&o<y)break;(!s||o===null||o>=y)&&(o=y,s={time:p.time,segmentIndex:f,partIndex:null})}}}return s}},{name:"Playlist",run:(i,e,t,n,r)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class Ag extends H.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new Ul,n=new Ua(t),r=new Ua(t);this.mediaSequenceStorage_={main:t,audio:n,vtt:r},this.logger_=ot("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,r,s){if(t!==1/0)return Tr.find(({name:f})=>f==="VOD").run(this,e,t);const o=this.runStrategies_(e,t,n,r,s);if(!o.length)return null;for(const d of o){const{syncPoint:f,strategy:h}=d,{segmentIndex:p,time:y}=f;if(p<0)continue;const w=e.segments[p],P=y,_=P+w.duration;if(this.logger_(`Strategy: ${h}. Current time: ${r}. selected segment: ${p}. Time: [${P} -> ${_}]}`),r>=P&&r<_)return this.logger_("Found sync point with exact match: ",f),f}return this.selectSyncPoint_(o,{key:"time",value:r})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+ji({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r,s){const o=[];for(let d=0;d<Tr.length;d++){const f=Tr[d],h=f.run(this,e,t,n,r,s);h&&(h.strategy=f.name,o.push({strategy:f.name,syncPoint:h}))}return o}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),s=e[0].strategy;for(let o=1;o<e.length;o++){const d=Math.abs(e[o].syncPoint[t.key]-t.value);d<r&&(r=d,n=e[o].syncPoint,s=e[o].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${s}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>Dg){H.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let r=n-1;r>=0;r--){const s=e.segments[r];if(s&&typeof s.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:s.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const s=r.dateTimeObject;r.discontinuity&&t&&s&&(this.timelineToDatetimeMappings[r.timeline]=-(s.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,s=e.part;let o=this.timelines[e.timeline],d,f;if(typeof e.timestampOffset=="number")o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),d=e.startOfSegment,f=t.end+o.mapping;else if(o)d=t.start+o.mapping,f=t.end+o.mapping;else return!1;return s&&(s.start=d,s.end=f),(!r.start||d<r.start)&&(r.start=d),r.end=f,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],o=t.discontinuitySequence+r+1,d=s-e.mediaIndex,f=Math.abs(d);if(!this.discontinuities[o]||this.discontinuities[o].accuracy>f){let h;d<0?h=n.start-ji({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:s}):h=n.end+ji({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:s}),this.discontinuities[o]={time:h,accuracy:f}}}}dispose(){this.trigger("dispose"),this.off()}}class Og extends H.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){if(typeof t=="number"&&typeof n=="number"){this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e];const r={timelineChangeInfo:{from:t,to:n}};this.trigger({type:"timelinechange",metadata:r})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const Lg=Sl(Tl(function(){var i=(function(){function v(){this.listeners={}}var b=v.prototype;return b.on=function(C,M){this.listeners[C]||(this.listeners[C]=[]),this.listeners[C].push(M)},b.off=function(C,M){if(!this.listeners[C])return!1;var L=this.listeners[C].indexOf(M);return this.listeners[C]=this.listeners[C].slice(0),this.listeners[C].splice(L,1),L>-1},b.trigger=function(C){var M=this.listeners[C];if(M)if(arguments.length===2)for(var L=M.length,k=0;k<L;++k)M[k].call(this,arguments[1]);else for(var R=Array.prototype.slice.call(arguments,1),A=M.length,O=0;O<A;++O)M[O].apply(this,R)},b.dispose=function(){this.listeners={}},b.pipe=function(C){this.on("data",function(M){C.push(M)})},v})();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(v){return v.subarray(0,v.byteLength-v[v.byteLength-1])}/*! @name aes-decrypter @version 4.0.2 @license Apache-2.0 */const t=function(){const v=[[[],[],[],[],[]],[[],[],[],[],[]]],b=v[0],T=v[1],C=b[4],M=T[4];let L,k,R;const A=[],O=[];let B,N,j,W,F,z;for(L=0;L<256;L++)O[(A[L]=L<<1^(L>>7)*283)^L]=L;for(k=R=0;!C[k];k^=B||1,R=O[R]||1)for(W=R^R<<1^R<<2^R<<3^R<<4,W=W>>8^W&255^99,C[k]=W,M[W]=k,j=A[N=A[B=A[k]]],z=j*16843009^N*65537^B*257^k*16843008,F=A[W]*257^W*16843008,L=0;L<4;L++)b[L][k]=F=F<<24^F>>>8,T[L][W]=z=z<<24^z>>>8;for(L=0;L<5;L++)b[L]=b[L].slice(0),T[L]=T[L].slice(0);return v};let n=null;class r{constructor(b){n||(n=t()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let T,C,M;const L=this._tables[0][4],k=this._tables[1],R=b.length;let A=1;if(R!==4&&R!==6&&R!==8)throw new Error("Invalid aes key size");const O=b.slice(0),B=[];for(this._key=[O,B],T=R;T<4*R+28;T++)M=O[T-1],(T%R===0||R===8&&T%R===4)&&(M=L[M>>>24]<<24^L[M>>16&255]<<16^L[M>>8&255]<<8^L[M&255],T%R===0&&(M=M<<8^M>>>24^A<<24,A=A<<1^(A>>7)*283)),O[T]=O[T-R]^M;for(C=0;T;C++,T--)M=O[C&3?T:T-4],T<=4||C<4?B[C]=M:B[C]=k[0][L[M>>>24]]^k[1][L[M>>16&255]]^k[2][L[M>>8&255]]^k[3][L[M&255]]}decrypt(b,T,C,M,L,k){const R=this._key[1];let A=b^R[0],O=M^R[1],B=C^R[2],N=T^R[3],j,W,F;const z=R.length/4-2;let K,J=4;const Z=this._tables[1],se=Z[0],ae=Z[1],ce=Z[2],fe=Z[3],ee=Z[4];for(K=0;K<z;K++)j=se[A>>>24]^ae[O>>16&255]^ce[B>>8&255]^fe[N&255]^R[J],W=se[O>>>24]^ae[B>>16&255]^ce[N>>8&255]^fe[A&255]^R[J+1],F=se[B>>>24]^ae[N>>16&255]^ce[A>>8&255]^fe[O&255]^R[J+2],N=se[N>>>24]^ae[A>>16&255]^ce[O>>8&255]^fe[B&255]^R[J+3],J+=4,A=j,O=W,B=F;for(K=0;K<4;K++)L[(3&-K)+k]=ee[A>>>24]<<24^ee[O>>16&255]<<16^ee[B>>8&255]<<8^ee[N&255]^R[J++],j=A,A=O,O=B,B=N,N=j}}class s extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(b){this.jobs.push(b),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const o=function(v){return v<<24|(v&65280)<<8|(v&16711680)>>8|v>>>24},d=function(v,b,T){const C=new Int32Array(v.buffer,v.byteOffset,v.byteLength>>2),M=new r(Array.prototype.slice.call(b)),L=new Uint8Array(v.byteLength),k=new Int32Array(L.buffer);let R,A,O,B,N,j,W,F,z;for(R=T[0],A=T[1],O=T[2],B=T[3],z=0;z<C.length;z+=4)N=o(C[z]),j=o(C[z+1]),W=o(C[z+2]),F=o(C[z+3]),M.decrypt(N,j,W,F,k,z),k[z]=o(k[z]^R),k[z+1]=o(k[z+1]^A),k[z+2]=o(k[z+2]^O),k[z+3]=o(k[z+3]^B),R=N,A=j,O=W,B=F;return L};class f{constructor(b,T,C,M){const L=f.STEP,k=new Int32Array(b.buffer),R=new Uint8Array(b.byteLength);let A=0;for(this.asyncStream_=new s,this.asyncStream_.push(this.decryptChunk_(k.subarray(A,A+L),T,C,R)),A=L;A<k.length;A+=L)C=new Uint32Array([o(k[A-4]),o(k[A-3]),o(k[A-2]),o(k[A-1])]),this.asyncStream_.push(this.decryptChunk_(k.subarray(A,A+L),T,C,R));this.asyncStream_.push(function(){M(null,e(R))})}static get STEP(){return 32e3}decryptChunk_(b,T,C,M){return function(){const L=d(b,T,C);M.set(L,b.byteOffset)}}}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},p;typeof window<"u"?p=window:typeof h<"u"?p=h:typeof self<"u"?p=self:p={};var y=p,w=function(b){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(b):b&&b.buffer instanceof ArrayBuffer},P=y.BigInt||Number;P("0x1"),P("0x100"),P("0x10000"),P("0x1000000"),P("0x100000000"),P("0x10000000000"),P("0x1000000000000"),P("0x100000000000000"),P("0x10000000000000000"),(function(){var v=new Uint16Array([65484]),b=new Uint8Array(v.buffer,v.byteOffset,v.byteLength);return b[0]===255?"big":b[0]===204?"little":"unknown"})();const _=function(v){const b={};return Object.keys(v).forEach(T=>{const C=v[T];w(C)?b[T]={bytes:C.buffer,byteOffset:C.byteOffset,byteLength:C.byteLength}:b[T]=C}),b};self.onmessage=function(v){const b=v.data,T=new Uint8Array(b.encrypted.bytes,b.encrypted.byteOffset,b.encrypted.byteLength),C=new Uint32Array(b.key.bytes,b.key.byteOffset,b.key.byteLength/4),M=new Uint32Array(b.iv.bytes,b.iv.byteOffset,b.iv.byteLength/4);new f(T,C,M,function(L,k){self.postMessage(_({source:b.source,decrypted:k}),[k.buffer])})}}));var Mg=bl(Lg);const kg=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},Bl=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},Xr=(i,e)=>{e.activePlaylistLoader=i,i.load()},Rg=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:n},mediaTypes:{[i]:r}}=e,s=r.activeTrack(),o=r.getActiveGroup(),d=r.activePlaylistLoader,f=r.lastGroup_;if(!(o&&f&&o.id===f.id)&&(r.lastGroup_=o,r.lastTrack_=s,Bl(t,r),!(!o||o.isMainPlaylist))){if(!o.playlistLoader){d&&n.resetEverything();return}t.resyncLoader(),Xr(o.playlistLoader,r)}},Ug=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;n.lastGroup_=null,t.abort(),t.pause()},Bg=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:n,main:r},mediaTypes:{[i]:s}}=e,o=s.activeTrack(),d=s.getActiveGroup(),f=s.activePlaylistLoader,h=s.lastTrack_;if(!(h&&o&&h.id===o.id)&&(s.lastGroup_=d,s.lastTrack_=o,Bl(n,s),!!d)){if(d.isMainPlaylist){if(!o||!h||o.id===h.id)return;const p=e.vhs.playlistController_,y=p.selectPlaylist();if(p.media()===y)return;s.logger_(`track change. Switching main audio from ${h.id} to ${o.id}`),t.pause(),r.resetEverything(),p.fastQualityChange_(y);return}if(i==="AUDIO"){if(!d.playlistLoader){r.setAudio(!0),r.resetEverything();return}n.setAudio(!0),r.setAudio(!1)}if(f===d.playlistLoader){Xr(d.playlistLoader,s);return}n.track&&n.track(o),n.resetEverything(),Xr(d.playlistLoader,s)}},Fn={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:t},excludePlaylist:n}=e,r=t.activeTrack(),s=t.activeGroup(),o=(s.filter(f=>f.default)[0]||s[0]).id,d=t.tracks[o];if(r===d){n({error:{message:"Problem encountered loading the default audio track."}});return}H.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const f in t.tracks)t.tracks[f].enabled=t.tracks[f]===d;t.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:t}}=e;H.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const n=t.activeTrack();n&&(n.mode="disabled"),t.onTrackChanged()}},Ba={AUDIO:(i,e,t)=>{if(!e)return;const{tech:n,requestOptions:r,segmentLoaders:{[i]:s}}=t;e.on("loadedmetadata",()=>{const o=e.media();s.playlist(o,r),(!n.paused()||o.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Fn[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:n,requestOptions:r,segmentLoaders:{[i]:s},mediaTypes:{[i]:o}}=t;e.on("loadedmetadata",()=>{const d=e.media();s.playlist(d,r),s.track(o.activeTrack()),(!n.paused()||d.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",Fn[i](i,t))}},Ng={AUDIO:(i,e)=>{const{vhs:t,sourceType:n,segmentLoaders:{[i]:r},requestOptions:s,main:{mediaGroups:o},mediaTypes:{[i]:{groups:d,tracks:f,logger_:h}},mainPlaylistLoader:p}=e,y=Vi(p.main);(!o[i]||Object.keys(o[i]).length===0)&&(o[i]={main:{default:{default:!0}}},y&&(o[i].main.default.playlists=p.main.playlists));for(const w in o[i]){d[w]||(d[w]=[]);for(const P in o[i][w]){let _=o[i][w][P],v;if(y?(h(`AUDIO group '${w}' label '${P}' is a main playlist`),_.isMainPlaylist=!0,v=null):n==="vhs-json"&&_.playlists?v=new oi(_.playlists[0],t,s):_.resolvedUri?v=new oi(_.resolvedUri,t,s):_.playlists&&n==="dash"?v=new Hr(_.playlists[0],t,s,p):v=null,_=le({id:P,playlistLoader:v},_),Ba[i](i,_.playlistLoader,e),d[w].push(_),typeof f[P]>"u"){const b=new H.AudioTrack({id:P,kind:kg(_),enabled:!1,language:_.language,default:_.default,label:P});f[P]=b}}}r.on("error",Fn[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:n,sourceType:r,segmentLoaders:{[i]:s},requestOptions:o,main:{mediaGroups:d},mediaTypes:{[i]:{groups:f,tracks:h}},mainPlaylistLoader:p}=e;for(const y in d[i]){f[y]||(f[y]=[]);for(const w in d[i][y]){if(!n.options_.useForcedSubtitles&&d[i][y][w].forced)continue;let P=d[i][y][w],_;if(r==="hls")_=new oi(P.resolvedUri,n,o);else if(r==="dash"){if(!P.playlists.filter(b=>b.excludeUntil!==1/0).length)return;_=new Hr(P.playlists[0],n,o,p)}else r==="vhs-json"&&(_=new oi(P.playlists?P.playlists[0]:P.resolvedUri,n,o));if(P=le({id:w,playlistLoader:_},P),Ba[i](i,P.playlistLoader,e),f[y].push(P),typeof h[w]>"u"){const v=t.addRemoteTextTrack({id:w,kind:"subtitles",default:P.default&&P.autoselect,language:P.language,label:w},!1).track;h[w]=v}}}s.on("error",Fn[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:n},mediaTypes:{[i]:{groups:r,tracks:s}}}=e;for(const o in n[i]){r[o]||(r[o]=[]);for(const d in n[i][o]){const f=n[i][o][d];if(!/^(?:CC|SERVICE)/.test(f.instreamId))continue;const h=t.options_.vhs&&t.options_.vhs.captionServices||{};let p={label:d,language:f.language,instreamId:f.instreamId,default:f.default&&f.autoselect};if(h[p.instreamId]&&(p=le(p,h[p.instreamId])),p.default===void 0&&delete p.default,r[o].push(le({id:d},f)),typeof s[d]>"u"){const y=t.addRemoteTextTrack({id:p.instreamId,kind:"captions",default:p.default,language:p.language,label:p.label},!1).track;s[d]=y}}}}},Nl=(i,e)=>{for(let t=0;t<i.length;t++)if(cs(e,i[t])||i[t].playlists&&Nl(i[t].playlists,e))return!0;return!1},jg=(i,e)=>t=>{const{mainPlaylistLoader:n,mediaTypes:{[i]:{groups:r}}}=e,s=n.media();if(!s)return null;let o=null;s.attributes[i]&&(o=r[s.attributes[i]]);const d=Object.keys(r);if(!o)if(i==="AUDIO"&&d.length>1&&Vi(e.main))for(let f=0;f<d.length;f++){const h=r[d[f]];if(Nl(h,s)){o=h;break}}else r.main?o=r.main:d.length===1&&(o=r[d[0]]);return typeof t>"u"?o:t===null||!o?null:o.filter(f=>f.id===t.id)[0]||null},$g={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].enabled)return t[n];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].mode==="showing"||t[n].mode==="hidden")return t[n];return null}},Fg=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},qg=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(h=>{Ng[h](h,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:n,vhs:r,segmentLoaders:{["AUDIO"]:s,main:o}}=i;["AUDIO","SUBTITLES"].forEach(h=>{e[h].activeGroup=jg(h,i),e[h].activeTrack=$g[h](h,i),e[h].onGroupChanged=Rg(h,i),e[h].onGroupChanging=Ug(h,i),e[h].onTrackChanged=Bg(h,i),e[h].getActiveGroup=Fg(h,i)});const d=e.AUDIO.activeGroup();if(d){const h=(d.filter(y=>y.default)[0]||d[0]).id;e.AUDIO.tracks[h].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(o.setAudio(!1),s.setAudio(!0)):o.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(h=>e[h].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(h=>e[h].onGroupChanging())});const f=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",f),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",()=>{n.audioTracks().removeEventListener("change",f),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const h in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[h])},Wg=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Ut,activeTrack:Ut,getActiveGroup:Ut,onGroupChanged:Ut,onTrackChanged:Ut,lastTrack_:null,logger_:ot(`MediaGroups[${e}]`)}}),i};class Na{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=Je(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class Vg extends H.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Na,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=ot("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n){this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),this.trigger("error");return}if(n.startsWith("data:")){this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1));return}this.steeringManifest.reloadUri=Je(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const r={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:r}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(s,o)=>{if(s){if(o.status===410){this.logger_(`manifest request 410 ${s}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),this.excludedSteeringManifestURLs.add(n);return}if(o.status===429){const h=o.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${s}.`),this.logger_(`content steering will retry in ${h} seconds.`),this.startTTLTimeout_(parseInt(h,10));return}this.logger_(`manifest failed to load ${s}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:r});let d;try{d=JSON.parse(this.request_.responseText)}catch(h){const p={errorType:H.Error.StreamingContentSteeringParserError,error:h};this.trigger({type:"error",metadata:p})}this.assignSteeringProperties_(d);const f={contentSteeringInfo:r.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:f}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new V.URL(e),n=new V.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(V.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new V.URL(e),n=this.getPathway(),r=this.getBandwidth_();if(n){const s=`_${this.manifestType_}_pathway`;t.searchParams.set(s,n)}if(r){const s=`_${this.manifestType_}_throughput`;t.searchParams.set(s,r)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const n=(r=>{for(const s of r)if(this.availablePathways_.has(s))return s;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==n&&(this.currentPathway=n,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=r=>this.excludedSteeringManifestURLs.has(r);if(this.proxyServerUrl_){const r=this.setProxyServerUrl_(e);if(!t(r))return r}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=V.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){V.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Na}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(Je(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const Hg=(i,e)=>{let t=null;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{i.apply(null,n)},e)}},zg=10;let qt;const Gg=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],Qg=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},Yg=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:n,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:o,bufferBasedABR:d,log:f}){if(!n)return H.log.warn("We received no playlist to switch to. Please check your stream."),!1;const h=`allowing switch ${i&&i.id||"null"} -> ${n.id}`;if(!i)return f(`${h} as current playlist is not set`),!0;if(n.id===i.id)return!1;const p=!!ai(e,t).length;if(!i.endList)return!p&&typeof i.partTargetDuration=="number"?(f(`not ${h} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(f(`${h} as current playlist is live`),!0);const y=ls(e,t),w=d?Ue.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Ue.MAX_BUFFER_LOW_WATER_LINE;if(o<w)return f(`${h} as duration < max low water line (${o} < ${w})`),!0;const P=n.attributes.BANDWIDTH,_=i.attributes.BANDWIDTH;if(P<_&&(!d||y<s)){let v=`${h} as next bandwidth < current bandwidth (${P} < ${_})`;return d&&(v+=` and forwardBuffer < bufferHighWaterLine (${y} < ${s})`),f(v),!0}if((!d||P>_)&&y>=r){let v=`${h} as forwardBuffer >= bufferLowWaterLine (${y} >= ${r})`;return d&&(v+=` and next bandwidth > current bandwidth (${P} > ${_})`),f(v),!0}return f(`not ${h} as no switching criteria met`),!1};class Xg extends H.EventTarget{constructor(e){super(),this.fastQualityChange_=Hg(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:n,tech:r,bandwidth:s,externVhs:o,useCueTags:d,playlistExclusionDuration:f,enableLowInitialPlaylist:h,sourceType:p,cacheEncryptionKeys:y,bufferBasedABR:w,leastPixelDiffSelector:P,captionServices:_,experimentalUseMMS:v}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:b}=e;(b===null||typeof b>"u")&&(b=1/0),qt=o,this.bufferBasedABR=!!w,this.leastPixelDiffSelector=!!P,this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.player_=e.player_,this.sourceType_=p,this.useCueTags_=d,this.playlistExclusionDuration=f,this.maxPlaylistRetries=b,this.enableLowInitialPlaylist=h,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:b,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=Wg(),v&&V.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new V.ManagedMediaSource,this.usingManagedMediaSource_=!0,H.log("Using ManagedMediaSource")):V.MediaSource&&(this.mediaSource=new V.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=Be(),this.hasPlayed_=!1,this.syncController_=new Ag(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new Mg,this.sourceUpdater_=new Rl(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new Og,this.keyStatusMap_=new Map;const T={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:y,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new Hr(t,this.vhs_,le(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new oi(t,this.vhs_,le(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Qr(le(T,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Qr(le(T,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new Eg(le(T,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((L,k)=>{function R(){r.off("vttjserror",A),L()}function A(){r.off("vttjsloaded",R),k()}r.one("vttjsloaded",R),r.one("vttjserror",A),r.addWebVttScript_()})}),e);const C=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new Vg(this.vhs_.xhr,C),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),Gg.forEach(L=>{this[L+"_"]=Qg.bind(this,L)}),this.logger_=ot("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const M=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(M,()=>{const L=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-L,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),s=r&&(r.id||r.uri),o=e&&(e.id||e.uri);if(s&&s!==o){this.logger_(`switch media ${s} -> ${o} from ${t}`);const d={renditionInfo:{id:o,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:d}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,r=this.contentSteeringController_.getPathway();if(n&&r){const o=(n.length?n[0].playlists:n.playlists).filter(d=>d.attributes.serviceLocation===r);o.length&&this.mediaTypes_[e].activePlaylistLoader.media(o[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=V.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(V.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let s;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)s=this.mediaTypes_.AUDIO.activeTrack();else{const d=n.main||r.length&&n[r[0]];for(const f in d)if(d[f].default){s={label:f};break}}if(!s)return t;const o=[];for(const d in n)if(n[d][s.label]){const f=n[d][s.label];if(f.playlists&&f.playlists.length)o.push.apply(o,f.playlists);else if(f.uri)o.push(f);else if(e.playlists.length)for(let h=0;h<e.playlists.length;h++){const p=e.playlists[h];p.attributes&&p.attributes.AUDIO&&p.attributes.AUDIO===d&&o.push(p)}}return o.length?o:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const t=this.mainPlaylistLoader_.media(),n=t.targetDuration*1.5*1e3;$r(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,t.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.mainSegmentLoader_.load()),qg({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),t),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let t=this.mainPlaylistLoader_.media();if(!t){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let n;if(this.enableLowInitialPlaylist&&(n=this.selectInitialPlaylist()),n||(n=this.selectPlaylist()),!n||!this.shouldSwitchToMedia_(n)||(this.initialMedia_=n,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;t=this.initialMedia_}this.handleUpdatedMediaPlaylist(t)}),this.mainPlaylistLoader_.on("error",()=>{const t=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const t=this.mainPlaylistLoader_.media(),n=t.targetDuration*1.5*1e3;$r(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,this.sourceType_==="dash"&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const t=this.mainPlaylistLoader_.media();if(t.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(t)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(t=>{this.mainPlaylistLoader_.on(t,n=>{this.player_.trigger(Qe({},n))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const s=Object.keys(n.AUDIO);for(const o in n.AUDIO)for(const d in n.AUDIO[o])n.AUDIO[o][d].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),qt.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),s.length&&Object.keys(n.AUDIO[s[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),s=this.bufferHighWaterLine(),o=this.tech_.buffered();return Yg({buffered:o,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const n=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:n.playlist,error:n})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const n=this.audioSegmentLoader_.pendingSegment_;if(!n||!n.segment||!n.segment.syncInfo)return;const r=n.segment.syncInfo.end+.01;this.tech_.setCurrentTime(r)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",n=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:zg}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const n=this.getCodecsOrExclude_();n&&this.sourceUpdater_.addOrChangeSourceBuffers(n)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(n=>{this.mainSegmentLoader_.on(n,r=>{this.player_.trigger(Qe({},r))}),this.audioSegmentLoader_.on(n,r=>{this.player_.trigger(Qe({},r))}),this.subtitleSegmentLoader_.on(n,r=>{this.player_.trigger(Qe({},r))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let r=n;if(e.start){const s=e.start.timeOffset;s<0?r=Math.max(n+s,t.start(0)):r=Math.min(n,s)}this.trigger("firstplay"),this.tech_.setCurrentTime(r)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const r=qt.Playlist.playlistEnd(e,n),s=this.tech_.currentTime(),o=this.tech_.buffered();if(!o.length)return r-s<=St;const d=o.end(o.length-1);return d-s<=St&&r-d<=St}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,s=r.filter(Qn),o=s.length===1&&s[0]===e;if(r.length===1&&n!==1/0)return H.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(o);if(o){if(this.main().contentSteering){const _=this.pathwayAttribute_(e),v=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(_),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(_)},v);return}let P=!1;r.forEach(_=>{if(_===e)return;const v=_.excludeUntil;typeof v<"u"&&v!==1/0&&(P=!0,delete _.excludeUntil)}),P&&(H.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let d;e.playlistErrors_>this.maxPlaylistRetries?d=1/0:d=Date.now()+n*1e3,e.excludeUntil=d,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const f=this.selectPlaylist();if(!f){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const h=t.internal?this.logger_:H.log.warn,p=t.message?" "+t.message:"";h(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${p} Switching to playlist ${f.id}.`),f.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),f.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const y=f.targetDuration/2*1e3||5*1e3,w=typeof f.lastRequest=="number"&&Date.now()-f.lastRequest<=y;return this.switchMedia_(f,"exclude",o||w)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r=e==="all";(r||e==="main")&&n.push(this.mainPlaylistLoader_);const s=[];(r||e==="audio")&&s.push("AUDIO"),(r||e==="subtitle")&&(s.push("CLOSED-CAPTIONS"),s.push("SUBTITLES")),s.forEach(o=>{const d=this.mediaTypes_[o]&&this.mediaTypes_[o].activePlaylistLoader;d&&n.push(d)}),["main","audio","subtitle"].forEach(o=>{const d=this[`${o}SegmentLoader_`];d&&(e===o||e==="all")&&n.push(d)}),n.forEach(o=>t.forEach(d=>{typeof o[d]=="function"&&o[d]()}))}setCurrentTime(e){const t=ai(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:qt.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const n=e.media();if(!n)return null;const r=this.syncController_.getMediaSequenceSync(t);if(r&&r.isReliable){const d=r.start,f=r.end;if(!isFinite(d)||!isFinite(f))return null;const h=qt.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n),p=Math.max(d,f-h);return Be([[d,p]])}const s=this.syncController_.getExpiredTime(n,this.duration());if(s===null)return null;const o=qt.Playlist.seekable(n,s,qt.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return o.length?o:null}computeFinalSeekable_(e,t){if(!t)return e;const n=e.start(0),r=e.end(0),s=t.start(0),o=t.end(0);return s>r||n>o?e:Be([[Math.max(n,s),Math.min(r,o)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_||n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${Qo(this.seekable_)}]`);const r={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:r}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}const t=this.tech_.buffered();let n=qt.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(r=>{r.playlistLoader&&r.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=$i(this.main(),t),r={},s=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||th),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||ma}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||s)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||ma,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const o=(h,p)=>h?Ni(p,this.usingManagedMediaSource_):pr(p),d={};let f;if(["video","audio"].forEach(function(h){if(r.hasOwnProperty(h)&&!o(e[h].isFmp4,r[h])){const p=e[h].isFmp4?"browser":"muxer";d[p]=d[p]||[],d[p].push(r[h]),h==="audio"&&(f=p)}}),s&&f&&t.attributes.AUDIO){const h=t.attributes.AUDIO;this.main().playlists.forEach(p=>{(p.attributes&&p.attributes.AUDIO)===h&&p!==t&&(p.excludeUntil=1/0)}),this.logger_(`excluding audio group ${h} as ${f} does not support codec(s): "${r.audio}"`)}if(Object.keys(d).length){const h=Object.keys(d).reduce((p,y)=>(p&&(p+=", "),p+=`${y} does not support codec(s): "${d[y].join(",")}"`,p),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:h},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const h=[];if(["video","audio"].forEach(p=>{const y=(Rt(this.sourceUpdater_.codecs[p]||"")[0]||{}).type,w=(Rt(r[p]||"")[0]||{}).type;y&&w&&y.toLowerCase()!==w.toLowerCase()&&h.push(`"${this.sourceUpdater_.codecs[p]}" -> "${r[p]}"`)}),h.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${h.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return r}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const r=e[n];if(t.indexOf(r.id)!==-1)return;t.push(r.id);const s=$i(this.main,r),o=[];s.audio&&!pr(s.audio)&&!Ni(s.audio,this.usingManagedMediaSource_)&&o.push(`audio codec ${s.audio}`),s.video&&!pr(s.video)&&!Ni(s.video,this.usingManagedMediaSource_)&&o.push(`video codec ${s.video}`),s.text&&s.text==="stpp.ttml.im1t"&&o.push(`text codec ${s.text}`),o.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${o.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=qi(Rt(e)),s=ba(r),o=r.video&&Rt(r.video)[0]||null,d=r.audio&&Rt(r.audio)[0]||null;Object.keys(n).forEach(f=>{const h=n[f];if(t.indexOf(h.id)!==-1||h.excludeUntil===1/0)return;t.push(h.id);const p=[],y=$i(this.mainPlaylistLoader_.main,h),w=ba(y);if(!(!y.audio&&!y.video)){if(w!==s&&p.push(`codec count "${w}" !== "${s}"`),!this.sourceUpdater_.canChangeType()){const P=y.video&&Rt(y.video)[0]||null,_=y.audio&&Rt(y.audio)[0]||null;P&&o&&P.type.toLowerCase()!==o.type.toLowerCase()&&p.push(`video codec "${P.type}" !== "${o.type}"`),_&&d&&_.type.toLowerCase()!==d.type.toLowerCase()&&p.push(`audio codec "${_.type}" !== "${d.type}"`)}p.length&&(h.excludeUntil=1/0,this.logger_(`excluding ${h.id}: ${p.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),Cg(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Ue.GOAL_BUFFER_LENGTH,n=Ue.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Ue.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Ue.BUFFER_LOW_WATER_LINE,n=Ue.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Ue.MAX_BUFFER_LOW_WATER_LINE),s=Math.max(t,Ue.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?s:r)}bufferHighWaterLine(){return Ue.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){Ia(this.inbandTextTracks_,"com.apple.streaming",this.tech_),ag({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const r=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();Ia(this.inbandTextTracks_,e,this.tech_),ng({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:r,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(t=>{this.contentSteeringController_.on(t,n=>{this.trigger(Qe({},n))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const t=this.main();(this.contentSteeringController_.didDASHTagChange(t.uri,t.contentSteering)||(()=>{const s=this.contentSteeringController_.getAvailablePathways(),o=[];for(const d of t.playlists){const f=d.attributes.serviceLocation;if(f&&(o.push(f),!s.has(f)))return!0}return!!(!o.length&&s.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const n=this.main().playlists,r=new Set;let s=!1;Object.keys(n).forEach(o=>{const d=n[o],f=this.pathwayAttribute_(d),h=f&&e!==f;d.excludeUntil===1/0&&d.lastExcludeReason_==="content-steering"&&!h&&(delete d.excludeUntil,delete d.lastExcludeReason_,s=!0);const y=!d.excludeUntil&&d.excludeUntil!==1/0;!r.has(d.id)&&h&&y&&(r.add(d.id),d.excludeUntil=1/0,d.lastExcludeReason_="content-steering",this.logger_(`excluding ${d.id} for ${d.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(o=>{const d=this.mediaTypes_[o];if(d.activePlaylistLoader){const f=d.activePlaylistLoader.media_;f&&f.attributes.serviceLocation!==e&&(s=!0)}}),s&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,n=this.contentSteeringController_.currentPathwayClones,r=this.contentSteeringController_.nextPathwayClones;if(n&&n.size||r&&r.size){for(const[o,d]of n.entries())r.get(o)||(this.mainPlaylistLoader_.updateOrDeleteClone(d),this.contentSteeringController_.excludePathway(o));for(const[o,d]of r.entries()){const f=n.get(o);if(!f){t.filter(p=>p.attributes["PATHWAY-ID"]===d["BASE-ID"]).forEach(p=>{this.mainPlaylistLoader_.addClonePathway(d,p)}),this.contentSteeringController_.addAvailablePathway(o);continue}this.equalPathwayClones_(f,d)||(this.mainPlaylistLoader_.updateOrDeleteClone(d,!0),this.contentSteeringController_.addAvailablePathway(o))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...r])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,r=t["URI-REPLACEMENT"].PARAMS;for(const s in n)if(n[s]!==r[s])return!1;for(const s in r)if(n[s]!==r[s])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const r=this.mainPlaylistLoader_.getKeyIdSet(n);!r||!r.size||r.forEach(s=>{const o="usable",d=this.keyStatusMap_.has(s)&&this.keyStatusMap_.get(s)===o,f=n.lastExcludeReason_===t&&n.excludeUntil===1/0;d?d&&f&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${s} is ${o}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${s} doesn't exist in the keyStatusMap or is not ${o}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(n=>{const r=n&&n.attributes&&n.attributes.RESOLUTION&&n.attributes.RESOLUTION.height<720,s=n.excludeUntil===1/0&&n.lastExcludeReason_===t;r&&s&&(delete n.excludeUntil,H.log.warn(`enabling non-HD playlist ${n.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const s=(typeof e=="string"?e:wg(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${s} added to the keyStatusMap`),this.keyStatusMap_.set(s,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const Kg=(i,e,t)=>n=>{const r=i.main.playlists[e],s=us(r),o=Qn(r);if(typeof n>"u")return o;n?delete r.disabled:r.disabled=!0;const d={renditionInfo:{id:e,bandwidth:r.attributes.BANDWIDTH,resolution:r.attributes.RESOLUTION,codecs:r.attributes.CODECS},cause:"fast-quality"};return n!==o&&!s&&(n?(t(r),i.trigger({type:"renditionenabled",metadata:d})):i.trigger({type:"renditiondisabled",metadata:d})),n};class Jg{constructor(e,t,n){const{playlistController_:r}=e,s=r.fastQualityChange_.bind(r);if(t.attributes){const o=t.attributes.RESOLUTION;this.width=o&&o.width,this.height=o&&o.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=$i(r.main(),t),this.playlist=t,this.id=n,this.enabled=Kg(e.playlists,t.id,s)}}const Zg=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=Vi(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(n=>!us(n)).map((n,r)=>new Jg(i,n,n.id)):[]}},ja=["seeking","seeked","pause","playing","error"];class ey extends H.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=ot("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),o=this.playlistController_,d=["main","subtitle","audio"],f={};d.forEach(p=>{f[p]={reset:()=>this.resetSegmentDownloads_(p),updateend:()=>this.checkSegmentDownloads_(p)},o[`${p}SegmentLoader_`].on("appendsdone",f[p].updateend),o[`${p}SegmentLoader_`].on("playlistupdate",f[p].reset),this.tech_.on(["seeked","seeking"],f[p].reset)});const h=p=>{["main","audio"].forEach(y=>{o[`${y}SegmentLoader_`][p]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),h("off"))},this.clearSeekingAppendCheck_=()=>h("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),h("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(ja,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(ja,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),d.forEach(p=>{o[`${p}SegmentLoader_`].off("appendsdone",f[p].updateend),o[`${p}SegmentLoader_`].off("playlistupdate",f[p].reset),this.tech_.off(["seeked","seeking"],f[p].reset)}),this.checkCurrentTimeTimeout_&&V.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&V.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=V.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),s=jm(this[`${e}Buffered_`],r);if(this[`${e}Buffered_`]=r,s){const o={bufferedRanges:r};t.trigger({type:"bufferedrangeschanged",metadata:o}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:ei(r)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+St>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(Be([this.lastRecordedTime,e]));const n={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:n}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),n=this.tech_.currentTime(),r=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let s;if(r&&(s=t.end(t.length-1)),this.beforeSeekableWindow_(t,n)){const _=t.start(0);s=_+(_===t.end(0)?0:St)}if(typeof s<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${Qo(t)}. Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0;const o=this.playlistController_.sourceUpdater_,d=this.tech_.buffered(),f=o.audioBuffer?o.audioBuffered():null,h=o.videoBuffer?o.videoBuffered():null,p=this.media(),y=p.partTargetDuration?p.partTargetDuration:(p.targetDuration-bt)*2,w=[f,h];for(let _=0;_<w.length;_++){if(!w[_])continue;if(ls(w[_],n)<y)return!1}const P=Tn(d,n);return P.length===0?!1:(s=P.start(0)+St,this.logger_(`Buffered region starts (${P.start(0)})  just beyond seek point (${n}). Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=ai(t,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const d=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${d}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(d),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const o=Tn(r,t);return o.length>0?(this.logger_(`Stopped at ${t} and seeking to ${o.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let s=e.end(e.length-1)+St;const o=!n.endList,d=typeof n.partTargetDuration=="number";return o&&(d||r)&&(s=e.end(e.length-1)+n.targetDuration*3),t>s}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const s=ai(e,n-3),o=ai(e,n),d=ai(t,n);d.length&&!o.length&&s.length&&(r={start:s.end(0),end:d.end(0)})}else Tn(e,n).length||(r=this.gapFromVideoUnderflow_(e,n));return r?(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=Tn(t,n);if(this.resetTimeUpdate_(),r.length===0||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+bt);const s={gapInfo:{from:n,to:r.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:s}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const n=Um(e);for(let r=0;r<n.length;r++){const s=n.start(r),o=n.end(r);if(t-s<4&&t-s>2)return{start:s,end:o}}return null}}const ty={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},jl=function(i,e){let t=0,n=0;const r=le(ty,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){n&&i.currentTime(n)},o=function(p){p!=null&&(n=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",s),i.src(p),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},d=function(){if(Date.now()-t<r.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){H.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),r.getSource.call(i,o)},f=function(){i.off("loadedmetadata",s),i.off("error",d),i.off("dispose",f)},h=function(p){f(),jl(i,p)};i.on("error",d),i.on("dispose",f),i.reloadSourceOnError=h},iy=function(i){jl(this,i)};var $l="3.17.2",ny="7.1.0",ry="1.3.1",sy="7.2.0",ay="4.0.2";const Pe={PlaylistLoader:oi,Playlist:et,utils:cp,STANDARD_PLAYLIST_SELECTOR:Ca,INITIAL_PLAYLIST_SELECTOR:Jp,lastBandwidthSelector:Ca,movingAverageBandwidthSelector:Xp,comparePlaylistBandwidth:fs,comparePlaylistResolution:Yp,xhr:fl()};Object.keys(Ue).forEach(i=>{Object.defineProperty(Pe,i,{get(){return H.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),Ue[i]},set(e){if(H.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){H.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}Ue[i]=e}})});const Fl="videojs-vhs",ql=function(i,e){const t=e.media();let n=-1;for(let r=0;r<i.length;r++)if(i[r].id===t.id){n=r;break}i.selectedIndex_=n,i.trigger({selectedIndex:n,type:"change"})},oy=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),ql(i,e.playlists)};Pe.canPlaySource=function(){return H.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const ly=(i,e,t)=>{if(!i)return i;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=qi(Rt(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(n.audio=t.attributes.CODECS);const r=Nn(n.video),s=Nn(n.audio),o={};for(const d in i)o[d]={},s&&(o[d].audioContentType=s),r&&(o[d].videoContentType=r),e.contentProtection&&e.contentProtection[d]&&e.contentProtection[d].pssh&&(o[d].pssh=e.contentProtection[d].pssh),typeof i[d]=="string"&&(o[d].url=i[d]);return le(i,o)},dy=(i,e)=>i.reduce((t,n)=>{if(!n.contentProtection)return t;const r=e.reduce((s,o)=>{const d=n.contentProtection[o];return d&&d.pssh&&(s[o]={pssh:d.pssh}),s},{});return Object.keys(r).length&&t.push(r),t},[]),uy=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:n})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const r=t?n.concat([t]):n,s=dy(r,Object.keys(e)),o=[],d=[];return s.forEach(f=>{d.push(new Promise((h,p)=>{i.tech_.one("keysessioncreated",h)})),o.push(new Promise((h,p)=>{i.eme.initializeMediaKeys({keySystems:f},y=>{if(y){p(y);return}h()})}))}),Promise.race([Promise.all(o),Promise.race(d)])},cy=({player:i,sourceKeySystems:e,media:t,audioMedia:n})=>{const r=ly(e,t,n);return r?(i.currentSource().keySystems=r,r&&!i.eme?(H.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},Wl=()=>{if(!V.localStorage)return null;const i=V.localStorage.getItem(Fl);if(!i)return null;try{return JSON.parse(i)}catch{return null}},hy=i=>{if(!V.localStorage)return!1;let e=Wl();e=e?le(e,i):i;try{V.localStorage.setItem(Fl,JSON.stringify(e))}catch{return!1}return e},fy=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i,Vl=(i,e)=>{i._requestCallbackSet||(i._requestCallbackSet=new Set),i._requestCallbackSet.add(e)},Hl=(i,e)=>{i._responseCallbackSet||(i._responseCallbackSet=new Set),i._responseCallbackSet.add(e)},zl=(i,e)=>{i._requestCallbackSet&&(i._requestCallbackSet.delete(e),i._requestCallbackSet.size||delete i._requestCallbackSet)},Gl=(i,e)=>{i._responseCallbackSet&&(i._responseCallbackSet.delete(e),i._responseCallbackSet.size||delete i._responseCallbackSet)};Pe.supportsNativeHls=(function(){if(!ht||!ht.createElement)return!1;const i=ht.createElement("video");return H.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1})();Pe.supportsNativeDash=(function(){return!ht||!ht.createElement||!H.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(ht.createElement("video").canPlayType("application/dash+xml"))})();Pe.supportsTypeNatively=i=>i==="hls"?Pe.supportsNativeHls:i==="dash"?Pe.supportsNativeDash:!1;Pe.isSupported=function(){return H.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};Pe.xhr.onRequest=function(i){Vl(Pe.xhr,i)};Pe.xhr.onResponse=function(i){Hl(Pe.xhr,i)};Pe.xhr.offRequest=function(i){zl(Pe.xhr,i)};Pe.xhr.offResponse=function(i){Gl(Pe.xhr,i)};const my=H.getComponent("Component");class Ql extends my{constructor(e,t,n){if(super(t,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=ot("VhsHandler"),t.options_&&t.options_.playerId){const r=H.getPlayer(t.options_.playerId);this.player_=r}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(ht,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],r=>{const s=ht.fullscreenElement||ht.webkitFullscreenElement||ht.mozFullScreenElement||ht.msFullscreenElement;s&&s.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=le(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=typeof this.options_.useNetworkInformationApi<"u"?this.options_.useNetworkInformationApi:!0,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const n=Wl();n&&n.bandwidth&&(this.options_.bandwidth=n.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),n&&n.throughput&&(this.options_.throughput=n.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=Ue.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Ue.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(n=>{typeof this.source_[n]<"u"&&(this.options_[n]=this.source_[n])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=fy(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Pe,this.options_.sourceType=Uo(t),this.options_.seekTo=s=>{this.tech_.setCurrentTime(s)},this.options_.player_=this.player_,this.playlistController_=new Xg(this.options_);const n=le({liveRangeSafeTimeDelta:St},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new ey(n),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const s=H.players[this.tech_.options_.playerId];let o=this.playlistController_.error;typeof o=="object"&&!o.code?o.code=3:typeof o=="string"&&(o={message:o,code:3}),s.error(o)});const r=this.options_.bufferBasedABR?Pe.movingAverageBandwidthSelector(.55):Pe.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=Pe.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(s){this.playlistController_.selectPlaylist=s.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(s){this.playlistController_.mainSegmentLoader_.throughput.rate=s,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let s=this.playlistController_.mainSegmentLoader_.bandwidth;const o=V.navigator.connection||V.navigator.mozConnection||V.navigator.webkitConnection,d=1e7;if(this.options_.useNetworkInformationApi&&o){const f=o.downlink*1e3*1e3;f>=d&&s>=d?s=Math.max(s,f):s=f}return s},set(s){this.playlistController_.mainSegmentLoader_.bandwidth=s,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const s=1/(this.bandwidth||1);let o;return this.throughput>0?o=1/this.throughput:o=0,Math.floor(1/(s+o))},set(){H.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>ei(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>ei(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&hy({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{Zg(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=V.URL.createObjectURL(this.playlistController_.mediaSource),(H.browser.IS_ANY_SAFARI||H.browser.IS_IOS)&&this.options_.overrideNative&&this.options_.sourceType==="hls"&&typeof this.tech_.addSourceElement=="function"?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),uy({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=cy({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{this.playlistController_.updatePlaylistByKeyStatus(n.keyId,n.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=H.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{oy(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{ql(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":$l,"mux.js":ny,"mpd-parser":ry,"m3u8-parser":sy,"aes-decrypter":ay}}version(){return this.constructor.version()}canChangeType(){return Rl.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&V.URL.revokeObjectURL&&(V.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return _p({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return _l({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{Vl(this.xhr,e)},this.xhr.onResponse=e=>{Hl(this.xhr,e)},this.xhr.offRequest=e=>{zl(this.xhr,e)},this.xhr.offResponse=e=>{Gl(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(n=>{this.playlistController_.on(n,r=>{this.player_.trigger(Qe({},r))})}),t.forEach(n=>{this.playbackWatcher_.on(n,r=>{this.player_.trigger(Qe({},r))})})}}const qn={name:"videojs-http-streaming",VERSION:$l,canHandleSource(i,e={}){const t=le(H.options,e);return!t.vhs.experimentalUseMMS&&!Ni("avc1.4d400d,mp4a.40.2",!1)?!1:qn.canPlayType(i.type,t)},handleSource(i,e,t={}){const n=le(H.options,t);return e.vhs=new Ql(i,e,n),e.vhs.xhr=fl(),e.vhs.setupXhrHooks_(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=Uo(i);if(!t)return"";const n=qn.getOverrideNative(e);return!Pe.supportsTypeNatively(t)||n?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(H.browser.IS_ANY_SAFARI||H.browser.IS_IOS),{overrideNative:n=t}=e;return n}},py=()=>Ni("avc1.4d400d,mp4a.40.2",!0);py()&&H.getTech("Html5").registerSourceHandler(qn,0);H.VhsHandler=Ql;H.VhsSourceHandler=qn;H.Vhs=Pe;H.use||H.registerComponent("Vhs",Pe);H.options.vhs=H.options.vhs||{};(!H.getPlugin||!H.getPlugin("reloadSourceOnError"))&&H.registerPlugin("reloadSourceOnError",iy);ph();const Bi=({src:i,onEnded:e})=>{const t=X.useRef(null),n=X.useRef(null),r=X.useRef(null),s=Ic(),o=Dc(d=>d.settings.volume);return X.useEffect(()=>{if(!t.current||!i)return;const d=i.includes("youtube.com")||i.includes("youtu.be");n.current=H(t.current,{controls:!0,autoplay:!0,fluid:!0,responsive:!0,aspectRatio:"16:9",bigPlayButton:!1,preload:"auto",playbackRates:[.5,.75,1,1.25,1.5,2],sources:d?[{src:i,type:"video/youtube"}]:[{src:i,type:i.includes(".m3u8")?"application/x-mpegURL":"video/mp4"}],techOrder:d?["youtube","html5"]:["html5"]});const f=n.current;return f&&(f.fill(!0),f.volume(o),f.on("volumechange",()=>{const h=f.volume();s(Ac(h))}),f.on("error",h=>{console.error("Video player error:",h)}),f.on("loadedmetadata",()=>{f.paused()&&f.play()?.catch(h=>{console.warn("Play failed:",h)})}),e&&f.on("ended",e)),()=>{if(r.current&&(clearTimeout(r.current),r.current=null),n.current&&!n.current.isDisposed())try{try{n.current.pause()}catch{}r.current=window.setTimeout(()=>{try{n.current&&!n.current.isDisposed()&&n.current.dispose()}catch(h){console.warn("Error during Video.js dispose:",h)}n.current=null,r.current=null},50)}catch(h){console.warn("Error during Video.js dispose scheduling:",h);try{n.current.dispose()}catch{}n.current=null}}},[i]),i?E.jsx("div",{"data-vjs-player":!0,children:E.jsx("video",{ref:t,className:"video-js vjs-default-skin"})}):null},gy=({src:i,title:e="TikTok Video",autoplayEnabled:t=!1})=>{const n=X.useRef(null),r=Ye();return X.useEffect(()=>{const s=o=>{if(o.origin!=="https://www.tiktok.com"||!o.data||typeof o.data!="object")return;const{type:d,value:f,["x-tiktok-player"]:h}=o.data;h&&d==="onStateChange"&&(f===0&&t&&r(st({set:!0})),n.current?.contentWindow?.postMessage({type:"unMute","x-tiktok-player":!0},"*"))};return window.addEventListener("message",s),()=>window.removeEventListener("message",s)},[r,t]),E.jsx("iframe",{ref:n,src:i,title:e,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay; fullscreen",allowFullScreen:!0})};function $a(i){const e=Le.c(8),{src:t,title:n,autoplayEnabled:r,dispatch:s}=i;let o,d;e[0]!==r||e[1]!==s?(o=()=>{if(r){const p=setTimeout(()=>{s(st({set:!0}))},5e3);return()=>clearTimeout(p)}},d=[r,s],e[0]=r,e[1]=s,e[2]=o,e[3]=d):(o=e[2],d=e[3]),X.useEffect(o,d);let f;e[4]===Symbol.for("react.memo_cache_sentinel")?(f={maxWidth:"100%",maxHeight:"100%",width:"auto",height:"auto",objectFit:"contain",display:"block",background:"black",margin:"auto",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},e[4]=f):f=e[4];let h;return e[5]!==t||e[6]!==n?(h=E.jsx("img",{src:t,alt:n,style:f}),e[5]=t,e[6]=n,e[7]=h):h=e[7],h}var Qt={},Dt={},wr={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Fa;function lt(){return Fa||(Fa=1,(function(i){(function(){var e={}.hasOwnProperty;function t(){for(var s="",o=0;o<arguments.length;o++){var d=arguments[o];d&&(s=r(s,n(d)))}return s}function n(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var d in s)e.call(s,d)&&s[d]&&(o=r(o,d));return o}function r(s,o){return o?s?s+" "+o:s+o:s}i.exports?(t.default=t,i.exports=t):window.classNames=t})()})(wr)),wr.exports}var Yt={},qa;function ms(){if(qa)return Yt;qa=1;var i=Yt&&Yt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.useFrame=void 0;const e=i(at()),t=n=>e.default.useMemo(()=>n||{document:typeof document<"u"?document:void 0,window:typeof window<"u"?window:void 0},[n]);return Yt.useFrame=t,Yt}var At={},Ot={},Wa;function Wt(){if(Wa)return Ot;Wa=1;var i=Ot&&Ot.__rest||function(s,o){var d={};for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&o.indexOf(f)<0&&(d[f]=s[f]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,f=Object.getOwnPropertySymbols(s);h<f.length;h++)o.indexOf(f[h])<0&&Object.prototype.propertyIsEnumerable.call(s,f[h])&&(d[f[h]]=s[f[h]]);return d},e=Ot&&Ot.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.EmbedStyle=void 0;const t=e(lt()),n=e(at()),r=s=>{var o=i(s,[]);return n.default.createElement("style",Object.assign({},o,{className:(0,t.default)(o.className),style:Object.assign({},o.style)}),`
        .rsme-embed .rsme-d-none {
          display: none;
        }
    
        .rsme-embed .twitter-tweet {
          margin: 0 !important;
        }
    
        .rsme-embed blockquote {
          margin: 0 !important;
          padding: 0 !important;
        }

        .rsme-embed.rsme-facebook-embed .fb-post iframe {
          width: 100% !important;
        }

        .rsme-embed.rsme-facebook-embed .fb-post span {
          width: 100% !important;
        }
      `)};return Ot.EmbedStyle=r,Ot}var Lt={},Va;function Yl(){if(Va)return Lt;Va=1;var i=Lt&&Lt.__rest||function(s,o){var d={};for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&o.indexOf(f)<0&&(d[f]=s[f]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,f=Object.getOwnPropertySymbols(s);h<f.length;h++)o.indexOf(f[h])<0&&Object.prototype.propertyIsEnumerable.call(s,f[h])&&(d[f[h]]=s[f[h]]);return d},e=Lt&&Lt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.BorderSpinner=void 0;const t=e(lt()),n=e(at()),r=s=>{var o=i(s,[]);return n.default.createElement(n.default.Fragment,null,n.default.createElement("style",null,`
        .rsme-spinner {
          border: 3px solid rgba(0,0,0,0.75);
          border-right-color: transparent;
          border-radius: 50%;
          animation: rsme-spin 1s linear infinite;
        }
        @keyframes rsme-spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }  
      `),n.default.createElement("div",Object.assign({},o,{className:(0,t.default)("rsme-spinner",o.className),style:Object.assign({width:10,height:10},o.style)})))};return Lt.BorderSpinner=r,Lt}var Xt={},Ha;function yy(){return Ha||(Ha=1,(function(i){var e=Xt&&Xt.__rest||function(h,p){var y={};for(var w in h)Object.prototype.hasOwnProperty.call(h,w)&&p.indexOf(w)<0&&(y[w]=h[w]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,w=Object.getOwnPropertySymbols(h);P<w.length;P++)p.indexOf(w[P])<0&&Object.prototype.propertyIsEnumerable.call(h,w[P])&&(y[w[P]]=h[w[P]]);return y},t=Xt&&Xt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(i,"__esModule",{value:!0}),i.ShareArrowIcon=i.ChatBubbleIcon=i.HeartIcon=i.EngagementIconsPlaceholder=void 0;const n=t(lt()),r=t(at()),s=h=>{var p=e(h,[]);return r.default.createElement("div",Object.assign({},p,{className:(0,n.default)(p.className),style:Object.assign({display:"flex",alignItems:"center",columnGap:14},p.style)}),r.default.createElement(i.HeartIcon,null),r.default.createElement(i.ChatBubbleIcon,null),r.default.createElement(i.ShareArrowIcon,null))};i.EngagementIconsPlaceholder=s;const o=h=>r.default.createElement("div",Object.assign({},h),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"12.5px",width:"12.5px",transform:"translateX(0px) translateY(7px)"}}),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",height:"12.5px",transform:"rotate(-45deg) translateX(3px) translateY(1px)",width:"12.5px",flexGrow:0,marginRight:"6px",marginLeft:"2px"}}),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"12.5px",width:"12.5px",transform:"translateX(9px) translateY(-18px)"}}));i.HeartIcon=o;const d=h=>r.default.createElement("div",Object.assign({},h),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"20px",width:"20px"}}),r.default.createElement("div",{style:{width:0,height:0,borderTop:"2px solid transparent",borderLeft:"6px solid #f4f4f4",borderBottom:"2px solid transparent",transform:"translateX(16px) translateY(-4px) rotate(30deg)"}}));i.ChatBubbleIcon=d;const f=h=>r.default.createElement("div",Object.assign({},h,{style:{height:25,width:25,transform:"translateX(0px) translateY(-2px)"}}),r.default.createElement("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512",xmlSpace:"preserve"},r.default.createElement("path",{style:{fill:"#F4F4F4"},d:`M295.204,180.593C132.168,180.593,0,312.759,0,475.796
c51.398-130.047,184.869-203.22,317.483-183.603L295.204,180.593z`}),r.default.createElement("path",{style:{fill:"#F4F4F4"},d:`M512,253L295.204,36.204v217.818C159.946,249.655,34.992,339.262,0,475.794
c59.905-109.171,178.724-165.463,295.204-151.033v145.035L512,253z`})));i.ShareArrowIcon=f})(Xt)),Xt}var Mt={},za;function _y(){if(za)return Mt;za=1;var i=Mt&&Mt.__rest||function(s,o){var d={};for(var f in s)Object.prototype.hasOwnProperty.call(s,f)&&o.indexOf(f)<0&&(d[f]=s[f]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,f=Object.getOwnPropertySymbols(s);h<f.length;h++)o.indexOf(f[h])<0&&Object.prototype.propertyIsEnumerable.call(s,f[h])&&(d[f[h]]=s[f[h]]);return d},e=Mt&&Mt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.ProfilePlaceholder=void 0;const t=e(lt()),n=e(at()),r=s=>{var o=i(s,[]);return n.default.createElement("div",Object.assign({},o,{className:(0,t.default)(o.className),style:Object.assign({},o.style)}),n.default.createElement("div",{style:{display:"flex",columnGap:14}},n.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",width:40,height:40}}),n.default.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",rowGap:6}},n.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:4,width:100,height:14}}),n.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:4,width:60,height:14}}))))};return Mt.ProfilePlaceholder=r,Mt}var Ga;function Vt(){if(Ga)return At;Ga=1;var i=At&&At.__rest||function(p,y){var w={};for(var P in p)Object.prototype.hasOwnProperty.call(p,P)&&y.indexOf(P)<0&&(w[P]=p[P]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,P=Object.getOwnPropertySymbols(p);_<P.length;_++)y.indexOf(P[_])<0&&Object.prototype.propertyIsEnumerable.call(p,P[_])&&(w[P[_]]=p[P[_]]);return w},e=At&&At.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(At,"__esModule",{value:!0}),At.PlaceholderEmbed=void 0;const t=e(lt()),n=e(at()),r=Wt(),s=Yl(),o=yy(),d=_y(),f=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,h=p=>{var y,{url:w,linkText:P="View post",imageUrl:_,spinner:v=n.default.createElement(s.BorderSpinner,null),allowJavaScriptUrls:b=!0,spinnerDisabled:T}=p,C=i(p,["url","linkText","imageUrl","spinner","allowJavaScriptUrls","spinnerDisabled"]);return f.test(w)&&!b?(console.warn("PlaceholderEmbed has blocked a javascript: URL as a security precaution"),null):n.default.createElement("div",Object.assign({},C,{className:(0,t.default)(C.className),style:Object.assign({overflow:"hidden",border:"1px solid #dee2e6",backgroundColor:"#ffffff",borderRadius:0,boxSizing:"border-box",position:"relative"},C.style)}),n.default.createElement(r.EmbedStyle,null),n.default.createElement("a",{href:w,style:{textDecoration:"none"},target:"_blank",rel:"noopener noreferrer"},!_&&n.default.createElement("div",{style:{position:"absolute",top:0,left:0,display:"flex",justifyContent:"space-between",alignItems:"start",paddingLeft:16,paddingRight:16,paddingTop:16,paddingBottom:16,zIndex:2,backgroundColor:"#ffffff"}},n.default.createElement(d.ProfilePlaceholder,null)),n.default.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:_?"start":"center",height:"100%",width:"100%"}},!_&&n.default.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",rowGap:16,zIndex:3,padding:8,backgroundColor:"#ffffff"}},!T&&v,!!P&&n.default.createElement("div",{style:{color:"#000000",fontFamily:"Arial,sans-serif",fontSize:"14px",fontStyle:"normal",fontWeight:550,lineHeight:"18px",textAlign:"center"}},P)),_&&(typeof((y=C.style)===null||y===void 0?void 0:y.height)<"u"?n.default.createElement("div",{style:{width:"100%",height:"100%",background:`url("${_}")`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center",marginBottom:"40"}}):n.default.createElement("div",{style:{width:"100%",marginBottom:40}},n.default.createElement("img",{src:_,style:{width:"100%"}})))),n.default.createElement("div",{style:{position:"absolute",bottom:0,left:0,height:40,width:"100%",backgroundColor:"#ffffff",zIndex:1}},!_&&n.default.createElement(o.EngagementIconsPlaceholder,{style:{marginLeft:16}}),_&&n.default.createElement("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"space-between",columnGap:16}},n.default.createElement("div",{style:{color:"#0095f6",fontWeight:600,fontFamily:"Arial,sans-serif",fontSize:"14px",fontStyle:"normal",whiteSpace:"nowrap",marginLeft:16}},P),!T&&n.default.createElement("div",{style:{marginRight:16}},v)))))};return At.PlaceholderEmbed=h,At}var ki={},Qa;function ps(){if(Qa)return ki;Qa=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.generateUUID=void 0;const i=()=>{let e=new Date().getTime(),t=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(n==="x"?r:r&3|8).toString(16)})};return ki.generateUUID=i,ki}var Kt={},Ya;function gs(){if(Ya)return Kt;Ya=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Subs=Kt.Subscribe=void 0;class i{static subscribe(n){try{return n()}catch(r){console.error(r)}return()=>{}}static subscribeEvent(n,r,s){return n.addListener(r,s),()=>{n.removeListener(r,s)}}static subscribeDOMEvent(n,r,s,o){return n.addEventListener(r,s,o),()=>{n.removeEventListener(r,s,o)}}static setTimeout(n,r,...s){const o=setTimeout(n,r,s);return()=>clearTimeout(o)}static setInterval(n,r,...s){const o=setInterval(n,r,s);return()=>clearInterval(o)}static unsubAll(n){if(Array.isArray(n))n.forEach(r=>{try{r()}catch(s){console.error(s)}});else try{n()}catch(r){console.error(r)}}static createCleanup(n){return()=>i.unsubAll(n)}}Kt.Subscribe=i;class e{constructor(n=[]){this.list=n}subscribe(n){const r=i.subscribe(n);return this.push(r),r}subscribeEvent(n,r,s){const o=i.subscribeEvent(n,r,s);return this.push(o),o}subscribeDOMEvent(n,r,s){const o=i.subscribeDOMEvent(n,r,s);return this.push(o),o}setTimeout(n,r,...s){const o=setTimeout(n,r,s),d=()=>clearTimeout(o);return this.push(d),d}setInterval(n,r,...s){const o=setInterval(n,r,s),d=()=>clearInterval(o);return this.push(d),d}push(n){this.list.push(n)}unsubAll(){i.unsubAll(this.list),this.list.splice(0,this.list.length)}createCleanup(){return()=>{this.unsubAll()}}}return Kt.Subs=e,Kt}var Xa;function vy(){if(Xa)return Dt;Xa=1;var i=Dt&&Dt.__rest||function(R,A){var O={};for(var B in R)Object.prototype.hasOwnProperty.call(R,B)&&A.indexOf(B)<0&&(O[B]=R[B]);if(R!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,B=Object.getOwnPropertySymbols(R);N<B.length;N++)A.indexOf(B[N])<0&&Object.prototype.propertyIsEnumerable.call(R,B[N])&&(O[B[N]]=R[B[N]]);return O},e=Dt&&Dt.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.FacebookEmbed=void 0;const t=e(lt()),n=e(at()),r=ms(),s=Vt(),o=ps(),d=Wt(),f=gs(),h="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v16.0",p=550,y=p,w=372,P=3,_="check-script",v="load-script",b="confirm-script-loaded",T="process-embed",C="confirm-embed-success",M="retrying",L="embed-success",k=R=>{var A,O,{url:B,width:N,height:j,linkText:W="View post on Facebook",placeholderImageUrl:F,placeholderSpinner:z,placeholderSpinnerDisabled:K=!1,placeholderProps:J,embedPlaceholder:Z,placeholderDisabled:se=!1,scriptLoadDisabled:ae=!1,retryDelay:ce=5e3,retryDisabled:fe=!1,frame:ee=void 0,debug:ye=!1}=R,ge=i(R,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","frame","debug"]);const[oe,xe]=n.default.useState(_),ke=n.default.useMemo(()=>oe===L,[oe]),de=n.default.useRef((0,o.generateUUID)()),[he,Ee]=n.default.useState(Date.now()),De=n.default.useMemo(()=>`${de.current}-${he}`,[he]),re=(0,r.useFrame)(ee);n.default.useEffect(()=>{ye&&console.log(`[${new Date().toISOString()}]: ${oe}`)},[ye,oe]),n.default.useEffect(()=>{var Se,me,Oe;oe===_&&(!((Oe=(me=(Se=re.window)===null||Se===void 0?void 0:Se.FB)===null||me===void 0?void 0:me.XFBML)===null||Oe===void 0)&&Oe.parse?xe(T):ae?console.error("Facebook embed script not found. Unable to process Facebook embed:",B):xe(v))},[ae,oe,B,re.window]),n.default.useEffect(()=>{if(oe===v&&re.document){const Se=re.document.createElement("script");Se.setAttribute("src",h),re.document.head.appendChild(Se),xe(b)}},[oe,re.document]),n.default.useEffect(()=>{const Se=new f.Subs;return oe===b&&Se.setInterval(()=>{var me,Oe,ne;!((ne=(Oe=(me=re.window)===null||me===void 0?void 0:me.FB)===null||Oe===void 0?void 0:Oe.XFBML)===null||ne===void 0)&&ne.parse&&xe(T)},1),Se.createCleanup()},[oe,re.window]),n.default.useEffect(()=>{var Se,me,Oe;if(oe===T){const ne=(Oe=(me=(Se=re.window)===null||Se===void 0?void 0:Se.FB)===null||me===void 0?void 0:me.XFBML)===null||Oe===void 0?void 0:Oe.parse;ne?(ne(),xe(C)):console.error("Facebook embed script not found. Unable to process Facebook embed:",B)}},[oe,B,re.window]),n.default.useEffect(()=>{const Se=new f.Subs;return oe===C&&(Se.setInterval(()=>{if(re.document){const me=re.document.getElementById(de.current);if(me){const Oe=me.getElementsByClassName("fb-post")[0];Oe&&Oe.children.length>0&&xe(L)}}},1),fe||Se.setTimeout(()=>{xe(M)},ce)),Se.createCleanup()},[fe,ce,oe,re.document]),n.default.useEffect(()=>{oe===M&&(Ee(Date.now()),xe(T))},[oe]);const Ae=!!N?.toString().includes("%"),Ne=!!j?.toString().includes("%"),Me={maxWidth:Ae?void 0:y,width:typeof N<"u"?Ae?"100%":N:"100%",height:Ne?"100%":typeof j<"u"?j:typeof((A=ge.style)===null||A===void 0?void 0:A.height)<"u"||typeof((O=ge.style)===null||O===void 0?void 0:O.maxHeight)<"u"?"100%":w,border:"1px solid #dee2e6",borderRadius:P},Bt=Z??n.default.createElement(s.PlaceholderEmbed,Object.assign({url:B,imageUrl:F,linkText:W,spinner:z,spinnerDisabled:K},J,{style:Object.assign(Object.assign({},Me),J?.style)}));return n.default.createElement("div",Object.assign({},ge,{className:(0,t.default)("rsme-embed rsme-facebook-embed",ge.className),style:Object.assign({overflow:"hidden",width:N??void 0,height:j??void 0,borderRadius:P},ge.style)}),n.default.createElement(d.EmbedStyle,null),n.default.createElement("div",{id:de.current,className:(0,t.default)(!ke&&"rsme-d-none")},n.default.createElement("div",{key:De,className:"fb-post","data-href":B,"data-width":Ae?"100%":N??p,style:{width:Ae?"100%":N??p,height:Ne?"100%":j??void 0}})),!ke&&!se&&Bt)};return Dt.FacebookEmbed=k,Dt}var We={},Ka;function by(){if(Ka)return We;Ka=1;var i=We&&We.__createBinding||(Object.create?(function(O,B,N,j){j===void 0&&(j=N);var W=Object.getOwnPropertyDescriptor(B,N);(!W||("get"in W?!B.__esModule:W.writable||W.configurable))&&(W={enumerable:!0,get:function(){return B[N]}}),Object.defineProperty(O,j,W)}):(function(O,B,N,j){j===void 0&&(j=N),O[j]=B[N]})),e=We&&We.__setModuleDefault||(Object.create?(function(O,B){Object.defineProperty(O,"default",{enumerable:!0,value:B})}):function(O,B){O.default=B}),t=We&&We.__importStar||function(O){if(O&&O.__esModule)return O;var B={};if(O!=null)for(var N in O)N!=="default"&&Object.prototype.hasOwnProperty.call(O,N)&&i(B,O,N);return e(B,O),B},n=We&&We.__rest||function(O,B){var N={};for(var j in O)Object.prototype.hasOwnProperty.call(O,j)&&B.indexOf(j)<0&&(N[j]=O[j]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function")for(var W=0,j=Object.getOwnPropertySymbols(O);W<j.length;W++)B.indexOf(j[W])<0&&Object.prototype.propertyIsEnumerable.call(O,j[W])&&(N[j[W]]=O[j[W]]);return N},r=We&&We.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(We,"__esModule",{value:!0}),We.InstagramEmbed=void 0;const s=r(lt()),o=t(at()),d=gs(),f=ms(),h=Vt(),p=ps(),y=Wt(),w="https://www.instagram.com/embed.js",P=328,_=372,v=3,b="check-script",T="load-script",C="confirm-script-loaded",M="process-embed",L="confirm-embed-success",k="retrying",R="embed-success",A=O=>{var B,N,{url:j,width:W,height:F,linkText:z="View post on Instagram",captioned:K=!1,placeholderImageUrl:J,placeholderSpinner:Z,placeholderSpinnerDisabled:se=!1,placeholderProps:ae,embedPlaceholder:ce,placeholderDisabled:fe=!1,scriptLoadDisabled:ee=!1,retryDelay:ye=5e3,retryDisabled:ge=!1,igVersion:oe="14",frame:xe=void 0,debug:ke=!1}=O,de=n(O,["url","width","height","linkText","captioned","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","igVersion","frame","debug"]);const[he,Ee]=o.useState(b),De=o.useRef((0,p.generateUUID)()),[re,Ae]=o.useState(Date.now()),Ne=o.useMemo(()=>`${De.current}-${re}`,[re]),Me=(0,f.useFrame)(xe);o.useEffect(()=>{ke&&console.log(`[${new Date().toISOString()}]: ${he}`)},[ke,he]),o.useEffect(()=>{var Ce,Xe,Fe;he===b&&(!((Fe=(Xe=(Ce=Me.window)===null||Ce===void 0?void 0:Ce.instgrm)===null||Xe===void 0?void 0:Xe.Embeds)===null||Fe===void 0)&&Fe.process?Ee(M):ee?console.error("Instagram embed script not found. Unable to process Instagram embed:",j):Ee(T))},[ee,he,j,Me.window]),o.useEffect(()=>{if(he===T&&Me.document){const Ce=Me.document.createElement("script");Ce.setAttribute("src",w),Me.document.head.appendChild(Ce),Ee(C)}},[he,Me.document]),o.useEffect(()=>{const Ce=new d.Subs;return he===C&&Ce.setInterval(()=>{var Xe,Fe,pt;!((pt=(Fe=(Xe=Me.window)===null||Xe===void 0?void 0:Xe.instgrm)===null||Fe===void 0?void 0:Fe.Embeds)===null||pt===void 0)&&pt.process&&Ee(M)},1),Ce.createCleanup()},[he,Me.window]),o.useEffect(()=>{var Ce,Xe,Fe;if(he===M){const pt=(Fe=(Xe=(Ce=Me.window)===null||Ce===void 0?void 0:Ce.instgrm)===null||Xe===void 0?void 0:Xe.Embeds)===null||Fe===void 0?void 0:Fe.process;pt?(pt(),Ee(L)):console.error("Instagram embed script not found. Unable to process Instagram embed:",j)}},[he,Me.window,j]),o.useEffect(()=>{const Ce=new d.Subs;return he===L&&(Ce.setInterval(()=>{Me.document&&(Me.document.getElementById(De.current)||Ee(R))},1),ge||Ce.setTimeout(()=>{Ee(k)},ye)),Ce.createCleanup()},[ye,ge,he,Me.document]),o.useEffect(()=>{he===k&&(Ae(Date.now()),Ee(M))},[he]);const Bt=j.split(/[?#]/)[0].replace(/\.com\/.*?\/p/,".com/p").replace(/\.com\/.*?\/reel/,".com/reel"),Se=`${Bt}${Bt.endsWith("/")?"":"/"}`,me=!!W?.toString().includes("%"),Oe=!!F?.toString().includes("%"),ne={minWidth:me?void 0:P,width:typeof W<"u"?me?"100%":W:"100%",height:Oe?"100%":typeof F<"u"?F:typeof((B=de.style)===null||B===void 0?void 0:B.height)<"u"||typeof((N=de.style)===null||N===void 0?void 0:N.maxHeight)<"u"?"100%":_,border:"1px solid #dee2e6",borderRadius:v},Xn=ce??o.createElement(h.PlaceholderEmbed,Object.assign({url:Se,imageUrl:J,linkText:z,spinner:Z,spinnerDisabled:se},ae,{style:Object.assign(Object.assign({},ne),ae?.style)}));return o.createElement("div",Object.assign({},de,{className:(0,s.default)("rsme-embed rsme-instagram-embed",De.current,de.className),style:Object.assign(Object.assign({overflow:"hidden",width:W??void 0,height:F??void 0,borderRadius:v},de.style),{position:"relative"})}),o.createElement(y.EmbedStyle,null),o.createElement("blockquote",{key:Ne,className:"instagram-media","data-instgrm-permalink":`${Se}?utm_source=ig_embed&utm_campaign=loading`,"data-instgrm-version":oe,"data-instgrm-captioned":K||void 0,"data-width":me?"100%":W??void 0,style:{width:"calc(100% - 2px)"}},!fe&&Xn,o.createElement("div",{id:De.current,className:"instagram-media-pre-embed rsme-d-none"}," ")))};return We.InstagramEmbed=A,We}var Ve={},Ja;function Sy(){if(Ja)return Ve;Ja=1;var i=Ve&&Ve.__createBinding||(Object.create?(function(_,v,b,T){T===void 0&&(T=b);var C=Object.getOwnPropertyDescriptor(v,b);(!C||("get"in C?!v.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return v[b]}}),Object.defineProperty(_,T,C)}):(function(_,v,b,T){T===void 0&&(T=b),_[T]=v[b]})),e=Ve&&Ve.__setModuleDefault||(Object.create?(function(_,v){Object.defineProperty(_,"default",{enumerable:!0,value:v})}):function(_,v){_.default=v}),t=Ve&&Ve.__importStar||function(_){if(_&&_.__esModule)return _;var v={};if(_!=null)for(var b in _)b!=="default"&&Object.prototype.hasOwnProperty.call(_,b)&&i(v,_,b);return e(v,_),v},n=Ve&&Ve.__rest||function(_,v){var b={};for(var T in _)Object.prototype.hasOwnProperty.call(_,T)&&v.indexOf(T)<0&&(b[T]=_[T]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var C=0,T=Object.getOwnPropertySymbols(_);C<T.length;C++)v.indexOf(T[C])<0&&Object.prototype.propertyIsEnumerable.call(_,T[C])&&(b[T[C]]=_[T[C]]);return b},r=Ve&&Ve.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.LinkedInEmbed=void 0;const s=r(lt()),o=t(at()),d=Vt(),f=Wt(),h=250,p=550,y=550,w=8,P=_=>{var v,b,{url:T,postUrl:C,width:M,height:L=500,linkText:k="View post on LinkedIn",placeholderImageUrl:R,placeholderSpinner:A,placeholderSpinnerDisabled:O=!1,placeholderProps:B,embedPlaceholder:N,placeholderDisabled:j=!1}=_,W=n(_,["url","postUrl","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled"]);const[F,z]=o.useState(!1),K={minWidth:h,maxWidth:p,width:typeof M<"u"?M:"100%",height:typeof L<"u"?L:typeof((v=W.style)===null||v===void 0?void 0:v.height)<"u"||typeof((b=W.style)===null||b===void 0?void 0:b.maxHeight)<"u"?"100%":y,border:"solid 1px rgba(0, 0, 0, 0.15)",borderRadius:w},J=N??o.createElement(d.PlaceholderEmbed,Object.assign({url:C??T,imageUrl:R,linkText:k,spinner:A,spinnerDisabled:O},B,{style:Object.assign(Object.assign({},K),B?.style)}));return o.createElement("div",Object.assign({},W,{className:(0,s.default)("rsme-embed rsme-linkedin-embed",W.className),style:Object.assign({overflow:"hidden",width:M??void 0,height:L??void 0,borderRadius:w},W.style)}),o.createElement(f.EmbedStyle,null),o.createElement("iframe",{className:(0,s.default)("linkedin-post",!F&&"rsme-d-none"),src:T,width:"100%",height:F?L:0,frameBorder:"0",onLoad:()=>z(!0)}),!F&&!j&&J)};return Ve.LinkedInEmbed=P,Ve}var He={},Za;function Ty(){if(Za)return He;Za=1;var i=He&&He.__createBinding||(Object.create?(function(_,v,b,T){T===void 0&&(T=b);var C=Object.getOwnPropertyDescriptor(v,b);(!C||("get"in C?!v.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return v[b]}}),Object.defineProperty(_,T,C)}):(function(_,v,b,T){T===void 0&&(T=b),_[T]=v[b]})),e=He&&He.__setModuleDefault||(Object.create?(function(_,v){Object.defineProperty(_,"default",{enumerable:!0,value:v})}):function(_,v){_.default=v}),t=He&&He.__importStar||function(_){if(_&&_.__esModule)return _;var v={};if(_!=null)for(var b in _)b!=="default"&&Object.prototype.hasOwnProperty.call(_,b)&&i(v,_,b);return e(v,_),v},n=He&&He.__rest||function(_,v){var b={};for(var T in _)Object.prototype.hasOwnProperty.call(_,T)&&v.indexOf(T)<0&&(b[T]=_[T]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var C=0,T=Object.getOwnPropertySymbols(_);C<T.length;C++)v.indexOf(T[C])<0&&Object.prototype.propertyIsEnumerable.call(_,T[C])&&(b[T[C]]=_[T[C]]);return b},r=He&&He.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(He,"__esModule",{value:!0}),He.PinterestEmbed=void 0;const s=r(lt()),o=t(at()),d=Vt(),f=Wt(),h=250,p=550,y=550,w=8,P=_=>{var v,b,T,{url:C,postUrl:M,width:L,height:k=500,linkText:R="View post on Pinterest",placeholderImageUrl:A,placeholderSpinner:O,placeholderSpinnerDisabled:B=!1,placeholderProps:N,embedPlaceholder:j,placeholderDisabled:W=!1}=_,F=n(_,["url","postUrl","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled"]);const[z,K]=o.useState(!1),J={minWidth:h,maxWidth:p,width:typeof L<"u"?L:"100%",height:typeof k<"u"?k:typeof((v=F.style)===null||v===void 0?void 0:v.height)<"u"||typeof((b=F.style)===null||b===void 0?void 0:b.maxHeight)<"u"?"100%":y,border:"solid 1px rgba(0, 0, 0, 0.15)",borderRadius:w},Z=j??o.createElement(d.PlaceholderEmbed,Object.assign({url:M??C,imageUrl:A,linkText:R,spinner:O,spinnerDisabled:B},N,{style:Object.assign(Object.assign({},J),N?.style)})),se=(T=C.match(/pin\/([\w\d_-]+)/))===null||T===void 0?void 0:T[1],ae=se??"000000000000000000";return o.createElement("div",Object.assign({},F,{className:(0,s.default)("rsme-embed rsme-pinterest-embed",F.className),style:Object.assign({overflow:"hidden",width:L??void 0,height:k??void 0,borderRadius:w},F.style)}),o.createElement(f.EmbedStyle,null),o.createElement("iframe",{className:(0,s.default)("pinterest-post",!z&&"rsme-d-none"),src:`https://assets.pinterest.com/ext/embed.html?id=${ae}`,width:"100%",height:z?k:0,frameBorder:"0",scrolling:"no",onLoad:()=>K(!0)}),!z&&!W&&Z)};return He.PinterestEmbed=P,He}var kt={},eo;function wy(){if(eo)return kt;eo=1;var i=kt&&kt.__rest||function(M,L){var k={};for(var R in M)Object.prototype.hasOwnProperty.call(M,R)&&L.indexOf(R)<0&&(k[R]=M[R]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var A=0,R=Object.getOwnPropertySymbols(M);A<R.length;A++)L.indexOf(R[A])<0&&Object.prototype.propertyIsEnumerable.call(M,R[A])&&(k[R[A]]=M[R[A]]);return k},e=kt&&kt.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(kt,"__esModule",{value:!0}),kt.TikTokEmbed=void 0;const t=e(lt()),n=e(at()),r=gs(),s=ms(),o=Vt(),d=ps(),f=Wt(),h="https://www.tiktok.com/embed.js",p=325,y=480,w=550,P=8,_="process-embed",v="confirm-embed-success",b="retrying",T="embed-success",C=M=>{var L,k,{url:R,width:A,height:O,linkText:B="View post on TikTok",placeholderImageUrl:N,placeholderSpinner:j,placeholderSpinnerDisabled:W=!1,placeholderProps:F,embedPlaceholder:z,placeholderDisabled:K=!1,scriptLoadDisabled:J=!1,retryDelay:Z=5e3,retryDisabled:se=!1,frame:ae=void 0,debug:ce=!1}=M,fe=i(M,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","frame","debug"]);const[ee,ye]=n.default.useState(_),ge=n.default.useRef((0,d.generateUUID)()),[oe,xe]=n.default.useState(Date.now()),ke=n.default.useMemo(()=>`${ge.current}-${oe}`,[oe]),de=(0,s.useFrame)(ae);n.default.useEffect(()=>{ce&&console.log(`[${new Date().toISOString()}]: ${ee}`)},[ce,ee]),n.default.useEffect(()=>{if(ee===_&&de.document&&!J){const re="tiktok-embed-script",Ae=de.document.getElementById(re);Ae&&Ae.remove();const Ne=de.document.createElement("script");Ne.setAttribute("src",`${h}?t=${Date.now()}`),Ne.setAttribute("id",re),de.document.head.appendChild(Ne),ye(v)}},[J,ee,de.document]),n.default.useEffect(()=>{const re=new r.Subs;return ee===v&&(re.setInterval(()=>{de.document&&(de.document.getElementById(ge.current)||ye(T))},1),se||re.setTimeout(()=>{ye(b)},Z)),re.createCleanup()},[Z,se,ee,de.document]),n.default.useEffect(()=>{ee===b&&(xe(Date.now()),ye(_))},[ee]);const he=R.replace(/[?].*$/,"").replace(/^.+\//,""),Ee={minWidth:p,maxWidth:y,width:typeof A<"u"?A:"100%",height:typeof O<"u"?O:typeof((L=fe.style)===null||L===void 0?void 0:L.height)<"u"||typeof((k=fe.style)===null||k===void 0?void 0:k.maxHeight)<"u"?"100%":w,border:"solid 1px rgba(22,24,35,0.12)",borderRadius:P},De=z??n.default.createElement(o.PlaceholderEmbed,Object.assign({url:R,imageUrl:N,linkText:B,spinner:j,spinnerDisabled:W},F,{style:Object.assign(Object.assign({},Ee),F?.style)}));return n.default.createElement("div",Object.assign({},fe,{className:(0,t.default)("rsme-embed rsme-tiktok-embed",fe.className),style:Object.assign({overflow:"hidden",width:A??void 0,height:O??void 0,borderRadius:P},fe.style)}),n.default.createElement(f.EmbedStyle,null),n.default.createElement("div",{className:"tiktok-embed-container"},n.default.createElement("blockquote",{key:ke,className:"tiktok-embed",cite:R,"data-video-id":he},K?n.default.createElement("div",{id:ge.current,style:{display:"none"}}," "):n.default.createElement("div",{id:ge.current,style:{display:"flex",justifyContent:"center"}},De))))};return kt.TikTokEmbed=C,kt}var Ri={},ze={},xr={exports:{}};/*!
  * $script.js JS loader & dependency manager
  * https://github.com/ded/script.js
  * (c) Dustin Diaz 2014 | License MIT
  */var to;function Et(){return to||(to=1,(function(i){(function(e,t){i.exports?i.exports=t():this[e]=t()})("$script",function(){var e=document,t=e.getElementsByTagName("head")[0],n=!1,r="push",s="readyState",o="onreadystatechange",d={},f={},h={},p,y;function w(b,T){for(var C=0,M=b.length;C<M;++C)if(!T(b[C]))return n;return 1}function P(b,T){w(b,function(C){return T(C),1})}function _(b,T,C){b=b[r]?b:[b];var M=T&&T.call,L=M?T:C,k=M?b.join(""):T,R=b.length;function A(B){return B.call?B():d[B]}function O(){if(!--R){d[k]=1,L&&L();for(var B in f)w(B.split("|"),A)&&!P(f[B],A)&&(f[B]=[])}}return setTimeout(function(){P(b,function B(N,j){if(N===null)return O();if(!j&&!/^https?:\/\//.test(N)&&p&&(N=N.indexOf(".js")===-1?p+N+".js":p+N),h[N])return h[N]==2?O():setTimeout(function(){B(N,!0)},0);h[N]=1,v(N,O)})},0),_}function v(b,T){var C=e.createElement("script"),M;C.onload=C.onerror=C[o]=function(){C[s]&&!/^c|loade/.test(C[s])||M||(C.onload=C[o]=null,M=1,h[b]=2,T())},C.async=1,C.src=y?b+(b.indexOf("?")===-1?"?":"&")+y:b,t.insertBefore(C,t.lastChild)}return _.get=v,_.order=function(b,T,C){(function M(L){L=b.shift(),b.length?_(L,M):_(L,T,C)})()},_.path=function(b){p=b},_.urlArgs=function(b){y=b},_.ready=function(b,T,C){b=b[r]?b:[b];var M=[];return!P(b,function(L){d[L]||M[r](L)})&&w(b,function(L){return d[L]})?T():(function(L){f[L]=f[L]||[],f[L][r](T),C&&C(M)})(b.join("|")),_},_.done=function(b){_([null],b)},_})})(xr)),xr.exports}var Pt="https://platform.twitter.com/widgets.js",Er="createTimeline",xy=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1],o=function(){var h=Object.assign({},e.options);if(e!=null&&e.autoHeight){var p,y;h.height=(p=t.current)===null||p===void 0||(y=p.parentNode)===null||y===void 0?void 0:y.offsetHeight}return h=Object.assign({},h,{theme:e?.theme,linkColor:e?.linkColor,borderColor:e?.borderColor,lang:e?.lang,tweetLimit:e?.tweetLimit,ariaPolite:e?.ariaPolite}),h},d=function(h){return h.chrome="",e.noHeader&&(h.chrome=h.chrome+" noheader"),e.noFooter&&(h.chrome=h.chrome+" nofooter"),e.noBorders&&(h.chrome=h.chrome+" noborders"),e.noScrollbar&&(h.chrome=h.chrome+" noscrollbar"),e.transparent&&(h.chrome=h.chrome+" transparent"),h};return G.useEffect(function(){var f=!0,h=Et();return h(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(f){if(!window.twttr.widgets[Er]){console.error("Method "+Er+" is not present anymore in twttr.widget api");return}var p=o();p=d(p),window.twttr.widgets[Er]({sourceType:e.sourceType,screenName:e.screenName,userId:e.userId,ownerScreenName:e.ownerScreenName,slug:e.slug,id:e.id||e.widgetId,url:e.url},t?.current,p).then(function(y){s(!1),e.onLoad&&e.onLoad(y)})}}),function(){f=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Pr="createShareButton",Ey=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Pr]){console.error("Method "+Pr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Pr](e.url,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Cr="createFollowButton",Py=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Cr]){console.error("Method "+Cr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Cr](e.screenName,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Ir="createHashtagButton",Cy=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Ir]){console.error("Method "+Ir+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Ir](e.tag,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Dr="createMentionButton",Iy=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Dr]){console.error("Method "+Dr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Dr](e.screenName,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Ar="createTweet",Dy=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Ar]){console.error("Method "+Ar+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Ar](e.tweetId,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Or="createMoment",Ay=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Or]){console.error("Method "+Or+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Or](e.momentId,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Lr="createDMButton",Oy=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Lr]){console.error("Method "+Lr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Lr](e.id,t?.current,e.options).then(function(f){o&&(s(!1),e.onLoad&&e.onLoad(f))})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Mr="createVideo",Ly=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Mr]){console.error("Method "+Mr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Mr](e.id,t?.current).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},kr="createPeriscopeOnAirButton",My=function(e){var t=G.useRef(null),n=G.useState(!0),r=n[0],s=n[1];return G.useEffect(function(){var o=!0,d=Et();return d(Pt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[kr]){console.error("Method "+kr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[kr](e.username,t?.current,e.options).then(function(f){s(!1),e.onLoad&&e.onLoad(f)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))};const ky=Object.freeze(Object.defineProperty({__proto__:null,TwitterDMButton:Oy,TwitterFollowButton:Py,TwitterHashtagButton:Cy,TwitterMentionButton:Iy,TwitterMomentShare:Ay,TwitterOnAirButton:My,TwitterShareButton:Ey,TwitterTimelineEmbed:xy,TwitterTweetEmbed:Dy,TwitterVideoEmbed:Ly},Symbol.toStringTag,{value:"Module"})),Ry=No(ky);var io;function Xl(){if(io)return ze;io=1;var i=ze&&ze.__createBinding||(Object.create?(function(v,b,T,C){C===void 0&&(C=T);var M=Object.getOwnPropertyDescriptor(b,T);(!M||("get"in M?!b.__esModule:M.writable||M.configurable))&&(M={enumerable:!0,get:function(){return b[T]}}),Object.defineProperty(v,C,M)}):(function(v,b,T,C){C===void 0&&(C=T),v[C]=b[T]})),e=ze&&ze.__setModuleDefault||(Object.create?(function(v,b){Object.defineProperty(v,"default",{enumerable:!0,value:b})}):function(v,b){v.default=b}),t=ze&&ze.__importStar||function(v){if(v&&v.__esModule)return v;var b={};if(v!=null)for(var T in v)T!=="default"&&Object.prototype.hasOwnProperty.call(v,T)&&i(b,v,T);return e(b,v),b},n=ze&&ze.__rest||function(v,b){var T={};for(var C in v)Object.prototype.hasOwnProperty.call(v,C)&&b.indexOf(C)<0&&(T[C]=v[C]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var M=0,C=Object.getOwnPropertySymbols(v);M<C.length;M++)b.indexOf(C[M])<0&&Object.prototype.propertyIsEnumerable.call(v,C[M])&&(T[C[M]]=v[C[M]]);return T},r=ze&&ze.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(ze,"__esModule",{value:!0}),ze.XEmbed=void 0;const s=r(lt()),o=t(at()),d=Ry,f=Vt(),h=Wt(),p=250,y=550,w=350,P=12,_=v=>{var b,T,{url:C,width:M,height:L,linkText:k="View post on X",placeholderImageUrl:R,placeholderSpinner:A,placeholderSpinnerDisabled:O=!1,placeholderProps:B,embedPlaceholder:N,placeholderDisabled:j,twitterTweetEmbedProps:W}=v,F=n(v,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","twitterTweetEmbedProps"]);const z=C.substring(C.lastIndexOf("/")+1).replace(/[?].*$/,""),K=!!M?.toString().includes("%"),J=!!L?.toString().includes("%"),Z={minWidth:p,maxWidth:y,width:typeof M<"u"?K?"100%":M:"100%",height:J?"100%":typeof L<"u"?L:typeof((b=F.style)===null||b===void 0?void 0:b.height)<"u"||typeof((T=F.style)===null||T===void 0?void 0:T.maxHeight)<"u"?"100%":w,border:"solid 1px #c9d4d9",borderRadius:P},se=N??o.createElement(f.PlaceholderEmbed,Object.assign({url:C,imageUrl:R,linkText:k,spinner:A,spinnerDisabled:O},B,{style:Object.assign(Object.assign({},Z),B?.style)}));return o.createElement("div",Object.assign({},F,{className:(0,s.default)("rsme-embed rsme-twitter-embed",F.className),style:Object.assign({overflow:"hidden",width:M??void 0,height:L??void 0,borderRadius:P},F.style)}),o.createElement(h.EmbedStyle,null),o.createElement(d.TwitterTweetEmbed,Object.assign({tweetId:z,placeholder:j?void 0:se},W)))};return ze.XEmbed=_,ze}var no;function Uy(){if(no)return Ri;no=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.TwitterEmbed=void 0;const i=Xl();return Ri.TwitterEmbed=i.XEmbed,Ri}var Ge={},Rr,ro;function By(){return ro||(ro=1,Rr=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!i(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[r]))return!1;for(r=n;r--!==0;){var o=s[r];if(!i(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}),Rr}var Ny=By();const jy=jo(Ny);var En={exports:{}},Ur,so;function $y(){if(so)return Ur;so=1;var i;/**
* @link https://github.com/gajus/sister for the canonical source repository
* @license https://github.com/gajus/sister/blob/master/LICENSE BSD 3-Clause
*/return i=function(){var e={},t={};return e.on=function(n,r){var s={name:n,handler:r};return t[n]=t[n]||[],t[n].unshift(s),s},e.off=function(n){var r=t[n.name].indexOf(n);r!==-1&&t[n.name].splice(r,1)},e.trigger=function(n,r){var s=t[n],o;if(s)for(o=s.length;o--;)s[o].handler(r)},e},Ur=i,Ur}var Pn={exports:{}},Br,ao;function Fy(){if(ao)return Br;ao=1,Br=function(r,s,o){var d=document.head||document.getElementsByTagName("head")[0],f=document.createElement("script");typeof s=="function"&&(o=s,s={}),s=s||{},o=o||function(){},f.type=s.type||"text/javascript",f.charset=s.charset||"utf8",f.async="async"in s?!!s.async:!0,f.src=r,s.attrs&&i(f,s.attrs),s.text&&(f.text=""+s.text);var h="onload"in f?e:t;h(f,o),f.onload||e(f,o),d.appendChild(f)};function i(n,r){for(var s in r)n.setAttribute(s,r[s])}function e(n,r){n.onload=function(){this.onerror=this.onload=null,r(null,n)},n.onerror=function(){this.onerror=this.onload=null,r(new Error("Failed to load "+this.src),n)}}function t(n,r){n.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,r(null,n))}}return Br}var oo;function qy(){return oo||(oo=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Fy(),n=r(t);function r(s){return s&&s.__esModule?s:{default:s}}e.default=function(s){var o=new Promise(function(d){if(window.YT&&window.YT.Player&&window.YT.Player instanceof Function){d(window.YT);return}else{var f=window.location.protocol==="http:"?"http:":"https:";(0,n.default)(f+"//www.youtube.com/iframe_api",function(p){p&&s.trigger("error",p)})}var h=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){h&&h(),d(window.YT)}});return o},i.exports=e.default})(Pn,Pn.exports)),Pn.exports}var Cn={exports:{}},In={exports:{}},Dn={exports:{}},Nr,lo;function Wy(){if(lo)return Nr;lo=1;var i=1e3,e=i*60,t=e*60,n=t*24,r=n*365.25;Nr=function(h,p){p=p||{};var y=typeof h;if(y==="string"&&h.length>0)return s(h);if(y==="number"&&isNaN(h)===!1)return p.long?d(h):o(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function s(h){if(h=String(h),!(h.length>100)){var p=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(h);if(p){var y=parseFloat(p[1]),w=(p[2]||"ms").toLowerCase();switch(w){case"years":case"year":case"yrs":case"yr":case"y":return y*r;case"days":case"day":case"d":return y*n;case"hours":case"hour":case"hrs":case"hr":case"h":return y*t;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function o(h){return h>=n?Math.round(h/n)+"d":h>=t?Math.round(h/t)+"h":h>=e?Math.round(h/e)+"m":h>=i?Math.round(h/i)+"s":h+"ms"}function d(h){return f(h,n,"day")||f(h,t,"hour")||f(h,e,"minute")||f(h,i,"second")||h+" ms"}function f(h,p,y){if(!(h<p))return h<p*1.5?Math.floor(h/p)+" "+y:Math.ceil(h/p)+" "+y+"s"}return Nr}var uo;function Vy(){return uo||(uo=1,(function(i,e){e=i.exports=r.debug=r.default=r,e.coerce=f,e.disable=o,e.enable=s,e.enabled=d,e.humanize=Wy(),e.names=[],e.skips=[],e.formatters={};var t;function n(h){var p=0,y;for(y in h)p=(p<<5)-p+h.charCodeAt(y),p|=0;return e.colors[Math.abs(p)%e.colors.length]}function r(h){function p(){if(p.enabled){var y=p,w=+new Date,P=w-(t||w);y.diff=P,y.prev=t,y.curr=w,t=w;for(var _=new Array(arguments.length),v=0;v<_.length;v++)_[v]=arguments[v];_[0]=e.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");var b=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,function(C,M){if(C==="%%")return C;b++;var L=e.formatters[M];if(typeof L=="function"){var k=_[b];C=L.call(y,k),_.splice(b,1),b--}return C}),e.formatArgs.call(y,_);var T=p.log||e.log||console.log.bind(console);T.apply(y,_)}}return p.namespace=h,p.enabled=e.enabled(h),p.useColors=e.useColors(),p.color=n(h),typeof e.init=="function"&&e.init(p),p}function s(h){e.save(h),e.names=[],e.skips=[];for(var p=(typeof h=="string"?h:"").split(/[\s,]+/),y=p.length,w=0;w<y;w++)p[w]&&(h=p[w].replace(/\*/g,".*?"),h[0]==="-"?e.skips.push(new RegExp("^"+h.substr(1)+"$")):e.names.push(new RegExp("^"+h+"$")))}function o(){e.enable("")}function d(h){var p,y;for(p=0,y=e.skips.length;p<y;p++)if(e.skips[p].test(h))return!1;for(p=0,y=e.names.length;p<y;p++)if(e.names[p].test(h))return!0;return!1}function f(h){return h instanceof Error?h.stack||h.message:h}})(Dn,Dn.exports)),Dn.exports}var co;function Hy(){return co||(co=1,(function(i,e){var t={};e=i.exports=Vy(),e.log=s,e.formatArgs=r,e.save=o,e.load=d,e.useColors=n,e.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:f(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function n(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(h){try{return JSON.stringify(h)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}};function r(h){var p=this.useColors;if(h[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+h[0]+(p?"%c ":" ")+"+"+e.humanize(this.diff),!!p){var y="color: "+this.color;h.splice(1,0,y,"color: inherit");var w=0,P=0;h[0].replace(/%[a-zA-Z%]/g,function(_){_!=="%%"&&(w++,_==="%c"&&(P=w))}),h.splice(P,0,y)}}function s(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(h){try{h==null?e.storage.removeItem("debug"):e.storage.debug=h}catch{}}function d(){var h;try{h=e.storage.debug}catch{}return!h&&typeof process<"u"&&"env"in process&&(h=t.DEBUG),h}e.enable(d());function f(){try{return window.localStorage}catch{}}})(In,In.exports)),In.exports}var An={exports:{}},ho;function zy(){return ho||(ho=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=["cueVideoById","loadVideoById","cueVideoByUrl","loadVideoByUrl","playVideo","pauseVideo","stopVideo","getVideoLoadedFraction","cuePlaylist","loadPlaylist","nextVideo","previousVideo","playVideoAt","setShuffle","setLoop","getPlaylist","getPlaylistIndex","setOption","mute","unMute","isMuted","setVolume","getVolume","seekTo","getPlayerState","getPlaybackRate","setPlaybackRate","getAvailablePlaybackRates","getPlaybackQuality","setPlaybackQuality","getAvailableQualityLevels","getCurrentTime","getDuration","removeEventListener","getVideoUrl","getVideoEmbedCode","getOptions","getOption","addEventListener","destroy","setSize","getIframe"],i.exports=e.default})(An,An.exports)),An.exports}var On={exports:{}},fo;function Gy(){return fo||(fo=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=["ready","stateChange","playbackQualityChange","playbackRateChange","error","apiChange","volumeChange"],i.exports=e.default})(On,On.exports)),On.exports}var Ln={exports:{}},Mn={exports:{}},mo;function Qy(){return mo||(mo=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={BUFFERING:3,ENDED:0,PAUSED:2,PLAYING:1,UNSTARTED:-1,VIDEO_CUED:5},i.exports=e.default})(Mn,Mn.exports)),Mn.exports}var po;function Yy(){return po||(po=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qy(),n=r(t);function r(s){return s&&s.__esModule?s:{default:s}}e.default={pauseVideo:{acceptableStates:[n.default.ENDED,n.default.PAUSED],stateChangeRequired:!1},playVideo:{acceptableStates:[n.default.ENDED,n.default.PLAYING],stateChangeRequired:!1},seekTo:{acceptableStates:[n.default.ENDED,n.default.PLAYING,n.default.PAUSED],stateChangeRequired:!0,timeout:3e3}},i.exports=e.default})(Ln,Ln.exports)),Ln.exports}var go;function Xy(){return go||(go=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Hy(),n=p(t),r=zy(),s=p(r),o=Gy(),d=p(o),f=Yy(),h=p(f);function p(P){return P&&P.__esModule?P:{default:P}}var y=(0,n.default)("youtube-player"),w={};w.proxyEvents=function(P){var _={},v=function(A){var O="on"+A.slice(0,1).toUpperCase()+A.slice(1);_[O]=function(B){y('event "%s"',O,B),P.trigger(A,B)}},b=!0,T=!1,C=void 0;try{for(var M=d.default[Symbol.iterator](),L;!(b=(L=M.next()).done);b=!0){var k=L.value;v(k)}}catch(R){T=!0,C=R}finally{try{!b&&M.return&&M.return()}finally{if(T)throw C}}return _},w.promisifyPlayer=function(P){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,v={},b=function(O){_&&h.default[O]?v[O]=function(){for(var B=arguments.length,N=Array(B),j=0;j<B;j++)N[j]=arguments[j];return P.then(function(W){var F=h.default[O],z=W.getPlayerState(),K=W[O].apply(W,N);return F.stateChangeRequired||Array.isArray(F.acceptableStates)&&F.acceptableStates.indexOf(z)===-1?new Promise(function(J){var Z=function se(){var ae=W.getPlayerState(),ce=void 0;typeof F.timeout=="number"&&(ce=setTimeout(function(){W.removeEventListener("onStateChange",se),J()},F.timeout)),Array.isArray(F.acceptableStates)&&F.acceptableStates.indexOf(ae)!==-1&&(W.removeEventListener("onStateChange",se),clearTimeout(ce),J())};W.addEventListener("onStateChange",Z)}).then(function(){return K}):K})}:v[O]=function(){for(var B=arguments.length,N=Array(B),j=0;j<B;j++)N[j]=arguments[j];return P.then(function(W){return W[O].apply(W,N)})}},T=!0,C=!1,M=void 0;try{for(var L=s.default[Symbol.iterator](),k;!(T=(k=L.next()).done);T=!0){var R=k.value;b(R)}}catch(A){C=!0,M=A}finally{try{!T&&L.return&&L.return()}finally{if(C)throw M}}return v},e.default=w,i.exports=e.default})(Cn,Cn.exports)),Cn.exports}var yo;function Ky(){return yo||(yo=1,(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},n=$y(),r=h(n),s=qy(),o=h(s),d=Xy(),f=h(d);function h(y){return y&&y.__esModule?y:{default:y}}var p=void 0;e.default=function(y){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=(0,r.default)();if(p||(p=(0,o.default)(_)),w.events)throw new Error("Event handlers cannot be overwritten.");if(typeof y=="string"&&!document.getElementById(y))throw new Error('Element "'+y+'" does not exist.');w.events=f.default.proxyEvents(_);var v=new Promise(function(T){if((typeof y>"u"?"undefined":t(y))==="object"&&y.playVideo instanceof Function){var C=y;T(C)}else p.then(function(M){var L=new M.Player(y,w);return _.on("ready",function(){T(L)}),null})}),b=f.default.promisifyPlayer(v,P);return b.on=_.on,b.off=_.off,b},i.exports=e.default})(En,En.exports)),En.exports}var Jy=Ky();const Zy=jo(Jy);var e_=Object.defineProperty,t_=Object.defineProperties,i_=Object.getOwnPropertyDescriptors,_o=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,vo=(i,e,t)=>e in i?e_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Kr=(i,e)=>{for(var t in e||(e={}))n_.call(e,t)&&vo(i,t,e[t]);if(_o)for(var t of _o(e))r_.call(e,t)&&vo(i,t,e[t]);return i},Jr=(i,e)=>t_(i,i_(e)),s_=(i,e,t)=>new Promise((n,r)=>{var s=f=>{try{d(t.next(f))}catch(h){r(h)}},o=f=>{try{d(t.throw(f))}catch(h){r(h)}},d=f=>f.done?n(f.value):Promise.resolve(f.value).then(s,o);d((t=t.apply(i,e)).next())});function a_(i,e){var t,n;if(i.videoId!==e.videoId)return!0;const r=((t=i.opts)==null?void 0:t.playerVars)||{},s=((n=e.opts)==null?void 0:n.playerVars)||{};return r.start!==s.start||r.end!==s.end}function bo(i={}){return Jr(Kr({},i),{height:0,width:0,playerVars:Jr(Kr({},i.playerVars),{autoplay:0,start:0,end:0})})}function o_(i,e){return i.videoId!==e.videoId||!jy(bo(i.opts),bo(e.opts))}function l_(i,e){var t,n,r,s;return i.id!==e.id||i.className!==e.className||((t=i.opts)==null?void 0:t.width)!==((n=e.opts)==null?void 0:n.width)||((r=i.opts)==null?void 0:r.height)!==((s=e.opts)==null?void 0:s.height)||i.iframeClassName!==e.iframeClassName||i.title!==e.title}var d_={videoId:"",id:"",className:"",iframeClassName:"",style:{},title:"",loading:void 0,opts:{},onReady:()=>{},onError:()=>{},onPlay:()=>{},onPause:()=>{},onEnd:()=>{},onStateChange:()=>{},onPlaybackRateChange:()=>{},onPlaybackQualityChange:()=>{}},u_={videoId:je.string,id:je.string,className:je.string,iframeClassName:je.string,style:je.object,title:je.string,loading:je.oneOf(["lazy","eager"]),opts:je.objectOf(je.any),onReady:je.func,onError:je.func,onPlay:je.func,onPause:je.func,onEnd:je.func,onStateChange:je.func,onPlaybackRateChange:je.func,onPlaybackQualityChange:je.func},Rn=class extends G.Component{constructor(i){super(i),this.destroyPlayerPromise=void 0,this.onPlayerReady=e=>{var t,n;return(n=(t=this.props).onReady)==null?void 0:n.call(t,e)},this.onPlayerError=e=>{var t,n;return(n=(t=this.props).onError)==null?void 0:n.call(t,e)},this.onPlayerStateChange=e=>{var t,n,r,s,o,d,f,h;switch((n=(t=this.props).onStateChange)==null||n.call(t,e),e.data){case Rn.PlayerState.ENDED:(s=(r=this.props).onEnd)==null||s.call(r,e);break;case Rn.PlayerState.PLAYING:(d=(o=this.props).onPlay)==null||d.call(o,e);break;case Rn.PlayerState.PAUSED:(h=(f=this.props).onPause)==null||h.call(f,e);break}},this.onPlayerPlaybackRateChange=e=>{var t,n;return(n=(t=this.props).onPlaybackRateChange)==null?void 0:n.call(t,e)},this.onPlayerPlaybackQualityChange=e=>{var t,n;return(n=(t=this.props).onPlaybackQualityChange)==null?void 0:n.call(t,e)},this.destroyPlayer=()=>this.internalPlayer?(this.destroyPlayerPromise=this.internalPlayer.destroy().then(()=>this.destroyPlayerPromise=void 0),this.destroyPlayerPromise):Promise.resolve(),this.createPlayer=()=>{if(typeof document>"u")return;if(this.destroyPlayerPromise){this.destroyPlayerPromise.then(this.createPlayer);return}const e=Jr(Kr({},this.props.opts),{videoId:this.props.videoId});this.internalPlayer=Zy(this.container,e),this.internalPlayer.on("ready",this.onPlayerReady),this.internalPlayer.on("error",this.onPlayerError),this.internalPlayer.on("stateChange",this.onPlayerStateChange),this.internalPlayer.on("playbackRateChange",this.onPlayerPlaybackRateChange),this.internalPlayer.on("playbackQualityChange",this.onPlayerPlaybackQualityChange),(this.props.title||this.props.loading)&&this.internalPlayer.getIframe().then(t=>{this.props.title&&t.setAttribute("title",this.props.title),this.props.loading&&t.setAttribute("loading",this.props.loading)})},this.resetPlayer=()=>this.destroyPlayer().then(this.createPlayer),this.updatePlayer=()=>{var e;(e=this.internalPlayer)==null||e.getIframe().then(t=>{this.props.id?t.setAttribute("id",this.props.id):t.removeAttribute("id"),this.props.iframeClassName?t.setAttribute("class",this.props.iframeClassName):t.removeAttribute("class"),this.props.opts&&this.props.opts.width?t.setAttribute("width",this.props.opts.width.toString()):t.removeAttribute("width"),this.props.opts&&this.props.opts.height?t.setAttribute("height",this.props.opts.height.toString()):t.removeAttribute("height"),this.props.title?t.setAttribute("title",this.props.title):t.setAttribute("title","YouTube video player"),this.props.loading?t.setAttribute("loading",this.props.loading):t.removeAttribute("loading")})},this.getInternalPlayer=()=>this.internalPlayer,this.updateVideo=()=>{var e,t,n,r;if(typeof this.props.videoId>"u"||this.props.videoId===null){(e=this.internalPlayer)==null||e.stopVideo();return}let s=!1;const o={videoId:this.props.videoId};if((t=this.props.opts)!=null&&t.playerVars&&(s=this.props.opts.playerVars.autoplay===1,"start"in this.props.opts.playerVars&&(o.startSeconds=this.props.opts.playerVars.start),"end"in this.props.opts.playerVars&&(o.endSeconds=this.props.opts.playerVars.end)),s){(n=this.internalPlayer)==null||n.loadVideoById(o);return}(r=this.internalPlayer)==null||r.cueVideoById(o)},this.refContainer=e=>{this.container=e},this.container=null,this.internalPlayer=null}componentDidMount(){this.createPlayer()}componentDidUpdate(i){return s_(this,null,function*(){l_(i,this.props)&&this.updatePlayer(),o_(i,this.props)&&(yield this.resetPlayer()),a_(i,this.props)&&this.updateVideo()})}componentWillUnmount(){this.destroyPlayer()}render(){return G.createElement("div",{className:this.props.className,style:this.props.style},G.createElement("div",{id:this.props.id,className:this.props.iframeClassName,ref:this.refContainer}))}},Yn=Rn;Yn.propTypes=u_;Yn.defaultProps=d_;Yn.PlayerState={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:5};var c_=Yn;const h_=Object.freeze(Object.defineProperty({__proto__:null,default:c_},Symbol.toStringTag,{value:"Module"})),f_=No(h_);var So;function m_(){if(So)return Ge;So=1;var i=Ge&&Ge.__createBinding||(Object.create?(function(_,v,b,T){T===void 0&&(T=b);var C=Object.getOwnPropertyDescriptor(v,b);(!C||("get"in C?!v.__esModule:C.writable||C.configurable))&&(C={enumerable:!0,get:function(){return v[b]}}),Object.defineProperty(_,T,C)}):(function(_,v,b,T){T===void 0&&(T=b),_[T]=v[b]})),e=Ge&&Ge.__setModuleDefault||(Object.create?(function(_,v){Object.defineProperty(_,"default",{enumerable:!0,value:v})}):function(_,v){_.default=v}),t=Ge&&Ge.__importStar||function(_){if(_&&_.__esModule)return _;var v={};if(_!=null)for(var b in _)b!=="default"&&Object.prototype.hasOwnProperty.call(_,b)&&i(v,_,b);return e(v,_),v},n=Ge&&Ge.__rest||function(_,v){var b={};for(var T in _)Object.prototype.hasOwnProperty.call(_,T)&&v.indexOf(T)<0&&(b[T]=_[T]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var C=0,T=Object.getOwnPropertySymbols(_);C<T.length;C++)v.indexOf(T[C])<0&&Object.prototype.propertyIsEnumerable.call(_,T[C])&&(b[T[C]]=_[T[C]]);return b},r=Ge&&Ge.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.YouTubeEmbed=void 0;const s=r(lt()),o=t(at()),d=r(f_),f=Vt(),h=Wt(),p=640,y=360,w=0,P=_=>{var v,b,T,C,M,L,k,R,A,O,B,N,j,{url:W,width:F,height:z,linkText:K="Watch on YouTube",placeholderImageUrl:J,placeholderSpinner:Z,placeholderSpinnerDisabled:se=!1,placeholderProps:ae,embedPlaceholder:ce,placeholderDisabled:fe,youTubeProps:ee}=_,ye=n(_,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","youTubeProps"]);const[ge,oe]=o.useState(!1),xe=(v=W.match(/[?&]v=(.+?)(?:$|[&?])/))===null||v===void 0?void 0:v[1],ke=(b=W.match(/https:\/\/(?:www\.)?youtube\.com\/shorts\/(.+?)(?:$|[&?])/))===null||b===void 0?void 0:b[1],de=(T=W.match(/https:\/\/youtu\.be\/(.+?)(?:$|[&?])/))===null||T===void 0?void 0:T[1],he=(C=W.match(/https:\/\/(?:www\.)youtube(-nocookie)?\.com\/embed\/(.+?)(?:$|[&?])/))===null||C===void 0?void 0:C[2],Ee=(k=(L=(M=xe??ke)!==null&&M!==void 0?M:de)!==null&&L!==void 0?L:he)!==null&&k!==void 0?k:"00000000",De=+((A=(R=W.match(/(.+?)(?:$|[&?])start=(\d+)/))===null||R===void 0?void 0:R[2])!==null&&A!==void 0?A:0),re=!!F?.toString().includes("%"),Ae=!!z?.toString().includes("%");let Ne={};De&&(Ne.playerVars={start:De}),typeof F<"u"&&(Ne.width=re?"100%":`${F}`),typeof z<"u"&&(Ne.height=Ae?"100%":`${z}`),Ne=Object.assign(Object.assign({},Ne),ee?.opts);const Me={maxWidth:re?void 0:p,width:typeof F<"u"?re?"100%":F:"100%",height:Ae?"100%":typeof z<"u"?z:typeof((O=ye.style)===null||O===void 0?void 0:O.height)<"u"||typeof((B=ye.style)===null||B===void 0?void 0:B.maxHeight)<"u"?"100%":y,border:"1px solid #dee2e6",borderRadius:w},Bt=ce??o.createElement(f.PlaceholderEmbed,Object.assign({url:W,imageUrl:J,linkText:K,spinner:Z,spinnerDisabled:se},ae,{style:Object.assign(Object.assign({},Me),ae?.style)}));return o.createElement("div",Object.assign({},ye,{className:(0,s.default)("rsme-embed rsme-youtube-embed",ye.className),style:Object.assign({overflow:"hidden",width:F??void 0,height:z??void 0,borderRadius:w},ye.style)}),o.createElement(h.EmbedStyle,null),o.createElement("div",{className:(0,s.default)(!ge&&"rsme-d-none")},o.createElement(d.default,Object.assign({},ee,{className:(N=ee?.className)!==null&&N!==void 0?N:"youtube-iframe",videoId:(j=ee?.videoId)!==null&&j!==void 0?j:Ee,opts:Ne,onReady:Se=>{oe(!0),ee&&ee.onReady&&ee?.onReady(Se)}}))),!ge&&!fe&&Bt)};return Ge.YouTubeEmbed=P,Ge}var To;function p_(){return To||(To=1,(function(i){var e=Qt&&Qt.__createBinding||(Object.create?(function(n,r,s,o){o===void 0&&(o=s);var d=Object.getOwnPropertyDescriptor(r,s);(!d||("get"in d?!r.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(n,o,d)}):(function(n,r,s,o){o===void 0&&(o=s),n[o]=r[s]})),t=Qt&&Qt.__exportStar||function(n,r){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&e(r,n,s)};Object.defineProperty(i,"__esModule",{value:!0}),t(vy(),i),t(by(),i),t(Sy(),i),t(Ty(),i),t(wy(),i),t(Uy(),i),t(Xl(),i),t(m_(),i),t(Vt(),i),t(Yl(),i)})(Qt)),Qt}var Kl=p_();function g_(i){const e=Le.c(14);let t,n,r,s,o;e[0]!==i?({url:o,autoplayEnabled:t,dispatch:n,timeout:s,...r}=i,e[0]=i,e[1]=t,e[2]=n,e[3]=r,e[4]=s,e[5]=o):(t=e[1],n=e[2],r=e[3],s=e[4],o=e[5]);const d=s===void 0?5e3:s;let f,h;e[6]!==t||e[7]!==n||e[8]!==d?(f=()=>{if(t){const y=setTimeout(()=>{n(st({set:!0}))},d);return()=>clearTimeout(y)}},h=[t,n,d],e[6]=t,e[7]=n,e[8]=d,e[9]=f,e[10]=h):(f=e[9],h=e[10]),X.useEffect(f,h);let p;return e[11]!==r||e[12]!==o?(p=E.jsx(Kl.InstagramEmbed,{url:o,...r}),e[11]=r,e[12]=o,e[13]=p):p=e[13],p}function y_(i){const e=Le.c(14);let t,n,r,s,o;e[0]!==i?({url:o,autoplayEnabled:t,dispatch:n,timeout:s,...r}=i,e[0]=i,e[1]=t,e[2]=n,e[3]=r,e[4]=s,e[5]=o):(t=e[1],n=e[2],r=e[3],s=e[4],o=e[5]);const d=s===void 0?5e3:s;let f,h;e[6]!==t||e[7]!==n||e[8]!==d?(f=()=>{if(t){const y=setTimeout(()=>{n(st({set:!0}))},d);return()=>clearTimeout(y)}},h=[t,n,d],e[6]=t,e[7]=n,e[8]=d,e[9]=f,e[10]=h):(f=e[9],h=e[10]),X.useEffect(f,h);let p;return e[11]!==r||e[12]!==o?(p=E.jsx(Kl.XEmbed,{url:o,...r}),e[11]=r,e[12]=o,e[13]=p):p=e[13],p}function __(i){const e=Le.c(3),{src:t,autoplayEnabled:n,onEnded:r}=i,s=n?r:void 0;let o;return e[0]!==t||e[1]!==s?(o=E.jsx(Bi,{src:t,onEnded:s}),e[0]=t,e[1]=s,e[2]=o):o=e[2],o}function v_(i){const e=new Image;return e.decoding="async",e.src=i,{cleanup:()=>{try{e.src=""}catch{}}}}function b_(i){const e=document.createElement("video");return e.preload="auto",e.muted=!0,e.playsInline=!0,e.src=i,{cleanup:()=>{try{e.pause()}catch{}try{e.removeAttribute("src")}catch{}try{e.load()}catch{}}}}async function S_(i,e){const t=new AbortController,n=e??t.signal;let r=!1;try{await fetch(i,{method:"GET",mode:"cors",signal:n,cache:"force-cache"})}catch{r=!0}return{cleanup:()=>{try{t.abort()}catch{}}}}async function T_(i,e){const t=new AbortController,n=e??t.signal;try{await fetch(i,{method:"HEAD",mode:"cors",signal:n,cache:"force-cache"})}catch{}return{cleanup:()=>{try{t.abort()}catch{}}}}const w_=(i,e,t,n,r,s)=>{if(!i)return null;const{Platform:o,id:d,title:f}=i;if(!d)return null;const h=e||ft.getEmbedUrl(d)||"",p=t&&n?()=>{r||s(st({set:!0}))}:void 0;switch(o){case"YouTube":case"Twitch":return t?E.jsx(Bi,{src:e,onEnded:p},`${d}-${e}-${t}`):E.jsx("iframe",{src:ft.getEmbedUrl(d)||h,title:f,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`);case"Streamable":return t?E.jsx(__,{src:h,title:f||"Streamable Video",autoplayEnabled:t&&!!n,onEnded:p},`${d}-${t}`):E.jsx("iframe",{src:ft.getEmbedUrl(d)+"?autoplay=1&loop=0"||h+"?autoplay=1&loop=0",title:f,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`);case"Kick":return E.jsx(Bi,{src:h,onEnded:p},`${i.id}-${e}-${t}`);case"Reddit":return e&&(/\.(jpg|jpeg|png|gif|webp)(\?|$)/i.test(e)||e.includes("preview.redd.it")||e.includes("i.redd.it"))?E.jsx($a,{src:e,title:f,autoplayEnabled:t&&!!n,dispatch:s},`${d}-${e}-${t}`):E.jsx(Bi,{src:e,onEnded:p},`${i.id}-${e}-${t}`);case"Instagram":return E.jsx(g_,{url:h,autoplayEnabled:t&&!!n,dispatch:s,height:"100%",captioned:!0},d);case"TikTok":return E.jsx(gy,{src:e?e+"?autoplay=1&rel=0":ft.getEmbedUrl(d)+"?autoplay=1&rel=0",title:f,autoplayEnabled:t&&!!n},`${d}-${e}-${t}`);case"Twitter":return e?.endsWith(".jpg")||e?.endsWith(".png")?E.jsx($a,{src:e,title:f,autoplayEnabled:t&&!!n,dispatch:s},`${d}-${e}-${t}`):e?.endsWith(".mp4")?E.jsx(Bi,{src:e,onEnded:p},`${d}-${e}-${t}`):E.jsx(y_,{url:h,style:{maxWidth:"100%",maxHeight:"100%",width:500,height:"100%"},autoplayEnabled:t&&!!n,dispatch:s},`${d}-${e}-${t}`);default:return E.jsx("iframe",{src:h,title:f,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`)}};function ys({className:i}){const e=Ye(),t=te(Wn),n=te(Zr),r=te(es),s=te(Oc),[o,d]=X.useState(void 0),[f,h]=X.useState(null),[p,y]=X.useState(!1),[w,P]=X.useState(!1),_=te(Lc),v=X.useRef(null),b=X.useCallback(()=>{e(st({set:!1})),e(Mc())},[e]);X.useEffect(()=>{if(!t){d(void 0),h(null),y(!1);return}if(r&&n&&t.id?.startsWith("twitch-vod:")){e(ts());return}d(void 0),y(!0),P(!1),v.current&&(clearTimeout(v.current),v.current=null);let L=!0;return v.current=window.setTimeout(()=>{L&&P(!0),v.current=null},1e3),(async()=>{try{const R=await ft.getAutoplayUrl(t.id);L&&(d(R),h(null),y(!1),v.current&&(clearTimeout(v.current),v.current=null),P(!1))}catch{L&&(h("Failed to load video"),d(void 0),y(!1),v.current&&(clearTimeout(v.current),v.current=null),P(!1))}})(),()=>{L=!1,v.current&&(clearTimeout(v.current),v.current=null),P(!1)}},[t,r,e]);const T=X.useRef(null),C=X.useRef(null);X.useEffect(()=>{T.current?.cleanup(),T.current=null;try{C.current?.abort()}catch{}if(C.current=null,!t||!n||!r)return;const L=navigator;if(L?.connection?.saveData)return;const k=L?.connection?.effectiveType;if(k&&/2g/.test(k))return;const R=new AbortController;return C.current=R,(async()=>{try{const A=await ft.getAutoplayUrl(n);if(!A)return;let O=null;/\.(jpg|jpeg|png|gif|webp)(\?|$)/i.test(A)||A.includes("preview.redd.it")||A.includes("i.redd.it")||A.includes("i.imgur.com")?O=v_(A):/\.mp4(\?|$)/i.test(A)?O=b_(A):/\.m3u8(\?|$)/i.test(A)?O=await S_(A,R.signal):O=await T_(A,R.signal),T.current=O}catch{}})(),()=>{T.current?.cleanup(),T.current=null;try{C.current?.abort()}catch{}C.current=null}},[t?.id,n,r]);const M=w_(t,o,r,n,s,e);return E.jsxs(xt,{align:"center",sx:{background:"black",width:"100%",aspectRatio:"16 / 9",position:"relative",flex:"0 0 auto"},className:i,children:[f?E.jsx("div",{style:{color:"red"},children:f}):p&&w?E.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:E.jsx(Gc,{size:"xl",color:"white"})}):o||!r?M:E.jsx("div",{}),_>0&&E.jsxs("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",zIndex:3,background:"rgba(0, 0, 0, 0.6)",color:"white",padding:"6px 10px",borderRadius:"0 0 12px 12px",fontWeight:600,fontSize:12},"aria-live":"polite",children:["Skip votes: ",_]}),E.jsx(Mm,{visible:!!s,onCancel:b})]})}function wo(){const i=X.useRef(null),e=X.useRef(!1),t=X.useRef({left:0,width:0}),n=Ye(),r=te(kc),[s,o]=X.useState(r),d=30,f=85;X.useEffect(()=>{const p={pct:s},y={id:0},w=()=>{y.id=0,o(v=>p.pct)},P=v=>{if(!e.current||!t.current.width)return;const T=v.clientX-t.current.left,C=Math.max(d,Math.min(f,Math.round(T/t.current.width*100)));p.pct=C,y.id||(y.id=requestAnimationFrame(w))},_=()=>{e.current=!1,y.id&&(cancelAnimationFrame(y.id),y.id=0),n(Hn({playerPercentDefault:p.pct}))};return window.addEventListener("pointermove",P),window.addEventListener("pointerup",_),()=>{window.removeEventListener("pointermove",P),window.removeEventListener("pointerup",_),y.id&&cancelAnimationFrame(y.id)}},[d,f,s]),X.useEffect(()=>{e.current||o(r)},[r]);const h=p=>{const y=p.currentTarget;try{y.setPointerCapture?.(p.pointerId)}catch{}if(e.current=!0,i.current){const w=i.current.getBoundingClientRect();t.current.left=w.left,t.current.width=w.width}p.preventDefault()};return E.jsx(Fi,{fluid:!0,py:"md",sx:{height:"100%"},className:"classic-layout",children:E.jsx(Bn,{sx:{height:"100%"},columns:24,children:E.jsx(Bn.Col,{span:24,sx:{height:"100%"},children:E.jsxs(we,{ref:i,className:"classic-layout-inner",sx:{display:"flex",height:"100%",gap:3},children:[E.jsx(we,{className:"player-area",sx:{flex:`0 0 ${s}%`,minWidth:0},children:E.jsxs(xt,{justify:"flex-start",spacing:"xs",sx:{height:"100%"},children:[E.jsx(ys,{}),E.jsxs(wt,{position:"apart",className:"player-meta-group",sx:{alignItems:"flex-start",width:"100%"},children:[E.jsx(Gn,{className:"player-title"}),E.jsx(Ho,{className:"player-buttons"})]})]})}),E.jsx(we,{className:"classic-resizer",onPointerDown:h,sx:{width:8,touchAction:"none",cursor:"col-resize",display:"flex",alignItems:"center",justifyContent:"center"},children:E.jsx(we,{sx:{width:2,height:"40%",background:"rgba(0,0,0,0.25)",borderRadius:2}})}),E.jsx(we,{className:"queue-area",sx:{flex:1,minWidth:0},children:E.jsxs(xt,{justify:"flex-start",sx:{height:"100%",maxHeight:"100%",gap:3},children:[E.jsx(os,{}),E.jsx(ko,{sx:{".mantine-ScrollArea-viewport > div":{display:"block !important"},".mantine-ScrollArea-viewport":{paddingRight:"9px"},".mantine-ScrollArea-scrollbar":{width:"9px !important",paddingRight:"2px"}},scrollbarSize:9,children:E.jsx(wt,{direction:"column",sx:{height:"100%",gap:3},children:E.jsx(as,{})})})]})})]})})})})}function x_(i,e){Array.from(i.styleSheets).forEach(t=>{if(t.cssRules){const n=i.createElement("style");Array.from(t.cssRules).forEach(r=>{n.appendChild(i.createTextNode(r.cssText))}),e.head.appendChild(n)}else if(t.href){const n=i.createElement("link");n.rel="stylesheet",n.href=t.href,e.head.appendChild(n)}})}function E_({children:i}){const e=document.createElement("div");return X.useEffect(()=>{const t=window.open("","",`width=${window.outerWidth},height=${window.outerHeight},popup`);if(t){const n=()=>t.close();return window.addEventListener("unload",n),t.document.body.appendChild(e),t.document.title="Twitch React Queue — Player",setTimeout(()=>x_(document,t.document),100),()=>{window.removeEventListener("unload",n),t.close()}}},[e]),E.jsx(Qc,{target:e,children:i})}function P_(){const i=Le.c(2);let e;i[0]===Symbol.for("react.memo_cache_sentinel")?(e={height:"100%"},i[0]=e):e=i[0];let t;return i[1]===Symbol.for("react.memo_cache_sentinel")?(t=E.jsx(Rc,{noNav:!0,children:E.jsx(Fi,{fluid:!0,py:"md",sx:e,children:E.jsxs(xt,{justify:"flex-start",sx:{height:"100%"},children:[E.jsx(ys,{}),E.jsx(Gn,{})]})})}),i[1]=t):t=i[1],t}function C_(){const i=Le.c(8);let e;i[0]===Symbol.for("react.memo_cache_sentinel")?(e=fa(),i[0]=e):e=i[0];const[t,n]=X.useState(e);let r;i[1]===Symbol.for("react.memo_cache_sentinel")?(r=E.jsx(vt,{variant:"default",onClick:()=>n(fa()),children:"Reload layout"}),i[1]=r):r=i[1];let s,o;i[2]===Symbol.for("react.memo_cache_sentinel")?(s=E.jsxs(wt,{position:"apart",align:"flex-end",pb:"sm",children:[E.jsx(Gn,{}),E.jsx(Ho,{})]}),o=E.jsx(os,{}),i[2]=s,i[3]=o):(s=i[2],o=i[3]);let d;i[4]===Symbol.for("react.memo_cache_sentinel")?(d=E.jsxs(Fi,{fluid:!0,py:"md",children:[r,E.jsxs(Fi,{size:"xl",children:[s,o,E.jsx(Bn,{pt:"sm",children:E.jsx(as,{card:!0,wrapper:I_})})]})]}),i[4]=d):d=i[4];let f;i[5]===Symbol.for("react.memo_cache_sentinel")?(f=E.jsx(E_,{children:E.jsx(P_,{})}),i[5]=f):f=i[5];let h;return i[6]!==t?(h=E.jsxs(X.Fragment,{children:[d,f]},t),i[6]=t,i[7]=h):h=i[7],h}function I_(i){const{children:e}=i;return E.jsx(Bn.Col,{span:2,children:e})}function xo(i){const e=Le.c(17),{children:t,onClick:n,title:r,size:s,color:o,variant:d,className:f,style:h,clearWhenIdle:p}=i,y=s===void 0?"lg":s,w=d===void 0?"filled":d,P=p===void 0?!1:p,[_,v]=X.useState(!1);let b;e[0]===Symbol.for("react.memo_cache_sentinel")?(b=()=>v(!0),e[0]=b):b=e[0];const T=b;let C;e[1]===Symbol.for("react.memo_cache_sentinel")?(C=()=>v(!1),e[1]=C):C=e[1];const M=C,L=_?1:.25,k=_?"scale(1.02)":"none";let R;e[2]!==P||e[3]!==_||e[4]!==h||e[5]!==L||e[6]!==k?(R={borderRadius:"50%",transition:"opacity 160ms, transform 120ms",opacity:L,transform:k,pointerEvents:"auto",...h},P&&!_&&Object.assign(R,{backgroundColor:"transparent",boxShadow:"none",border:"none"}),e[2]=P,e[3]=_,e[4]=h,e[5]=L,e[6]=k,e[7]=R):R=e[7];const A=o;let O;return e[8]!==R||e[9]!==t||e[10]!==f||e[11]!==n||e[12]!==y||e[13]!==A||e[14]!==r||e[15]!==w?(O=E.jsx(Ze,{size:y,variant:w,color:A,title:r,onClick:n,style:R,className:f,onMouseEnter:T,onMouseLeave:M,children:t}),e[8]=R,e[9]=t,e[10]=f,e[11]=n,e[12]=y,e[13]=A,e[14]=r,e[15]=w,e[16]=O):O=e[16],O}function D_(){const i=Le.c(14),[e,t]=X.useState(!1),n=Wi();let r;i[0]===Symbol.for("react.memo_cache_sentinel")?(r={position:"fixed",bottom:20,left:20,zIndex:2e3},i[0]=r):r=i[0];const s=r;let o;i[1]===Symbol.for("react.memo_cache_sentinel")?(o={position:"relative",zIndex:50},i[1]=o):o=i[1];const d=o,f=n.colorScheme==="dark"?n.colors.dark[7]:n.white,h=n.colorScheme==="dark"?n.colors.gray[0]:void 0;let p;i[2]!==f||i[3]!==h?(p={position:"absolute",bottom:"calc(100% + 12px)",left:0,background:f,color:h,padding:"12px 14px",borderRadius:8,boxShadow:"0 8px 26px rgba(0, 0, 0, 0.45)",zIndex:60,minWidth:"50vw",maxWidth:"min(90vw, 560px)"},i[2]=f,i[3]=h,i[4]=p):p=i[4];const y=p;let w,P;i[5]===Symbol.for("react.memo_cache_sentinel")?(w=()=>t(!0),P=()=>t(!1),i[5]=w,i[6]=P):(w=i[5],P=i[6]);let _;i[7]===Symbol.for("react.memo_cache_sentinel")?(_={opacity:.35,transition:"opacity 140ms, transform 160ms",width:64,height:64,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:32},i[7]=_):_=i[7];let v;i[8]===Symbol.for("react.memo_cache_sentinel")?(v=E.jsx("div",{style:d,children:E.jsx(Ze,{variant:"filled",size:"xl",style:_,onMouseEnter:O_,onMouseLeave:A_,children:E.jsx(Uc,{size:36})})}),i[8]=v):v=i[8];let b;i[9]!==y||i[10]!==e?(b=e&&E.jsx("div",{style:y,children:E.jsx(Gn,{})}),i[9]=y,i[10]=e,i[11]=b):b=i[11];let T;return i[12]!==b?(T=E.jsxs("div",{style:s,onMouseEnter:w,onMouseLeave:P,children:[v,b]}),i[12]=b,i[13]=T):T=i[13],T}function A_(i){const e=i.currentTarget;e.style.opacity="0.35",e.style.transform="scale(1)"}function O_(i){const e=i.currentTarget;e.style.opacity="1",e.style.transform="scale(1.05)"}function L_(){const i=Ye(),[e,t]=X.useState(!1),n=te(es),[r,s]=X.useState(60),[o,d]=X.useState(0),[f,h]=X.useState(0),p=Wi(),y=`calc(100vh - ${r}px - 48px)`;X.useEffect(()=>{const b=T=>{const C=window.innerWidth,M=T.clientX,L=document.querySelector(".player-box");if(L){const j=L.getBoundingClientRect();if(T.clientX>=j.left&&T.clientX<=j.right&&T.clientY>=j.top&&T.clientY<=j.bottom){d(0),h(0);return}}const A=Math.max(0,Math.min(1,1-M/300));d(A);const O=C-M,N=Math.max(0,Math.min(1,1-O/300));h(N)};return window.addEventListener("mousemove",b),()=>{window.removeEventListener("mousemove",b)}},[]),X.useEffect(()=>{if(typeof window>"u")return;const b=document.querySelector("header");if(!b)return;let T=0,C=!0;const M=()=>{if(C)try{const R=b.offsetHeight||0;s(Math.round(R))}catch{}},L=()=>{try{cancelAnimationFrame(T)}catch{}T=requestAnimationFrame(M)};L(),window.addEventListener("resize",L),window.addEventListener("orientationchange",L);let k=null;try{k=new MutationObserver(()=>L()),k.observe(b,{attributes:!0,attributeFilter:["class","style"],childList:!0,subtree:!1})}catch{k=null}return()=>{C=!1;try{cancelAnimationFrame(T)}catch{}try{window.removeEventListener("resize",L)}catch{}try{window.removeEventListener("orientationchange",L)}catch{}try{k?.disconnect()}catch{}}},[]);const w=()=>{t(b=>!b)},P=()=>{i(st({set:!1})),i(Co())},_=()=>{i(st({set:!1})),i(ts())},v=b=>{i(st({set:!1})),i(Po(b.currentTarget.checked))};return E.jsxs(Fi,{fluid:!0,pt:"md",className:"spotlight-layout",children:[E.jsx("div",{className:"content-container",children:E.jsxs("div",{className:"stage",children:[E.jsx("div",{className:"spotlight-edge-zone left",onClick:P,style:{background:`linear-gradient(to right,
                rgba(0, 0, 0, ${.6*o}) 0%,
                rgba(0, 0, 0, ${.35*o}) 40%,
                transparent 100%)`},children:E.jsx("div",{className:"spotlight-edge-icon",style:{opacity:o,transform:`translateX(${-10+o*10}px)`},children:E.jsx(Th,{size:64,stroke:2.5})})}),E.jsx("div",{className:"spotlight-edge-zone right",onClick:_,style:{background:`linear-gradient(to left,
                rgba(0, 0, 0, ${.6*f}) 0%,
                rgba(0, 0, 0, ${.35*f}) 40%,
                transparent 100%)`},children:E.jsx("div",{className:"spotlight-edge-icon",style:{opacity:f,transform:`translateX(${10-f*10}px)`},children:E.jsx(xh,{size:64,stroke:2.5})})}),E.jsx("div",{className:"player-box",style:{height:y},children:E.jsx(ys,{})}),E.jsxs("div",{className:`spotlight-queue-overlay ${e?"open":"closed"}`,style:{background:p.colorScheme==="dark"?"rgba(26,27,30,0.70)":"rgba(255,255,255,0.70)",color:p.colorScheme==="dark"?p.colors.gray[0]:void 0,backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)"},children:[E.jsx("div",{className:"spotlight-queue-close",children:E.jsx(xo,{onClick:w,title:e?"Hide queue":"Show queue",color:"dark",size:60,clearWhenIdle:!0,children:E.jsx(Bc,{size:34})})}),E.jsx("div",{className:"panel-section",children:E.jsx(os,{})}),E.jsx("div",{className:"panel-section",children:E.jsx("div",{className:"spotlight-queue-grid",role:"list",children:E.jsx(as,{card:!0,wrapper:({children:b})=>E.jsx("div",{className:"spotlight-queue-item",role:"listitem",children:b})})})})]})]})}),!e&&E.jsx("div",{className:"spotlight-queue-toggle",children:E.jsx(xo,{onClick:w,title:"Show queue",clearWhenIdle:!0,color:"dark",size:72,children:E.jsx(Ph,{size:40})})}),E.jsx("div",{className:"autoplay-toggle",children:E.jsx(Un,{size:"sm",label:"Autoplay",checked:n,onChange:v})}),E.jsx("div",{className:"info-toggle",children:E.jsx(D_,{})})]})}async function M_(){try{const i="https://etf-dc-scrape-links-api.web.app/links.json",e=await $c.get(i,{timeout:1e4});if(e.status!==200)throw new Error(`HTTP error: ${e.status}`);const t=e.data;return!t||!Array.isArray(t.links)?(console.warn("Invalid response format from Discord links API"),[]):t.links}catch(i){return console.error("Failed to fetch links:",i),[]}}function k_(){const i=Ye(),e=te(Nc),t=zn(),[n,r]=X.useState(!1),[s,o]=X.useState(!1),[d,f]=X.useState(!1),[h,p]=X.useState(!1),[y,w]=X.useState("top"),[P,_]=X.useState(20),v="etf_bot".split(",").map(A=>A.trim()).filter(Boolean),b=e&&v.includes(e),T=()=>{t.openModal({title:"Import links",children:E.jsx(zo,{}),size:"lg"}),r(!1)},C=X.useCallback(async()=>{if(s)return;o(!0);const A=setTimeout(()=>{o(!1)},1e4);try{const O=await M_();let B=0,N=0;for(const j of O){if(!j?.url||typeof j.url!="string"){console.warn("Invalid link entry:",j),N++;continue}const{url:W,username:F}=j,z=ft.getIdFromUrl(W);if(z)try{const K=await ft.getClipById(z);K?(i(bn({...K,submitters:[F+"*"],url:K.url||W})),B++):(i(bn({id:z,submitters:[F+"*"],url:W})),B++)}catch(K){console.error("Failed to process clip:",W,K),N++}else console.warn("Unsupported link format:",W),N++}console.log(`Import completed: ${B} successful, ${N} failed`)}catch(O){console.error("Import process failed:",O)}finally{clearTimeout(A),o(!1),r(!1)}},[i,s]),M=X.useCallback(async A=>{if(d)return;r(!0),p(!1),f(!0),w(A);const O=setTimeout(()=>{f(!1)},15e3);try{const B=await jc.getSubredditPosts("LivestreamFail",A,P,"day");let N=0,j=0;console.log(`Found ${B.length} potential clips from Reddit (${A})`);for(const W of B){if(!W?.url||typeof W.url!="string"){console.warn("Invalid link entry:",W),j++;continue}const{url:F,username:z,title:K}=W,J=ft.getIdFromUrl(F);if(J)try{const Z=await ft.getClipById(J);Z?(i(bn({...Z,submitters:[`${z} (r/LSF)`],url:Z.url||F,title:K||Z.title})),N++):(i(bn({id:J,submitters:[`${z} (r/LSF)`],url:F,title:K})),N++)}catch(Z){console.error("Failed to process clip:",F,Z),j++}else console.warn("Unsupported link format:",F),j++}console.log(`Reddit import (${A}) completed: ${N} successful, ${j} failed`)}catch(B){console.error("Reddit import process failed:",B)}finally{clearTimeout(O),f(!1),setTimeout(()=>{p(!1),r(!1)},600)}},[i,d,P]);if(!e)return null;const L={top:"Top",hot:"Hot",best:"Best",new:"New"},k=()=>{r(A=>(A&&p(!1),!A))},R=X.useRef(null);return X.useEffect(()=>{if(!n)return;const A=O=>{const B=O.target;if(!B)return;const N=O.composedPath?O.composedPath():O.path;if(N&&N.length){for(const j of N)if(j instanceof HTMLElement&&(R.current&&R.current.contains(j)||j.closest&&(j.closest(".mantine-Menu-dropdown")||j.closest(".mantine-Popover-dropdown")||j.closest(".mantine-Popover-root")||j.closest(".mantine-Popper-root")||j.closest("[data-mantine-dropdown]")||j.closest("[data-mantine-popover]"))))return}if(!(R.current&&R.current.contains(B))){try{const j=O.clientX,W=O.clientY;if(typeof j=="number"&&typeof W=="number"){const F=[".etf-reddit-dropdown",".mantine-Menu-dropdown",".mantine-Popover-dropdown",".mantine-Popover-root",".mantine-Popper-root","[data-mantine-dropdown]","[data-mantine-popover]"];for(const z of F){const K=document.querySelectorAll(z);for(const J of Array.from(K)){if(!(J instanceof HTMLElement))continue;const Z=J.getBoundingClientRect();if(j>=Z.left&&j<=Z.right&&W>=Z.top&&W<=Z.bottom)return}}}}catch{}r(!1),p(!1)}};return document.addEventListener("pointerdown",A),()=>document.removeEventListener("pointerdown",A)},[n]),E.jsxs(we,{className:"floating-import-menu",ref:R,children:[E.jsx(Ze,{className:`fab-main ${n?"open":""}`,size:"xl",radius:"xl",variant:"filled",color:"indigo","aria-label":n?"Close import options":"Open import options",onClick:k,sx:{transition:"transform 220ms ease","&:hover":{transform:"scale(1.08)"}},children:E.jsx(Vh,{size:24})}),E.jsxs(we,{className:`fab-items ${n?"open":""}`,children:[E.jsx(Ze,{className:"fab-item fab-item-1",size:"xl",radius:"xl",variant:"filled",color:"violet","aria-label":"Import in bulk",onClick:T,children:E.jsx($o,{size:20})}),E.jsx(yt,{withinPortal:!0,position:"left",withArrow:!0,closeOnItemClick:!1,opened:h,onOpen:()=>p(!0),onClose:()=>p(!1),control:E.jsx(Ze,{className:"fab-item fab-item-2",size:"xl",radius:"xl",variant:"filled",color:"orange","aria-label":"Import from r/LSF",loading:d,children:E.jsx(Jc,{size:20})}),children:E.jsxs("div",{className:"etf-reddit-dropdown",children:[E.jsx(yt.Label,{children:E.jsxs("div",{className:"reddit-menu-header",children:[E.jsx("span",{children:"Sort by"}),E.jsx(Ze,{size:"xs",variant:"light","aria-label":"Close Reddit import menu",onClick:()=>p(!1),children:E.jsx(ss,{size:12})})]})}),["top","hot","best","new"].map(A=>E.jsx(yt.Item,{onClick:()=>M(A),sx:A===y?{fontWeight:600}:void 0,children:L[A]},A)),E.jsx(Yc,{}),E.jsx(yt.Label,{children:"Number of posts"}),E.jsx("div",{style:{padding:"8px 12px"},onClick:A=>A.stopPropagation(),onPointerDown:A=>A.stopPropagation(),onMouseDown:A=>A.stopPropagation(),children:E.jsx(Mo,{value:P,onChange:A=>_(typeof A=="number"?A:20),min:1,max:100,step:5,size:"xs",placeholder:"20",styles:{input:{textAlign:"center"}}})})]})}),b&&E.jsx(Ze,{className:"fab-item fab-item-3",size:"xl",radius:"xl",variant:"filled",color:"indigo","aria-label":"Import from Discord",loading:s,onClick:C,children:E.jsx(yh,{size:20})})]})]})}const R_=()=>{const i=Le.c(15),e=Ye(),t=te(Oo),{yea:n,nay:r}=te(Fc),s=n+r;let o;i[0]!==s||i[1]!==n?(o=s>0?Math.round(n/s*100):0,i[0]=s,i[1]=n,i[2]=o):o=i[2];const d=o,f=s>0?100-d:0;let h;i[3]!==e?(h=()=>{e(Lo())},i[3]=e,i[4]=h):h=i[4];const p=h;let y;i[5]!==p||i[6]!==r||i[7]!==f||i[8]!==s||i[9]!==n||i[10]!==d?(y=P=>E.jsx(we,{style:P,sx:U_,children:E.jsxs(we,{sx:B_,children:[E.jsxs(we,{sx:{position:"relative",padding:"10px 14px 0"},children:[E.jsxs(we,{sx:N_,children:[E.jsx(we,{sx:_=>({position:"absolute",top:0,left:0,bottom:0,width:`${s>0?d:50}%`,transition:"width 300ms ease",background:`linear-gradient(90deg, ${_.colors.green[5]}, ${_.colors.green[7]})`,boxShadow:`0 0 12px ${_.colors.green[8]}55`,animation:"pollGlowYea 2.4s ease-in-out infinite",transformOrigin:"left center"})}),E.jsx(we,{sx:_=>({position:"absolute",top:0,right:0,bottom:0,width:`${s>0?f:50}%`,transition:"width 300ms ease",background:`linear-gradient(90deg, ${_.colors.red[7]}, ${_.colors.red[5]})`,boxShadow:`0 0 12px ${_.colors.red[8]}55`,animation:"pollGlowNay 2.4s ease-in-out infinite",transformOrigin:"right center"})}),E.jsx(rt,{weight:800,size:"sm",sx:j_,children:s>0?`${d}%`:""}),E.jsx(rt,{weight:800,size:"sm",sx:$_,children:s>0?`${f}%`:""})]}),E.jsxs(wt,{spacing:"lg",position:"apart",align:"stretch",children:[E.jsxs(we,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",minHeight:56},children:[E.jsx(rt,{weight:700,size:"sm",color:"green",children:"Yea"}),E.jsxs(rt,{size:"xs",color:"dimmed",children:[n," vote",n===1?"":"s"]})]}),E.jsxs(we,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",minHeight:56,alignItems:"flex-end"},children:[E.jsx(rt,{weight:700,size:"sm",color:"red",children:"Nay"}),E.jsxs(rt,{size:"xs",color:"dimmed",children:[r," vote",r===1?"":"s"]})]})]})]}),E.jsxs(we,{sx:F_,children:[E.jsx(rt,{size:"xs",color:"dimmed",weight:800,sx:{whiteSpace:"nowrap",textAlign:"center",width:"100%"},children:s>0?`Total votes: ${s}`:"Type VoteYea / VoteNay to vote"}),E.jsx(we,{role:"button","aria-label":"Close poll",onClick:p,sx:q_,children:E.jsx(ss,{size:10,stroke:2.2})})]})]})}),i[5]=p,i[6]=r,i[7]=f,i[8]=s,i[9]=n,i[10]=d,i[11]=y):y=i[11];let w;return i[12]!==t||i[13]!==y?(w=E.jsx(Xc,{mounted:t,transition:"slide-up",duration:260,timingFunction:"ease-out",children:y}),i[12]=t,i[13]=y,i[14]=w):w=i[14],w};function U_(i){return{position:"fixed",left:0,right:0,bottom:12,zIndex:1200,pointerEvents:"none",display:"flex",justifyContent:"center"}}function B_(i){return{width:"90%",maxWidth:960,background:i.colorScheme==="dark"?"rgba(21, 24, 28, 0.92)":"rgba(255, 255, 255, 0.94)",border:`1px solid ${i.colorScheme==="dark"?i.colors.dark[4]:i.colors.gray[3]}`,borderRadius:12,boxShadow:i.shadows.lg,overflow:"visible",position:"relative",pointerEvents:"auto",backdropFilter:"blur(6px)"}}function N_(i){return{position:"relative",height:28,borderRadius:10,overflow:"hidden",background:i.colorScheme==="dark"?i.colors.dark[7]:i.colors.gray[1],border:`1px solid ${i.colorScheme==="dark"?i.colors.dark[4]:i.colors.gray[3]}`}}function j_(i){return{position:"absolute",left:10,top:2,textShadow:"0 1px 3px rgba(0,0,0,0.55)",color:i.colorScheme==="dark"?i.colors.teal[1]:i.colors.gray[7]}}function $_(i){return{position:"absolute",right:10,top:2,textShadow:"0 1px 3px rgba(0,0,0,0.55)",color:i.colorScheme==="dark"?i.colors.orange[2]:i.colors.gray[7]}}function F_(i){return{position:"absolute",left:"50%",bottom:-1,transform:"translateX(-50%)",width:200,display:"flex",flexDirection:"column",alignItems:"center",pointerEvents:"auto"}}function q_(i){return{marginTop:6,width:36,height:18,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderTopLeftRadius:999,borderTopRightRadius:999,borderBottomLeftRadius:0,borderBottomRightRadius:0,boxShadow:"none",color:i.colorScheme==="dark"?i.colors.gray[3]:i.colors.dark[6],cursor:"pointer",pointerEvents:"auto",transition:"background 120ms ease, box-shadow 120ms ease, border 120ms ease","&:hover":{background:i.colorScheme==="dark"?i.colors.dark[6]:i.white,border:`1px solid ${i.colorScheme==="dark"?i.colors.dark[4]:i.colors.gray[3]}`,boxShadow:i.shadows.xs,color:i.colorScheme==="dark"?i.white:i.colors.dark[7]}}}const W_=()=>{const i=Le.c(8),e=te(qc);let t;e:switch(e){case"classic":{let o;i[0]===Symbol.for("react.memo_cache_sentinel")?(o=E.jsx(wo,{}),i[0]=o):o=i[0],t=o;break e}case"spotlight":{let o;i[1]===Symbol.for("react.memo_cache_sentinel")?(o=E.jsx(L_,{}),i[1]=o):o=i[1],t=o;break e}case"fullscreen":{let o;i[2]===Symbol.for("react.memo_cache_sentinel")?(o=E.jsx(C_,{}),i[2]=o):o=i[2],t=o;break e}default:{let o;i[3]===Symbol.for("react.memo_cache_sentinel")?(o=E.jsx(wo,{}),i[3]=o):o=i[3],t=o}}let n,r;i[4]===Symbol.for("react.memo_cache_sentinel")?(n=E.jsx(k_,{}),r=E.jsx(R_,{}),i[4]=n,i[5]=r):(n=i[4],r=i[5]);let s;return i[6]!==t?(s=E.jsxs(E.Fragment,{children:[t,n,r]}),i[6]=t,i[7]=s):s=i[7],s};W_.displayName="QueuePage";export{W_ as default};
