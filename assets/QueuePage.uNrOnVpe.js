import{c as Ae,r as ut,t as Fe,a as ke,u as yt,b as se,s as Gu,d as Xr,e as jn,f as Kr,g as zu,h as dt,i as _o,j as D,k as Qu,p as vo,l as bo,m as To,n as So,o as Yu,q as Xu,v as Ku,w as Ju,x as Zu,y as wo,z as ec,A as tc,B as ic,C as nc,D as rc,E as sc,F as ac,G as oc,H as lc,I as dc,J as uc,K as cc,L as hc,N as fc,O as mc,P as pc,Q as gc,R as yc,S as _c,T as ki,U as vc,V as bc,W as Tc}from"./index.mdu6KBT-.js";import{a as it,h as Jr,B as Bt,G as At,c as qi,T as Nt,b as Zr,M as vn,z as Sc,r as le,N as wc,S as Ft,A as Xt,R as G,i as Ec,E as xc,F as la,I as Pc,P as Ne,y as $i,J as ci,K as Cc,O as da,Q as Ic}from"./mantine.C6sLFowA.js";import{P as Dc,C as Eo}from"./Clip.klP-5jMz.js";import{v as H,_ as ze,w as W,a as Ac,D as Oc,b as ua,c as Bi,m as ur,p as It,d as lt,i as Lc,g as es,e as Mc,f as Kt,h as Rc,t as kc,s as xo,j as Uc,k as Po,P as Bc,l as Nc,n as ts,o as Un,q as Fc,u as $c,x as jc,y as qc,z as Wc,A as Vc,B as Hc}from"./videojs.NeURMMHm.js";import{r as tt,g as Co,a as Io}from"./vendor.NHdFJPub.js";/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gc=[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]],zc=Ae("outline","chevron-left","ChevronLeft",Gc);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qc=[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]],Yc=Ae("outline","chevron-right","ChevronRight",Qc);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xc=[["path",{d:"M18 18h-13l-1.865 -9.327a.25 .25 0 0 1 .4 -.244l4.465 3.571l1.6 -2.4m1.596 -2.394l.804 -1.206l4 6l4.464 -3.571a.25 .25 0 0 1 .401 .244l-1.363 6.818",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]],Kc=Ae("outline","crown-off","CrownOff",Xc);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=[["path",{d:"M12 6l4 6l5 -4l-2 10h-14l-2 -10l5 4z",key:"svg-0"}]],Zc=Ae("outline","crown","Crown",Jc);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 13v-8a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-5.5m-9.5 -2h7m-3 -3l3 3l-3 3",key:"svg-1"}]],th=Ae("outline","file-import","FileImport",eh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]],nh=Ae("outline","info-circle","InfoCircle",ih);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]],sh=Ae("outline","menu-2","Menu2",rh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=[["path",{d:"M15 15h-1a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25a9 9 0 0 1 -6.372 -15.356",key:"svg-0"}],["path",{d:"M8 4c1.236 -.623 2.569 -1 4 -1c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828a4.516 4.516 0 0 1 -1.127 .73",key:"svg-1"}],["path",{d:"M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}],["path",{d:"M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-4"}],["path",{d:"M3 3l18 18",key:"svg-5"}]],oh=Ae("outline","palette-off","PaletteOff",ah);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=[["path",{d:"M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25",key:"svg-0"}],["path",{d:"M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}]],dh=Ae("outline","palette","Palette",lh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=[["path",{d:"M4 5v14l12 -7z",key:"svg-0"}],["path",{d:"M20 5l0 14",key:"svg-1"}]],ch=Ae("outline","player-skip-forward","PlayerSkipForward",uh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const hh=[["path",{d:"M3 5v14l8 -7z",key:"svg-0"}],["path",{d:"M14 5v14l8 -7z",key:"svg-1"}]],fh=Ae("outline","player-track-next","PlayerTrackNext",hh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=[["path",{d:"M21 5v14l-8 -7z",key:"svg-0"}],["path",{d:"M10 5v14l-8 -7z",key:"svg-1"}]],ph=Ae("outline","player-track-prev","PlayerTrackPrev",mh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]],yh=Ae("outline","refresh","Refresh",gh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const _h=[["path",{d:"M3 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M17 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M5 11v-3a3 3 0 0 1 3 -3h8a3 3 0 0 1 3 3v3",key:"svg-3"}],["path",{d:"M16.5 8.5l2.5 2.5l2.5 -2.5",key:"svg-4"}]],vh=Ae("outline","reorder","Reorder",_h);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const bh=[["path",{d:"M6 5l0 14",key:"svg-0"}],["path",{d:"M10 5l0 14",key:"svg-1"}],["path",{d:"M14 5l0 14",key:"svg-2"}],["path",{d:"M18 5l0 14",key:"svg-3"}],["path",{d:"M3 17l18 -10",key:"svg-4"}]],Th=Ae("outline","tallymarks","Tallymarks",bh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=[["path",{d:"M7 13v-6m-3 -3a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 1 0 4 0v-3m2 -2h1a2 2 0 0 0 2 -2l-1 -5c-.295 -1.26 -1.11 -2.076 -2 -2h-7c-.57 0 -1.102 .159 -1.556 .434",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]],wh=Ae("outline","thumb-down-off","ThumbDownOff",Sh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=[["path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3",key:"svg-0"}]],xh=Ae("outline","thumb-down","ThumbDown",Eh);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ph=[["path",{d:"M4 7h16",key:"svg-0"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-1"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-2"}],["path",{d:"M10 12l4 4m0 -4l-4 4",key:"svg-3"}]],Ch=Ae("outline","trash-x","TrashX",Ph);/**
 * @license @tabler/icons-react v3.34.1 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],Dh=Ae("outline","x","X",Ih);function Ah(n){if(n===null||n===!0||n===!1)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function ca(n){var e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}function Mn(n,e){ut(2,arguments);var t=Fe(n),i=Fe(e),r=t.getTime()-i.getTime();return r<0?-1:r>0?1:r}var Do=6e4,Ao=36e5;function Oh(n,e){ut(2,arguments);var t=Fe(n),i=Fe(e),r=t.getFullYear()-i.getFullYear(),a=t.getMonth()-i.getMonth();return r*12+a}function Lh(n,e){return ut(2,arguments),Fe(n).getTime()-Fe(e).getTime()}var Mh={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(n){return n<0?Math.ceil(n):Math.floor(n)}},Rh="trunc";function kh(n){return Mh[Rh]}function Uh(n){ut(1,arguments);var e=Fe(n);return e.setHours(23,59,59,999),e}function Bh(n){ut(1,arguments);var e=Fe(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function Nh(n){ut(1,arguments);var e=Fe(n);return Uh(e).getTime()===Bh(e).getTime()}function Fh(n,e){ut(2,arguments);var t=Fe(n),i=Fe(e),r=Mn(t,i),a=Math.abs(Oh(t,i)),o;if(a<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*a);var d=Mn(t,i)===-r;Nh(Fe(n))&&a===1&&Mn(n,i)===1&&(d=!1),o=r*(a-Number(d))}return o===0?0:o}function $h(n,e,t){ut(2,arguments);var i=Lh(n,e)/1e3;return kh()(i)}var jh={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},qh=function(n,e,t){var i,r=jh[n];return typeof r=="string"?i=r:e===1?i=r.one:i=r.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+i:i+" ago":i};function cr(n){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):n.defaultWidth,i=n.formats[t]||n.formats[n.defaultWidth];return i}}var Wh={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Vh={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Hh={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Gh={date:cr({formats:Wh,defaultWidth:"full"}),time:cr({formats:Vh,defaultWidth:"full"}),dateTime:cr({formats:Hh,defaultWidth:"full"})},zh={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Qh=function(n,e,t,i){return zh[n]};function Di(n){return function(e,t){var i=t||{},r=i.context?String(i.context):"standalone",a;if(r==="formatting"&&n.formattingValues){var o=n.defaultFormattingWidth||n.defaultWidth,d=i.width?String(i.width):o;a=n.formattingValues[d]||n.formattingValues[o]}else{var m=n.defaultWidth,h=i.width?String(i.width):n.defaultWidth;a=n.values[h]||n.values[m]}var g=n.argumentCallback?n.argumentCallback(e):e;return a[g]}}var Yh={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Xh={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Kh={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Jh={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Zh={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ef={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},tf=function(n,e){var t=Number(n),i=t%100;if(i>20||i<10)switch(i%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},nf={ordinalNumber:tf,era:Di({values:Yh,defaultWidth:"wide"}),quarter:Di({values:Xh,defaultWidth:"wide",argumentCallback:function(n){return n-1}}),month:Di({values:Kh,defaultWidth:"wide"}),day:Di({values:Jh,defaultWidth:"wide"}),dayPeriod:Di({values:Zh,defaultWidth:"wide",formattingValues:ef,defaultFormattingWidth:"wide"})};function Ai(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.width,r=i&&n.matchPatterns[i]||n.matchPatterns[n.defaultMatchWidth],a=e.match(r);if(!a)return null;var o=a[0],d=i&&n.parsePatterns[i]||n.parsePatterns[n.defaultParseWidth],m=Array.isArray(d)?sf(d,function(y){return y.test(o)}):rf(d,function(y){return y.test(o)}),h;h=n.valueCallback?n.valueCallback(m):m,h=t.valueCallback?t.valueCallback(h):h;var g=e.slice(o.length);return{value:h,rest:g}}}function rf(n,e){for(var t in n)if(n.hasOwnProperty(t)&&e(n[t]))return t}function sf(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return t}function af(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.match(n.matchPattern);if(!i)return null;var r=i[0],a=e.match(n.parsePattern);if(!a)return null;var o=n.valueCallback?n.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;var d=e.slice(r.length);return{value:o,rest:d}}}var of=/^(\d+)(th|st|nd|rd)?/i,lf=/\d+/i,df={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},uf={any:[/^b/i,/^(a|c)/i]},cf={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},hf={any:[/1/i,/2/i,/3/i,/4/i]},ff={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},mf={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},pf={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},gf={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},yf={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},_f={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},vf={ordinalNumber:af({matchPattern:of,parsePattern:lf,valueCallback:function(n){return parseInt(n,10)}}),era:Ai({matchPatterns:df,defaultMatchWidth:"wide",parsePatterns:uf,defaultParseWidth:"any"}),quarter:Ai({matchPatterns:cf,defaultMatchWidth:"wide",parsePatterns:hf,defaultParseWidth:"any",valueCallback:function(n){return n+1}}),month:Ai({matchPatterns:ff,defaultMatchWidth:"wide",parsePatterns:mf,defaultParseWidth:"any"}),day:Ai({matchPatterns:pf,defaultMatchWidth:"wide",parsePatterns:gf,defaultParseWidth:"any"}),dayPeriod:Ai({matchPatterns:yf,defaultMatchWidth:"any",parsePatterns:_f,defaultParseWidth:"any"})},bf={code:"en-US",formatDistance:qh,formatLong:Gh,formatRelative:Qh,localize:nf,match:vf,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Tf(n,e){if(n==null)throw new TypeError("assign requires that input parameter not be null or undefined");e=e||{};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n}function Sf(n){return Tf({},n)}var ha=1440,wf=2520,hr=43200,Ef=86400;function xf(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ut(2,arguments);var i=t.locale||bf;if(!i.formatDistance)throw new RangeError("locale must contain formatDistance property");var r=Mn(n,e);if(isNaN(r))throw new RangeError("Invalid time value");var a=Sf(t);a.addSuffix=!!t.addSuffix,a.comparison=r;var o,d;r>0?(o=Fe(e),d=Fe(n)):(o=Fe(n),d=Fe(e));var m=$h(d,o),h=(ca(d)-ca(o))/1e3,g=Math.round((m-h)/60),y;if(g<2)return t.includeSeconds?m<5?i.formatDistance("lessThanXSeconds",5,a):m<10?i.formatDistance("lessThanXSeconds",10,a):m<20?i.formatDistance("lessThanXSeconds",20,a):m<40?i.formatDistance("halfAMinute",null,a):m<60?i.formatDistance("lessThanXMinutes",1,a):i.formatDistance("xMinutes",1,a):g===0?i.formatDistance("lessThanXMinutes",1,a):i.formatDistance("xMinutes",g,a);if(g<45)return i.formatDistance("xMinutes",g,a);if(g<90)return i.formatDistance("aboutXHours",1,a);if(g<ha){var S=Math.round(g/60);return i.formatDistance("aboutXHours",S,a)}else{if(g<wf)return i.formatDistance("xDays",1,a);if(g<hr){var x=Math.round(g/ha);return i.formatDistance("xDays",x,a)}else if(g<Ef)return y=Math.round(g/hr),i.formatDistance("aboutXMonths",y,a)}if(y=Fh(d,o),y<12){var _=Math.round(g/hr);return i.formatDistance("xMonths",_,a)}else{var T=y%12,v=Math.floor(y/12);return T<3?i.formatDistance("aboutXYears",v,a):T<9?i.formatDistance("overXYears",v,a):i.formatDistance("almostXYears",v+1,a)}}function Pf(n,e){return ut(1,arguments),xf(n,Date.now(),e)}function Cf(n,e){ut(1,arguments);var t={},i=t.additionalDigits==null?2:Ah(t.additionalDigits);if(i!==2&&i!==1&&i!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof n=="string"||Object.prototype.toString.call(n)==="[object String]"))return new Date(NaN);var r=Of(n),a;if(r.date){var o=Lf(r.date,i);a=Mf(o.restDateString,o.year)}if(!a||isNaN(a.getTime()))return new Date(NaN);var d=a.getTime(),m=0,h;if(r.time&&(m=Rf(r.time),isNaN(m)))return new Date(NaN);if(r.timezone){if(h=kf(r.timezone),isNaN(h))return new Date(NaN)}else{var g=new Date(d+m),y=new Date(0);return y.setFullYear(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate()),y.setHours(g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds()),y}return new Date(d+m+h)}var bn={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},If=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Df=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Af=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Of(n){var e={},t=n.split(bn.dateTimeDelimiter),i;if(t.length>2)return e;if(/:/.test(t[0])?i=t[0]:(e.date=t[0],i=t[1],bn.timeZoneDelimiter.test(e.date)&&(e.date=n.split(bn.timeZoneDelimiter)[0],i=n.substr(e.date.length,n.length))),i){var r=bn.timezone.exec(i);r?(e.time=i.replace(r[1],""),e.timezone=r[1]):e.time=i}return e}function Lf(n,e){var t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),i=n.match(t);if(!i)return{year:NaN,restDateString:""};var r=i[1]?parseInt(i[1]):null,a=i[2]?parseInt(i[2]):null;return{year:a===null?r:a*100,restDateString:n.slice((i[1]||i[2]).length)}}function Mf(n,e){if(e===null)return new Date(NaN);var t=n.match(If);if(!t)return new Date(NaN);var i=!!t[4],r=Oi(t[1]),a=Oi(t[2])-1,o=Oi(t[3]),d=Oi(t[4]),m=Oi(t[5])-1;if(i)return $f(e,d,m)?Uf(e,d,m):new Date(NaN);var h=new Date(0);return!Nf(e,a,o)||!Ff(e,r)?new Date(NaN):(h.setUTCFullYear(e,a,Math.max(r,o)),h)}function Oi(n){return n?parseInt(n):1}function Rf(n){var e=n.match(Df);if(!e)return NaN;var t=fr(e[1]),i=fr(e[2]),r=fr(e[3]);return jf(t,i,r)?t*Ao+i*Do+r*1e3:NaN}function fr(n){return n&&parseFloat(n.replace(",","."))||0}function kf(n){if(n==="Z")return 0;var e=n.match(Af);if(!e)return 0;var t=e[1]==="+"?-1:1,i=parseInt(e[2]),r=e[3]&&parseInt(e[3])||0;return qf(i,r)?t*(i*Ao+r*Do):NaN}function Uf(n,e,t){var i=new Date(0);i.setUTCFullYear(n,0,4);var r=i.getUTCDay()||7,a=(e-1)*7+t+1-r;return i.setUTCDate(i.getUTCDate()+a),i}var Bf=[31,null,31,30,31,30,31,31,30,31,30,31];function Oo(n){return n%400===0||n%4===0&&n%100!==0}function Nf(n,e,t){return e>=0&&e<=11&&t>=1&&t<=(Bf[e]||(Oo(n)?29:28))}function Ff(n,e){return e>=1&&e<=(Oo(n)?366:365)}function $f(n,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function jf(n,e,t){return n===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&n>=0&&n<25}function qf(n,e){return e>=0&&e<=59}function Lo(n){const e=ke.c(31),{className:t}=n,i=yt(),r=se(Gu),a=se(Xr),o=se(jn),d=se(Kr),m=se(zu);let h;e[0]===Symbol.for("react.memo_cache_sentinel")?(h={flexShrink:0,marginLeft:"auto"},e[0]=h):h=e[0];let g;e[1]===Symbol.for("react.memo_cache_sentinel")?(g={display:"flex",alignItems:"center"},e[1]=g):g=e[1];let y;e[2]!==i?(y=M=>{i(dt({set:!1})),i(_o(M.currentTarget.checked))},e[2]=i,e[3]=y):y=e[3];let S;e[4]!==d||e[5]!==y?(S=D.jsx(it,{sx:g,children:D.jsx(Jr,{size:"sm",label:"Autoplay",checked:d,onChange:y})}),e[4]=d,e[5]=y,e[6]=S):S=e[6];let x;e[7]!==o||e[8]!==r||e[9]!==i?(x=o&&D.jsx(Bt,{size:"xs",variant:"default",rightIcon:D.jsx(ch,{}),onClick:()=>{i(dt({set:!1})),i(Qu())},disabled:!r,children:"Skip"}),e[7]=o,e[8]=r,e[9]=i,e[10]=x):x=e[10];let _;e[11]!==S||e[12]!==x?(_=D.jsxs(At,{align:"center",spacing:"xs",children:[S,x]}),e[11]=S,e[12]=x,e[13]=_):_=e[13];let T;e[14]===Symbol.for("react.memo_cache_sentinel")?(T=D.jsx(ph,{}),e[14]=T):T=e[14];let v;e[15]!==i?(v=()=>{i(dt({set:!1})),i(vo())},e[15]=i,e[16]=v):v=e[16];const E=!m;let P;e[17]!==v||e[18]!==E?(P=D.jsx(Bt,{size:"xs",leftIcon:T,onClick:v,disabled:E,children:"Prev"}),e[17]=v,e[18]=E,e[19]=P):P=e[19];let O;e[20]===Symbol.for("react.memo_cache_sentinel")?(O=D.jsx(fh,{}),e[20]=O):O=e[20];let A;e[21]!==i?(A=()=>{i(dt({set:!1})),i(bo())},e[21]=i,e[22]=A):A=e[22];const k=!r&&!a;let U;e[23]!==A||e[24]!==k?(U=D.jsx(Bt,{size:"xs",rightIcon:O,onClick:A,disabled:k,children:"Next"}),e[23]=A,e[24]=k,e[25]=U):U=e[25];let L;return e[26]!==t||e[27]!==P||e[28]!==U||e[29]!==_?(L=D.jsxs(At,{align:"center",className:t,sx:h,children:[_,P,U]}),e[26]=t,e[27]=P,e[28]=U,e[29]=_,e[30]=L):L=e[30],L}const mr=D.jsx(D.Fragment,{children:" "});function qn(n){const e=ke.c(34),{className:t}=n,i=se(To),r=qi(),a=i?.submitters?.[0];let o;e[0]!==a?(o=Q=>a?Q.chatUsers[a.toLowerCase()]:void 0,e[0]=a,e[1]=o):o=e[1];const d=se(o);let m;e[2]===Symbol.for("react.memo_cache_sentinel")?(m=So(3),e[2]=m):m=e[2];const h=se(m),g=a?h.findIndex(Q=>Q.username===a.toLowerCase()):-1,y=g>=0?`chip-anim-${g}`:void 0,S=se(Wf),x=S&&y?y:void 0;let _;e:{if(!S||y||!d){_=void 0;break e}const Q=d.broadcaster?r.colors.red[6]:d.vip?r.colors.pink[6]:d.mod?r.colors.green[6]:void 0;let K;e[3]!==Q?(K=Q?{color:Q}:void 0,e[3]=Q,e[4]=K):K=e[4],_=K}const T=_;let v;e[5]===Symbol.for("react.memo_cache_sentinel")?(v={strong:{fontWeight:600},flex:1,minWidth:0,overflow:"hidden"},e[5]=v):v=e[5];const E=i?.title??mr;let P;e[6]!==E?(P=D.jsx(Nt,{size:"xl",weight:700,lineClamp:1,children:E}),e[6]=E,e[7]=P):P=e[7];let O;e[8]!==i?(O=i?.url&&i?.Platform&&(i.Platform==="Twitter"||i.Platform==="Instagram")&&D.jsx(Nt,{size:"xs",weight:700,lineClamp:1,children:D.jsx("a",{href:i?.url,target:"_blank",rel:"noopener noreferrer",style:{color:"#228be6",textDecoration:"underline"},children:i.url||mr})}),e[8]=i,e[9]=O):O=e[9];let A;e[10]===Symbol.for("react.memo_cache_sentinel")?(A={display:"flex",alignItems:"center",gap:".25rem"},e[10]=A):A=e[10];const k=i?.Platform;let U;e[11]!==k?(U=D.jsx(Dc,{platform:k}),e[11]=k,e[12]=U):U=e[12];const L=i?.author??mr;let M;e[13]!==L?(M=D.jsx("strong",{children:L}),e[13]=L,e[14]=M):M=e[14];let B;e[15]!==i?.category?(B=i?.category&&D.jsxs(D.Fragment,{children:[" (",D.jsx("strong",{children:i?.category}),")"]}),e[15]=i?.category,e[16]=B):B=e[16];let $;e[17]!==i||e[18]!==x||e[19]!==T?($=i?.submitters[0]&&D.jsxs(D.Fragment,{children:[", submitted by"," ",D.jsx("strong",{className:x,style:T,children:i?.submitters[0]}),i?.submitters.length>1&&D.jsxs(D.Fragment,{children:[" and ",i.submitters.length-1," other(s)"]})]}),e[17]=i,e[18]=x,e[19]=T,e[20]=$):$=e[20];let q;e[21]!==i?.createdAt?(q=i?.createdAt&&D.jsxs(D.Fragment,{children:[", created ",Pf(Cf(i?.createdAt))," ago"]}),e[21]=i?.createdAt,e[22]=q):q=e[22];let V;e[23]!==U||e[24]!==M||e[25]!==B||e[26]!==$||e[27]!==q?(V=D.jsxs(Nt,{sx:A,color:"dimmed",size:"sm",lineClamp:1,children:[U,M,B,$,q]}),e[23]=U,e[24]=M,e[25]=B,e[26]=$,e[27]=q,e[28]=V):V=e[28];let F;return e[29]!==t||e[30]!==V||e[31]!==P||e[32]!==O?(F=D.jsxs(it,{className:t,sx:v,children:[P,O,V]}),e[29]=t,e[30]=V,e[31]=P,e[32]=O,e[33]=F):F=e[33],F}function Wf(n){return n.clipQueue.coloredSubmitterNames!==!1}function is(n){const e=ke.c(17),{wrapper:t,card:i}=n,r=yt(),a=se(Yu),o=t??Vf;let d;e[0]!==r?(d=x=>()=>r(Xu(x)),e[0]=r,e[1]=d):d=e[1];const m=d;let h;e[2]!==r?(h=x=>()=>r(Ku(x)),e[2]=r,e[3]=h):h=e[3];const g=h;let y;if(e[4]!==o||e[5]!==i||e[6]!==a||e[7]!==m||e[8]!==g){let x;e[10]!==o||e[11]!==i||e[12]!==m||e[13]!==g?(x=(_,T)=>D.jsx(o,{children:D.jsx(Eo,{platform:_.Platform||void 0,clipId:_.id,card:i,queueIndex:T+1,onClick:m(_.id),onCrossClick:g(_.id)},_.id)},_.id),e[10]=o,e[11]=i,e[12]=m,e[13]=g,e[14]=x):x=e[14],y=a.map(x),e[4]=o,e[5]=i,e[6]=a,e[7]=m,e[8]=g,e[9]=y}else y=e[9];let S;return e[15]!==y?(S=D.jsx(D.Fragment,{children:y}),e[15]=y,e[16]=S):S=e[16],S}function Vf(n){const{children:e}=n;return D.jsx(D.Fragment,{children:e})}function Hf(n){const e=ke.c(16),{onSubmit:t}=n,i=yt(),r=se(jn),[a,o]=le.useState(r);let d;e[0]!==i||e[1]!==t||e[2]!==a?(d=P=>{i(wo({clipLimit:a||null})),t(),P.preventDefault()},e[0]=i,e[1]=t,e[2]=a,e[3]=d):d=e[3];const m=d;let h;e[4]===Symbol.for("react.memo_cache_sentinel")?(h=D.jsx("em",{children:"Skip"}),e[4]=h):h=e[4];let g;e[5]===Symbol.for("react.memo_cache_sentinel")?(g=D.jsx("em",{children:"Next"}),e[5]=g):g=e[5];let y;e[6]===Symbol.for("react.memo_cache_sentinel")?(y=D.jsxs(D.Fragment,{children:["Max number of clips in the queue. Afterwards new clips will not be accepted, current clips can be boosted to the top of the queue. You can ",h," a clip instead of ",g,"-ing it to free a spot.",D.jsx("br",{}),"Leave empty or 0 to disable."]}),e[6]=y):y=e[6];const S=a??void 0;let x;e[7]===Symbol.for("react.memo_cache_sentinel")?(x=P=>o(P),e[7]=x):x=e[7];let _;e[8]!==S?(_=D.jsx(wc,{placeholder:"Clip limit",description:y,min:0,step:1,value:S,onChange:x}),e[8]=S,e[9]=_):_=e[9];let T;e[10]===Symbol.for("react.memo_cache_sentinel")?(T=D.jsx(Bt,{type:"submit",children:"Save"}),e[10]=T):T=e[10];let v;e[11]!==_?(v=D.jsxs(Ft,{children:[_,T]}),e[11]=_,e[12]=v):v=e[12];let E;return e[13]!==m||e[14]!==v?(E=D.jsx("form",{onSubmit:m,children:v}),e[13]=m,e[14]=v,e[15]=E):E=e[15],E}function Gf(){const n=ke.c(23),e=Zr(),t=yt(),i=se(jn),r=se(Ju);let a;n[0]!==e?(a=()=>{const P=e.openModal({title:"Set clip limit",children:D.jsx(Hf,{onSubmit:()=>e.closeModal(P)})})},n[0]=e,n[1]=a):a=n[1];const o=a;let d;n[2]===Symbol.for("react.memo_cache_sentinel")?(d=D.jsx(Th,{size:14}),n[2]=d):d=n[2];const m=i??"off";let h;n[3]!==m?(h=D.jsx(Sc,{color:"indigo",children:m}),n[3]=m,n[4]=h):h=n[4];let g;n[5]!==o?(g=()=>o(),n[5]=o,n[6]=g):g=n[6];let y;n[7]!==h||n[8]!==g?(y=D.jsx(vn.Item,{icon:d,rightSection:h,onClick:g,children:"Set queue limit"}),n[7]=h,n[8]=g,n[9]=y):y=n[9];let S;n[10]===Symbol.for("react.memo_cache_sentinel")?(S=D.jsx(vh,{size:14}),n[10]=S):S=n[10];let x;n[11]!==t?(x=P=>t(wo({reorderOnDuplicate:P.currentTarget.checked})),n[11]=t,n[12]=x):x=n[12];let _;n[13]!==r||n[14]!==x?(_=D.jsx(vn.Item,{icon:S,rightSection:D.jsx(Jr,{size:"sm",checked:r,onChange:x}),children:"Popularity sort"}),n[13]=r,n[14]=x,n[15]=_):_=n[15];let T;n[16]===Symbol.for("react.memo_cache_sentinel")?(T=D.jsx(Ch,{size:14}),n[16]=T):T=n[16];let v;n[17]!==t?(v=D.jsx(vn.Item,{icon:T,color:"red",onClick:()=>t(Zu()),children:"Clear queue"}),n[17]=t,n[18]=v):v=n[18];let E;return n[19]!==v||n[20]!==y||n[21]!==_?(E=D.jsx("div",{className:"queue-quick-menu-container",children:D.jsxs(vn,{withinPortal:!1,position:"bottom",placement:"end",closeOnItemClick:!0,children:[y,_,v]})}),n[19]=v,n[20]=y,n[21]=_,n[22]=E):E=n[22],E}const zf=n=>{const e=ke.c(23),{count:t}=n,i=t===void 0?3:t,r=yt(),a=qi();let o;e[0]!==i?(o=So(i),e[0]=i,e[1]=o):o=e[1];const d=se(o),m=se(Qf);let h;e[2]!==r?(h=()=>{r(ec())},e[2]=r,e[3]=h):h=e[3];const g=h;let y;e:{if(!d||d.length===0){y=null;break e}let L;e[4]!==m||e[5]!==d?(L=[],d.forEach((M,B)=>{B>0&&L.push(D.jsx("span",{className:"chip-sep",children:"•"},`sep-${B}`)),L.push(D.jsxs("span",{className:`top-submitter-chip ${m?`chip-anim-${B%3}`:""}`,children:[D.jsx("span",{className:"name",children:M.username}),D.jsx("span",{className:"count",children:M.count})]},M.username))}),e[4]=m,e[5]=d,e[6]=L):L=e[6],y=L}const S=y;if(!S||S.length===0)return null;const x=`1px solid ${a.colorScheme==="dark"?"#2b2b2b":"#e9ecef"}`;let _;e[7]!==x?(_={overflow:"hidden",width:"100%",mt:8,borderRadius:8,padding:"6px 10px",border:x},e[7]=x,e[8]=_):_=e[8];let T;e[9]===Symbol.for("react.memo_cache_sentinel")?(T={display:"flex",alignItems:"center",gap:8},e[9]=T):T=e[9];let v;e[10]===Symbol.for("react.memo_cache_sentinel")?(v={overflowX:"hidden",overflowY:"hidden",flex:1,minWidth:0,"&::-webkit-scrollbar":{height:0}},e[10]=v):v=e[10];let E;e[11]===Symbol.for("react.memo_cache_sentinel")?(E={display:"inline-block"},e[11]=E):E=e[11];let P;e[12]!==S?(P=D.jsx(it,{sx:v,children:D.jsx("span",{className:"top-submitters-marquee",style:E,children:S})}),e[12]=S,e[13]=P):P=e[13];let O;e[14]===Symbol.for("react.memo_cache_sentinel")?(O=D.jsx(yh,{size:14}),e[14]=O):O=e[14];let A;e[15]!==g?(A=D.jsx(Xt,{className:"top-submitters-refresh",size:"sm",variant:"light",onClick:g,title:"Reset top clippers",children:O}),e[15]=g,e[16]=A):A=e[16];let k;e[17]!==P||e[18]!==A?(k=D.jsxs(it,{sx:T,children:[P,A]}),e[17]=P,e[18]=A,e[19]=k):k=e[19];let U;return e[20]!==k||e[21]!==_?(U=D.jsx(it,{sx:_,children:k}),e[20]=k,e[21]=_,e[22]=U):U=e[22],U};function Qf(n){return n.clipQueue.coloredSubmitterNames!==!1}function Yf(){const n=Zr(),e=yt(),[t,i]=G.useState(""),[r,a]=G.useState(null),o=()=>n.closeAll(),d=()=>{let m=[];try{const h=JSON.parse(t);if(Array.isArray(h))for(const g of h)typeof g=="string"?m.push({url:g}):g&&typeof g.url=="string"&&m.push({url:g.url,submitter:g.submitter});else typeof h=="string"?m.push({url:h}):h&&typeof h.url=="string"&&m.push({url:h.url,submitter:h.submitter})}catch{const g=t.split(/[,\n\r]+/).map(y=>y.trim()).filter(Boolean);for(const y of g)m.push({url:y})}if(m.length===0){a("No URLs found in the provided input");return}for(const h of m){const g={username:h.submitter??"import*"};e(tc({url:h.url,userstate:g}))}o()};return D.jsxs(Ft,{children:[D.jsxs(Nt,{size:"sm",children:["Paste JSON array of strings or objects with a ",D.jsx("code",{children:"url"})," property."]}),D.jsx(Ec,{placeholder:`[
  { "url": "https://youtu.be/dQw4w9WgXcQ", "submitter": "alice" },
  { "url": "https://www.tiktok.com/@user/video/987654321", "submitter": "charlie" }
]`,autosize:!0,minRows:6,value:t,onChange:m=>i(m.currentTarget.value)}),r&&D.jsx(Nt,{color:"red",size:"sm",children:r}),D.jsxs(At,{position:"right",children:[D.jsx(Bt,{variant:"outline",onClick:o,children:"Cancel"}),D.jsx(Bt,{onClick:d,children:"Import"})]})]})}const ns=n=>{const e=ke.c(60),{className:t}=n,i=yt(),r=se(ic),a=se(nc),o=se(rc),d=se(sc),m=se(jn),h=se(ac),g=se(oc).length,y=Zr();let S;e[0]!==i?(S=Ue=>{i(lc(Ue==="open"))},e[0]=i,e[1]=S):S=e[1];const x=S;let _;e[2]!==y?(_=()=>{y.openModal({title:"Import links",children:D.jsx(Yf,{}),size:"lg"})},e[2]=y,e[3]=_):_=e[3];const T=_;let v;e[4]!==i?(v=()=>{i(dc())},e[4]=i,e[5]=v):v=e[5];const E=v;let P;e[6]!==i?(P=()=>{i(uc())},e[6]=i,e[7]=P):P=e[7];const O=P;let A;e[8]!==i?(A=()=>{i(cc())},e[8]=i,e[9]=A):A=e[9];const k=A,U=`${g} of ${h}${m?`/${m}`:""} clips left`;let L;e[10]===Symbol.for("react.memo_cache_sentinel")?(L=D.jsx(Nt,{size:"lg",weight:700,sx:{flexGrow:1},children:"Queue"}),e[10]=L):L=e[10];let M;e[11]===Symbol.for("react.memo_cache_sentinel")?(M={flexBasis:196},e[11]=M):M=e[11];const B=r?"open":"closed";let $;e[12]===Symbol.for("react.memo_cache_sentinel")?($=[{label:"Closed",value:"closed"},{label:"Open",value:"open"}],e[12]=$):$=e[12];let q;e[13]!==x||e[14]!==B?(q=D.jsx(xc,{size:"xs",sx:M,value:B,data:$,onChange:x}),e[13]=x,e[14]=B,e[15]=q):q=e[15];let V;e[16]===Symbol.for("react.memo_cache_sentinel")?(V=D.jsx(Gf,{}),e[16]=V):V=e[16];let F;e[17]!==q?(F=D.jsxs(At,{children:[L,q,V]}),e[17]=q,e[18]=F):F=e[18];let Q;e[19]===Symbol.for("react.memo_cache_sentinel")?(Q={width:"100%"},e[19]=Q):Q=e[19];let K;e[20]===Symbol.for("react.memo_cache_sentinel")?(K={flex:1,margin:0,padding:0},e[20]=K):K=e[20];let Z;e[21]!==U?(Z=D.jsx(Nt,{size:"md",weight:700,sx:K,children:U}),e[21]=U,e[22]=Z):Z=e[22];let ie;e[23]===Symbol.for("react.memo_cache_sentinel")?(ie={alignItems:"center",margin:4},e[23]=ie):ie=e[23];let ae;e[24]===Symbol.for("react.memo_cache_sentinel")?(ae=D.jsx(th,{size:18}),e[24]=ae):ae=e[24];let ne;e[25]!==T?(ne=D.jsx(Xt,{size:"sm",variant:"light",onClick:T,title:"Import links","aria-label":"Import links",children:ae}),e[25]=T,e[26]=ne):ne=e[26];const he=d?"Disable skip voting":"Enable skip voting";let fe;e[27]!==d?(fe=d?D.jsx(xh,{size:18}):D.jsx(wh,{size:18}),e[27]=d,e[28]=fe):fe=e[28];let X;e[29]!==E||e[30]!==he||e[31]!==fe?(X=D.jsx(Xt,{size:"sm",variant:"light",onClick:E,title:he,"aria-label":"Toggle skip voting",children:fe}),e[29]=E,e[30]=he,e[31]=fe,e[32]=X):X=e[32];const ye=o?"Disable submitter colors":"Enable submitter colors";let ge;e[33]!==o?(ge=o?D.jsx(dh,{size:18}):D.jsx(oh,{size:18}),e[33]=o,e[34]=ge):ge=e[34];let re;e[35]!==O||e[36]!==ye||e[37]!==ge?(re=D.jsx(Xt,{size:"sm",variant:"light",onClick:O,title:ye,"aria-label":"Toggle submitter colors",children:ge}),e[35]=O,e[36]=ye,e[37]=ge,e[38]=re):re=e[38];const Se=a?"Hide top submitters":"Show top submitters";let Oe;e[39]!==a?(Oe=a?D.jsx(Zc,{size:18}):D.jsx(Kc,{size:18}),e[39]=a,e[40]=Oe):Oe=e[40];let ue;e[41]!==k||e[42]!==Se||e[43]!==Oe?(ue=D.jsx(Xt,{size:"sm",variant:"light",onClick:k,title:Se,children:Oe}),e[41]=k,e[42]=Se,e[43]=Oe,e[44]=ue):ue=e[44];let oe;e[45]!==ne||e[46]!==X||e[47]!==re||e[48]!==ue?(oe=D.jsxs(At,{spacing:6,align:"center",sx:ie,children:[ne,X,re,ue]}),e[45]=ne,e[46]=X,e[47]=re,e[48]=ue,e[49]=oe):oe=e[49];let we;e[50]!==Z||e[51]!==oe?(we=D.jsxs(At,{position:"apart",align:"center",sx:Q,mt:0,children:[Z,oe]}),e[50]=Z,e[51]=oe,e[52]=we):we=e[52];let Ce;e[53]!==a?(Ce=a&&D.jsx(zf,{count:3}),e[53]=a,e[54]=Ce):Ce=e[54];let te;return e[55]!==t||e[56]!==F||e[57]!==we||e[58]!==Ce?(te=D.jsxs(Ft,{spacing:0,className:t,children:[F,we,Ce]}),e[55]=t,e[56]=F,e[57]=we,e[58]=Ce,e[59]=te):te=e[59],te};function Xf(n){const e=ke.c(35),{visible:t,onCancel:i}=n,r=se(hc),a=se(Xr),o=t&&!!a,[d,m]=le.useState(0),h=le.useRef(null),g=qi(),y=g.colors.blue?.[4],S=g.colorScheme==="light"?g.white:void 0,x=se(fc);let _;if(e[0]!==x||e[1]!==a){let F;e[3]!==a?(F=Q=>Q.id===a,e[3]=a,e[4]=F):F=e[4],_=x.find(F),e[0]=x,e[1]=a,e[2]=_}else _=e[2];const T=_;let v,E;if(e[5]!==r||e[6]!==o?(v=()=>{if(!o){m(0),h.current&&(cancelAnimationFrame(h.current),h.current=null);return}if(!r||r<=0){m(100);return}const F=performance.now(),Q=K=>{const Z=K-F,ie=Math.min(100,Z/r*100);m(ie),ie<100?h.current=requestAnimationFrame(Q):h.current=null};return h.current=requestAnimationFrame(Q),()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null)}},E=[o,r],e[5]=r,e[6]=o,e[7]=v,e[8]=E):(v=e[7],E=e[8]),le.useEffect(v,E),!o)return null;const P=!o;let O;e[9]!==y||e[10]!==d?(O=[{value:d,color:y}],e[9]=y,e[10]=d,e[11]=O):O=e[11];let A;e[12]!==i||e[13]!==S?(A=i&&D.jsx(la,{children:D.jsx(Bt,{compact:!0,size:"md",variant:"subtle",color:"dark",onClick:i,sx:{color:S},children:"Cancel"})}),e[12]=i,e[13]=S,e[14]=A):A=e[14];let k;e[15]!==O||e[16]!==A?(k=D.jsx(la,{children:D.jsx(Pc,{size:120,thickness:14,sections:O,label:A})}),e[15]=O,e[16]=A,e[17]=k):k=e[17];let U;e[18]!==S?(U=D.jsx(Nt,{size:"lg",weight:700,align:"center",sx:{color:S},children:"Next up"}),e[18]=S,e[19]=U):U=e[19];let L;e[20]!==S?(L={maxWidth:420,width:"100%",color:S},e[20]=S,e[21]=L):L=e[21];const M=T?.Platform||void 0;let B;e[22]!==a||e[23]!==M?(B=D.jsx(Eo,{platform:M,clipId:a}),e[22]=a,e[23]=M,e[24]=B):B=e[24];let $;e[25]!==B||e[26]!==L?($=D.jsx(it,{sx:L,children:B}),e[25]=B,e[26]=L,e[27]=$):$=e[27];let q;e[28]!==$||e[29]!==k||e[30]!==U?(q=D.jsxs(Ft,{spacing:"sm",align:"center",children:[k,U,$]}),e[28]=$,e[29]=k,e[30]=U,e[31]=q):q=e[31];let V;return e[32]!==q||e[33]!==P?(V=D.jsx(it,{sx:Kf,"aria-hidden":P,children:q}),e[32]=q,e[33]=P,e[34]=V):V=e[34],V}function Kf(){return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0,0,0,0.6)",zIndex:2,padding:24,pointerEvents:"auto"}}/*! @name @videojs/http-streaming @version 3.17.2 @license Apache-2.0 */const Xe=Ac,Bn=(n,e)=>e&&e.responseURL&&n!==e.responseURL?e.responseURL:n,nt=n=>H.log.debug?H.log.debug.bind(H,"VHS:",`${n} >`):function(){};function de(...n){const e=H.obj||H;return(e.merge||e.mergeOptions).apply(e,n)}function Re(...n){const e=H.time||H;return(e.createTimeRanges||e.createTimeRanges).apply(e,n)}function Jf(n){if(n.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<n.length;t++){const i=n.start(t),r=n.end(t);e+=`${i} --> ${r}. Duration (${r-i})
`}return e}const mt=1/30,pt=mt*3,Mo=function(n,e){const t=[];let i;if(n&&n.length)for(i=0;i<n.length;i++)e(n.start(i),n.end(i))&&t.push([n.start(i),n.end(i)]);return Re(t)},ri=function(n,e){return Mo(n,function(t,i){return t-pt<=e&&i+pt>=e})},Tn=function(n,e){return Mo(n,function(t){return t-mt>=e})},Zf=function(n){if(n.length<2)return Re();const e=[];for(let t=1;t<n.length;t++){const i=n.end(t-1),r=n.start(t);e.push([i,r])}return Re(e)},em=function(n,e){let t=null,i=null,r=0;const a=[],o=[];if(!n||!n.length||!e||!e.length)return Re();let d=n.length;for(;d--;)a.push({time:n.start(d),type:"start"}),a.push({time:n.end(d),type:"end"});for(d=e.length;d--;)a.push({time:e.start(d),type:"start"}),a.push({time:e.end(d),type:"end"});for(a.sort(function(m,h){return m.time-h.time}),d=0;d<a.length;d++)a[d].type==="start"?(r++,r===2&&(t=a[d].time)):a[d].type==="end"&&(r--,r===1&&(i=a[d].time)),t!==null&&i!==null&&(o.push([t,i]),t=null,i=null);return Re(o)},Ro=n=>{const e=[];if(!n||!n.length)return"";for(let t=0;t<n.length;t++)e.push(n.start(t)+" => "+n.end(t));return e.join(", ")},tm=function(n,e,t=1){return((n.length?n.end(n.length-1):0)-e)/t},Jt=n=>{const e=[];for(let t=0;t<n.length;t++)e.push({start:n.start(t),end:n.end(t)});return e},im=function(n,e){if(n===e)return!1;if(!n&&e||!e&&n||n.length!==e.length)return!0;for(let t=0;t<n.length;t++)if(n.start(t)!==e.start(t)||n.end(t)!==e.end(t))return!0;return!1},pr=function(n){if(!(!n||!n.length||!n.end))return n.end(n.length-1)},rs=function(n,e){let t=0;if(!n||!n.length)return t;for(let i=0;i<n.length;i++){const r=n.start(i),a=n.end(i);if(!(e>a)){if(e>r&&e<=a){t+=a-e;continue}t+=a-r}}return t},ss=(n,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(i){t+=i.duration}),(e.preloadHints||[]).forEach(function(i){i.type==="PART"&&(t+=n.partTargetDuration)}),t},Ur=n=>(n.segments||[]).reduce((e,t,i)=>(t.parts?t.parts.forEach(function(r,a){e.push({duration:r.duration,segmentIndex:i,partIndex:a,part:r,segment:t})}):e.push({duration:t.duration,segmentIndex:i,partIndex:null,segment:t,part:null}),e),[]),ko=n=>{const e=n.segments&&n.segments.length&&n.segments[n.segments.length-1];return e&&e.parts||[]},Uo=({preloadSegment:n})=>{if(!n)return;const{parts:e,preloadHints:t}=n;let i=(t||[]).reduce((r,a)=>r+(a.type==="PART"?1:0),0);return i+=e&&e.length?e.length:0,i},Bo=(n,e)=>{if(e.endList)return 0;if(n&&n.suggestedPresentationDelay)return n.suggestedPresentationDelay;const t=ko(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},nm=function(n,e){let t=0,i=e-n.mediaSequence,r=n.segments[i];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;i--;){if(r=n.segments[i],typeof r.end<"u")return{result:t+r.end,precise:!0};if(t+=ss(n,r),typeof r.start<"u")return{result:t+r.start,precise:!0}}return{result:t,precise:!1}},rm=function(n,e){let t=0,i,r=e-n.mediaSequence;for(;r<n.segments.length;r++){if(i=n.segments[r],typeof i.start<"u")return{result:i.start-t,precise:!0};if(t+=ss(n,i),typeof i.end<"u")return{result:i.end-t,precise:!0}}return{result:-1,precise:!1}},No=function(n,e,t){if(typeof e>"u"&&(e=n.mediaSequence+n.segments.length),e<n.mediaSequence)return 0;const i=nm(n,e);if(i.precise)return i.result;const r=rm(n,e);return r.precise?r.result:i.result+t},Fo=function(n,e,t){if(!n)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(n.totalDuration)return n.totalDuration;if(!n.endList)return W.Infinity}return No(n,e,t)},Ni=function({defaultDuration:n,durationList:e,startIndex:t,endIndex:i}){let r=0;if(t>i&&([t,i]=[i,t]),t<0){for(let a=t;a<Math.min(0,i);a++)r+=n;t=0}for(let a=t;a<i;a++)r+=e[a].duration;return r},$o=function(n,e,t,i){if(!n||!n.segments)return null;if(n.endList)return Fo(n);if(e===null)return null;e=e||0;let r=No(n,n.mediaSequence+n.segments.length,e);return t&&(i=typeof i=="number"?i:Bo(null,n),r-=i),Math.max(0,r)},sm=function(n,e,t){const r=e||0;let a=$o(n,e,!0,t);return a===null?Re():(a<r&&(a=r),Re(r,a))},am=function({playlist:n,currentTime:e,startingSegmentIndex:t,startingPartIndex:i,startTime:r,exactManifestTimings:a}){let o=e-r;const d=Ur(n);let m=0;for(let h=0;h<d.length;h++){const g=d[h];if(t===g.segmentIndex&&!(typeof i=="number"&&typeof g.partIndex=="number"&&i!==g.partIndex)){m=h;break}}if(o<0){if(m>0)for(let h=m-1;h>=0;h--){const g=d[h];if(o+=g.duration,a){if(o<0)continue}else if(o+mt<=0)continue;return{partIndex:g.partIndex,segmentIndex:g.segmentIndex,startTime:r-Ni({defaultDuration:n.targetDuration,durationList:d,startIndex:m,endIndex:h})}}return{partIndex:d[0]&&d[0].partIndex||null,segmentIndex:d[0]&&d[0].segmentIndex||0,startTime:e}}if(m<0){for(let h=m;h<0;h++)if(o-=n.targetDuration,o<0)return{partIndex:d[0]&&d[0].partIndex||null,segmentIndex:d[0]&&d[0].segmentIndex||0,startTime:e};m=0}for(let h=m;h<d.length;h++){const g=d[h];o-=g.duration;const y=g.duration>mt,S=o===0,x=y&&o+mt>=0;if(!((S||x)&&h!==d.length-1)){if(a){if(o>0)continue}else if(o-mt>=0)continue;return{partIndex:g.partIndex,segmentIndex:g.segmentIndex,startTime:r+Ni({defaultDuration:n.targetDuration,durationList:d,startIndex:m,endIndex:h})}}}return{segmentIndex:d[d.length-1].segmentIndex,partIndex:d[d.length-1].partIndex,startTime:e}},jo=function(n){return n.excludeUntil&&n.excludeUntil>Date.now()},as=function(n){return n.excludeUntil&&n.excludeUntil===1/0},Wn=function(n){const e=jo(n);return!n.disabled&&!e},om=function(n){return n.disabled},lm=function(n){for(let e=0;e<n.segments.length;e++)if(n.segments[e].key)return!0;return!1},qo=function(n,e){return e.attributes&&e.attributes[n]},dm=function(n,e,t,i=0){return qo("BANDWIDTH",t)?(n*t.attributes.BANDWIDTH-i*8)/e:NaN},Br=(n,e)=>{if(n.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return n.playlists.filter(i=>Wn(i)?(i.attributes.BANDWIDTH||0)<t:!1).length===0},os=(n,e)=>!n&&!e||!n&&e||n&&!e?!1:!!(n===e||n.id&&e.id&&n.id===e.id||n.resolvedUri&&e.resolvedUri&&n.resolvedUri===e.resolvedUri||n.uri&&e.uri&&n.uri===e.uri),fa=function(n,e){const t=n&&n.mediaGroups&&n.mediaGroups.AUDIO||{};let i=!1;for(const r in t){for(const a in t[r])if(i=e(t[r][a]),i)break;if(i)break}return!!i},Wi=n=>{if(!n||!n.playlists||!n.playlists.length)return fa(n,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<n.playlists.length;e++){const t=n.playlists[e],i=t.attributes&&t.attributes.CODECS;if(!(i&&i.split(",").every(a=>Lc(a))||fa(n,a=>os(t,a))))return!1}return!0};var Ke={liveEdgeDelay:Bo,duration:Fo,seekable:sm,getMediaInfoForTime:am,isEnabled:Wn,isDisabled:om,isExcluded:jo,isIncompatible:as,playlistEnd:$o,isAes:lm,hasAttribute:qo,estimateSegmentRequestTime:dm,isLowestEnabledRendition:Br,isAudioOnly:Wi,playlistMatch:os,segmentDurationWithParts:ss};const{log:Wo}=H,ai=(n,e)=>`${n}-${e}`,Vo=(n,e,t)=>`placeholder-uri-${n}-${e}-${t}`,um=({onwarn:n,oninfo:e,manifestString:t,customTagParsers:i=[],customTagMappers:r=[],llhls:a})=>{const o=new Bc;n&&o.on("warn",n),e&&o.on("info",e),i.forEach(h=>o.addParser(h)),r.forEach(h=>o.addTagMapper(h)),o.push(t),o.end();const d=o.manifest;if(a||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(h){d.hasOwnProperty(h)&&delete d[h]}),d.segments&&d.segments.forEach(function(h){["parts","preloadHints"].forEach(function(g){h.hasOwnProperty(g)&&delete h[g]})})),!d.targetDuration){let h=10;d.segments&&d.segments.length&&(h=d.segments.reduce((g,y)=>Math.max(g,y.duration),0)),n&&n({message:`manifest has no targetDuration defaulting to ${h}`}),d.targetDuration=h}const m=ko(d);if(m.length&&!d.partTargetDuration){const h=m.reduce((g,y)=>Math.max(g,y.duration),0);n&&(n({message:`manifest has no partTargetDuration defaulting to ${h}`}),Wo.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),d.partTargetDuration=h}return d},hi=(n,e)=>{n.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(n.mediaGroups[t])for(const i in n.mediaGroups[t])for(const r in n.mediaGroups[t][i]){const a=n.mediaGroups[t][i][r];e(a,t,i,r)}})},Ho=({playlist:n,uri:e,id:t})=>{n.id=t,n.playlistErrors_=0,e&&(n.uri=e),n.attributes=n.attributes||{}},cm=n=>{let e=n.playlists.length;for(;e--;){const t=n.playlists[e];Ho({playlist:t,id:ai(e,t.uri)}),t.resolvedUri=Xe(n.uri,t.uri),n.playlists[t.id]=t,n.playlists[t.uri]=t,t.attributes.BANDWIDTH||Wo.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},hm=n=>{hi(n,e=>{e.uri&&(e.resolvedUri=Xe(n.uri,e.uri))})},fm=(n,e)=>{const t=ai(0,e),i={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:W.location.href,resolvedUri:W.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return i.playlists[t]=i.playlists[0],i.playlists[e]=i.playlists[0],i},Go=(n,e,t=Vo)=>{n.uri=e;for(let r=0;r<n.playlists.length;r++)if(!n.playlists[r].uri){const a=`placeholder-uri-${r}`;n.playlists[r].uri=a}const i=Wi(n);hi(n,(r,a,o,d)=>{if(!r.playlists||!r.playlists.length){if(i&&a==="AUDIO"&&!r.uri)for(let m=0;m<n.playlists.length;m++){const h=n.playlists[m];if(h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===o)return}r.playlists=[ze({},r)]}r.playlists.forEach(function(m,h){const g=t(a,o,d,m),y=ai(h,g);m.uri?m.resolvedUri=m.resolvedUri||Xe(n.uri,m.uri):(m.uri=h===0?g:y,m.resolvedUri=m.uri),m.id=m.id||y,m.attributes=m.attributes||{},n.playlists[m.id]=m,n.playlists[m.uri]=m})}),cm(n),hm(n)};class ma{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,i=t.startDate.getTime();this.trimProcessedDateRanges_(i),this.pendingDateRanges_=e.reduce((r,a)=>(r.set(a.id,a),r),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((i,r)=>{if(!this.processedDateRanges_.has(r)&&(i.startTime=i.startDate.getTime()/1e3-this.offset_,i.processDateRange=()=>this.processDateRange(i),t.push(i),!!i.class))if(e[i.class]){const a=e[i.class].push(i);i.classListIndex=a-1}else e[i.class]=[i],i.classListIndex=0});for(const i of t){const r=e[i.class]||[];i.endDate?i.endTime=i.endDate.getTime()/1e3-this.offset_:i.endOnNext&&r[i.classListIndex+1]?i.endTime=r[i.classListIndex+1].startTime:i.duration?i.endTime=i.startTime+i.duration:i.plannedDuration?i.endTime=i.startTime+i.plannedDuration:i.endTime=i.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((i,r)=>{i.startDate.getTime()<e&&this.processedDateRanges_.delete(r)})}}const zo=22,Zt=({requestType:n,request:e,error:t,parseFailure:i})=>{const r=e.status<200||e.status>299,a=e.status>=400&&e.status<=499,o={uri:e.uri,requestType:n},d=r&&!a||i;if(t&&a)o.error=ze({},t),o.errorType=H.Error.NetworkRequestFailed;else if(e.aborted)o.errorType=H.Error.NetworkRequestAborted;else if(e.timedout)o.errorType=H.Error.NetworkRequestTimeout;else if(d){const m=i?H.Error.NetworkBodyParserFailed:H.Error.NetworkBadStatus;o.errorType=m,o.status=e.status,o.headers=e.headers}return o},mm=nt("CodecUtils"),Qo=function(n){const e=n.attributes||{};if(e.CODECS)return It(e.CODECS)},Yo=(n,e)=>{const t=e.attributes||{};return n&&n.mediaGroups&&n.mediaGroups.AUDIO&&t.AUDIO&&n.mediaGroups.AUDIO[t.AUDIO]},pm=(n,e)=>{if(!Yo(n,e))return!0;const t=e.attributes||{},i=n.mediaGroups.AUDIO[t.AUDIO];for(const r in i)if(!i[r].uri&&!i[r].playlists)return!0;return!1},ji=function(n){const e={};return n.forEach(({mediaType:t,type:i,details:r})=>{e[t]=e[t]||[],e[t].push(kc(`${i}${r}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){mm(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},pa=function(n){let e=0;return n.audio&&e++,n.video&&e++,e},Fi=function(n,e){const t=e.attributes||{},i=ji(Qo(e)||[]);if(Yo(n,e)&&!i.audio&&!pm(n,e)){const r=ji(Rc(n,t.AUDIO)||[]);r.audio&&(i.audio=r.audio)}return i},{EventTarget:gm}=H,ym=(n,e)=>{if(e.endList||!e.serverControl)return n;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:i}=e;let r=e.mediaSequence+e.segments.length;if(i){const a=i.parts||[],o=Uo(e)-1;o>-1&&o!==a.length-1&&(t._HLS_part=o),(o>-1||a.length)&&r--}t._HLS_msn=r}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const i=new W.URL(n);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(r){t.hasOwnProperty(r)&&i.searchParams.set(r,t[r])}),n=i.toString()}return n},_m=(n,e)=>{if(!n)return e;const t=de(n,e);if(n.preloadHints&&!e.preloadHints&&delete t.preloadHints,n.parts&&!e.parts)delete t.parts;else if(n.parts&&e.parts)for(let i=0;i<e.parts.length;i++)n.parts&&n.parts[i]&&(t.parts[i]=de(n.parts[i],e.parts[i]));return!n.skipped&&e.skipped&&(t.skipped=!1),n.preload&&!e.preload&&(t.preload=!1),t},vm=(n,e,t)=>{const i=n.slice(),r=e.slice();t=t||0;const a=[];let o;for(let d=0;d<r.length;d++){const m=i[d+t],h=r[d];m?(o=m.map||o,a.push(_m(m,h))):(o&&!h.map&&(h.map=o),a.push(h))}return a},Xo=(n,e)=>{!n.resolvedUri&&n.uri&&(n.resolvedUri=Xe(e,n.uri)),n.key&&!n.key.resolvedUri&&(n.key.resolvedUri=Xe(e,n.key.uri)),n.map&&!n.map.resolvedUri&&(n.map.resolvedUri=Xe(e,n.map.uri)),n.map&&n.map.key&&!n.map.key.resolvedUri&&(n.map.key.resolvedUri=Xe(e,n.map.key.uri)),n.parts&&n.parts.length&&n.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=Xe(e,t.uri))}),n.preloadHints&&n.preloadHints.length&&n.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=Xe(e,t.uri))})},Ko=function(n){const e=n.segments||[],t=n.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let i=0;i<t.preloadHints.length;i++)if(t.preloadHints[i].type==="MAP")return e}t.duration=n.targetDuration,t.preload=!0,e.push(t)}return e},Jo=(n,e)=>n===e||n.segments&&e.segments&&n.segments.length===e.segments.length&&n.endList===e.endList&&n.mediaSequence===e.mediaSequence&&n.preloadSegment===e.preloadSegment,Nr=(n,e,t=Jo)=>{const i=de(n,{}),r=i.playlists[e.id];if(!r||t(r,e))return null;e.segments=Ko(e);const a=de(r,e);if(a.preloadSegment&&!e.preloadSegment&&delete a.preloadSegment,r.segments){if(e.skip){e.segments=e.segments||[];for(let o=0;o<e.skip.skippedSegments;o++)e.segments.unshift({skipped:!0})}a.segments=vm(r.segments,e.segments,e.mediaSequence-r.mediaSequence)}a.segments.forEach(o=>{Xo(o,a.resolvedUri)});for(let o=0;o<i.playlists.length;o++)i.playlists[o].id===e.id&&(i.playlists[o]=a);return i.playlists[e.id]=a,i.playlists[e.uri]=a,hi(n,(o,d,m,h)=>{if(o.playlists)for(let g=0;g<o.playlists.length;g++)e.id===o.playlists[g].id&&(o.playlists[g]=a)}),i},Fr=(n,e)=>{const t=n.segments||[],i=t[t.length-1],r=i&&i.parts&&i.parts[i.parts.length-1],a=r&&r.duration||i&&i.duration;return e&&a?a*1e3:(n.partTargetDuration||n.targetDuration||10)*500},ga=(n,e,t)=>{if(!n)return;const i=[];return n.forEach(r=>{if(!r.attributes)return;const{BANDWIDTH:a,RESOLUTION:o,CODECS:d}=r.attributes;i.push({id:r.id,bandwidth:a,resolution:o,codecs:d})}),{type:e,isLive:t,renditions:i}};class si extends gm{constructor(e,t,i={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=nt("PlaylistLoader");const{withCredentials:r=!1}=i;this.src=e,this.vhs_=t,this.withCredentials=r,this.addDateRangesToTextTrack_=i.addDateRangesToTextTrack;const a=t.options_;this.customTagParsers=a&&a.customTagParsers||[],this.customTagMappers=a&&a.customTagMappers||[],this.llhls=a&&a.llhls,this.dateRangesStorage_=new ma,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=Xe(this.main.uri,e.uri);this.llhls&&(t=ym(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(i,r)=>{if(this.request){if(i)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,i){const{uri:r,id:a}=t;this.request=null,i&&(this.state=i),this.error={playlist:this.main.playlists[a],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:Zt({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const i=um({onwarn:({message:r})=>this.logger_(`m3u8-parser warn for ${e}: ${r}`),oninfo:({message:r})=>this.logger_(`m3u8-parser info for ${e}: ${r}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return!i.playlists||!i.playlists.length||this.excludeAudioOnlyVariants(i.playlists),i}catch(i){this.error=i,this.error.metadata={errorType:H.Error.StreamingHlsPlaylistParserError,error:i}}}excludeAudioOnlyVariants(e){const t=i=>{const r=i.attributes||{},{width:a,height:o}=r.RESOLUTION||{};if(a&&o)return!0;const d=Qo(i)||[];return!!ji(d).video};e.some(t)&&e.forEach(i=>{t(i)||(i.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:i,id:r}){this.request=null,this.state="HAVE_METADATA";const a={playlistInfo:{type:"media",uri:i}};this.trigger({type:"playlistparsestart",metadata:a});const o=t||this.parseManifest_({url:i,manifestString:e});o.lastRequest=Date.now(),Ho({playlist:o,uri:i,id:r});const d=Nr(this.main,o);this.targetDuration=o.partTargetDuration||o.targetDuration,this.pendingMedia_=null,d?(this.main=d,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(Fr(this.media(),!!d)),a.parsedPlaylist=ga(this.main.playlists,a.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:a}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),W.clearTimeout(this.mediaUpdateTimeout),W.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new ma,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(W.clearTimeout(this.finalRenditionTimeout),t){const d=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=W.setTimeout(this.media.bind(this,e,!1),d);return}const i=this.state,r=!this.media_||e.id!==this.media_.id,a=this.main.playlists[e.id];if(a&&a.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),i==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(Fr(e,!0)),!r)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const o={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:o}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(d,m)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=Bn(e.resolvedUri,m),d)return this.playlistRequestError(this.request,e,i);this.trigger({type:"playlistrequestcomplete",metadata:o}),this.haveMetadata({playlistString:m.responseText,url:e.uri,id:e.id}),i==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const i=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=W.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},i);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=W.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=W.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,i)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:i.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:i.responseText,code:2,metadata:Zt({requestType:i.requestType,request:i,error:t})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=Bn(this.src,i),this.trigger({type:"playlistparsestart",metadata:e});const r=this.parseManifest_({manifestString:i.responseText,url:this.src});e.parsedPlaylist=ga(r.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(r)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,Go(this.main,this.srcUri()),e.playlists.forEach(i=>{i.segments=Ko(i),i.segments.forEach(r=>{Xo(r,i.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||W.location.href;this.main=fm(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const i=this.main,r=e.ID;let a=i.playlists.length;for(;a--;){const o=i.playlists[a];if(o.attributes["PATHWAY-ID"]===r){const d=o.resolvedUri,m=o.id;if(t){const h=this.createCloneURI_(o.resolvedUri,e),g=ai(r,h),y=this.createCloneAttributes_(r,o.attributes),S=this.createClonePlaylist_(o,g,e,y);i.playlists[a]=S,i.playlists[g]=S,i.playlists[h]=S}else i.playlists.splice(a,1);delete i.playlists[m],delete i.playlists[d]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const i=this.main,r=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(a=>{if(!(!i.mediaGroups[a]||!i.mediaGroups[a][r])){for(const o in i.mediaGroups[a])if(o===r){for(const d in i.mediaGroups[a][o])i.mediaGroups[a][o][d].playlists.forEach((h,g)=>{const y=i.playlists[h.id],S=y.id,x=y.resolvedUri;delete i.playlists[S],delete i.playlists[x]});delete i.mediaGroups[a][o]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const i=this.main,r=i.playlists.length,a=this.createCloneURI_(t.resolvedUri,e),o=ai(e.ID,a),d=this.createCloneAttributes_(e.ID,t.attributes),m=this.createClonePlaylist_(t,o,e,d);i.playlists[r]=m,i.playlists[o]=m,i.playlists[a]=m,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,i=e["BASE-ID"],r=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(a=>{if(!(!r.mediaGroups[a]||r.mediaGroups[a][t]))for(const o in r.mediaGroups[a]){if(o===i)r.mediaGroups[a][t]={};else continue;for(const d in r.mediaGroups[a][o]){const m=r.mediaGroups[a][o][d];r.mediaGroups[a][t][d]=ze({},m);const h=r.mediaGroups[a][t][d],g=this.createCloneURI_(m.resolvedUri,e);h.resolvedUri=g,h.uri=g,h.playlists=[],m.playlists.forEach((y,S)=>{const x=r.playlists[y.id],_=Vo(a,t,d),T=ai(t,_);if(x&&!r.playlists[T]){const v=this.createClonePlaylist_(x,T,e),E=v.resolvedUri;r.playlists[T]=v,r.playlists[E]=v}h.playlists[S]=this.createClonePlaylist_(y,T,e)})}}})}createClonePlaylist_(e,t,i,r){const a=this.createCloneURI_(e.resolvedUri,i),o={resolvedUri:a,uri:a,id:t};return e.segments&&(o.segments=[]),r&&(o.attributes=r),de(e,o)}createCloneURI_(e,t){const i=new URL(e);i.hostname=t["URI-REPLACEMENT"].HOST;const r=t["URI-REPLACEMENT"].PARAMS;for(const a of Object.keys(r))i.searchParams.set(a,r[a]);return i.href}createCloneAttributes_(e,t){const i={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{t[r]&&(i[r]=e)}),i}getKeyIdSet(e){const t=new Set;if(!e||!e.contentProtection)return t;for(const i in e.contentProtection)if(e.contentProtection[i]&&e.contentProtection[i].attributes&&e.contentProtection[i].attributes.keyId){const r=e.contentProtection[i].attributes.keyId;t.add(r.toLowerCase())}return t}}const $r=function(n,e,t,i){const r=n.responseType==="arraybuffer"?n.response:n.responseText;!e&&r&&(n.responseTime=Date.now(),n.roundTripTime=n.responseTime-n.requestTime,n.bytesReceived=r.byteLength||r.length,n.bandwidth||(n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3))),t.headers&&(n.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(n.timedout=!0),!e&&!n.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(n&&(r||n.responseText)))),i(e,n)},bm=(n,e)=>{if(!n||!n.size)return;let t=e;return n.forEach(i=>{t=i(t)}),t},Tm=(n,e,t,i)=>{!n||!n.size||n.forEach(r=>{r(e,t,i)})},Zo=function(){const n=function e(t,i){t=de({timeout:45e3},t);const r=e.beforeRequest||H.Vhs.xhr.beforeRequest,a=e._requestCallbackSet||H.Vhs.xhr._requestCallbackSet||new Set,o=e._responseCallbackSet||H.Vhs.xhr._responseCallbackSet;r&&typeof r=="function"&&(H.log.warn("beforeRequest is deprecated, use onRequest instead."),a.add(r));const d=H.Vhs.xhr.original===!0?H.xhr:H.Vhs.xhr,m=bm(a,t);a.delete(r);const h=d(m||t,function(y,S){return Tm(o,h,y,S),$r(h,y,S,i)}),g=h.abort;return h.abort=function(){return h.aborted=!0,g.apply(h,arguments)},h.uri=t.uri,h.requestType=t.requestType,h.requestTime=Date.now(),h};return n.original=!0,n},Sm=function(n){let e;const t=n.offset;return typeof n.offset=="bigint"||typeof n.length=="bigint"?e=W.BigInt(n.offset)+W.BigInt(n.length)-W.BigInt(1):e=n.offset+n.length-1,"bytes="+t+"-"+e},jr=function(n){const e={};return n.byterange&&(e.Range=Sm(n.byterange)),e},wm=function(n,e){return n.start(e)+"-"+n.end(e)},Em=function(n,e){const t=n.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},xm=function(n){return n>=32&&n<126?String.fromCharCode(n):"."},el=function(n){const e={};return Object.keys(n).forEach(t=>{const i=n[t];Nc(i)?e[t]={bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:e[t]=i}),e},Nn=function(n){const e=n.byterange||{length:1/0,offset:0};return[e.length,e.offset,n.resolvedUri].join(",")},tl=function(n){return n.resolvedUri},il=n=>{const e=Array.prototype.slice.call(n),t=16;let i="",r,a;for(let o=0;o<e.length/t;o++)r=e.slice(o*t,o*t+t).map(Em).join(""),a=e.slice(o*t,o*t+t).map(xm).join(""),i+=r+" "+a+`
`;return i},Pm=({bytes:n})=>il(n),Cm=n=>{let e="",t;for(t=0;t<n.length;t++)e+=wm(n,t)+" ";return e};var Im=Object.freeze({__proto__:null,createTransferableMessage:el,initSegmentId:Nn,segmentKeyId:tl,hexDump:il,tagDump:Pm,textRanges:Cm});const nl=.25,Dm=(n,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,r=e.videoTimingInfo.transmuxedPresentationStart+t,a=n-r;return new Date(e.dateTimeObject.getTime()+a*1e3)},Am=n=>n.transmuxedPresentationEnd-n.transmuxedPresentationStart-n.transmuxerPrependedSeconds,Om=(n,e)=>{let t;try{t=new Date(n)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let i=e.segments[0];if(t<new Date(i.dateTimeObject))return null;for(let m=0;m<e.segments.length-1;m++){i=e.segments[m];const h=new Date(e.segments[m+1].dateTimeObject);if(t<h)break}const r=e.segments[e.segments.length-1],a=r.dateTimeObject,o=r.videoTimingInfo?Am(r.videoTimingInfo):r.duration+r.duration*nl,d=new Date(a.getTime()+o*1e3);return t>d?null:(t>new Date(a)&&(i=r),{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:Ke.duration(e,e.mediaSequence+e.segments.indexOf(i)),type:i.videoTimingInfo?"accurate":"estimate"})},Lm=(n,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,i;for(let a=0;a<e.segments.length&&(i=e.segments[a],t=i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:t+i.duration,!(n<=t));a++);const r=e.segments[e.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<n)return null;if(n>t){if(n>t+r.duration*nl)return null;i=r}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:t-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}},Mm=(n,e)=>{let t,i;try{t=new Date(n),i=new Date(e)}catch{}const r=t.getTime();return(i.getTime()-r)/1e3},Rm=n=>{if(!n.segments||n.segments.length===0)return!1;for(let e=0;e<n.segments.length;e++)if(!n.segments[e].dateTimeObject)return!1;return!0},km=({playlist:n,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!n||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const i=Lm(e,n);if(!i)return t({message:"valid programTime was not found"});if(i.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:i.estimatedStart});const r={mediaSeconds:e},a=Dm(e,i.segment);return a&&(r.programDateTime=a.toISOString()),t(null,r)},rl=({programTime:n,playlist:e,retryCount:t=2,seekTo:i,pauseAfterSeek:r=!0,tech:a,callback:o})=>{if(!o)throw new Error("seekToProgramTime: callback must be provided");if(typeof n>"u"||!e||!i)return o({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!a.hasStarted_)return o({message:"player must be playing a live stream to start buffering"});if(!Rm(e))return o({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const d=Om(n,e);if(!d)return o({message:`${n} was not found in the stream`});const m=d.segment,h=Mm(m.dateTimeObject,n);if(d.type==="estimate"){if(t===0)return o({message:`${n} is not buffered yet. Try again`});i(d.estimatedStart+h),a.one("seeked",()=>{rl({programTime:n,playlist:e,retryCount:t-1,seekTo:i,pauseAfterSeek:r,tech:a,callback:o})});return}const g=m.start+h,y=()=>o(null,a.currentTime());a.one("seeked",y),r&&a.pause(),i(g)},gr=(n,e)=>{if(n.readyState===4)return e()},Um=(n,e,t,i)=>{let r=[],a,o=!1;const d=function(y,S,x,_){return S.abort(),o=!0,t(y,S,x,_)},m=function(y,S){if(o)return;if(y)return y.metadata=Zt({requestType:i,request:S,error:y}),d(y,S,"",r);const x=S.responseText.substring(r&&r.byteLength||0,S.responseText.length);if(r=Fc(r,$c(x,!0)),a=a||jc(r),r.length<10||a&&r.length<a+2)return gr(S,()=>d(y,S,"",r));const _=ts(r);return _==="ts"&&r.length<188?gr(S,()=>d(y,S,"",r)):!_&&r.length<376?gr(S,()=>d(y,S,"",r)):d(null,S,_,r)},g=e({uri:n,beforeSend(y){y.overrideMimeType("text/plain; charset=x-user-defined"),y.addEventListener("progress",function({total:S,loaded:x}){return $r(y,null,{statusCode:y.status},m)})}},function(y,S){return $r(g,y,S,m)});return g},{EventTarget:Bm}=H,ya=function(n,e){if(!Jo(n,e)||n.sidx&&e.sidx&&(n.sidx.offset!==e.sidx.offset||n.sidx.length!==e.sidx.length))return!1;if(!n.sidx&&e.sidx||n.sidx&&!e.sidx||n.segments&&!e.segments||!n.segments&&e.segments)return!1;if(!n.segments&&!e.segments)return!0;for(let t=0;t<n.segments.length;t++){const i=n.segments[t],r=e.segments[t];if(i.uri!==r.uri)return!1;if(!i.byterange&&!r.byterange)continue;const a=i.byterange,o=r.byterange;if(a&&!o||!a&&o||a.offset!==o.offset||a.length!==o.length)return!1}return!0},Nm=(n,e,t,i)=>{const r=i.attributes.NAME||t;return`placeholder-uri-${n}-${e}-${r}`},Fm=({mainXml:n,srcUrl:e,clientOffset:t,sidxMapping:i,previousManifest:r})=>{const a=Uc(n,{manifestUri:e,clientOffset:t,sidxMapping:i,previousManifest:r});return Go(a,e,Nm),a},$m=(n,e)=>{hi(n,(t,i,r,a)=>{(!e.mediaGroups[i][r]||!(a in e.mediaGroups[i][r]))&&delete n.mediaGroups[i][r][a]})},jm=(n,e,t)=>{let i=!0,r=de(n,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let a=0;a<e.playlists.length;a++){const o=e.playlists[a];if(o.sidx){const m=es(o.sidx);t&&t[m]&&t[m].sidx&&Po(o,t[m].sidx,o.sidx.resolvedUri)}const d=Nr(r,o,ya);d&&(r=d,i=!1)}return hi(e,(a,o,d,m)=>{if(a.playlists&&a.playlists.length){const h=a.playlists[0].id,g=Nr(r,a.playlists[0],ya);g&&(r=g,m in r.mediaGroups[o][d]||(r.mediaGroups[o][d][m]=a),r.mediaGroups[o][d][m].playlists[0]=r.playlists[h],i=!1)}}),$m(r,e),e.minimumUpdatePeriod!==n.minimumUpdatePeriod&&(i=!1),i?null:r},qm=(n,e)=>(!n.map&&!e.map||!!(n.map&&e.map&&n.map.byterange.offset===e.map.byterange.offset&&n.map.byterange.length===e.map.byterange.length))&&n.uri===e.uri&&n.byterange.offset===e.byterange.offset&&n.byterange.length===e.byterange.length,_a=(n,e)=>{const t={};for(const i in n){const a=n[i].sidx;if(a){const o=es(a);if(!e[o])break;const d=e[o].sidxInfo;qm(d,a)&&(t[o]=e[o])}}return t},Wm=(n,e)=>{let i=_a(n.playlists,e);return hi(n,(r,a,o,d)=>{if(r.playlists&&r.playlists.length){const m=r.playlists;i=de(i,_a(m,e))}}),i};class qr extends Bm{constructor(e,t,i={},r){super(),this.isPaused_=!0,this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:a=!1}=i;if(this.vhs_=t,this.withCredentials=a,this.addMetadataToTextTrack=i.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=nt("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,i){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},i&&(this.state=i),this.trigger("error"),!0}addSidxSegments_(e,t,i){const r=e.sidx&&es(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r]){W.clearTimeout(this.mediaRequest_),this.mediaRequest_=W.setTimeout(()=>i(!1),0);return}const a=Bn(e.sidx.resolvedUri),o=(m,h)=>{if(this.requestErrored_(m,h,t))return;const g=this.mainPlaylistLoader_.sidxMapping_,{requestType:y}=h;let S;try{S=Wc(Vc(h.response).subarray(8))}catch(x){x.metadata=Zt({requestType:y,request:h,parseFailure:!0}),this.requestErrored_(x,h,t);return}return g[r]={sidxInfo:e.sidx,sidx:S},Po(e,S,e.sidx.resolvedUri),i(!0)},d="dash-sidx";this.request=Um(a,this.vhs_.xhr,(m,h,g,y)=>{if(m)return o(m,h);if(!g||g!=="mp4"){const _=g||"unknown";return o({status:h.status,message:`Unsupported ${_} container type for sidx segment at URL: ${a}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},h)}const{offset:S,length:x}=e.sidx.byterange;if(y.length>=x+S)return o(m,{response:y.subarray(S,S+x),status:h.status,uri:h.uri});this.request=this.vhs_.xhr({uri:a,responseType:"arraybuffer",requestType:"dash-sidx",headers:jr({byterange:e.sidx.byterange})},o)},d)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},W.clearTimeout(this.minimumUpdatePeriodTimeout_),W.clearTimeout(this.mediaRequest_),W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const i=!this.media_||e.id!==this.media_.id;if(i&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,i&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}i&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,r=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,W.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(W.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){this.isPaused_=!1,W.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const i=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=W.setTimeout(()=>this.load(),i);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){W.clearTimeout(this.mediaRequest_),this.mediaRequest_=W.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(i,r)=>{if(i){const{requestType:o}=r;i.metadata=Zt({requestType:o,request:r,error:i})}if(this.requestErrored_(i,r)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:t});const a=r.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=r.responseText,r.responseHeaders&&r.responseHeaders.date?this.mainLoaded_=Date.parse(r.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=Bn(this.mainPlaylistLoader_.srcUrl,r),a){this.handleMain_(),this.syncClientServerClock_(()=>e(r,a));return}return e(r,a)})}syncClientServerClock_(e){const t=Mc(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:Xe(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(i,r)=>{if(!this.request)return;if(i){const{requestType:o}=r;return this.error.metadata=Zt({requestType:o,request:r,error:i}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let a;t.method==="HEAD"?!r.responseHeaders||!r.responseHeaders.date?a=this.mainLoaded_:a=Date.parse(r.responseHeaders.date):a=Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=a-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){W.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:t});let i;try{i=Fm({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(a){this.error=a,this.error.metadata={errorType:H.Error.StreamingDashManifestParserError,error:a},this.trigger("error")}e&&(i=jm(e,i,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=i||e;const r=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(r&&r!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=r),(!e||i&&i.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(i),i){const{duration:a,endList:o}=i,d=[];i.playlists.forEach(h=>{d.push({id:h.id,bandwidth:h.attributes.BANDWIDTH,resolution:h.attributes.RESOLUTION,codecs:h.attributes.CODECS})});const m={duration:a,isLive:!o,renditions:d};t.parsedManifest=m,this.trigger({type:"manifestparsecomplete",metadata:t})}return!!i}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(W.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=W.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=Wm(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,i=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,i=!this.media_||this.media_!==t[e];if(i?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const r=()=>{this.media().endList||(this.mediaUpdateTimeout=W.setTimeout(()=>{this.trigger("mediaupdatetimeout"),r()},Fr(this.media(),!!i)))};r()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(i=>({cueTime:i.start,frames:[{data:i.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const i in e.contentProtection){const r=e.contentProtection[i].attributes["cenc:default_KID"];r&&t.add(r.replace(/-/g,"").toLowerCase())}return t}}}var Me={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const Vm=n=>{const e=new Uint8Array(new ArrayBuffer(n.length));for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e.buffer},sl=function(n){return n.on=n.addEventListener,n.off=n.removeEventListener,n},Hm=function(n){try{return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(n),URL.createObjectURL(t.getBlob())}},al=function(n){return function(){const e=Hm(n),t=sl(new Worker(e));t.objURL=e;const i=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),i.call(this)},t}},ol=function(n){return`var browserWorkerPolyFill = ${sl.toString()};
browserWorkerPolyFill(self);
`+n},ll=function(n){return n.toString().replace(/^function.+?{/,"").slice(0,-1)},Gm=ol(ll(function(){var n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=function(){this.init=function(){var s={};this.on=function(l,c){s[l]||(s[l]=[]),s[l]=s[l].concat(c)},this.off=function(l,c){var u;return s[l]?(u=s[l].indexOf(c),s[l]=s[l].slice(),s[l].splice(u,1),u>-1):!1},this.trigger=function(l){var c,u,f,p;if(c=s[l],!!c)if(arguments.length===2)for(f=c.length,u=0;u<f;++u)c[u].call(this,arguments[1]);else{for(p=[],u=arguments.length,u=1;u<arguments.length;++u)p.push(arguments[u]);for(f=c.length,u=0;u<f;++u)c[u].apply(this,p)}},this.dispose=function(){s={}}}};e.prototype.pipe=function(s){return this.on("data",function(l){s.push(l)}),this.on("done",function(l){s.flush(l)}),this.on("partialdone",function(l){s.partialFlush(l)}),this.on("endedtimeline",function(l){s.endTimeline(l)}),this.on("reset",function(l){s.reset(l)}),s},e.prototype.push=function(s){this.trigger("data",s)},e.prototype.flush=function(s){this.trigger("done",s)},e.prototype.partialFlush=function(s){this.trigger("partialdone",s)},e.prototype.endTimeline=function(s){this.trigger("endedtimeline",s)},e.prototype.reset=function(s){this.trigger("reset",s)};var t=e,i=Math.pow(2,32),r=function(s){var l=new DataView(s.buffer,s.byteOffset,s.byteLength),c;return l.getBigUint64?(c=l.getBigUint64(0),c<Number.MAX_SAFE_INTEGER?Number(c):c):l.getUint32(0)*i+l.getUint32(4)},a={getUint64:r,MAX_UINT32:i},o=a.MAX_UINT32,d,m,h,g,y,S,x,_,T,v,E,P,O,A,k,U,L,M,B,$,q,V,F,Q,K,Z,ie,ae,ne,he,fe,X,ye,ge,re,Se;(function(){var s;if(F={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(s in F)F.hasOwnProperty(s)&&(F[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);Q=new Uint8Array([105,115,111,109]),Z=new Uint8Array([97,118,99,49]),K=new Uint8Array([0,0,0,1]),ie=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ae=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ne={video:ie,audio:ae},X=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),fe=new Uint8Array([0,0,0,0,0,0,0,0]),ye=new Uint8Array([0,0,0,0,0,0,0,0]),ge=ye,re=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Se=ye,he=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),d=function(s){var l=[],c=0,u,f,p;for(u=1;u<arguments.length;u++)l.push(arguments[u]);for(u=l.length;u--;)c+=l[u].byteLength;for(f=new Uint8Array(c+8),p=new DataView(f.buffer,f.byteOffset,f.byteLength),p.setUint32(0,f.byteLength),f.set(s,4),u=0,c=8;u<l.length;u++)f.set(l[u],c),c+=l[u].byteLength;return f},m=function(){return d(F.dinf,d(F.dref,X))},h=function(s){return d(F.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,s.audioobjecttype<<3|s.samplingfrequencyindex>>>1,s.samplingfrequencyindex<<7|s.channelcount<<3,6,1,2]))},g=function(){return d(F.ftyp,Q,K,Q,Z)},U=function(s){return d(F.hdlr,ne[s])},y=function(s){return d(F.mdat,s)},k=function(s){var l=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,s.duration>>>24&255,s.duration>>>16&255,s.duration>>>8&255,s.duration&255,85,196,0,0]);return s.samplerate&&(l[12]=s.samplerate>>>24&255,l[13]=s.samplerate>>>16&255,l[14]=s.samplerate>>>8&255,l[15]=s.samplerate&255),d(F.mdhd,l)},A=function(s){return d(F.mdia,k(s),U(s.type),x(s))},S=function(s){return d(F.mfhd,new Uint8Array([0,0,0,0,(s&4278190080)>>24,(s&16711680)>>16,(s&65280)>>8,s&255]))},x=function(s){return d(F.minf,s.type==="video"?d(F.vmhd,he):d(F.smhd,fe),m(),M(s))},_=function(s,l){for(var c=[],u=l.length;u--;)c[u]=$(l[u]);return d.apply(null,[F.moof,S(s)].concat(c))},T=function(s){for(var l=s.length,c=[];l--;)c[l]=P(s[l]);return d.apply(null,[F.moov,E(4294967295)].concat(c).concat(v(s)))},v=function(s){for(var l=s.length,c=[];l--;)c[l]=q(s[l]);return d.apply(null,[F.mvex].concat(c))},E=function(s){var l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(s&4278190080)>>24,(s&16711680)>>16,(s&65280)>>8,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return d(F.mvhd,l)},L=function(s){var l=s.samples||[],c=new Uint8Array(4+l.length),u,f;for(f=0;f<l.length;f++)u=l[f].flags,c[f+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return d(F.sdtp,c)},M=function(s){return d(F.stbl,B(s),d(F.stts,Se),d(F.stsc,ge),d(F.stsz,re),d(F.stco,ye))},(function(){var s,l;B=function(c){return d(F.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),c.type==="video"?s(c):l(c))},s=function(c){var u=c.sps||[],f=c.pps||[],p=[],b=[],w,C;for(w=0;w<u.length;w++)p.push((u[w].byteLength&65280)>>>8),p.push(u[w].byteLength&255),p=p.concat(Array.prototype.slice.call(u[w]));for(w=0;w<f.length;w++)b.push((f[w].byteLength&65280)>>>8),b.push(f[w].byteLength&255),b=b.concat(Array.prototype.slice.call(f[w]));if(C=[F.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(c.width&65280)>>8,c.width&255,(c.height&65280)>>8,c.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d(F.avcC,new Uint8Array([1,c.profileIdc,c.profileCompatibility,c.levelIdc,255].concat([u.length],p,[f.length],b))),d(F.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],c.sarRatio){var I=c.sarRatio[0],R=c.sarRatio[1];C.push(d(F.pasp,new Uint8Array([(I&4278190080)>>24,(I&16711680)>>16,(I&65280)>>8,I&255,(R&4278190080)>>24,(R&16711680)>>16,(R&65280)>>8,R&255])))}return d.apply(null,C)},l=function(c){return d(F.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(c.channelcount&65280)>>8,c.channelcount&255,(c.samplesize&65280)>>8,c.samplesize&255,0,0,0,0,(c.samplerate&65280)>>8,c.samplerate&255,0,0]),h(c))}})(),O=function(s){var l=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(s.id&4278190080)>>24,(s.id&16711680)>>16,(s.id&65280)>>8,s.id&255,0,0,0,0,(s.duration&4278190080)>>24,(s.duration&16711680)>>16,(s.duration&65280)>>8,s.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(s.width&65280)>>8,s.width&255,0,0,(s.height&65280)>>8,s.height&255,0,0]);return d(F.tkhd,l)},$=function(s){var l,c,u,f,p,b,w;return l=d(F.tfhd,new Uint8Array([0,0,0,58,(s.id&4278190080)>>24,(s.id&16711680)>>16,(s.id&65280)>>8,s.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),b=Math.floor(s.baseMediaDecodeTime/o),w=Math.floor(s.baseMediaDecodeTime%o),c=d(F.tfdt,new Uint8Array([1,0,0,0,b>>>24&255,b>>>16&255,b>>>8&255,b&255,w>>>24&255,w>>>16&255,w>>>8&255,w&255])),p=92,s.type==="audio"?(u=V(s,p),d(F.traf,l,c,u)):(f=L(s),u=V(s,f.length+p),d(F.traf,l,c,u,f))},P=function(s){return s.duration=s.duration||4294967295,d(F.trak,O(s),A(s))},q=function(s){var l=new Uint8Array([0,0,0,0,(s.id&4278190080)>>24,(s.id&16711680)>>16,(s.id&65280)>>8,s.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return s.type!=="video"&&(l[l.length-1]=0),d(F.trex,l)},(function(){var s,l,c;c=function(u,f){var p=0,b=0,w=0,C=0;return u.length&&(u[0].duration!==void 0&&(p=1),u[0].size!==void 0&&(b=2),u[0].flags!==void 0&&(w=4),u[0].compositionTimeOffset!==void 0&&(C=8)),[0,0,p|b|w|C,1,(u.length&4278190080)>>>24,(u.length&16711680)>>>16,(u.length&65280)>>>8,u.length&255,(f&4278190080)>>>24,(f&16711680)>>>16,(f&65280)>>>8,f&255]},l=function(u,f){var p,b,w,C,I,R;for(C=u.samples||[],f+=20+16*C.length,w=c(C,f),b=new Uint8Array(w.length+C.length*16),b.set(w),p=w.length,R=0;R<C.length;R++)I=C[R],b[p++]=(I.duration&4278190080)>>>24,b[p++]=(I.duration&16711680)>>>16,b[p++]=(I.duration&65280)>>>8,b[p++]=I.duration&255,b[p++]=(I.size&4278190080)>>>24,b[p++]=(I.size&16711680)>>>16,b[p++]=(I.size&65280)>>>8,b[p++]=I.size&255,b[p++]=I.flags.isLeading<<2|I.flags.dependsOn,b[p++]=I.flags.isDependedOn<<6|I.flags.hasRedundancy<<4|I.flags.paddingValue<<1|I.flags.isNonSyncSample,b[p++]=I.flags.degradationPriority&61440,b[p++]=I.flags.degradationPriority&15,b[p++]=(I.compositionTimeOffset&4278190080)>>>24,b[p++]=(I.compositionTimeOffset&16711680)>>>16,b[p++]=(I.compositionTimeOffset&65280)>>>8,b[p++]=I.compositionTimeOffset&255;return d(F.trun,b)},s=function(u,f){var p,b,w,C,I,R;for(C=u.samples||[],f+=20+8*C.length,w=c(C,f),p=new Uint8Array(w.length+C.length*8),p.set(w),b=w.length,R=0;R<C.length;R++)I=C[R],p[b++]=(I.duration&4278190080)>>>24,p[b++]=(I.duration&16711680)>>>16,p[b++]=(I.duration&65280)>>>8,p[b++]=I.duration&255,p[b++]=(I.size&4278190080)>>>24,p[b++]=(I.size&16711680)>>>16,p[b++]=(I.size&65280)>>>8,p[b++]=I.size&255;return d(F.trun,p)},V=function(u,f){return u.type==="audio"?s(u,f):l(u,f)}})();var Oe={ftyp:g,mdat:y,moof:_,moov:T,initSegment:function(s){var l=g(),c=T(s),u;return u=new Uint8Array(l.byteLength+c.byteLength),u.set(l),u.set(c,l.byteLength),u}},ue=function(s){var l,c,u=[],f=[];for(f.byteLength=0,f.nalCount=0,f.duration=0,u.byteLength=0,l=0;l<s.length;l++)c=s[l],c.nalUnitType==="access_unit_delimiter_rbsp"?(u.length&&(u.duration=c.dts-u.dts,f.byteLength+=u.byteLength,f.nalCount+=u.length,f.duration+=u.duration,f.push(u)),u=[c],u.byteLength=c.data.byteLength,u.pts=c.pts,u.dts=c.dts):(c.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(u.keyFrame=!0),u.duration=c.dts-u.dts,u.byteLength+=c.data.byteLength,u.push(c));return f.length&&(!u.duration||u.duration<=0)&&(u.duration=f[f.length-1].duration),f.byteLength+=u.byteLength,f.nalCount+=u.length,f.duration+=u.duration,f.push(u),f},oe=function(s){var l,c,u=[],f=[];for(u.byteLength=0,u.nalCount=0,u.duration=0,u.pts=s[0].pts,u.dts=s[0].dts,f.byteLength=0,f.nalCount=0,f.duration=0,f.pts=s[0].pts,f.dts=s[0].dts,l=0;l<s.length;l++)c=s[l],c.keyFrame?(u.length&&(f.push(u),f.byteLength+=u.byteLength,f.nalCount+=u.nalCount,f.duration+=u.duration),u=[c],u.nalCount=c.length,u.byteLength=c.byteLength,u.pts=c.pts,u.dts=c.dts,u.duration=c.duration):(u.duration+=c.duration,u.nalCount+=c.length,u.byteLength+=c.byteLength,u.push(c));return f.length&&u.duration<=0&&(u.duration=f[f.length-1].duration),f.byteLength+=u.byteLength,f.nalCount+=u.nalCount,f.duration+=u.duration,f.push(u),f},we=function(s){var l;return!s[0][0].keyFrame&&s.length>1&&(l=s.shift(),s.byteLength-=l.byteLength,s.nalCount-=l.nalCount,s[0][0].dts=l.dts,s[0][0].pts=l.pts,s[0][0].duration+=l.duration),s},Ce=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},te=function(s,l){var c=Ce();return c.dataOffset=l,c.compositionTimeOffset=s.pts-s.dts,c.duration=s.duration,c.size=4*s.length,c.size+=s.byteLength,s.keyFrame&&(c.flags.dependsOn=2,c.flags.isNonSyncSample=0),c},Ue=function(s,l){var c,u,f,p,b,w=l||0,C=[];for(c=0;c<s.length;c++)for(p=s[c],u=0;u<p.length;u++)b=p[u],f=te(b,w),w+=f.size,C.push(f);return C},Be=function(s){var l,c,u,f,p,b,w=0,C=s.byteLength,I=s.nalCount,R=C+4*I,N=new Uint8Array(R),z=new DataView(N.buffer);for(l=0;l<s.length;l++)for(f=s[l],c=0;c<f.length;c++)for(p=f[c],u=0;u<p.length;u++)b=p[u],z.setUint32(w,b.data.byteLength),w+=4,N.set(b.data,w),w+=b.data.byteLength;return N},De=function(s,l){var c,u=l||0,f=[];return c=te(s,u),f.push(c),f},Ot=function(s){var l,c,u=0,f=s.byteLength,p=s.length,b=f+4*p,w=new Uint8Array(b),C=new DataView(w.buffer);for(l=0;l<s.length;l++)c=s[l],C.setUint32(u,c.data.byteLength),u+=4,w.set(c.data,u),u+=c.data.byteLength;return w},be={groupNalsIntoFrames:ue,groupFramesIntoGops:oe,extendFirstKeyFrame:we,generateSampleTable:Ue,concatenateNalData:Be,generateSampleTableForFrame:De,concatenateNalDataForFrame:Ot},me=[33,16,5,32,164,27],Ie=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ee=function(s){for(var l=[];s--;)l.push(0);return l},Hn=function(s){return Object.keys(s).reduce(function(l,c){return l[c]=new Uint8Array(s[c].reduce(function(u,f){return u.concat(f)},[])),l},{})},xe,Qe=function(){if(!xe){var s={96e3:[me,[227,64],ee(154),[56]],88200:[me,[231],ee(170),[56]],64e3:[me,[248,192],ee(240),[56]],48e3:[me,[255,192],ee(268),[55,148,128],ee(54),[112]],44100:[me,[255,192],ee(268),[55,163,128],ee(84),[112]],32e3:[me,[255,192],ee(268),[55,234],ee(226),[112]],24e3:[me,[255,192],ee(268),[55,255,128],ee(268),[111,112],ee(126),[224]],16e3:[me,[255,192],ee(268),[55,255,128],ee(268),[111,255],ee(269),[223,108],ee(195),[1,192]],12e3:[Ie,ee(268),[3,127,248],ee(268),[6,255,240],ee(268),[13,255,224],ee(268),[27,253,128],ee(259),[56]],11025:[Ie,ee(268),[3,127,248],ee(268),[6,255,240],ee(268),[13,255,224],ee(268),[27,255,192],ee(268),[55,175,128],ee(108),[112]],8e3:[Ie,ee(268),[3,121,16],ee(47),[7]]};xe=Hn(s)}return xe},$e=9e4,ct,Gn,Vi,zn,ms,ps,gs;ct=function(s){return s*$e},Gn=function(s,l){return s*l},Vi=function(s){return s/$e},zn=function(s,l){return s/l},ms=function(s,l){return ct(zn(s,l))},ps=function(s,l){return Gn(Vi(s),l)},gs=function(s,l,c){return Vi(c?s:s-l)};var _e={ONE_SECOND_IN_TS:$e,secondsToVideoTs:ct,secondsToAudioTs:Gn,videoTsToSeconds:Vi,audioTsToSeconds:zn,audioTsToVideoTs:ms,videoTsToAudioTs:ps,metadataTsToSeconds:gs},Nl=Qe,Hi=_e,Fl=function(s){var l,c,u=0;for(l=0;l<s.length;l++)c=s[l],u+=c.data.byteLength;return u},$l=function(s,l,c,u){var f,p=0,b=0,w=0,C=0,I,R,N;if(l.length&&(f=Hi.audioTsToVideoTs(s.baseMediaDecodeTime,s.samplerate),p=Math.ceil(Hi.ONE_SECOND_IN_TS/(s.samplerate/1024)),c&&u&&(b=f-Math.max(c,u),w=Math.floor(b/p),C=w*p),!(w<1||C>Hi.ONE_SECOND_IN_TS/2))){for(I=Nl()[s.samplerate],I||(I=l[0].data),R=0;R<w;R++)N=l[0],l.splice(0,0,{data:I,dts:N.dts-p,pts:N.pts-p});return s.baseMediaDecodeTime-=Math.floor(Hi.videoTsToAudioTs(C,s.samplerate)),C}},jl=function(s,l,c){return l.minSegmentDts>=c?s:(l.minSegmentDts=1/0,s.filter(function(u){return u.dts>=c?(l.minSegmentDts=Math.min(l.minSegmentDts,u.dts),l.minSegmentPts=l.minSegmentDts,!0):!1}))},ql=function(s){var l,c,u=[];for(l=0;l<s.length;l++)c=s[l],u.push({size:c.data.byteLength,duration:1024});return u},Wl=function(s){var l,c,u=0,f=new Uint8Array(Fl(s));for(l=0;l<s.length;l++)c=s[l],f.set(c.data,u),u+=c.data.byteLength;return f},Vl={prefixWithSilence:$l,trimAdtsFramesByEarliestDts:jl,generateSampleTable:ql,concatenateFrameData:Wl},Hl=_e.ONE_SECOND_IN_TS,Gl=function(s,l){typeof l.pts=="number"&&(s.timelineStartInfo.pts===void 0&&(s.timelineStartInfo.pts=l.pts),s.minSegmentPts===void 0?s.minSegmentPts=l.pts:s.minSegmentPts=Math.min(s.minSegmentPts,l.pts),s.maxSegmentPts===void 0?s.maxSegmentPts=l.pts:s.maxSegmentPts=Math.max(s.maxSegmentPts,l.pts)),typeof l.dts=="number"&&(s.timelineStartInfo.dts===void 0&&(s.timelineStartInfo.dts=l.dts),s.minSegmentDts===void 0?s.minSegmentDts=l.dts:s.minSegmentDts=Math.min(s.minSegmentDts,l.dts),s.maxSegmentDts===void 0?s.maxSegmentDts=l.dts:s.maxSegmentDts=Math.max(s.maxSegmentDts,l.dts))},zl=function(s){delete s.minSegmentDts,delete s.maxSegmentDts,delete s.minSegmentPts,delete s.maxSegmentPts},Ql=function(s,l){var c,u,f=s.minSegmentDts;return l||(f-=s.timelineStartInfo.dts),c=s.timelineStartInfo.baseMediaDecodeTime,c+=f,c=Math.max(0,c),s.type==="audio"&&(u=s.samplerate/Hl,c*=u,c=Math.floor(c)),c},Yl={clearDtsInfo:zl,calculateTrackBaseMediaDecodeTime:Ql,collectDtsInfo:Gl},ys=4,Xl=128,Kl=function(s){for(var l=0,c={payloadType:-1,payloadSize:0},u=0,f=0;l<s.byteLength&&s[l]!==Xl;){for(;s[l]===255;)u+=255,l++;for(u+=s[l++];s[l]===255;)f+=255,l++;if(f+=s[l++],!c.payload&&u===ys){var p=String.fromCharCode(s[l+3],s[l+4],s[l+5],s[l+6]);if(p==="GA94"){c.payloadType=u,c.payloadSize=f,c.payload=s.subarray(l,l+f);break}else c.payload=void 0}l+=f,u=0,f=0}return c},Jl=function(s){return s.payload[0]!==181||(s.payload[1]<<8|s.payload[2])!==49||String.fromCharCode(s.payload[3],s.payload[4],s.payload[5],s.payload[6])!=="GA94"||s.payload[7]!==3?null:s.payload.subarray(8,s.payload.length-1)},Zl=function(s,l){var c=[],u,f,p,b;if(!(l[0]&64))return c;for(f=l[0]&31,u=0;u<f;u++)p=u*3,b={type:l[p+2]&3,pts:s},l[p+2]&4&&(b.ccData=l[p+3]<<8|l[p+4],c.push(b));return c},ed=function(s){for(var l=s.byteLength,c=[],u=1,f,p;u<l-2;)s[u]===0&&s[u+1]===0&&s[u+2]===3?(c.push(u+2),u+=2):u++;if(c.length===0)return s;f=l-c.length,p=new Uint8Array(f);var b=0;for(u=0;u<f;b++,u++)b===c[0]&&(b++,c.shift()),p[u]=s[b];return p},_s={parseSei:Kl,parseUserData:Jl,parseCaptionPackets:Zl,discardEmulationPreventionBytes:ed,USER_DATA_REGISTERED_ITU_T_T35:ys},Qn=t,Gi=_s,Ye=function(s){s=s||{},Ye.prototype.init.call(this),this.parse708captions_=typeof s.parse708captions=="boolean"?s.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Te(0,0),new Te(0,1),new Te(1,0),new Te(1,1)],this.parse708captions_&&(this.cc708Stream_=new pe({captionServices:s.captionServices})),this.reset(),this.ccStreams_.forEach(function(l){l.on("data",this.trigger.bind(this,"data")),l.on("partialdone",this.trigger.bind(this,"partialdone")),l.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Ye.prototype=new Qn,Ye.prototype.push=function(s){var l,c,u;if(s.nalUnitType==="sei_rbsp"&&(l=Gi.parseSei(s.escapedRBSP),!!l.payload&&l.payloadType===Gi.USER_DATA_REGISTERED_ITU_T_T35&&(c=Gi.parseUserData(l),!!c))){if(s.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(s.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}u=Gi.parseCaptionPackets(s.pts,c),this.captionPackets_=this.captionPackets_.concat(u),this.latestDts_!==s.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=s.dts}},Ye.prototype.flushCCStreams=function(s){this.ccStreams_.forEach(function(l){return s==="flush"?l.flush():l.partialFlush()},this)},Ye.prototype.flushStream=function(s){if(!this.captionPackets_.length){this.flushCCStreams(s);return}this.captionPackets_.forEach(function(l,c){l.presortIndex=c}),this.captionPackets_.sort(function(l,c){return l.pts===c.pts?l.presortIndex-c.presortIndex:l.pts-c.pts}),this.captionPackets_.forEach(function(l){l.type<2?this.dispatchCea608Packet(l):this.dispatchCea708Packet(l)},this),this.captionPackets_.length=0,this.flushCCStreams(s)},Ye.prototype.flush=function(){return this.flushStream("flush")},Ye.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Ye.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(s){s.reset()})},Ye.prototype.dispatchCea608Packet=function(s){this.setsTextOrXDSActive(s)?this.activeCea608Channel_[s.type]=null:this.setsChannel1Active(s)?this.activeCea608Channel_[s.type]=0:this.setsChannel2Active(s)&&(this.activeCea608Channel_[s.type]=1),this.activeCea608Channel_[s.type]!==null&&this.ccStreams_[(s.type<<1)+this.activeCea608Channel_[s.type]].push(s)},Ye.prototype.setsChannel1Active=function(s){return(s.ccData&30720)===4096},Ye.prototype.setsChannel2Active=function(s){return(s.ccData&30720)===6144},Ye.prototype.setsTextOrXDSActive=function(s){return(s.ccData&28928)===256||(s.ccData&30974)===4138||(s.ccData&30974)===6186},Ye.prototype.dispatchCea708Packet=function(s){this.parse708captions_&&this.cc708Stream_.push(s)};var td={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},id=function(s){var l=td[s]||s;return s&4096&&s===l?"":String.fromCharCode(l)},zi=function(s){return 32<=s&&s<=127||160<=s&&s<=255},bt=function(s){this.windowNum=s,this.reset()};bt.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},bt.prototype.getText=function(){return this.rows.join(`
`)},bt.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},bt.prototype.newLine=function(s){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(s),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},bt.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},bt.prototype.addText=function(s){this.rows[this.rowIdx]+=s},bt.prototype.backspace=function(){if(!this.isEmpty()){var s=this.rows[this.rowIdx];this.rows[this.rowIdx]=s.substr(0,s.length-1)}};var Qi=function(s,l,c){this.serviceNum=s,this.text="",this.currentWindow=new bt(-1),this.windows=[],this.stream=c,typeof l=="string"&&this.createTextDecoder(l)};Qi.prototype.init=function(s,l){this.startPts=s;for(var c=0;c<8;c++)this.windows[c]=new bt(c),typeof l=="function"&&(this.windows[c].beforeRowOverflow=l)},Qi.prototype.setCurrentWindow=function(s){this.currentWindow=this.windows[s]},Qi.prototype.createTextDecoder=function(s){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(s)}catch(l){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+s+" encoding. "+l})}};var pe=function(s){s=s||{},pe.prototype.init.call(this);var l=this,c=s.captionServices||{},u={},f;Object.keys(c).forEach(p=>{f=c[p],/^SERVICE/.test(p)&&(u[p]=f.encoding)}),this.serviceEncodings=u,this.current708Packet=null,this.services={},this.push=function(p){p.type===3?(l.new708Packet(),l.add708Bytes(p)):(l.current708Packet===null&&l.new708Packet(),l.add708Bytes(p))}};pe.prototype=new Qn,pe.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},pe.prototype.add708Bytes=function(s){var l=s.ccData,c=l>>>8,u=l&255;this.current708Packet.ptsVals.push(s.pts),this.current708Packet.data.push(c),this.current708Packet.data.push(u)},pe.prototype.push708Packet=function(){var s=this.current708Packet,l=s.data,c=null,u=null,f=0,p=l[f++];for(s.seq=p>>6,s.sizeCode=p&63;f<l.length;f++)p=l[f++],c=p>>5,u=p&31,c===7&&u>0&&(p=l[f++],c=p),this.pushServiceBlock(c,f,u),u>0&&(f+=u-1)},pe.prototype.pushServiceBlock=function(s,l,c){var u,f=l,p=this.current708Packet.data,b=this.services[s];for(b||(b=this.initService(s,f));f<l+c&&f<p.length;f++)u=p[f],zi(u)?f=this.handleText(f,b):u===24?f=this.multiByteCharacter(f,b):u===16?f=this.extendedCommands(f,b):128<=u&&u<=135?f=this.setCurrentWindow(f,b):152<=u&&u<=159?f=this.defineWindow(f,b):u===136?f=this.clearWindows(f,b):u===140?f=this.deleteWindows(f,b):u===137?f=this.displayWindows(f,b):u===138?f=this.hideWindows(f,b):u===139?f=this.toggleWindows(f,b):u===151?f=this.setWindowAttributes(f,b):u===144?f=this.setPenAttributes(f,b):u===145?f=this.setPenColor(f,b):u===146?f=this.setPenLocation(f,b):u===143?b=this.reset(f,b):u===8?b.currentWindow.backspace():u===12?b.currentWindow.clearText():u===13?b.currentWindow.pendingNewLine=!0:u===14?b.currentWindow.clearText():u===141&&f++},pe.prototype.extendedCommands=function(s,l){var c=this.current708Packet.data,u=c[++s];return zi(u)&&(s=this.handleText(s,l,{isExtended:!0})),s},pe.prototype.getPts=function(s){return this.current708Packet.ptsVals[Math.floor(s/2)]},pe.prototype.initService=function(s,l){var u="SERVICE"+s,c=this,u,f;return u in this.serviceEncodings&&(f=this.serviceEncodings[u]),this.services[s]=new Qi(s,f,c),this.services[s].init(this.getPts(l),function(p){c.flushDisplayed(p,c.services[s])}),this.services[s]},pe.prototype.handleText=function(s,l,c){var u=c&&c.isExtended,f=c&&c.isMultiByte,p=this.current708Packet.data,b=u?4096:0,w=p[s],C=p[s+1],I=l.currentWindow,R,N;function z(j){return j.map(Y=>("0"+(Y&255).toString(16)).slice(-2)).join("")}if(f?(N=[w,C],s++):N=[w],l.textDecoder_&&!u)R=l.textDecoder_.decode(new Uint8Array(N));else if(f){const j=z(N);R=String.fromCharCode(parseInt(j,16))}else R=id(b|w);return I.pendingNewLine&&!I.isEmpty()&&I.newLine(this.getPts(s)),I.pendingNewLine=!1,I.addText(R),s},pe.prototype.multiByteCharacter=function(s,l){var c=this.current708Packet.data,u=c[s+1],f=c[s+2];return zi(u)&&zi(f)&&(s=this.handleText(++s,l,{isMultiByte:!0})),s},pe.prototype.setCurrentWindow=function(s,l){var c=this.current708Packet.data,u=c[s],f=u&7;return l.setCurrentWindow(f),s},pe.prototype.defineWindow=function(s,l){var c=this.current708Packet.data,u=c[s],f=u&7;l.setCurrentWindow(f);var p=l.currentWindow;return u=c[++s],p.visible=(u&32)>>5,p.rowLock=(u&16)>>4,p.columnLock=(u&8)>>3,p.priority=u&7,u=c[++s],p.relativePositioning=(u&128)>>7,p.anchorVertical=u&127,u=c[++s],p.anchorHorizontal=u,u=c[++s],p.anchorPoint=(u&240)>>4,p.rowCount=u&15,u=c[++s],p.columnCount=u&63,u=c[++s],p.windowStyle=(u&56)>>3,p.penStyle=u&7,p.virtualRowCount=p.rowCount+1,s},pe.prototype.setWindowAttributes=function(s,l){var c=this.current708Packet.data,u=c[s],f=l.currentWindow.winAttr;return u=c[++s],f.fillOpacity=(u&192)>>6,f.fillRed=(u&48)>>4,f.fillGreen=(u&12)>>2,f.fillBlue=u&3,u=c[++s],f.borderType=(u&192)>>6,f.borderRed=(u&48)>>4,f.borderGreen=(u&12)>>2,f.borderBlue=u&3,u=c[++s],f.borderType+=(u&128)>>5,f.wordWrap=(u&64)>>6,f.printDirection=(u&48)>>4,f.scrollDirection=(u&12)>>2,f.justify=u&3,u=c[++s],f.effectSpeed=(u&240)>>4,f.effectDirection=(u&12)>>2,f.displayEffect=u&3,s},pe.prototype.flushDisplayed=function(s,l){for(var c=[],u=0;u<8;u++)l.windows[u].visible&&!l.windows[u].isEmpty()&&c.push(l.windows[u].getText());l.endPts=s,l.text=c.join(`

`),this.pushCaption(l),l.startPts=s},pe.prototype.pushCaption=function(s){s.text!==""&&(this.trigger("data",{startPts:s.startPts,endPts:s.endPts,text:s.text,stream:"cc708_"+s.serviceNum}),s.text="",s.startPts=s.endPts)},pe.prototype.displayWindows=function(s,l){var c=this.current708Packet.data,u=c[++s],f=this.getPts(s);this.flushDisplayed(f,l);for(var p=0;p<8;p++)u&1<<p&&(l.windows[p].visible=1);return s},pe.prototype.hideWindows=function(s,l){var c=this.current708Packet.data,u=c[++s],f=this.getPts(s);this.flushDisplayed(f,l);for(var p=0;p<8;p++)u&1<<p&&(l.windows[p].visible=0);return s},pe.prototype.toggleWindows=function(s,l){var c=this.current708Packet.data,u=c[++s],f=this.getPts(s);this.flushDisplayed(f,l);for(var p=0;p<8;p++)u&1<<p&&(l.windows[p].visible^=1);return s},pe.prototype.clearWindows=function(s,l){var c=this.current708Packet.data,u=c[++s],f=this.getPts(s);this.flushDisplayed(f,l);for(var p=0;p<8;p++)u&1<<p&&l.windows[p].clearText();return s},pe.prototype.deleteWindows=function(s,l){var c=this.current708Packet.data,u=c[++s],f=this.getPts(s);this.flushDisplayed(f,l);for(var p=0;p<8;p++)u&1<<p&&l.windows[p].reset();return s},pe.prototype.setPenAttributes=function(s,l){var c=this.current708Packet.data,u=c[s],f=l.currentWindow.penAttr;return u=c[++s],f.textTag=(u&240)>>4,f.offset=(u&12)>>2,f.penSize=u&3,u=c[++s],f.italics=(u&128)>>7,f.underline=(u&64)>>6,f.edgeType=(u&56)>>3,f.fontStyle=u&7,s},pe.prototype.setPenColor=function(s,l){var c=this.current708Packet.data,u=c[s],f=l.currentWindow.penColor;return u=c[++s],f.fgOpacity=(u&192)>>6,f.fgRed=(u&48)>>4,f.fgGreen=(u&12)>>2,f.fgBlue=u&3,u=c[++s],f.bgOpacity=(u&192)>>6,f.bgRed=(u&48)>>4,f.bgGreen=(u&12)>>2,f.bgBlue=u&3,u=c[++s],f.edgeRed=(u&48)>>4,f.edgeGreen=(u&12)>>2,f.edgeBlue=u&3,s},pe.prototype.setPenLocation=function(s,l){var c=this.current708Packet.data,u=c[s],f=l.currentWindow.penLoc;return l.currentWindow.pendingNewLine=!0,u=c[++s],f.row=u&15,u=c[++s],f.column=u&63,s},pe.prototype.reset=function(s,l){var c=this.getPts(s);return this.flushDisplayed(c,l),this.initService(l.serviceNum,s)};var nd={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Yi=function(s){return s===null?"":(s=nd[s]||s,String.fromCharCode(s))},Xi=14,rd=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],qt=function(){for(var s=[],l=Xi+1;l--;)s.push({text:"",indent:0,offset:0});return s},Te=function(s,l){Te.prototype.init.call(this),this.field_=s||0,this.dataChannel_=l||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(c){var u,f,p,b,w;if(u=c.ccData&32639,u===this.lastControlCode_){this.lastControlCode_=null;return}if((u&61440)===4096?this.lastControlCode_=u:u!==this.PADDING_&&(this.lastControlCode_=null),p=u>>>8,b=u&255,u!==this.PADDING_)if(u===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(u===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(c.pts),this.flushDisplayed(c.pts),f=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=f,this.startPts_=c.pts;else if(u===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(c.pts);else if(u===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(c.pts);else if(u===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(c.pts);else if(u===this.CARRIAGE_RETURN_)this.clearFormatting(c.pts),this.flushDisplayed(c.pts),this.shiftRowsUp_(),this.startPts_=c.pts;else if(u===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(u===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(c.pts),this.displayed_=qt();else if(u===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=qt();else if(u===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(c.pts),this.displayed_=qt()),this.mode_="paintOn",this.startPts_=c.pts;else if(this.isSpecialCharacter(p,b))p=(p&3)<<8,w=Yi(p|b),this[this.mode_](c.pts,w),this.column_++;else if(this.isExtCharacter(p,b))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),p=(p&3)<<8,w=Yi(p|b),this[this.mode_](c.pts,w),this.column_++;else if(this.isMidRowCode(p,b))this.clearFormatting(c.pts),this[this.mode_](c.pts," "),this.column_++,(b&14)===14&&this.addFormatting(c.pts,["i"]),(b&1)===1&&this.addFormatting(c.pts,["u"]);else if(this.isOffsetControlCode(p,b)){const I=b&3;this.nonDisplayed_[this.row_].offset=I,this.column_+=I}else if(this.isPAC(p,b)){var C=rd.indexOf(u&7968);if(this.mode_==="rollUp"&&(C-this.rollUpRows_+1<0&&(C=this.rollUpRows_-1),this.setRollUp(c.pts,C)),C!==this.row_&&C>=0&&C<=14&&(this.clearFormatting(c.pts),this.row_=C),b&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(c.pts,["u"]),(u&16)===16){const I=(u&14)>>1;this.column_=I*4,this.nonDisplayed_[this.row_].indent+=I}this.isColorPAC(b)&&(b&14)===14&&this.addFormatting(c.pts,["i"])}else this.isNormalChar(p)&&(b===0&&(b=null),w=Yi(p),w+=Yi(b),this[this.mode_](c.pts,w),this.column_+=w.length)}};Te.prototype=new Qn,Te.prototype.flushDisplayed=function(s){const l=u=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+u+"."})},c=[];this.displayed_.forEach((u,f)=>{if(u&&u.text&&u.text.length){try{u.text=u.text.trim()}catch{l(f)}u.text.length&&c.push({text:u.text,line:f+1,position:10+Math.min(70,u.indent*10)+u.offset*2.5})}else u==null&&l(f)}),c.length&&this.trigger("data",{startPts:this.startPts_,endPts:s,content:c,stream:this.name_})},Te.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=qt(),this.nonDisplayed_=qt(),this.lastControlCode_=null,this.column_=0,this.row_=Xi,this.rollUpRows_=2,this.formatting_=[]},Te.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Te.prototype.isSpecialCharacter=function(s,l){return s===this.EXT_&&l>=48&&l<=63},Te.prototype.isExtCharacter=function(s,l){return(s===this.EXT_+1||s===this.EXT_+2)&&l>=32&&l<=63},Te.prototype.isMidRowCode=function(s,l){return s===this.EXT_&&l>=32&&l<=47},Te.prototype.isOffsetControlCode=function(s,l){return s===this.OFFSET_&&l>=33&&l<=35},Te.prototype.isPAC=function(s,l){return s>=this.BASE_&&s<this.BASE_+8&&l>=64&&l<=127},Te.prototype.isColorPAC=function(s){return s>=64&&s<=79||s>=96&&s<=127},Te.prototype.isNormalChar=function(s){return s>=32&&s<=127},Te.prototype.setRollUp=function(s,l){if(this.mode_!=="rollUp"&&(this.row_=Xi,this.mode_="rollUp",this.flushDisplayed(s),this.nonDisplayed_=qt(),this.displayed_=qt()),l!==void 0&&l!==this.row_)for(var c=0;c<this.rollUpRows_;c++)this.displayed_[l-c]=this.displayed_[this.row_-c],this.displayed_[this.row_-c]={text:"",indent:0,offset:0};l===void 0&&(l=this.row_),this.topRow_=l-this.rollUpRows_+1},Te.prototype.addFormatting=function(s,l){this.formatting_=this.formatting_.concat(l);var c=l.reduce(function(u,f){return u+"<"+f+">"},"");this[this.mode_](s,c)},Te.prototype.clearFormatting=function(s){if(this.formatting_.length){var l=this.formatting_.reverse().reduce(function(c,u){return c+"</"+u+">"},"");this.formatting_=[],this[this.mode_](s,l)}},Te.prototype.popOn=function(s,l){var c=this.nonDisplayed_[this.row_].text;c+=l,this.nonDisplayed_[this.row_].text=c},Te.prototype.rollUp=function(s,l){var c=this.displayed_[this.row_].text;c+=l,this.displayed_[this.row_].text=c},Te.prototype.shiftRowsUp_=function(){var s;for(s=0;s<this.topRow_;s++)this.displayed_[s]={text:"",indent:0,offset:0};for(s=this.row_+1;s<Xi+1;s++)this.displayed_[s]={text:"",indent:0,offset:0};for(s=this.topRow_;s<this.row_;s++)this.displayed_[s]=this.displayed_[s+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Te.prototype.paintOn=function(s,l){var c=this.displayed_[this.row_].text;c+=l,this.displayed_[this.row_].text=c};var vs={CaptionStream:Ye,Cea608Stream:Te,Cea708Stream:pe},Ki={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},sd=t,ad=8589934592,od=4294967296,bs="shared",Yn=function(s,l){var c=1;for(s>l&&(c=-1);Math.abs(l-s)>od;)s+=c*ad;return s},Xn=function(s){var l,c;Xn.prototype.init.call(this),this.type_=s||bs,this.push=function(u){if(u.type==="metadata"){this.trigger("data",u);return}this.type_!==bs&&u.type!==this.type_||(c===void 0&&(c=u.dts),u.dts=Yn(u.dts,c),u.pts=Yn(u.pts,c),l=u.dts,this.trigger("data",u))},this.flush=function(){c=l,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){c=void 0,l=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Xn.prototype=new sd;var Ts={TimestampRolloverStream:Xn,handleRollover:Yn},ld=(s,l,c)=>{if(!s)return-1;for(var u=c;u<s.length;u++)if(s[u]===l)return u;return-1},dd={typedArrayIndexOf:ld},Ji=dd.typedArrayIndexOf,Zi={Utf8:3},Ss=function(s,l,c){var u,f="";for(u=l;u<c;u++)f+="%"+("00"+s[u].toString(16)).slice(-2);return f},fi=function(s,l,c){return decodeURIComponent(Ss(s,l,c))},mi=function(s,l,c){return unescape(Ss(s,l,c))},pi=function(s){return s[0]<<21|s[1]<<14|s[2]<<7|s[3]},gi={APIC:function(s){var l=1,c,u,f="-->";s.data[0]===Zi.Utf8&&(c=Ji(s.data,0,l),!(c<0)&&(s.mimeType=mi(s.data,l,c),l=c+1,s.pictureType=s.data[l],l++,u=Ji(s.data,0,l),!(u<0)&&(s.description=fi(s.data,l,u),l=u+1,s.mimeType===f?s.url=mi(s.data,l,s.data.length):s.pictureData=s.data.subarray(l,s.data.length))))},"T*":function(s){s.data[0]===Zi.Utf8&&(s.value=fi(s.data,1,s.data.length).replace(/\0*$/,""),s.values=s.value.split("\0"))},TXXX:function(s){var l;s.data[0]===Zi.Utf8&&(l=Ji(s.data,0,1),l!==-1&&(s.description=fi(s.data,1,l),s.value=fi(s.data,l+1,s.data.length).replace(/\0*$/,""),s.data=s.value))},"W*":function(s){s.url=mi(s.data,0,s.data.length).replace(/\0.*$/,"")},WXXX:function(s){var l;s.data[0]===Zi.Utf8&&(l=Ji(s.data,0,1),l!==-1&&(s.description=fi(s.data,1,l),s.url=mi(s.data,l+1,s.data.length).replace(/\0.*$/,"")))},PRIV:function(s){var l;for(l=0;l<s.data.length;l++)if(s.data[l]===0){s.owner=mi(s.data,0,l);break}s.privateData=s.data.subarray(l+1),s.data=s.privateData}},ud=function(s){var l,c,u=10,f=0,p=[];if(!(s.length<10||s[0]!==73||s[1]!==68||s[2]!==51)){f=pi(s.subarray(6,10)),f+=10;var b=s[5]&64;b&&(u+=4,u+=pi(s.subarray(10,14)),f-=pi(s.subarray(16,20)));do{if(l=pi(s.subarray(u+4,u+8)),l<1)break;c=String.fromCharCode(s[u],s[u+1],s[u+2],s[u+3]);var w={id:c,data:s.subarray(u+10,u+l+10)};w.key=w.id,gi[w.id]?gi[w.id](w):w.id[0]==="T"?gi["T*"](w):w.id[0]==="W"&&gi["W*"](w),p.push(w),u+=10,u+=l}while(u<f);return p}},ws={parseId3Frames:ud,parseSyncSafeInteger:pi,frameParsers:gi},cd=t,hd=Ki,Lt=ws,en;en=function(s){var l={descriptor:s&&s.descriptor},c=0,u=[],f=0,p;if(en.prototype.init.call(this),this.dispatchType=hd.METADATA_STREAM_TYPE.toString(16),l.descriptor)for(p=0;p<l.descriptor.length;p++)this.dispatchType+=("00"+l.descriptor[p].toString(16)).slice(-2);this.push=function(b){var w,C,I,R,N,z;if(b.type==="timed-metadata"){if(b.dataAlignmentIndicator&&(f=0,u.length=0),u.length===0&&(b.data.length<10||b.data[0]!==73||b.data[1]!==68||b.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(u.push(b),f+=b.data.byteLength,u.length===1&&(c=Lt.parseSyncSafeInteger(b.data.subarray(6,10)),c+=10),!(f<c)){for(w={data:new Uint8Array(c),frames:[],pts:u[0].pts,dts:u[0].dts},N=0;N<c;)w.data.set(u[0].data.subarray(0,c-N),N),N+=u[0].data.byteLength,f-=u[0].data.byteLength,u.shift();C=10,w.data[5]&64&&(C+=4,C+=Lt.parseSyncSafeInteger(w.data.subarray(10,14)),c-=Lt.parseSyncSafeInteger(w.data.subarray(16,20)));do{if(I=Lt.parseSyncSafeInteger(w.data.subarray(C+4,C+8)),I<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(z=String.fromCharCode(w.data[C],w.data[C+1],w.data[C+2],w.data[C+3]),R={id:z,data:w.data.subarray(C+10,C+I+10)},R.key=R.id,Lt.frameParsers[R.id]?Lt.frameParsers[R.id](R):R.id[0]==="T"?Lt.frameParsers["T*"](R):R.id[0]==="W"&&Lt.frameParsers["W*"](R),R.owner==="com.apple.streaming.transportStreamTimestamp"){var j=R.data,Y=(j[3]&1)<<30|j[4]<<22|j[5]<<14|j[6]<<6|j[7]>>>2;Y*=4,Y+=j[7]&3,R.timeStamp=Y,w.pts===void 0&&w.dts===void 0&&(w.pts=R.timeStamp,w.dts=R.timeStamp),this.trigger("timestamp",R)}w.frames.push(R),C+=10,C+=I}while(C<c);this.trigger("data",w)}}}},en.prototype=new cd;var fd=en,Kn=t,Jn=vs,st=Ki,md=Ts.TimestampRolloverStream,tn,yi,nn,ei=188,Zn=71;tn=function(){var s=new Uint8Array(ei),l=0;tn.prototype.init.call(this),this.push=function(c){var u=0,f=ei,p;for(l?(p=new Uint8Array(c.byteLength+l),p.set(s.subarray(0,l)),p.set(c,l),l=0):p=c;f<p.byteLength;){if(p[u]===Zn&&p[f]===Zn){this.trigger("data",p.subarray(u,f)),u+=ei,f+=ei;continue}u++,f++}u<p.byteLength&&(s.set(p.subarray(u),0),l=p.byteLength-u)},this.flush=function(){l===ei&&s[0]===Zn&&(this.trigger("data",s),l=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){l=0,this.trigger("reset")}},tn.prototype=new Kn,yi=function(){var s,l,c,u;yi.prototype.init.call(this),u=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,s=function(f,p){var b=0;p.payloadUnitStartIndicator&&(b+=f[b]+1),p.type==="pat"?l(f.subarray(b),p):c(f.subarray(b),p)},l=function(f,p){p.section_number=f[7],p.last_section_number=f[8],u.pmtPid=(f[10]&31)<<8|f[11],p.pmtPid=u.pmtPid},c=function(f,p){var b,w,C,I;if(f[5]&1){for(u.programMapTable={video:null,audio:null,"timed-metadata":{}},b=(f[1]&15)<<8|f[2],w=3+b-4,C=(f[10]&15)<<8|f[11],I=12+C;I<w;){var R=f[I],N=(f[I+1]&31)<<8|f[I+2];R===st.H264_STREAM_TYPE&&u.programMapTable.video===null?u.programMapTable.video=N:R===st.ADTS_STREAM_TYPE&&u.programMapTable.audio===null?u.programMapTable.audio=N:R===st.METADATA_STREAM_TYPE&&(u.programMapTable["timed-metadata"][N]=R),I+=((f[I+3]&15)<<8|f[I+4])+5}p.programMapTable=u.programMapTable}},this.push=function(f){var p={},b=4;if(p.payloadUnitStartIndicator=!!(f[1]&64),p.pid=f[1]&31,p.pid<<=8,p.pid|=f[2],(f[3]&48)>>>4>1&&(b+=f[b]+1),p.pid===0)p.type="pat",s(f.subarray(b),p),this.trigger("data",p);else if(p.pid===this.pmtPid)for(p.type="pmt",s(f.subarray(b),p),this.trigger("data",p);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([f,b,p]):this.processPes_(f,b,p)},this.processPes_=function(f,p,b){b.pid===this.programMapTable.video?b.streamType=st.H264_STREAM_TYPE:b.pid===this.programMapTable.audio?b.streamType=st.ADTS_STREAM_TYPE:b.streamType=this.programMapTable["timed-metadata"][b.pid],b.type="pes",b.data=f.subarray(p),this.trigger("data",b)}},yi.prototype=new Kn,yi.STREAM_TYPES={h264:27,adts:15},nn=function(){var s=this,l=!1,c={data:[],size:0},u={data:[],size:0},f={data:[],size:0},p,b=function(C,I){var R;const N=C[0]<<16|C[1]<<8|C[2];I.data=new Uint8Array,N===1&&(I.packetLength=6+(C[4]<<8|C[5]),I.dataAlignmentIndicator=(C[6]&4)!==0,R=C[7],R&192&&(I.pts=(C[9]&14)<<27|(C[10]&255)<<20|(C[11]&254)<<12|(C[12]&255)<<5|(C[13]&254)>>>3,I.pts*=4,I.pts+=(C[13]&6)>>>1,I.dts=I.pts,R&64&&(I.dts=(C[14]&14)<<27|(C[15]&255)<<20|(C[16]&254)<<12|(C[17]&255)<<5|(C[18]&254)>>>3,I.dts*=4,I.dts+=(C[18]&6)>>>1)),I.data=C.subarray(9+C[8]))},w=function(C,I,R){var N=new Uint8Array(C.size),z={type:I},j=0,Y=0,J=!1,Le;if(!(!C.data.length||C.size<9)){for(z.trackId=C.data[0].pid,j=0;j<C.data.length;j++)Le=C.data[j],N.set(Le.data,Y),Y+=Le.data.byteLength;b(N,z),J=I==="video"||z.packetLength<=C.size,(R||J)&&(C.size=0,C.data.length=0),J&&s.trigger("data",z)}};nn.prototype.init.call(this),this.push=function(C){({pat:function(){},pes:function(){var I,R;switch(C.streamType){case st.H264_STREAM_TYPE:I=c,R="video";break;case st.ADTS_STREAM_TYPE:I=u,R="audio";break;case st.METADATA_STREAM_TYPE:I=f,R="timed-metadata";break;default:return}C.payloadUnitStartIndicator&&w(I,R,!0),I.data.push(C),I.size+=C.data.byteLength},pmt:function(){var I={type:"metadata",tracks:[]};p=C.programMapTable,p.video!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+p.video,codec:"avc",type:"video"}),p.audio!==null&&I.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+p.audio,codec:"adts",type:"audio"}),l=!0,s.trigger("data",I)}})[C.type]()},this.reset=function(){c.size=0,c.data.length=0,u.size=0,u.data.length=0,this.trigger("reset")},this.flushStreams_=function(){w(c,"video"),w(u,"audio"),w(f,"timed-metadata")},this.flush=function(){if(!l&&p){var C={type:"metadata",tracks:[]};p.video!==null&&C.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+p.video,codec:"avc",type:"video"}),p.audio!==null&&C.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+p.audio,codec:"adts",type:"audio"}),s.trigger("data",C)}l=!1,this.flushStreams_(),this.trigger("done")}},nn.prototype=new Kn;var Es={PAT_PID:0,MP2T_PACKET_LENGTH:ei,TransportPacketStream:tn,TransportParseStream:yi,ElementaryStream:nn,TimestampRolloverStream:md,CaptionStream:Jn.CaptionStream,Cea608Stream:Jn.Cea608Stream,Cea708Stream:Jn.Cea708Stream,MetadataStream:fd};for(var er in st)st.hasOwnProperty(er)&&(Es[er]=st[er]);var pd=Es,gd=t,yd=_e.ONE_SECOND_IN_TS,rn,xs=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];rn=function(s){var l,c=0;rn.prototype.init.call(this),this.skipWarn_=function(u,f){this.trigger("log",{level:"warn",message:`adts skiping bytes ${u} to ${f} in frame ${c} outside syncword`})},this.push=function(u){var f=0,p,b,w,C,I;if(s||(c=0),u.type==="audio"){l&&l.length?(w=l,l=new Uint8Array(w.byteLength+u.data.byteLength),l.set(w),l.set(u.data,w.byteLength)):l=u.data;for(var R;f+7<l.length;){if(l[f]!==255||(l[f+1]&246)!==240){typeof R!="number"&&(R=f),f++;continue}if(typeof R=="number"&&(this.skipWarn_(R,f),R=null),b=(~l[f+1]&1)*2,p=(l[f+3]&3)<<11|l[f+4]<<3|(l[f+5]&224)>>5,C=((l[f+6]&3)+1)*1024,I=C*yd/xs[(l[f+2]&60)>>>2],l.byteLength-f<p)break;this.trigger("data",{pts:u.pts+c*I,dts:u.dts+c*I,sampleCount:C,audioobjecttype:(l[f+2]>>>6&3)+1,channelcount:(l[f+2]&1)<<2|(l[f+3]&192)>>>6,samplerate:xs[(l[f+2]&60)>>>2],samplingfrequencyindex:(l[f+2]&60)>>>2,samplesize:16,data:l.subarray(f+7+b,f+p)}),c++,f+=p}typeof R=="number"&&(this.skipWarn_(R,f),R=null),l=l.subarray(f)}},this.flush=function(){c=0,this.trigger("done")},this.reset=function(){l=void 0,this.trigger("reset")},this.endTimeline=function(){l=void 0,this.trigger("endedtimeline")}},rn.prototype=new gd;var _d=rn,Ps;Ps=function(s){var l=s.byteLength,c=0,u=0;this.length=function(){return 8*l},this.bitsAvailable=function(){return 8*l+u},this.loadWord=function(){var f=s.byteLength-l,p=new Uint8Array(4),b=Math.min(4,l);if(b===0)throw new Error("no bytes available");p.set(s.subarray(f,f+b)),c=new DataView(p.buffer).getUint32(0),u=b*8,l-=b},this.skipBits=function(f){var p;u>f?(c<<=f,u-=f):(f-=u,p=Math.floor(f/8),f-=p*8,l-=p,this.loadWord(),c<<=f,u-=f)},this.readBits=function(f){var p=Math.min(u,f),b=c>>>32-p;return u-=p,u>0?c<<=p:l>0&&this.loadWord(),p=f-p,p>0?b<<p|this.readBits(p):b},this.skipLeadingZeros=function(){var f;for(f=0;f<u;++f)if((c&2147483648>>>f)!==0)return c<<=f,u-=f,f;return this.loadWord(),f+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var f=this.skipLeadingZeros();return this.readBits(f+1)-1},this.readExpGolomb=function(){var f=this.readUnsignedExpGolomb();return 1&f?1+f>>>1:-1*(f>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var vd=Ps,Cs=t,bd=vd,sn,an,Is;an=function(){var s=0,l,c;an.prototype.init.call(this),this.push=function(u){var f;c?(f=new Uint8Array(c.byteLength+u.data.byteLength),f.set(c),f.set(u.data,c.byteLength),c=f):c=u.data;for(var p=c.byteLength;s<p-3;s++)if(c[s+2]===1){l=s+5;break}for(;l<p;)switch(c[l]){case 0:if(c[l-1]!==0){l+=2;break}else if(c[l-2]!==0){l++;break}s+3!==l-2&&this.trigger("data",c.subarray(s+3,l-2));do l++;while(c[l]!==1&&l<p);s=l-2,l+=3;break;case 1:if(c[l-1]!==0||c[l-2]!==0){l+=3;break}this.trigger("data",c.subarray(s+3,l-2)),s=l-2,l+=3;break;default:l+=3;break}c=c.subarray(s),l-=s,s=0},this.reset=function(){c=null,s=0,this.trigger("reset")},this.flush=function(){c&&c.byteLength>3&&this.trigger("data",c.subarray(s+3)),c=null,s=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},an.prototype=new Cs,Is={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},sn=function(){var s=new an,l,c,u,f,p,b,w;sn.prototype.init.call(this),l=this,this.push=function(C){C.type==="video"&&(c=C.trackId,u=C.pts,f=C.dts,s.push(C))},s.on("data",function(C){var I={trackId:c,pts:u,dts:f,data:C,nalUnitTypeCode:C[0]&31};switch(I.nalUnitTypeCode){case 5:I.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:I.nalUnitType="sei_rbsp",I.escapedRBSP=p(C.subarray(1));break;case 7:I.nalUnitType="seq_parameter_set_rbsp",I.escapedRBSP=p(C.subarray(1)),I.config=b(I.escapedRBSP);break;case 8:I.nalUnitType="pic_parameter_set_rbsp";break;case 9:I.nalUnitType="access_unit_delimiter_rbsp";break}l.trigger("data",I)}),s.on("done",function(){l.trigger("done")}),s.on("partialdone",function(){l.trigger("partialdone")}),s.on("reset",function(){l.trigger("reset")}),s.on("endedtimeline",function(){l.trigger("endedtimeline")}),this.flush=function(){s.flush()},this.partialFlush=function(){s.partialFlush()},this.reset=function(){s.reset()},this.endTimeline=function(){s.endTimeline()},w=function(C,I){var R=8,N=8,z,j;for(z=0;z<C;z++)N!==0&&(j=I.readExpGolomb(),N=(R+j+256)%256),R=N===0?R:N},p=function(C){for(var I=C.byteLength,R=[],N=1,z,j;N<I-2;)C[N]===0&&C[N+1]===0&&C[N+2]===3?(R.push(N+2),N+=2):N++;if(R.length===0)return C;z=I-R.length,j=new Uint8Array(z);var Y=0;for(N=0;N<z;Y++,N++)Y===R[0]&&(Y++,R.shift()),j[N]=C[Y];return j},b=function(C){var I=0,R=0,N=0,z=0,j,Y,J,Le,Je,Rt,Ei,xi,Pi,Ci,_n,ve=[1,1],Ii,ot;if(j=new bd(C),Y=j.readUnsignedByte(),Le=j.readUnsignedByte(),J=j.readUnsignedByte(),j.skipUnsignedExpGolomb(),Is[Y]&&(Je=j.readUnsignedExpGolomb(),Je===3&&j.skipBits(1),j.skipUnsignedExpGolomb(),j.skipUnsignedExpGolomb(),j.skipBits(1),j.readBoolean()))for(_n=Je!==3?8:12,ot=0;ot<_n;ot++)j.readBoolean()&&(ot<6?w(16,j):w(64,j));if(j.skipUnsignedExpGolomb(),Rt=j.readUnsignedExpGolomb(),Rt===0)j.readUnsignedExpGolomb();else if(Rt===1)for(j.skipBits(1),j.skipExpGolomb(),j.skipExpGolomb(),Ei=j.readUnsignedExpGolomb(),ot=0;ot<Ei;ot++)j.skipExpGolomb();if(j.skipUnsignedExpGolomb(),j.skipBits(1),xi=j.readUnsignedExpGolomb(),Pi=j.readUnsignedExpGolomb(),Ci=j.readBits(1),Ci===0&&j.skipBits(1),j.skipBits(1),j.readBoolean()&&(I=j.readUnsignedExpGolomb(),R=j.readUnsignedExpGolomb(),N=j.readUnsignedExpGolomb(),z=j.readUnsignedExpGolomb()),j.readBoolean()&&j.readBoolean()){switch(Ii=j.readUnsignedByte(),Ii){case 1:ve=[1,1];break;case 2:ve=[12,11];break;case 3:ve=[10,11];break;case 4:ve=[16,11];break;case 5:ve=[40,33];break;case 6:ve=[24,11];break;case 7:ve=[20,11];break;case 8:ve=[32,11];break;case 9:ve=[80,33];break;case 10:ve=[18,11];break;case 11:ve=[15,11];break;case 12:ve=[64,33];break;case 13:ve=[160,99];break;case 14:ve=[4,3];break;case 15:ve=[3,2];break;case 16:ve=[2,1];break;case 255:{ve=[j.readUnsignedByte()<<8|j.readUnsignedByte(),j.readUnsignedByte()<<8|j.readUnsignedByte()];break}}ve&&ve[0]/ve[1]}return{profileIdc:Y,levelIdc:J,profileCompatibility:Le,width:(xi+1)*16-I*2-R*2,height:(2-Ci)*(Pi+1)*16-N*2-z*2,sarRatio:ve}}},sn.prototype=new Cs;var Td={H264Stream:sn},Sd=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ds=function(s,l){var c=s[l+6]<<21|s[l+7]<<14|s[l+8]<<7|s[l+9],u=s[l+5],f=(u&16)>>4;return c=c>=0?c:0,f?c+20:c+10},As=function(s,l){return s.length-l<10||s[l]!==73||s[l+1]!==68||s[l+2]!==51?l:(l+=Ds(s,l),As(s,l))},wd=function(s){var l=As(s,0);return s.length>=l+2&&(s[l]&255)===255&&(s[l+1]&240)===240&&(s[l+1]&22)===16},Os=function(s){return s[0]<<21|s[1]<<14|s[2]<<7|s[3]},Ed=function(s,l,c){var u,f="";for(u=l;u<c;u++)f+="%"+("00"+s[u].toString(16)).slice(-2);return f},xd=function(s,l,c){return unescape(Ed(s,l,c))},Pd=function(s,l){var c=(s[l+5]&224)>>5,u=s[l+4]<<3,f=s[l+3]&6144;return f|u|c},Cd=function(s,l){return s[l]===73&&s[l+1]===68&&s[l+2]===51?"timed-metadata":s[l]&!0&&(s[l+1]&240)===240?"audio":null},Id=function(s){for(var l=0;l+5<s.length;){if(s[l]!==255||(s[l+1]&246)!==240){l++;continue}return Sd[(s[l+2]&60)>>>2]}return null},Dd=function(s){var l,c,u,f;l=10,s[5]&64&&(l+=4,l+=Os(s.subarray(10,14)));do{if(c=Os(s.subarray(l+4,l+8)),c<1)return null;if(f=String.fromCharCode(s[l],s[l+1],s[l+2],s[l+3]),f==="PRIV"){u=s.subarray(l+10,l+c+10);for(var p=0;p<u.byteLength;p++)if(u[p]===0){var b=xd(u,0,p);if(b==="com.apple.streaming.transportStreamTimestamp"){var w=u.subarray(p+1),C=(w[3]&1)<<30|w[4]<<22|w[5]<<14|w[6]<<6|w[7]>>>2;return C*=4,C+=w[7]&3,C}break}}l+=10,l+=c}while(l<s.byteLength);return null},tr={isLikelyAacData:wd,parseId3TagSize:Ds,parseAdtsSize:Pd,parseType:Cd,parseSampleRate:Id,parseAacTimestamp:Dd},Ad=t,Ls=tr,on;on=function(){var s=new Uint8Array,l=0;on.prototype.init.call(this),this.setTimestamp=function(c){l=c},this.push=function(c){var u=0,f=0,p,b,w,C;for(s.length?(C=s.length,s=new Uint8Array(c.byteLength+C),s.set(s.subarray(0,C)),s.set(c,C)):s=c;s.length-f>=3;){if(s[f]===73&&s[f+1]===68&&s[f+2]===51){if(s.length-f<10||(u=Ls.parseId3TagSize(s,f),f+u>s.length))break;b={type:"timed-metadata",data:s.subarray(f,f+u)},this.trigger("data",b),f+=u;continue}else if((s[f]&255)===255&&(s[f+1]&240)===240){if(s.length-f<7||(u=Ls.parseAdtsSize(s,f),f+u>s.length))break;w={type:"audio",data:s.subarray(f,f+u),pts:l,dts:l},this.trigger("data",w),f+=u;continue}f++}p=s.length-f,p>0?s=s.subarray(f):s=new Uint8Array},this.reset=function(){s=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){s=new Uint8Array,this.trigger("endedtimeline")}},on.prototype=new Ad;var Od=on,Ld=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Md=Ld,Rd=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],kd=Rd,ln=t,_i=Oe,vi=be,dn=Vl,at=Yl,Tt=pd,un=_e,Ms=_d,Ud=Td.H264Stream,Bd=Od,Nd=tr.isLikelyAacData,Fd=_e.ONE_SECOND_IN_TS,Rs=Md,ks=kd,cn,bi,hn,Wt,$d=function(s,l){l.stream=s,this.trigger("log",l)},Us=function(s,l){for(var c=Object.keys(l),u=0;u<c.length;u++){var f=c[u];f==="headOfPipeline"||!l[f].on||l[f].on("log",$d.bind(s,f))}},Bs=function(s,l){var c;if(s.length!==l.length)return!1;for(c=0;c<s.length;c++)if(s[c]!==l[c])return!1;return!0},Ns=function(s,l,c,u,f,p){var b=c-l,w=u-l,C=f-c;return{start:{dts:s,pts:s+b},end:{dts:s+w,pts:s+C},prependedContentDuration:p,baseMediaDecodeTime:s}};bi=function(s,l){var c=[],u,f=0,p=0,b=1/0;l=l||{},u=l.firstSequenceNumber||0,bi.prototype.init.call(this),this.push=function(w){at.collectDtsInfo(s,w),s&&Rs.forEach(function(C){s[C]=w[C]}),c.push(w)},this.setEarliestDts=function(w){f=w},this.setVideoBaseMediaDecodeTime=function(w){b=w},this.setAudioAppendStart=function(w){p=w},this.flush=function(){var w,C,I,R,N,z,j;if(c.length===0){this.trigger("done","AudioSegmentStream");return}w=dn.trimAdtsFramesByEarliestDts(c,s,f),s.baseMediaDecodeTime=at.calculateTrackBaseMediaDecodeTime(s,l.keepOriginalTimestamps),j=dn.prefixWithSilence(s,w,p,b),s.samples=dn.generateSampleTable(w),I=_i.mdat(dn.concatenateFrameData(w)),c=[],C=_i.moof(u,[s]),R=new Uint8Array(C.byteLength+I.byteLength),u++,R.set(C),R.set(I,C.byteLength),at.clearDtsInfo(s),N=Math.ceil(Fd*1024/s.samplerate),w.length&&(z=w.length*N,this.trigger("segmentTimingInfo",Ns(un.audioTsToVideoTs(s.baseMediaDecodeTime,s.samplerate),w[0].dts,w[0].pts,w[0].dts+z,w[0].pts+z,j||0)),this.trigger("timingInfo",{start:w[0].pts,end:w[0].pts+z})),this.trigger("data",{track:s,boxes:R}),this.trigger("done","AudioSegmentStream")},this.reset=function(){at.clearDtsInfo(s),c=[],this.trigger("reset")}},bi.prototype=new ln,cn=function(s,l){var c,u=[],f=[],p,b;l=l||{},c=l.firstSequenceNumber||0,cn.prototype.init.call(this),delete s.minPTS,this.gopCache_=[],this.push=function(w){at.collectDtsInfo(s,w),w.nalUnitType==="seq_parameter_set_rbsp"&&!p&&(p=w.config,s.sps=[w.data],ks.forEach(function(C){s[C]=p[C]},this)),w.nalUnitType==="pic_parameter_set_rbsp"&&!b&&(b=w.data,s.pps=[w.data]),u.push(w)},this.flush=function(){for(var w,C,I,R,N,z,j=0,Y,J;u.length&&u[0].nalUnitType!=="access_unit_delimiter_rbsp";)u.shift();if(u.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(w=vi.groupNalsIntoFrames(u),I=vi.groupFramesIntoGops(w),I[0][0].keyFrame||(C=this.getGopForFusion_(u[0],s),C?(j=C.duration,I.unshift(C),I.byteLength+=C.byteLength,I.nalCount+=C.nalCount,I.pts=C.pts,I.dts=C.dts,I.duration+=C.duration):I=vi.extendFirstKeyFrame(I)),f.length){var Le;if(l.alignGopsAtEnd?Le=this.alignGopsAtEnd_(I):Le=this.alignGopsAtStart_(I),!Le){this.gopCache_.unshift({gop:I.pop(),pps:s.pps,sps:s.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),u=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}at.clearDtsInfo(s),I=Le}at.collectDtsInfo(s,I),s.samples=vi.generateSampleTable(I),N=_i.mdat(vi.concatenateNalData(I)),s.baseMediaDecodeTime=at.calculateTrackBaseMediaDecodeTime(s,l.keepOriginalTimestamps),this.trigger("processedGopsInfo",I.map(function(Je){return{pts:Je.pts,dts:Je.dts,byteLength:Je.byteLength}})),Y=I[0],J=I[I.length-1],this.trigger("segmentTimingInfo",Ns(s.baseMediaDecodeTime,Y.dts,Y.pts,J.dts+J.duration,J.pts+J.duration,j)),this.trigger("timingInfo",{start:I[0].pts,end:I[I.length-1].pts+I[I.length-1].duration}),this.gopCache_.unshift({gop:I.pop(),pps:s.pps,sps:s.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),u=[],this.trigger("baseMediaDecodeTime",s.baseMediaDecodeTime),this.trigger("timelineStartInfo",s.timelineStartInfo),R=_i.moof(c,[s]),z=new Uint8Array(R.byteLength+N.byteLength),c++,z.set(R),z.set(N,R.byteLength),this.trigger("data",{track:s,boxes:z}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),u=[],this.gopCache_.length=0,f.length=0,this.trigger("reset")},this.resetStream_=function(){at.clearDtsInfo(s),p=void 0,b=void 0},this.getGopForFusion_=function(w){var C=45e3,I=1/0,R,N,z,j,Y;for(Y=0;Y<this.gopCache_.length;Y++)j=this.gopCache_[Y],z=j.gop,!(!(s.pps&&Bs(s.pps[0],j.pps[0]))||!(s.sps&&Bs(s.sps[0],j.sps[0])))&&(z.dts<s.timelineStartInfo.dts||(R=w.dts-z.dts-z.duration,R>=-1e4&&R<=C&&(!N||I>R)&&(N=j,I=R)));return N?N.gop:null},this.alignGopsAtStart_=function(w){var C,I,R,N,z,j,Y,J;for(z=w.byteLength,j=w.nalCount,Y=w.duration,C=I=0;C<f.length&&I<w.length&&(R=f[C],N=w[I],R.pts!==N.pts);){if(N.pts>R.pts){C++;continue}I++,z-=N.byteLength,j-=N.nalCount,Y-=N.duration}return I===0?w:I===w.length?null:(J=w.slice(I),J.byteLength=z,J.duration=Y,J.nalCount=j,J.pts=J[0].pts,J.dts=J[0].dts,J)},this.alignGopsAtEnd_=function(w){var C,I,R,N,z,j;for(C=f.length-1,I=w.length-1,z=null,j=!1;C>=0&&I>=0;){if(R=f[C],N=w[I],R.pts===N.pts){j=!0;break}if(R.pts>N.pts){C--;continue}C===f.length-1&&(z=I),I--}if(!j&&z===null)return null;var Y;if(j?Y=I:Y=z,Y===0)return w;var J=w.slice(Y),Le=J.reduce(function(Je,Rt){return Je.byteLength+=Rt.byteLength,Je.duration+=Rt.duration,Je.nalCount+=Rt.nalCount,Je},{byteLength:0,duration:0,nalCount:0});return J.byteLength=Le.byteLength,J.duration=Le.duration,J.nalCount=Le.nalCount,J.pts=J[0].pts,J.dts=J[0].dts,J},this.alignGopsWith=function(w){f=w}},cn.prototype=new ln,Wt=function(s,l){this.numberOfTracks=0,this.metadataStream=l,s=s||{},typeof s.remux<"u"?this.remuxTracks=!!s.remux:this.remuxTracks=!0,typeof s.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=s.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Wt.prototype.init.call(this),this.push=function(c){if(c.content||c.text)return this.pendingCaptions.push(c);if(c.frames)return this.pendingMetadata.push(c);this.pendingTracks.push(c.track),this.pendingBytes+=c.boxes.byteLength,c.track.type==="video"&&(this.videoTrack=c.track,this.pendingBoxes.push(c.boxes)),c.track.type==="audio"&&(this.audioTrack=c.track,this.pendingBoxes.unshift(c.boxes))}},Wt.prototype=new ln,Wt.prototype.flush=function(s){var l=0,c={captions:[],captionStreams:{},metadata:[],info:{}},u,f,p,b=0,w;if(this.pendingTracks.length<this.numberOfTracks){if(s!=="VideoSegmentStream"&&s!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(b=this.videoTrack.timelineStartInfo.pts,ks.forEach(function(C){c.info[C]=this.videoTrack[C]},this)):this.audioTrack&&(b=this.audioTrack.timelineStartInfo.pts,Rs.forEach(function(C){c.info[C]=this.audioTrack[C]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?c.type=this.pendingTracks[0].type:c.type="combined",this.emittedTracks+=this.pendingTracks.length,p=_i.initSegment(this.pendingTracks),c.initSegment=new Uint8Array(p.byteLength),c.initSegment.set(p),c.data=new Uint8Array(this.pendingBytes),w=0;w<this.pendingBoxes.length;w++)c.data.set(this.pendingBoxes[w],l),l+=this.pendingBoxes[w].byteLength;for(w=0;w<this.pendingCaptions.length;w++)u=this.pendingCaptions[w],u.startTime=un.metadataTsToSeconds(u.startPts,b,this.keepOriginalTimestamps),u.endTime=un.metadataTsToSeconds(u.endPts,b,this.keepOriginalTimestamps),c.captionStreams[u.stream]=!0,c.captions.push(u);for(w=0;w<this.pendingMetadata.length;w++)f=this.pendingMetadata[w],f.cueTime=un.metadataTsToSeconds(f.pts,b,this.keepOriginalTimestamps),c.metadata.push(f);for(c.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",c),w=0;w<c.captions.length;w++)u=c.captions[w],this.trigger("caption",u);for(w=0;w<c.metadata.length;w++)f=c.metadata[w],this.trigger("id3Frame",f)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Wt.prototype.setRemux=function(s){this.remuxTracks=s},hn=function(s){var l=this,c=!0,u,f;hn.prototype.init.call(this),s=s||{},this.baseMediaDecodeTime=s.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var p={};this.transmuxPipeline_=p,p.type="aac",p.metadataStream=new Tt.MetadataStream,p.aacStream=new Bd,p.audioTimestampRolloverStream=new Tt.TimestampRolloverStream("audio"),p.timedMetadataTimestampRolloverStream=new Tt.TimestampRolloverStream("timed-metadata"),p.adtsStream=new Ms,p.coalesceStream=new Wt(s,p.metadataStream),p.headOfPipeline=p.aacStream,p.aacStream.pipe(p.audioTimestampRolloverStream).pipe(p.adtsStream),p.aacStream.pipe(p.timedMetadataTimestampRolloverStream).pipe(p.metadataStream).pipe(p.coalesceStream),p.metadataStream.on("timestamp",function(b){p.aacStream.setTimestamp(b.timeStamp)}),p.aacStream.on("data",function(b){b.type!=="timed-metadata"&&b.type!=="audio"||p.audioSegmentStream||(f=f||{timelineStartInfo:{baseMediaDecodeTime:l.baseMediaDecodeTime},codec:"adts",type:"audio"},p.coalesceStream.numberOfTracks++,p.audioSegmentStream=new bi(f,s),p.audioSegmentStream.on("log",l.getLogTrigger_("audioSegmentStream")),p.audioSegmentStream.on("timingInfo",l.trigger.bind(l,"audioTimingInfo")),p.adtsStream.pipe(p.audioSegmentStream).pipe(p.coalesceStream),l.trigger("trackinfo",{hasAudio:!!f,hasVideo:!!u}))}),p.coalesceStream.on("data",this.trigger.bind(this,"data")),p.coalesceStream.on("done",this.trigger.bind(this,"done")),Us(this,p)},this.setupTsPipeline=function(){var p={};this.transmuxPipeline_=p,p.type="ts",p.metadataStream=new Tt.MetadataStream,p.packetStream=new Tt.TransportPacketStream,p.parseStream=new Tt.TransportParseStream,p.elementaryStream=new Tt.ElementaryStream,p.timestampRolloverStream=new Tt.TimestampRolloverStream,p.adtsStream=new Ms,p.h264Stream=new Ud,p.captionStream=new Tt.CaptionStream(s),p.coalesceStream=new Wt(s,p.metadataStream),p.headOfPipeline=p.packetStream,p.packetStream.pipe(p.parseStream).pipe(p.elementaryStream).pipe(p.timestampRolloverStream),p.timestampRolloverStream.pipe(p.h264Stream),p.timestampRolloverStream.pipe(p.adtsStream),p.timestampRolloverStream.pipe(p.metadataStream).pipe(p.coalesceStream),p.h264Stream.pipe(p.captionStream).pipe(p.coalesceStream),p.elementaryStream.on("data",function(b){var w;if(b.type==="metadata"){for(w=b.tracks.length;w--;)!u&&b.tracks[w].type==="video"?(u=b.tracks[w],u.timelineStartInfo.baseMediaDecodeTime=l.baseMediaDecodeTime):!f&&b.tracks[w].type==="audio"&&(f=b.tracks[w],f.timelineStartInfo.baseMediaDecodeTime=l.baseMediaDecodeTime);u&&!p.videoSegmentStream&&(p.coalesceStream.numberOfTracks++,p.videoSegmentStream=new cn(u,s),p.videoSegmentStream.on("log",l.getLogTrigger_("videoSegmentStream")),p.videoSegmentStream.on("timelineStartInfo",function(C){f&&!s.keepOriginalTimestamps&&(f.timelineStartInfo=C,p.audioSegmentStream.setEarliestDts(C.dts-l.baseMediaDecodeTime))}),p.videoSegmentStream.on("processedGopsInfo",l.trigger.bind(l,"gopInfo")),p.videoSegmentStream.on("segmentTimingInfo",l.trigger.bind(l,"videoSegmentTimingInfo")),p.videoSegmentStream.on("baseMediaDecodeTime",function(C){f&&p.audioSegmentStream.setVideoBaseMediaDecodeTime(C)}),p.videoSegmentStream.on("timingInfo",l.trigger.bind(l,"videoTimingInfo")),p.h264Stream.pipe(p.videoSegmentStream).pipe(p.coalesceStream)),f&&!p.audioSegmentStream&&(p.coalesceStream.numberOfTracks++,p.audioSegmentStream=new bi(f,s),p.audioSegmentStream.on("log",l.getLogTrigger_("audioSegmentStream")),p.audioSegmentStream.on("timingInfo",l.trigger.bind(l,"audioTimingInfo")),p.audioSegmentStream.on("segmentTimingInfo",l.trigger.bind(l,"audioSegmentTimingInfo")),p.adtsStream.pipe(p.audioSegmentStream).pipe(p.coalesceStream)),l.trigger("trackinfo",{hasAudio:!!f,hasVideo:!!u})}}),p.coalesceStream.on("data",this.trigger.bind(this,"data")),p.coalesceStream.on("id3Frame",function(b){b.dispatchType=p.metadataStream.dispatchType,l.trigger("id3Frame",b)}),p.coalesceStream.on("caption",this.trigger.bind(this,"caption")),p.coalesceStream.on("done",this.trigger.bind(this,"done")),Us(this,p)},this.setBaseMediaDecodeTime=function(p){var b=this.transmuxPipeline_;s.keepOriginalTimestamps||(this.baseMediaDecodeTime=p),f&&(f.timelineStartInfo.dts=void 0,f.timelineStartInfo.pts=void 0,at.clearDtsInfo(f),b.audioTimestampRolloverStream&&b.audioTimestampRolloverStream.discontinuity()),u&&(b.videoSegmentStream&&(b.videoSegmentStream.gopCache_=[]),u.timelineStartInfo.dts=void 0,u.timelineStartInfo.pts=void 0,at.clearDtsInfo(u),b.captionStream.reset()),b.timestampRolloverStream&&b.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(p){f&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(p)},this.setRemux=function(p){var b=this.transmuxPipeline_;s.remux=p,b&&b.coalesceStream&&b.coalesceStream.setRemux(p)},this.alignGopsWith=function(p){u&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(p)},this.getLogTrigger_=function(p){var b=this;return function(w){w.stream=p,b.trigger("log",w)}},this.push=function(p){if(c){var b=Nd(p);b&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!b&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),c=!1}this.transmuxPipeline_.headOfPipeline.push(p)},this.flush=function(){c=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},hn.prototype=new ln;var jd={Transmuxer:hn},qd=function(s){return s>>>0},Wd=function(s){return("00"+s.toString(16)).slice(-2)},fn={toUnsigned:qd,toHexString:Wd},Vd=function(s){var l="";return l+=String.fromCharCode(s[0]),l+=String.fromCharCode(s[1]),l+=String.fromCharCode(s[2]),l+=String.fromCharCode(s[3]),l},Fs=Vd,Hd=fn.toUnsigned,Gd=Fs,$s=function(s,l){var c=[],u,f,p,b,w;if(!l.length)return null;for(u=0;u<s.byteLength;)f=Hd(s[u]<<24|s[u+1]<<16|s[u+2]<<8|s[u+3]),p=Gd(s.subarray(u+4,u+8)),b=f>1?u+f:s.byteLength,p===l[0]&&(l.length===1?c.push(s.subarray(u+8,b)):(w=$s(s.subarray(u+8,b),l.slice(1)),w.length&&(c=c.concat(w)))),u=b;return c},ir=$s,zd=fn.toUnsigned,Qd=a.getUint64,Yd=function(s){var l={version:s[0],flags:new Uint8Array(s.subarray(1,4))};return l.version===1?l.baseMediaDecodeTime=Qd(s.subarray(4)):l.baseMediaDecodeTime=zd(s[4]<<24|s[5]<<16|s[6]<<8|s[7]),l},nr=Yd,Xd=function(s){var l=new DataView(s.buffer,s.byteOffset,s.byteLength),c={version:s[0],flags:new Uint8Array(s.subarray(1,4)),trackId:l.getUint32(4)},u=c.flags[2]&1,f=c.flags[2]&2,p=c.flags[2]&8,b=c.flags[2]&16,w=c.flags[2]&32,C=c.flags[0]&65536,I=c.flags[0]&131072,R;return R=8,u&&(R+=4,c.baseDataOffset=l.getUint32(12),R+=4),f&&(c.sampleDescriptionIndex=l.getUint32(R),R+=4),p&&(c.defaultSampleDuration=l.getUint32(R),R+=4),b&&(c.defaultSampleSize=l.getUint32(R),R+=4),w&&(c.defaultSampleFlags=l.getUint32(R)),C&&(c.durationIsEmpty=!0),!u&&I&&(c.baseDataOffsetIsMoof=!0),c},js=Xd,Kd=function(s){return{isLeading:(s[0]&12)>>>2,dependsOn:s[0]&3,isDependedOn:(s[1]&192)>>>6,hasRedundancy:(s[1]&48)>>>4,paddingValue:(s[1]&14)>>>1,isNonSyncSample:s[1]&1,degradationPriority:s[2]<<8|s[3]}},Jd=Kd,qs=Jd,Zd=function(s){var l={version:s[0],flags:new Uint8Array(s.subarray(1,4)),samples:[]},c=new DataView(s.buffer,s.byteOffset,s.byteLength),u=l.flags[2]&1,f=l.flags[2]&4,p=l.flags[1]&1,b=l.flags[1]&2,w=l.flags[1]&4,C=l.flags[1]&8,I=c.getUint32(4),R=8,N;for(u&&(l.dataOffset=c.getInt32(R),R+=4),f&&I&&(N={flags:qs(s.subarray(R,R+4))},R+=4,p&&(N.duration=c.getUint32(R),R+=4),b&&(N.size=c.getUint32(R),R+=4),C&&(l.version===1?N.compositionTimeOffset=c.getInt32(R):N.compositionTimeOffset=c.getUint32(R),R+=4),l.samples.push(N),I--);I--;)N={},p&&(N.duration=c.getUint32(R),R+=4),b&&(N.size=c.getUint32(R),R+=4),w&&(N.flags=qs(s.subarray(R,R+4)),R+=4),C&&(l.version===1?N.compositionTimeOffset=c.getInt32(R):N.compositionTimeOffset=c.getUint32(R),R+=4),l.samples.push(N);return l},Ws=Zd,Vs={tfdt:nr,trun:Ws},Hs={parseTfdt:Vs.tfdt,parseTrun:Vs.trun},eu=function(s){for(var l=0,c=String.fromCharCode(s[l]),u="";c!=="\0";)u+=c,l++,c=String.fromCharCode(s[l]);return u+=c,u},tu={uint8ToCString:eu},mn=tu.uint8ToCString,iu=a.getUint64,nu=function(s){var l=4,c=s[0],u,f,p,b,w,C,I,R;if(c===0){u=mn(s.subarray(l)),l+=u.length,f=mn(s.subarray(l)),l+=f.length;var N=new DataView(s.buffer);p=N.getUint32(l),l+=4,w=N.getUint32(l),l+=4,C=N.getUint32(l),l+=4,I=N.getUint32(l),l+=4}else if(c===1){var N=new DataView(s.buffer);p=N.getUint32(l),l+=4,b=iu(s.subarray(l)),l+=8,C=N.getUint32(l),l+=4,I=N.getUint32(l),l+=4,u=mn(s.subarray(l)),l+=u.length,f=mn(s.subarray(l)),l+=f.length}R=new Uint8Array(s.subarray(l,s.byteLength));var z={scheme_id_uri:u,value:f,timescale:p||1,presentation_time:b,presentation_time_delta:w,event_duration:C,id:I,message_data:R};return su(c,z)?z:void 0},ru=function(s,l,c,u){return s||s===0?s/l:u+c/l},su=function(s,l){var c=l.scheme_id_uri!=="\0",u=s===0&&Gs(l.presentation_time_delta)&&c,f=s===1&&Gs(l.presentation_time)&&c;return!(s>1)&&u||f},Gs=function(s){return s!==void 0||s!==null},au={parseEmsgBox:nu,scaleTime:ru},Ti;typeof window<"u"?Ti=window:typeof n<"u"?Ti=n:typeof self<"u"?Ti=self:Ti={};var zs=Ti,pn=fn.toUnsigned,Si=fn.toHexString,Pe=ir,ti=Fs,rr=au,ou=js,lu=Ws,du=nr,uu=a.getUint64,Qs,Ys,Xs,Ks,Js,sr,Zs,ar=zs,cu=ws.parseId3Frames;Qs=function(s){var l={},c=Pe(s,["moov","trak"]);return c.reduce(function(u,f){var p,b,w,C,I;return p=Pe(f,["tkhd"])[0],!p||(b=p[0],w=b===0?12:20,C=pn(p[w]<<24|p[w+1]<<16|p[w+2]<<8|p[w+3]),I=Pe(f,["mdia","mdhd"])[0],!I)?null:(b=I[0],w=b===0?12:20,u[C]=pn(I[w]<<24|I[w+1]<<16|I[w+2]<<8|I[w+3]),u)},l)},Ys=function(s,l){var c;c=Pe(l,["moof","traf"]);var u=c.reduce(function(f,p){var b=Pe(p,["tfhd"])[0],w=pn(b[4]<<24|b[5]<<16|b[6]<<8|b[7]),C=s[w]||9e4,I=Pe(p,["tfdt"])[0],R=new DataView(I.buffer,I.byteOffset,I.byteLength),N;I[0]===1?N=uu(I.subarray(4,12)):N=R.getUint32(4);let z;return typeof N=="bigint"?z=N/ar.BigInt(C):typeof N=="number"&&!isNaN(N)&&(z=N/C),z<Number.MAX_SAFE_INTEGER&&(z=Number(z)),z<f&&(f=z),f},1/0);return typeof u=="bigint"||isFinite(u)?u:0},Xs=function(s,l){var c=Pe(l,["moof","traf"]),u=0,f=0,p;if(c&&c.length){var b=Pe(c[0],["tfhd"])[0],w=Pe(c[0],["trun"])[0],C=Pe(c[0],["tfdt"])[0];if(b){var I=ou(b);p=I.trackId}if(C){var R=du(C);u=R.baseMediaDecodeTime}if(w){var N=lu(w);N.samples&&N.samples.length&&(f=N.samples[0].compositionTimeOffset||0)}}var z=s[p]||9e4;typeof u=="bigint"&&(f=ar.BigInt(f),z=ar.BigInt(z));var j=(u+f)/z;return typeof j=="bigint"&&j<Number.MAX_SAFE_INTEGER&&(j=Number(j)),j},Ks=function(s){var l=Pe(s,["moov","trak"]),c=[];return l.forEach(function(u){var f=Pe(u,["mdia","hdlr"]),p=Pe(u,["tkhd"]);f.forEach(function(b,w){var C=ti(b.subarray(8,12)),I=p[w],R,N,z;C==="vide"&&(R=new DataView(I.buffer,I.byteOffset,I.byteLength),N=R.getUint8(0),z=N===0?R.getUint32(12):R.getUint32(20),c.push(z))})}),c},sr=function(s){var l=s[0],c=l===0?12:20;return pn(s[c]<<24|s[c+1]<<16|s[c+2]<<8|s[c+3])},Js=function(s){var l=Pe(s,["moov","trak"]),c=[];return l.forEach(function(u){var f={},p=Pe(u,["tkhd"])[0],b,w;p&&(b=new DataView(p.buffer,p.byteOffset,p.byteLength),w=b.getUint8(0),f.id=w===0?b.getUint32(12):b.getUint32(20));var C=Pe(u,["mdia","hdlr"])[0];if(C){var I=ti(C.subarray(8,12));I==="vide"?f.type="video":I==="soun"?f.type="audio":f.type=I}var R=Pe(u,["mdia","minf","stbl","stsd"])[0];if(R){var N=R.subarray(8);f.codec=ti(N.subarray(4,8));var z=Pe(N,[f.codec])[0],j,Y;z&&(/^[asm]vc[1-9]$/i.test(f.codec)?(j=z.subarray(78),Y=ti(j.subarray(4,8)),Y==="avcC"&&j.length>11?(f.codec+=".",f.codec+=Si(j[9]),f.codec+=Si(j[10]),f.codec+=Si(j[11])):f.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(f.codec)?(j=z.subarray(28),Y=ti(j.subarray(4,8)),Y==="esds"&&j.length>20&&j[19]!==0?(f.codec+="."+Si(j[19]),f.codec+="."+Si(j[20]>>>2&63).replace(/^0/,"")):f.codec="mp4a.40.2"):f.codec=f.codec.toLowerCase())}var J=Pe(u,["mdia","mdhd"])[0];J&&(f.timescale=sr(J)),c.push(f)}),c},Zs=function(s,l=0){var c=Pe(s,["emsg"]);return c.map(u=>{var f=rr.parseEmsgBox(new Uint8Array(u)),p=cu(f.message_data);return{cueTime:rr.scaleTime(f.presentation_time,f.timescale,f.presentation_time_delta,l),duration:rr.scaleTime(f.event_duration,f.timescale),frames:p}})};var wi={findBox:Pe,parseType:ti,timescale:Qs,startTime:Ys,compositionStartTime:Xs,videoTrackIds:Ks,tracks:Js,getTimescaleFromMediaHeader:sr,getEmsgID3:Zs};const{parseTrun:hu}=Hs,{findBox:ea}=wi;var ta=zs,fu=function(s){var l=ea(s,["moof","traf"]),c=ea(s,["mdat"]),u=[];return c.forEach(function(f,p){var b=l[p];u.push({mdat:f,traf:b})}),u},mu=function(s,l,c){var u=l,f=c.defaultSampleDuration||0,p=c.defaultSampleSize||0,b=c.trackId,w=[];return s.forEach(function(C){var I=hu(C),R=I.samples;R.forEach(function(N){N.duration===void 0&&(N.duration=f),N.size===void 0&&(N.size=p),N.trackId=b,N.dts=u,N.compositionTimeOffset===void 0&&(N.compositionTimeOffset=0),typeof u=="bigint"?(N.pts=u+ta.BigInt(N.compositionTimeOffset),u+=ta.BigInt(N.duration)):(N.pts=u+N.compositionTimeOffset,u+=N.duration)}),w=w.concat(R)}),w},ia={getMdatTrafPairs:fu,parseSamples:mu},pu=_s.discardEmulationPreventionBytes,gu=vs.CaptionStream,or=ir,yu=nr,_u=js,{getMdatTrafPairs:vu,parseSamples:bu}=ia,Tu=function(s,l){for(var c=s,u=0;u<l.length;u++){var f=l[u];if(c<f.size)return f;c-=f.size}return null},Su=function(s,l,c){var u=new DataView(s.buffer,s.byteOffset,s.byteLength),f={logs:[],seiNals:[]},p,b,w,C;for(b=0;b+4<s.length;b+=w)if(w=u.getUint32(b),b+=4,!(w<=0))switch(s[b]&31){case 6:var I=s.subarray(b+1,b+1+w),R=Tu(b,l);if(p={nalUnitType:"sei_rbsp",size:w,data:I,escapedRBSP:pu(I),trackId:c},R)p.pts=R.pts,p.dts=R.dts,C=R;else if(C)p.pts=C.pts,p.dts=C.dts;else{f.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+b+" for trackId "+c+". See mux.js#223."});break}f.seiNals.push(p);break}return f},wu=function(s,l){var c={},u=vu(s);return u.forEach(function(f){var p=f.mdat,b=f.traf,w=or(b,["tfhd"]),C=_u(w[0]),I=C.trackId,R=or(b,["tfdt"]),N=R.length>0?yu(R[0]).baseMediaDecodeTime:0,z=or(b,["trun"]),j,Y;l===I&&z.length>0&&(j=bu(z,N,C),Y=Su(p,j,I),c[I]||(c[I]={seiNals:[],logs:[]}),c[I].seiNals=c[I].seiNals.concat(Y.seiNals),c[I].logs=c[I].logs.concat(Y.logs))}),c},Eu=function(s,l,c){var u;if(l===null)return null;u=wu(s,l);var f=u[l]||{};return{seiNals:f.seiNals,logs:f.logs,timescale:c}},xu=function(){var s=!1,l,c,u,f,p,b;this.isInitialized=function(){return s},this.init=function(w){l=new gu,s=!0,b=w?w.isPartial:!1,l.on("data",function(C){C.startTime=C.startPts/f,C.endTime=C.endPts/f,p.captions.push(C),p.captionStreams[C.stream]=!0}),l.on("log",function(C){p.logs.push(C)})},this.isNewInit=function(w,C){return w&&w.length===0||C&&typeof C=="object"&&Object.keys(C).length===0?!1:u!==w[0]||f!==C[u]},this.parse=function(w,C,I){var R;if(this.isInitialized()){if(!C||!I)return null;if(this.isNewInit(C,I))u=C[0],f=I[u];else if(u===null||!f)return c.push(w),null}else return null;for(;c.length>0;){var N=c.shift();this.parse(N,C,I)}return R=Eu(w,u,f),R&&R.logs&&(p.logs=p.logs.concat(R.logs)),R===null||!R.seiNals?p.logs.length?{logs:p.logs,captions:[],captionStreams:[]}:null:(this.pushNals(R.seiNals),this.flushStream(),p)},this.pushNals=function(w){if(!this.isInitialized()||!w||w.length===0)return null;w.forEach(function(C){l.push(C)})},this.flushStream=function(){if(!this.isInitialized())return null;b?l.partialFlush():l.flush()},this.clearParsedCaptions=function(){p.captions=[],p.captionStreams={},p.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;l.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){c=[],u=null,f=null,p?this.clearParsedCaptions():p={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Pu=xu;const{parseTfdt:Cu}=Hs,Mt=ir,{getTimescaleFromMediaHeader:Iu}=wi,{parseSamples:Du,getMdatTrafPairs:Au}=ia;var na=function(){let s=9e4;this.init=function(l){const c=Mt(l,["moov","trak","mdia","mdhd"])[0];c&&(s=Iu(c))},this.parseSegment=function(l){const c=[],u=Au(l);let f=0;return u.forEach(function(p){const b=p.mdat,w=p.traf,C=Mt(w,["tfdt"])[0],I=Mt(w,["tfhd"])[0],R=Mt(w,["trun"]);if(C&&(f=Cu(C).baseMediaDecodeTime),R.length&&I){const N=Du(R,f,I);let z=0;N.forEach(function(j){const Y="utf-8",J=new TextDecoder(Y),Le=b.slice(z,z+j.size);if(Mt(Le,["vtte"])[0]){z+=j.size;return}Mt(Le,["vttc"]).forEach(function(Ei){const xi=Mt(Ei,["payl"])[0],Pi=Mt(Ei,["sttg"])[0],Ci=j.pts/s,_n=(j.pts+j.duration)/s;let ve,Ii;if(xi)try{ve=J.decode(xi)}catch(ot){console.error(ot)}if(Pi)try{Ii=J.decode(Pi)}catch(ot){console.error(ot)}j.duration&&ve&&c.push({cueText:ve,start:Ci,end:_n,settings:Ii})}),z+=j.size})}}),c}},lr=Ki,ra=function(s){var l=s[1]&31;return l<<=8,l|=s[2],l},gn=function(s){return!!(s[1]&64)},yn=function(s){var l=0;return(s[3]&48)>>>4>1&&(l+=s[4]+1),l},Ou=function(s,l){var c=ra(s);return c===0?"pat":c===l?"pmt":l?"pes":null},Lu=function(s){var l=gn(s),c=4+yn(s);return l&&(c+=s[c]+1),(s[c+10]&31)<<8|s[c+11]},Mu=function(s){var l={},c=gn(s),u=4+yn(s);if(c&&(u+=s[u]+1),!!(s[u+5]&1)){var f,p,b;f=(s[u+1]&15)<<8|s[u+2],p=3+f-4,b=(s[u+10]&15)<<8|s[u+11];for(var w=12+b;w<p;){var C=u+w;l[(s[C+1]&31)<<8|s[C+2]]=s[C],w+=((s[C+3]&15)<<8|s[C+4])+5}return l}},Ru=function(s,l){var c=ra(s),u=l[c];switch(u){case lr.H264_STREAM_TYPE:return"video";case lr.ADTS_STREAM_TYPE:return"audio";case lr.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},ku=function(s){var l=gn(s);if(!l)return null;var c=4+yn(s);if(c>=s.byteLength)return null;var u=null,f;return f=s[c+7],f&192&&(u={},u.pts=(s[c+9]&14)<<27|(s[c+10]&255)<<20|(s[c+11]&254)<<12|(s[c+12]&255)<<5|(s[c+13]&254)>>>3,u.pts*=4,u.pts+=(s[c+13]&6)>>>1,u.dts=u.pts,f&64&&(u.dts=(s[c+14]&14)<<27|(s[c+15]&255)<<20|(s[c+16]&254)<<12|(s[c+17]&255)<<5|(s[c+18]&254)>>>3,u.dts*=4,u.dts+=(s[c+18]&6)>>>1)),u},dr=function(s){switch(s){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Uu=function(s){for(var l=4+yn(s),c=s.subarray(l),u=0,f=0,p=!1,b;f<c.byteLength-3;f++)if(c[f+2]===1){u=f+5;break}for(;u<c.byteLength;)switch(c[u]){case 0:if(c[u-1]!==0){u+=2;break}else if(c[u-2]!==0){u++;break}f+3!==u-2&&(b=dr(c[f+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(p=!0));do u++;while(c[u]!==1&&u<c.length);f=u-2,u+=3;break;case 1:if(c[u-1]!==0||c[u-2]!==0){u+=3;break}b=dr(c[f+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(p=!0),f=u-2,u+=3;break;default:u+=3;break}return c=c.subarray(f),u-=f,f=0,c&&c.byteLength>3&&(b=dr(c[f+3]&31),b==="slice_layer_without_partitioning_rbsp_idr"&&(p=!0)),p},Bu={parseType:Ou,parsePat:Lu,parsePmt:Mu,parsePayloadUnitStartIndicator:gn,parsePesType:Ru,parsePesTime:ku,videoPacketContainsKeyFrame:Uu},sa=Ki,ii=Ts.handleRollover,ce={};ce.ts=Bu,ce.aac=tr;var Vt=_e.ONE_SECOND_IN_TS,je=188,ht=71,Nu=function(s,l){for(var c=0,u=je,f,p;u<s.byteLength;){if(s[c]===ht&&s[u]===ht){switch(f=s.subarray(c,u),p=ce.ts.parseType(f,l.pid),p){case"pat":l.pid=ce.ts.parsePat(f);break;case"pmt":var b=ce.ts.parsePmt(f);l.table=l.table||{},Object.keys(b).forEach(function(w){l.table[w]=b[w]});break}c+=je,u+=je;continue}c++,u++}},aa=function(s,l,c){for(var u=0,f=je,p,b,w,C,I,R=!1;f<=s.byteLength;){if(s[u]===ht&&(s[f]===ht||f===s.byteLength)){switch(p=s.subarray(u,f),b=ce.ts.parseType(p,l.pid),b){case"pes":w=ce.ts.parsePesType(p,l.table),C=ce.ts.parsePayloadUnitStartIndicator(p),w==="audio"&&C&&(I=ce.ts.parsePesTime(p),I&&(I.type="audio",c.audio.push(I),R=!0));break}if(R)break;u+=je,f+=je;continue}u++,f++}for(f=s.byteLength,u=f-je,R=!1;u>=0;){if(s[u]===ht&&(s[f]===ht||f===s.byteLength)){switch(p=s.subarray(u,f),b=ce.ts.parseType(p,l.pid),b){case"pes":w=ce.ts.parsePesType(p,l.table),C=ce.ts.parsePayloadUnitStartIndicator(p),w==="audio"&&C&&(I=ce.ts.parsePesTime(p),I&&(I.type="audio",c.audio.push(I),R=!0));break}if(R)break;u-=je,f-=je;continue}u--,f--}},Fu=function(s,l,c){for(var u=0,f=je,p,b,w,C,I,R,N,z,j=!1,Y={data:[],size:0};f<s.byteLength;){if(s[u]===ht&&s[f]===ht){switch(p=s.subarray(u,f),b=ce.ts.parseType(p,l.pid),b){case"pes":if(w=ce.ts.parsePesType(p,l.table),C=ce.ts.parsePayloadUnitStartIndicator(p),w==="video"&&(C&&!j&&(I=ce.ts.parsePesTime(p),I&&(I.type="video",c.video.push(I),j=!0)),!c.firstKeyFrame)){if(C&&Y.size!==0){for(R=new Uint8Array(Y.size),N=0;Y.data.length;)z=Y.data.shift(),R.set(z,N),N+=z.byteLength;if(ce.ts.videoPacketContainsKeyFrame(R)){var J=ce.ts.parsePesTime(R);J?(c.firstKeyFrame=J,c.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Y.size=0}Y.data.push(p),Y.size+=p.byteLength}break}if(j&&c.firstKeyFrame)break;u+=je,f+=je;continue}u++,f++}for(f=s.byteLength,u=f-je,j=!1;u>=0;){if(s[u]===ht&&s[f]===ht){switch(p=s.subarray(u,f),b=ce.ts.parseType(p,l.pid),b){case"pes":w=ce.ts.parsePesType(p,l.table),C=ce.ts.parsePayloadUnitStartIndicator(p),w==="video"&&C&&(I=ce.ts.parsePesTime(p),I&&(I.type="video",c.video.push(I),j=!0));break}if(j)break;u-=je,f-=je;continue}u--,f--}},$u=function(s,l){if(s.audio&&s.audio.length){var c=l;(typeof c>"u"||isNaN(c))&&(c=s.audio[0].dts),s.audio.forEach(function(p){p.dts=ii(p.dts,c),p.pts=ii(p.pts,c),p.dtsTime=p.dts/Vt,p.ptsTime=p.pts/Vt})}if(s.video&&s.video.length){var u=l;if((typeof u>"u"||isNaN(u))&&(u=s.video[0].dts),s.video.forEach(function(p){p.dts=ii(p.dts,u),p.pts=ii(p.pts,u),p.dtsTime=p.dts/Vt,p.ptsTime=p.pts/Vt}),s.firstKeyFrame){var f=s.firstKeyFrame;f.dts=ii(f.dts,u),f.pts=ii(f.pts,u),f.dtsTime=f.dts/Vt,f.ptsTime=f.pts/Vt}}},ju=function(s){for(var l=!1,c=0,u=null,f=null,p=0,b=0,w;s.length-b>=3;){var C=ce.aac.parseType(s,b);switch(C){case"timed-metadata":if(s.length-b<10){l=!0;break}if(p=ce.aac.parseId3TagSize(s,b),p>s.length){l=!0;break}f===null&&(w=s.subarray(b,b+p),f=ce.aac.parseAacTimestamp(w)),b+=p;break;case"audio":if(s.length-b<7){l=!0;break}if(p=ce.aac.parseAdtsSize(s,b),p>s.length){l=!0;break}u===null&&(w=s.subarray(b,b+p),u=ce.aac.parseSampleRate(w)),c++,b+=p;break;default:b++;break}if(l)return null}if(u===null||f===null)return null;var I=Vt/u,R={audio:[{type:"audio",dts:f,pts:f},{type:"audio",dts:f+c*1024*I,pts:f+c*1024*I}]};return R},qu=function(s){var l={pid:null,table:null},c={};Nu(s,l);for(var u in l.table)if(l.table.hasOwnProperty(u)){var f=l.table[u];switch(f){case sa.H264_STREAM_TYPE:c.video=[],Fu(s,l,c),c.video.length===0&&delete c.video;break;case sa.ADTS_STREAM_TYPE:c.audio=[],aa(s,l,c),c.audio.length===0&&delete c.audio;break}}return c},Wu=function(s,l){var c=ce.aac.isLikelyAacData(s),u;return c?u=ju(s):u=qu(s),!u||!u.audio&&!u.video?null:($u(u,l),u)},Vu={inspect:Wu,parseAudioPes_:aa};const Hu=function(s,l){l.on("data",function(c){const u=c.initSegment;c.initSegment={data:u.buffer,byteOffset:u.byteOffset,byteLength:u.byteLength};const f=c.data;c.data=f.buffer,s.postMessage({action:"data",segment:c,byteOffset:f.byteOffset,byteLength:f.byteLength},[c.data])}),l.on("done",function(c){s.postMessage({action:"done"})}),l.on("gopInfo",function(c){s.postMessage({action:"gopInfo",gopInfo:c})}),l.on("videoSegmentTimingInfo",function(c){const u={start:{decode:_e.videoTsToSeconds(c.start.dts),presentation:_e.videoTsToSeconds(c.start.pts)},end:{decode:_e.videoTsToSeconds(c.end.dts),presentation:_e.videoTsToSeconds(c.end.pts)},baseMediaDecodeTime:_e.videoTsToSeconds(c.baseMediaDecodeTime)};c.prependedContentDuration&&(u.prependedContentDuration=_e.videoTsToSeconds(c.prependedContentDuration)),s.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:u})}),l.on("audioSegmentTimingInfo",function(c){const u={start:{decode:_e.videoTsToSeconds(c.start.dts),presentation:_e.videoTsToSeconds(c.start.pts)},end:{decode:_e.videoTsToSeconds(c.end.dts),presentation:_e.videoTsToSeconds(c.end.pts)},baseMediaDecodeTime:_e.videoTsToSeconds(c.baseMediaDecodeTime)};c.prependedContentDuration&&(u.prependedContentDuration=_e.videoTsToSeconds(c.prependedContentDuration)),s.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:u})}),l.on("id3Frame",function(c){s.postMessage({action:"id3Frame",id3Frame:c})}),l.on("caption",function(c){s.postMessage({action:"caption",caption:c})}),l.on("trackinfo",function(c){s.postMessage({action:"trackinfo",trackInfo:c})}),l.on("audioTimingInfo",function(c){s.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:_e.videoTsToSeconds(c.start),end:_e.videoTsToSeconds(c.end)}})}),l.on("videoTimingInfo",function(c){s.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:_e.videoTsToSeconds(c.start),end:_e.videoTsToSeconds(c.end)}})}),l.on("log",function(c){s.postMessage({action:"log",log:c})})};class oa{constructor(l,c){this.options=c||{},this.self=l,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new jd.Transmuxer(this.options),Hu(this.self,this.transmuxer)}pushMp4Captions(l){this.captionParser||(this.captionParser=new Pu,this.captionParser.init());const c=new Uint8Array(l.data,l.byteOffset,l.byteLength),u=this.captionParser.parse(c,l.trackIds,l.timescales);this.self.postMessage({action:"mp4Captions",captions:u&&u.captions||[],logs:u&&u.logs||[],data:c.buffer},[c.buffer])}initMp4WebVttParser(l){this.webVttParser||(this.webVttParser=new na);const c=new Uint8Array(l.data,l.byteOffset,l.byteLength);this.webVttParser.init(c)}getMp4WebVttText(l){this.webVttParser||(this.webVttParser=new na);const c=new Uint8Array(l.data,l.byteOffset,l.byteLength),u=this.webVttParser.parseSegment(c);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:u||[],data:c.buffer},[c.buffer])}probeMp4StartTime({timescales:l,data:c}){const u=wi.startTime(l,c);this.self.postMessage({action:"probeMp4StartTime",startTime:u,data:c},[c.buffer])}probeMp4Tracks({data:l}){const c=wi.tracks(l);this.self.postMessage({action:"probeMp4Tracks",tracks:c,data:l},[l.buffer])}probeEmsgID3({data:l,offset:c}){const u=wi.getEmsgID3(l,c);this.self.postMessage({action:"probeEmsgID3",id3Frames:u,emsgData:l},[l.buffer])}probeTs({data:l,baseStartTime:c}){const u=typeof c=="number"&&!isNaN(c)?c*_e.ONE_SECOND_IN_TS:void 0,f=Vu.inspect(l,u);let p=null;f&&(p={hasVideo:f.video&&f.video.length===2||!1,hasAudio:f.audio&&f.audio.length===2||!1},p.hasVideo&&(p.videoStart=f.video[0].ptsTime),p.hasAudio&&(p.audioStart=f.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:p,data:l},[l.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(l){const c=new Uint8Array(l.data,l.byteOffset,l.byteLength);this.transmuxer.push(c)}reset(){this.transmuxer.reset()}setTimestampOffset(l){const c=l.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(_e.secondsToVideoTs(c)))}setAudioAppendStart(l){this.transmuxer.setAudioAppendStart(Math.ceil(_e.secondsToVideoTs(l.appendStart)))}setRemux(l){this.transmuxer.setRemux(l.remux)}flush(l){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(l){this.transmuxer.alignGopsWith(l.gopsToAlignWith.slice())}}self.onmessage=function(s){if(s.data.action==="init"&&s.data.options){this.messageHandlers=new oa(self,s.data.options);return}this.messageHandlers||(this.messageHandlers=new oa(self)),s.data&&s.data.action&&s.data.action!=="init"&&this.messageHandlers[s.data.action]&&this.messageHandlers[s.data.action](s.data)}}));var zm=al(Gm);const Qm=(n,e,t)=>{const{type:i,initSegment:r,captions:a,captionStreams:o,metadata:d,videoFrameDtsTime:m,videoFramePtsTime:h}=n.data.segment;e.buffer.push({captions:a,captionStreams:o,metadata:d});const g=n.data.segment.boxes||{data:n.data.segment.data},y={type:i,data:new Uint8Array(g.data,g.data.byteOffset,g.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};typeof m<"u"&&(y.videoFrameDtsTime=m),typeof h<"u"&&(y.videoFramePtsTime=h),t(y)},Ym=({transmuxedData:n,callback:e})=>{n.buffer=[],e(n)},Xm=(n,e)=>{e.gopInfo=n.data.gopInfo},dl=n=>{const{transmuxer:e,bytes:t,audioAppendStart:i,gopsToAlignWith:r,remux:a,onData:o,onTrackInfo:d,onAudioTimingInfo:m,onVideoTimingInfo:h,onVideoSegmentTimingInfo:g,onAudioSegmentTimingInfo:y,onId3:S,onCaptions:x,onDone:_,onEndedTimeline:T,onTransmuxerLog:v,isEndOfTimeline:E,segment:P,triggerSegmentEventFn:O}=n,A={buffer:[]};let k=E;const U=M=>{e.currentTransmux===n&&(M.data.action==="data"&&Qm(M,A,o),M.data.action==="trackinfo"&&d(M.data.trackInfo),M.data.action==="gopInfo"&&Xm(M,A),M.data.action==="audioTimingInfo"&&m(M.data.audioTimingInfo),M.data.action==="videoTimingInfo"&&h(M.data.videoTimingInfo),M.data.action==="videoSegmentTimingInfo"&&g(M.data.videoSegmentTimingInfo),M.data.action==="audioSegmentTimingInfo"&&y(M.data.audioSegmentTimingInfo),M.data.action==="id3Frame"&&S([M.data.id3Frame],M.data.id3Frame.dispatchType),M.data.action==="caption"&&x(M.data.caption),M.data.action==="endedtimeline"&&(k=!1,T()),M.data.action==="log"&&v(M.data.log),M.data.type==="transmuxed"&&(k||(e.onmessage=null,Ym({transmuxedData:A,callback:_}),ul(e))))},L=()=>{const M={message:"Received an error message from the transmuxer worker",metadata:{errorType:H.Error.StreamingFailedToTransmuxSegment,segmentInfo:Yt({segment:P})}};_(null,M)};if(e.onmessage=U,e.onerror=L,i&&e.postMessage({action:"setAudioAppendStart",appendStart:i}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof a<"u"&&e.postMessage({action:"setRemux",remux:a}),t.byteLength){const M=t instanceof ArrayBuffer?t:t.buffer,B=t instanceof ArrayBuffer?0:t.byteOffset;O({type:"segmenttransmuxingstart",segment:P}),e.postMessage({action:"push",data:M,byteOffset:B,byteLength:t.byteLength},[M])}E&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},ul=n=>{n.currentTransmux=null,n.transmuxQueue.length&&(n.currentTransmux=n.transmuxQueue.shift(),typeof n.currentTransmux=="function"?n.currentTransmux():dl(n.currentTransmux))},va=(n,e)=>{n.postMessage({action:e}),ul(n)},cl=(n,e)=>{if(!e.currentTransmux){e.currentTransmux=n,va(e,n);return}e.transmuxQueue.push(va.bind(null,e,n))},Km=n=>{cl("reset",n)},Jm=n=>{cl("endTimeline",n)},hl=n=>{if(!n.transmuxer.currentTransmux){n.transmuxer.currentTransmux=n,dl(n);return}n.transmuxer.transmuxQueue.push(n)},Zm=n=>{const e=new zm;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:n}),e};var yr={reset:Km,endTimeline:Jm,transmux:hl,createTransmuxer:Zm};const oi=function(n){const e=n.transmuxer,t=n.endAction||n.action,i=n.callback,r=ze({},n,{endAction:null,transmuxer:null,callback:null}),a=o=>{o.data.action===t&&(e.removeEventListener("message",a),o.data.data&&(o.data.data=new Uint8Array(o.data.data,n.byteOffset||0,n.byteLength||o.data.data.byteLength),n.data&&(n.data=o.data.data)),i(o.data))};if(e.addEventListener("message",a),n.data){const o=n.data instanceof ArrayBuffer;r.byteOffset=o?0:n.data.byteOffset,r.byteLength=n.data.byteLength;const d=[o?n.data:n.data.buffer];e.postMessage(r,d)}else e.postMessage(r)},gt={FAILURE:2,TIMEOUT:-101,ABORTED:-102},fl="wvtt",Wr=n=>{n.forEach(e=>{e.abort()})},ep=n=>({bandwidth:n.bandwidth,bytesReceived:n.bytesReceived||0,roundTripTime:n.roundTripTime||0}),tp=n=>{const e=n.target,i={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return i.bytesReceived=n.loaded,i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3),i},ls=(n,e)=>{const{requestType:t}=e,i=Zt({requestType:t,request:e,error:n});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:gt.TIMEOUT,xhr:e,metadata:i}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:gt.ABORTED,xhr:e,metadata:i}:n?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:gt.FAILURE,xhr:e,metadata:i}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:gt.FAILURE,xhr:e,metadata:i}:null},ba=(n,e,t,i)=>(r,a)=>{const o=a.response,d=ls(r,a);if(d)return t(d,n);if(o.byteLength!==16)return t({status:a.status,message:"Invalid HLS key at URL: "+a.uri,code:gt.FAILURE,xhr:a},n);const m=new DataView(o),h=new Uint32Array([m.getUint32(0),m.getUint32(4),m.getUint32(8),m.getUint32(12)]);for(let y=0;y<e.length;y++)e[y].bytes=h;const g={uri:a.uri};return i({type:"segmentkeyloadcomplete",segment:n,keyInfo:g}),t(null,n)},ip=(n,e)=>{e===fl&&n.transmuxer.postMessage({action:"initMp4WebVttParser",data:n.map.bytes})},np=(n,e,t)=>{e===fl&&oi({action:"getMp4WebVttText",data:n.bytes,transmuxer:n.transmuxer,callback:({data:i,mp4VttCues:r})=>{n.bytes=i,t(null,n,{mp4VttCues:r})}})},ml=(n,e)=>{const t=ts(n.map.bytes);if(t!=="mp4"){const i=n.map.resolvedUri||n.map.uri,r=t||"unknown";return e({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${i}`,code:gt.FAILURE,metadata:{mediaType:r}})}oi({action:"probeMp4Tracks",data:n.map.bytes,transmuxer:n.transmuxer,callback:({tracks:i,data:r})=>(n.map.bytes=r,i.forEach(function(a){n.map.tracks=n.map.tracks||{},!n.map.tracks[a.type]&&(n.map.tracks[a.type]=a,typeof a.id=="number"&&a.timescale&&(n.map.timescales=n.map.timescales||{},n.map.timescales[a.id]=a.timescale),a.type==="text"&&ip(n,a.codec))}),e(null))})},rp=({segment:n,finishProcessingFn:e,triggerSegmentEventFn:t})=>(i,r)=>{const a=ls(i,r);if(a)return e(a,n);const o=new Uint8Array(r.response);if(t({type:"segmentloaded",segment:n}),n.map.key)return n.map.encryptedBytes=o,e(null,n);n.map.bytes=o,ml(n,function(d){if(d)return d.xhr=r,d.status=r.status,e(d,n);e(null,n)})},sp=({segment:n,finishProcessingFn:e,responseType:t,triggerSegmentEventFn:i})=>(r,a)=>{const o=ls(r,a);if(o)return e(o,n);i({type:"segmentloaded",segment:n});const d=t==="arraybuffer"||!a.responseText?a.response:Vm(a.responseText.substring(n.lastReachedChar||0));return n.stats=ep(a),n.key?n.encryptedBytes=new Uint8Array(d):n.bytes=new Uint8Array(d),e(null,n)},ap=({segment:n,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})=>{const _=n.map&&n.map.tracks||{},T=!!(_.audio&&_.video);let v=i.bind(null,n,"audio","start");const E=i.bind(null,n,"audio","end");let P=i.bind(null,n,"video","start");const O=i.bind(null,n,"video","end"),A=()=>hl({bytes:e,transmuxer:n.transmuxer,audioAppendStart:n.audioAppendStart,gopsToAlignWith:n.gopsToAlignWith,remux:T,onData:k=>{k.type=k.type==="combined"?"video":k.type,g(n,k)},onTrackInfo:k=>{t&&(T&&(k.isMuxed=!0),t(n,k))},onAudioTimingInfo:k=>{v&&typeof k.start<"u"&&(v(k.start),v=null),E&&typeof k.end<"u"&&E(k.end)},onVideoTimingInfo:k=>{P&&typeof k.start<"u"&&(P(k.start),P=null),O&&typeof k.end<"u"&&O(k.end)},onVideoSegmentTimingInfo:k=>{const U={pts:{start:k.start.presentation,end:k.end.presentation},dts:{start:k.start.decode,end:k.end.decode}};x({type:"segmenttransmuxingtiminginfoavailable",segment:n,timingInfo:U}),r(k)},onAudioSegmentTimingInfo:k=>{const U={pts:{start:k.start.pts,end:k.end.pts},dts:{start:k.start.dts,end:k.end.dts}};x({type:"segmenttransmuxingtiminginfoavailable",segment:n,timingInfo:U}),a(k)},onId3:(k,U)=>{o(n,k,U)},onCaptions:k=>{d(n,[k])},isEndOfTimeline:m,onEndedTimeline:()=>{h()},onTransmuxerLog:S,onDone:(k,U)=>{y&&(k.type=k.type==="combined"?"video":k.type,x({type:"segmenttransmuxingcomplete",segment:n}),y(U,n,k))},segment:n,triggerSegmentEventFn:x});oi({action:"probeTs",transmuxer:n.transmuxer,data:e,baseStartTime:n.baseStartTime,callback:k=>{n.bytes=e=k.data;const U=k.result;U&&(t(n,{hasAudio:U.hasAudio,hasVideo:U.hasVideo,isMuxed:T}),t=null),A()}})},pl=({segment:n,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})=>{let _=new Uint8Array(e);if(qc(_)){n.isFmp4=!0;const{tracks:T}=n.map;if(T.text&&(!T.audio||!T.video)){g(n,{data:_,type:"text"}),np(n,T.text.codec,y);return}const E={isFmp4:!0,hasVideo:!!T.video,hasAudio:!!T.audio};T.audio&&T.audio.codec&&T.audio.codec!=="enca"&&(E.audioCodec=T.audio.codec),T.video&&T.video.codec&&T.video.codec!=="encv"&&(E.videoCodec=T.video.codec),T.video&&T.audio&&(E.isMuxed=!0),t(n,E);const P=(O,A)=>{g(n,{data:_,type:E.hasAudio&&!E.isMuxed?"audio":"video"}),A&&A.length&&o(n,A),O&&O.length&&d(n,O),y(null,n,{})};oi({action:"probeMp4StartTime",timescales:n.map.timescales,data:_,transmuxer:n.transmuxer,callback:({data:O,startTime:A})=>{e=O.buffer,n.bytes=_=O,E.hasAudio&&!E.isMuxed&&i(n,"audio","start",A),E.hasVideo&&i(n,"video","start",A),oi({action:"probeEmsgID3",data:_,transmuxer:n.transmuxer,offset:A,callback:({emsgData:k,id3Frames:U})=>{if(e=k.buffer,n.bytes=_=k,!T.video||!k.byteLength||!n.transmuxer){P(void 0,U);return}oi({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:n.transmuxer,data:_,timescales:n.map.timescales,trackIds:[T.video.id],callback:L=>{e=L.data.buffer,n.bytes=_=L.data,L.logs.forEach(function(M){S(de(M,{stream:"mp4CaptionParser"}))}),P(L.captions,U)}})}})}});return}if(!n.transmuxer){y(null,n,{});return}if(typeof n.container>"u"&&(n.container=ts(_)),n.container!=="ts"&&n.container!=="aac"){t(n,{hasAudio:!1,hasVideo:!1}),y(null,n,{});return}ap({segment:n,bytes:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})},gl=function({id:n,key:e,encryptedBytes:t,decryptionWorker:i,segment:r,doneFn:a},o){const d=h=>{if(h.data.source===n){i.removeEventListener("message",d);const g=h.data.decrypted;o(new Uint8Array(g.bytes,g.byteOffset,g.byteLength))}};i.onerror=()=>{const h="An error occurred in the decryption worker",g=Yt({segment:r}),y={message:h,metadata:{error:new Error(h),errorType:H.Error.StreamingFailedToDecryptSegment,segmentInfo:g,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};a(y,r)},i.addEventListener("message",d);let m;e.bytes.slice?m=e.bytes.slice():m=new Uint32Array(Array.prototype.slice.call(e.bytes)),i.postMessage(el({source:n,encrypted:t,key:m,iv:e.iv}),[t.buffer,m.buffer])},op=({decryptionWorker:n,segment:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})=>{x({type:"segmentdecryptionstart"}),gl({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:n,segment:e,doneFn:y},_=>{e.bytes=_,x({type:"segmentdecryptioncomplete",segment:e}),pl({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})})},lp=({activeXhrs:n,decryptionWorker:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})=>{let _=0,T=!1;return(v,E)=>{if(!T){if(v)return T=!0,Wr(n),y(v,E);if(_+=1,_===n.length){const P=function(){if(E.encryptedBytes)return op({decryptionWorker:e,segment:E,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x});pl({segment:E,bytes:E.bytes,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g,doneFn:y,onTransmuxerLog:S,triggerSegmentEventFn:x})};if(E.endOfAllRequests=Date.now(),E.map&&E.map.encryptedBytes&&!E.map.bytes)return x({type:"segmentdecryptionstart",segment:E}),gl({decryptionWorker:e,id:E.requestId+"-init",encryptedBytes:E.map.encryptedBytes,key:E.map.key,segment:E,doneFn:y},O=>{E.map.bytes=O,x({type:"segmentdecryptioncomplete",segment:E}),ml(E,A=>{if(A)return Wr(n),y(A,E);P()})});P()}}}},dp=({loadendState:n,abortFn:e})=>t=>{t.target.aborted&&e&&!n.calledAbortFn&&(e(),n.calledAbortFn=!0)},up=({segment:n,progressFn:e,trackInfoFn:t,timingInfoFn:i,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:a,id3Fn:o,captionsFn:d,isEndOfTimeline:m,endedTimelineFn:h,dataFn:g})=>y=>{if(!y.target.aborted)return n.stats=de(n.stats,tp(y)),!n.stats.firstBytesReceivedAt&&n.stats.bytesReceived&&(n.stats.firstBytesReceivedAt=Date.now()),e(y,n)},cp=({xhr:n,xhrOptions:e,decryptionWorker:t,segment:i,abortFn:r,progressFn:a,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:h,id3Fn:g,captionsFn:y,isEndOfTimeline:S,endedTimelineFn:x,dataFn:_,doneFn:T,onTransmuxerLog:v,triggerSegmentEventFn:E})=>{const P=[],O=lp({activeXhrs:P,decryptionWorker:t,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:h,id3Fn:g,captionsFn:y,isEndOfTimeline:S,endedTimelineFn:x,dataFn:_,doneFn:T,onTransmuxerLog:v,triggerSegmentEventFn:E});if(i.key&&!i.key.bytes){const M=[i.key];i.map&&!i.map.bytes&&i.map.key&&i.map.key.resolvedUri===i.key.resolvedUri&&M.push(i.map.key);const B=de(e,{uri:i.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),$=ba(i,M,O,E),q={uri:i.key.resolvedUri};E({type:"segmentkeyloadstart",segment:i,keyInfo:q});const V=n(B,$);P.push(V)}if(i.map&&!i.map.bytes){if(i.map.key&&(!i.key||i.key.resolvedUri!==i.map.key.resolvedUri)){const V=de(e,{uri:i.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),F=ba(i,[i.map.key],O,E),Q={uri:i.map.key.resolvedUri};E({type:"segmentkeyloadstart",segment:i,keyInfo:Q});const K=n(V,F);P.push(K)}const B=de(e,{uri:i.map.resolvedUri,responseType:"arraybuffer",headers:jr(i.map),requestType:"segment-media-initialization"}),$=rp({segment:i,finishProcessingFn:O,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:i});const q=n(B,$);P.push(q)}const A=de(e,{uri:i.part&&i.part.resolvedUri||i.resolvedUri,responseType:"arraybuffer",headers:jr(i),requestType:"segment"}),k=sp({segment:i,finishProcessingFn:O,responseType:A.responseType,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:i});const U=n(A,k);U.addEventListener("progress",up({segment:i,progressFn:a,trackInfoFn:o,timingInfoFn:d,videoSegmentTimingInfoFn:m,audioSegmentTimingInfoFn:h,id3Fn:g,captionsFn:y,isEndOfTimeline:S,endedTimelineFn:x,dataFn:_})),P.push(U);const L={};return P.forEach(M=>{M.addEventListener("loadend",dp({loadendState:L,abortFn:r}))}),()=>Wr(P)},Sn=nt("PlaylistSelector"),Ta=function(n){if(!n||!n.playlist)return;const e=n.playlist;return JSON.stringify({id:e.id,bandwidth:n.bandwidth,width:n.width,height:n.height,codecs:e.attributes&&e.attributes.CODECS||""})},li=function(n,e){if(!n)return"";const t=W.getComputedStyle(n);return t?t[e]:""},di=function(n,e){const t=n.slice();n.sort(function(i,r){const a=e(i,r);return a===0?t.indexOf(i)-t.indexOf(r):a})},ds=function(n,e){let t,i;return n.attributes.BANDWIDTH&&(t=n.attributes.BANDWIDTH),t=t||W.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(i=e.attributes.BANDWIDTH),i=i||W.Number.MAX_VALUE,t-i},hp=function(n,e){let t,i;return n.attributes.RESOLUTION&&n.attributes.RESOLUTION.width&&(t=n.attributes.RESOLUTION.width),t=t||W.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(i=e.attributes.RESOLUTION.width),i=i||W.Number.MAX_VALUE,t===i&&n.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?n.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-i};let yl=function(n){const{main:e,bandwidth:t,playerWidth:i,playerHeight:r,playerObjectFit:a,limitRenditionByPlayerDimensions:o,playlistController:d}=n;if(!e)return;const m={bandwidth:t,width:i,height:r,limitRenditionByPlayerDimensions:o};let h=e.playlists;Ke.isAudioOnly(e)&&(h=d.getAudioTrackPlaylists_(),m.audioOnly=!0);let g=h.map(L=>{let M;const B=L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.width,$=L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.height;return M=L.attributes&&L.attributes.BANDWIDTH,M=M||W.Number.MAX_VALUE,{bandwidth:M,width:B,height:$,playlist:L}});di(g,(L,M)=>L.bandwidth-M.bandwidth),g=g.filter(L=>!Ke.isIncompatible(L.playlist));let y=g.filter(L=>Ke.isEnabled(L.playlist));y.length||(y=g.filter(L=>!Ke.isDisabled(L.playlist)));const S=y.filter(L=>L.bandwidth*Me.BANDWIDTH_VARIANCE<t);let x=S[S.length-1];const _=S.filter(L=>L.bandwidth===x.bandwidth)[0];if(o===!1){const L=_||y[0]||g[0];if(L&&L.playlist){let M="sortedPlaylistReps";return _&&(M="bandwidthBestRep"),y[0]&&(M="enabledPlaylistReps"),Sn(`choosing ${Ta(L)} using ${M} with options`,m),L.playlist}return Sn("could not choose a playlist with options",m),null}const T=S.filter(L=>L.width&&L.height);di(T,(L,M)=>L.width-M.width);const v=T.filter(L=>L.width===i&&L.height===r);x=v[v.length-1];const E=v.filter(L=>L.bandwidth===x.bandwidth)[0];let P,O,A;E||(P=T.filter(L=>a==="cover"?L.width>i&&L.height>r:L.width>i||L.height>r),O=P.filter(L=>L.width===P[0].width&&L.height===P[0].height),x=O[O.length-1],A=O.filter(L=>L.bandwidth===x.bandwidth)[0]);let k;if(d.leastPixelDiffSelector){const L=T.map(M=>(M.pixelDiff=Math.abs(M.width-i)+Math.abs(M.height-r),M));di(L,(M,B)=>M.pixelDiff===B.pixelDiff?B.bandwidth-M.bandwidth:M.pixelDiff-B.pixelDiff),k=L[0]}const U=k||A||E||_||y[0]||g[0];if(U&&U.playlist){let L="sortedPlaylistReps";return k?L="leastPixelDiffRep":A?L="resolutionPlusOneRep":E?L="resolutionBestRep":_?L="bandwidthBestRep":y[0]&&(L="enabledPlaylistReps"),Sn(`choosing ${Ta(U)} using ${L} with options`,m),U.playlist}return Sn("could not choose a playlist with options",m),null};const Sa=function(){let n=this.useDevicePixelRatio&&W.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),yl({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(li(this.tech_.el(),"width"),10)*n,playerHeight:parseInt(li(this.tech_.el(),"height"),10)*n,playerObjectFit:this.usePlayerObjectFit?li(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},fp=function(n){let e=-1,t=-1;if(n<0||n>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let i=this.useDevicePixelRatio&&W.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=n*this.systemBandwidth+(1-n)*e,t=this.systemBandwidth),yl({main:this.playlists.main,bandwidth:e,playerWidth:parseInt(li(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(li(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?li(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},mp=function(n){const{main:e,currentTime:t,bandwidth:i,duration:r,segmentDuration:a,timeUntilRebuffer:o,currentTimeline:d,syncController:m}=n,h=e.playlists.filter(_=>!Ke.isIncompatible(_));let g=h.filter(Ke.isEnabled);g.length||(g=h.filter(_=>!Ke.isDisabled(_)));const S=g.filter(Ke.hasAttribute.bind(null,"BANDWIDTH")).map(_=>{const v=m.getSyncPoint(_,r,d,t)?1:2,P=Ke.estimateSegmentRequestTime(a,i,_)*v-o;return{playlist:_,rebufferingImpact:P}}),x=S.filter(_=>_.rebufferingImpact<=0);return di(x,(_,T)=>ds(T.playlist,_.playlist)),x.length?x[0]:(di(S,(_,T)=>_.rebufferingImpact-T.rebufferingImpact),S[0]||null)},pp=function(){const n=this.playlists.main.playlists.filter(Ke.isEnabled);return di(n,(t,i)=>ds(t,i)),n.filter(t=>!!Fi(this.playlists.main,t).video)[0]||null},gp=n=>{let e=0,t;return n.bytes&&(t=new Uint8Array(n.bytes),n.segments.forEach(i=>{t.set(i,e),e+=i.byteLength})),t};function _l(n){try{return new URL(n).pathname.split("/").slice(-2).join("/")}catch{return""}}const yp=function(n,e,t){if(!n[t]){e.trigger({type:"usage",name:"vhs-608"});let i=t;/^cc708_/.test(t)&&(i="SERVICE"+t.split("_")[1]);const r=e.textTracks().getTrackById(i);if(r)n[t]=r;else{const a=e.options_.vhs&&e.options_.vhs.captionServices||{};let o=t,d=t,m=!1;const h=a[i];h&&(o=h.label,d=h.language,m=h.default),n[t]=e.addRemoteTextTrack({kind:"captions",id:i,default:m,label:o,language:d},!1).track}}},_p=function({inbandTextTracks:n,captionArray:e,timestampOffset:t}){if(!e)return;const i=W.WebKitDataCue||W.VTTCue;e.forEach(r=>{const a=r.stream;r.content?r.content.forEach(o=>{const d=new i(r.startTime+t,r.endTime+t,o.text);d.line=o.line,d.align="left",d.position=o.position,d.positionAlign="line-left",n[a].addCue(d)}):n[a].addCue(new i(r.startTime+t,r.endTime+t,r.text))})},vp=function(n){Object.defineProperties(n.frame,{id:{get(){return H.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),n.value.key}},value:{get(){return H.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),n.value.data}},privateData:{get(){return H.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),n.value.data}}})},bp=({inbandTextTracks:n,metadataArray:e,timestampOffset:t,videoDuration:i})=>{if(!e)return;const r=W.WebKitDataCue||W.VTTCue,a=n.metadataTrack_;if(!a||(e.forEach(g=>{const y=g.cueTime+t;typeof y!="number"||W.isNaN(y)||y<0||!(y<1/0)||!g.frames||!g.frames.length||g.frames.forEach(S=>{const x=new r(y,y,S.value||S.url||S.data||"");x.frame=S,x.value=S,vp(x),a.addCue(x)})}),!a.cues||!a.cues.length))return;const o=a.cues,d=[];for(let g=0;g<o.length;g++)o[g]&&d.push(o[g]);const m=d.reduce((g,y)=>{const S=g[y.startTime]||[];return S.push(y),g[y.startTime]=S,g},{}),h=Object.keys(m).sort((g,y)=>Number(g)-Number(y));h.forEach((g,y)=>{const S=m[g],x=isFinite(i)?i:g,_=Number(h[y+1])||x;S.forEach(T=>{T.endTime=_})})},Tp={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},Sp=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),wp=({inbandTextTracks:n,dateRanges:e})=>{const t=n.metadataTrack_;if(!t)return;const i=W.WebKitDataCue||W.VTTCue;e.forEach(r=>{for(const a of Object.keys(r)){if(Sp.has(a))continue;const o=new i(r.startTime,r.endTime,"");o.id=r.id,o.type="com.apple.quicktime.HLS",o.value={key:Tp[a],data:r[a]},(a==="scte35Out"||a==="scte35In")&&(o.value.data=new Uint8Array(o.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(o)}r.processDateRange()})},wa=(n,e,t)=>{n.metadataTrack_||(n.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,H.browser.IS_ANY_SAFARI||(n.metadataTrack_.inBandMetadataTrackDispatchType=e))},Ui=function(n,e,t){let i,r;if(t&&t.cues)for(i=t.cues.length;i--;)r=t.cues[i],r.startTime>=n&&r.endTime<=e&&t.removeCue(r)},Ep=function(n){const e=n.cues;if(!e)return;const t={};for(let i=e.length-1;i>=0;i--){const r=e[i],a=`${r.startTime}-${r.endTime}-${r.text}`;t[a]?n.removeCue(r):t[a]=r}},xp=(n,e,t)=>{if(typeof e>"u"||e===null||!n.length)return[];const i=Math.ceil((e-t+3)*Kt.ONE_SECOND_IN_TS);let r;for(r=0;r<n.length&&!(n[r].pts>i);r++);return n.slice(r)},Pp=(n,e,t)=>{if(!e.length)return n;if(t)return e.slice();const i=e[0].pts;let r=0;for(r;r<n.length&&!(n[r].pts>=i);r++);return n.slice(0,r).concat(e)},Cp=(n,e,t,i)=>{const r=Math.ceil((e-i)*Kt.ONE_SECOND_IN_TS),a=Math.ceil((t-i)*Kt.ONE_SECOND_IN_TS),o=n.slice();let d=n.length;for(;d--&&!(n[d].pts<=a););if(d===-1)return o;let m=d+1;for(;m--&&!(n[m].pts<=r););return m=Math.max(m,0),o.splice(m,d-m+1),o},Ip=function(n,e){if(!n&&!e||!n&&e||n&&!e)return!1;if(n===e)return!0;const t=Object.keys(n).sort(),i=Object.keys(e).sort();if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++){const a=t[r];if(a!==i[r]||n[a]!==e[a])return!1}return!0},Dp=function(n,e,t){e=e||[];const i=[];let r=0;for(let a=0;a<e.length;a++){const o=e[a];if(n===o.timeline&&(i.push(a),r+=o.duration,r>t))return a}return i.length===0?0:i[i.length-1]},Li=1,Ap=500,Ea=n=>typeof n=="number"&&isFinite(n),wn=1/60,Op=(n,e,t)=>n!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,Lp=(n,e,t)=>{let i=e-Me.BACK_BUFFER_LENGTH;n.length&&(i=Math.max(i,n.start(0)));const r=e-t;return Math.min(r,i)},ni=n=>{const{startOfSegment:e,duration:t,segment:i,part:r,playlist:{mediaSequence:a,id:o,segments:d=[]},mediaIndex:m,partIndex:h,timeline:g}=n,y=d.length-1;let S="mediaIndex/partIndex increment";n.getMediaInfoForTime?S=`getMediaInfoForTime (${n.getMediaInfoForTime})`:n.isSyncRequest&&(S="getSyncSegmentCandidate (isSyncRequest)"),n.independent&&(S+=` with independent ${n.independent}`);const x=typeof h=="number",_=n.segment.uri?"segment":"pre-segment",T=x?Uo({preloadSegment:i})-1:0;return`${_} [${a+m}/${a+y}]`+(x?` part [${h}/${T}]`:"")+` segment start/end [${i.start} => ${i.end}]`+(x?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${g}] selected by [${S}] playlist [${o}]`},xa=n=>`${n}TimingInfo`,Mp=({segmentTimeline:n,currentTimeline:e,startOfSegment:t,buffered:i,overrideCheck:r})=>!r&&n===e?null:n<e?t:i.length?i.end(i.length-1):t,Vr=({timelineChangeController:n,currentTimeline:e,segmentTimeline:t,loaderType:i,audioDisabled:r})=>{if(e===t)return!1;if(i==="audio"){const a=n.lastTimelineChange({type:"main"});return!a||a.to!==t}if(i==="main"&&r){const a=n.pendingTimelineChange({type:"audio"});return!(a&&a.to===t)}return!1},Rp=n=>{if(!n)return!1;const e=n.pendingTimelineChange({type:"audio"}),t=n.pendingTimelineChange({type:"main"}),i=e&&t,r=i&&e.to!==t.to;return!!(i&&e.from!==-1&&t.from!==-1&&r)},kp=n=>{const e=n.timelineChangeController_.pendingTimelineChange({type:"audio"}),t=n.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&t&&e.to<t.to},kt=n=>{const e=n.pendingSegment_;if(!e)return;if(Vr({timelineChangeController:n.timelineChangeController_,currentTimeline:n.currentTimeline_,segmentTimeline:e.timeline,loaderType:n.loaderType_,audioDisabled:n.audioDisabled_})&&Rp(n.timelineChangeController_)){if(kp(n)){n.timelineChangeController_.trigger("audioTimelineBehind");return}n.timelineChangeController_.trigger("fixBadTimelineChange")}},Up=n=>{let e=0;return["video","audio"].forEach(function(t){const i=n[`${t}TimingInfo`];if(!i)return;const{start:r,end:a}=i;let o;typeof r=="bigint"||typeof a=="bigint"?o=W.BigInt(a)-W.BigInt(r):typeof r=="number"&&typeof a=="number"&&(o=a-r),typeof o<"u"&&o>e&&(e=o)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},Pa=({segmentDuration:n,maxDuration:e})=>n?Math.round(n)>e+mt:!1,Bp=(n,e)=>{if(e!=="hls")return null;const t=Up({audioTimingInfo:n.audioTimingInfo,videoTimingInfo:n.videoTimingInfo});if(!t)return null;const i=n.playlist.targetDuration,r=Pa({segmentDuration:t,maxDuration:i*2}),a=Pa({segmentDuration:t,maxDuration:i}),o=`Segment with index ${n.mediaIndex} from playlist ${n.playlist.id} has a duration of ${t} when the reported duration is ${n.duration} and the target duration is ${i}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||a?{severity:r?"warn":"info",message:o}:null},Yt=({type:n,segment:e})=>{if(!e)return;const t=!!(e.key||e.map&&e.map.ke),i=!!(e.map&&!e.map.bytes),r=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:n||e.type,uri:e.resolvedUri||e.uri,start:r,duration:e.duration,isEncrypted:t,isMediaInitialization:i}};class Hr extends H.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=nt(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(i){i!==this.state_&&(this.logger_(`${this.state_} -> ${i}`),this.state_=i,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():kt(this)}),this.sourceUpdater_.on("codecschange",i=>{this.trigger(ze({type:"codecschange"},i))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():kt(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",i=>{this.trigger(ze({type:"timelinechange"},i)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():kt(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():kt(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return yr.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&W.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null),this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,W.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&yr.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return Re();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:i,isMuxed:r}=e;if(i&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const i=Nn(e);let r=this.initSegments_[i];return t&&!r&&e.bytes&&(this.initSegments_[i]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const i=tl(e);let r=this.keyCache_[i];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[i]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const a={resolvedUri:(r||e).resolvedUri};return r&&(a.bytes=r.bytes),a}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e||this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const i=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let a=null;if(i&&(i.id?a=i.id:i.uri&&(a=i.uri)),this.logger_(`playlist update [${a} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${pr(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const o=e.mediaSequence-i.mediaSequence;if(this.logger_(`live window shift [${o}]`),this.mediaIndex!==null)if(this.mediaIndex-=o,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const d=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!d.parts||!d.parts.length||!d.parts[this.partIndex])){const m=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=m}}r&&(r.mediaIndex-=o,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(i,e)}pause(){this.checkBufferTimeout_&&(W.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&yr.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,i=()=>{},r=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let a=1;const o=()=>{a--,a===0&&i()};(r||!this.audioDisabled_)&&(a++,this.sourceUpdater_.removeAudio(e,t,o)),(r||this.loaderType_==="main")&&(this.gopBuffer_=Cp(this.gopBuffer_,e,t,this.timeMapping_),a++,this.sourceUpdater_.removeVideo(e,t,o));for(const d in this.inbandTextTracks_)Ui(e,t,this.inbandTextTracks_[d]);Ui(e,t,this.segmentMetadataTrack_),o()}monitorBuffer_(){this.checkBufferTimeout_&&W.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=W.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&W.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=W.setTimeout(this.monitorBufferTick_.bind(this),Ap)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:Yt({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,i=this.partIndex){if(!t||!this.mediaSource_)return!1;const r=typeof e=="number"&&t.segments[e],a=e+1===t.segments.length,o=!r||!r.parts||i+1===r.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&a&&o}chooseNextRequest_(){const e=this.buffered_(),t=pr(e)||0,i=rs(e,this.currentTime_()),r=!this.hasPlayed_()&&i>=1,a=i>=this.goalBufferLength_(),o=this.playlist_.segments;if(!o.length||r||a)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const d={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(d.isSyncRequest)d.mediaIndex=Dp(this.currentTimeline_,o,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${d.mediaIndex}`);else if(this.mediaIndex!==null){const S=o[this.mediaIndex],x=typeof this.partIndex=="number"?this.partIndex:-1;d.startOfSegment=S.end?S.end:t,S.parts&&S.parts[x+1]?(d.mediaIndex=this.mediaIndex,d.partIndex=x+1):d.mediaIndex=this.mediaIndex+1}else{let S,x,_;const T=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${T}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const v=this.getSyncInfoFromMediaSequenceSync_(T);if(!v){const E="No sync info found while using media sequence sync";return this.error({message:E,metadata:{errorType:H.Error.StreamingFailedToSelectNextSegment,error:new Error(E)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${v.start} --> ${v.end})`),S=v.segmentIndex,x=v.partIndex,_=v.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const v=Ke.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:T,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});S=v.segmentIndex,x=v.partIndex,_=v.startTime}d.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${T}`:`currentTime ${T}`,d.mediaIndex=S,d.startOfSegment=_,d.partIndex=x,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${d.mediaIndex} `)}const m=o[d.mediaIndex];let h=m&&typeof d.partIndex=="number"&&m.parts&&m.parts[d.partIndex];if(!m||typeof d.partIndex=="number"&&!h)return null;typeof d.partIndex!="number"&&m.parts&&(d.partIndex=0,h=m.parts[0]);const g=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!i&&h&&!g&&!h.independent)if(d.partIndex===0){const S=o[d.mediaIndex-1],x=S.parts&&S.parts.length&&S.parts[S.parts.length-1];x&&x.independent&&(d.mediaIndex-=1,d.partIndex=S.parts.length-1,d.independent="previous segment")}else m.parts[d.partIndex-1].independent&&(d.partIndex-=1,d.independent="previous part");const y=this.mediaSource_&&this.mediaSource_.readyState==="ended";return d.mediaIndex>=o.length-1&&y&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,d.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(d))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const i=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!i)return null;if(!i.isAppended)return i;const r=this.mediaSequenceSync_.getSyncInfoForTime(i.end);return r?(r.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),r):null}generateSegmentInfo_(e){const{independent:t,playlist:i,mediaIndex:r,startOfSegment:a,isSyncRequest:o,partIndex:d,forceTimestampOffset:m,getMediaInfoForTime:h}=e,g=i.segments[r],y=typeof d=="number"&&g.parts[d],S={requestId:"segment-loader-"+Math.random(),uri:y&&y.resolvedUri||g.resolvedUri,mediaIndex:r,partIndex:y?d:null,isSyncRequest:o,startOfSegment:a,playlist:i,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:g.timeline,duration:y&&y.duration||g.duration,segment:g,part:y,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:h,independent:t},x=typeof m<"u"?m:this.isPendingTimestampOffset_;S.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:g.timeline,currentTimeline:this.currentTimeline_,startOfSegment:a,buffered:this.buffered_(),overrideCheck:x});const _=pr(this.sourceUpdater_.audioBuffered());return typeof _=="number"&&(S.audioAppendStart=_-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(S.gopsToAlignWith=xp(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),S}timestampOffsetForSegment_(e){return Mp(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),i=e.bandwidth,r=this.pendingSegment_.duration,a=Ke.estimateSegmentRequestTime(r,i,this.playlist_,e.bytesReceived),o=tm(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(a<=o)return;const d=mp({main:this.vhs_.playlists.main,currentTime:t,bandwidth:i,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:o,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!d)return;const h=a-o-d.rebufferingImpact;let g=.5;o<=mt&&(g=1),!(!d.playlist||d.playlist.uri===this.playlist_.uri||h<g)&&(this.bandwidth=d.playlist.attributes.BANDWIDTH*Me.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${ni(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:i,hasVideo:r}=t,a={segmentInfo:Yt({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:i,hasVideo:r}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:a}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},Ip(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():kt(this))))}handleTimingInfo_(e,t,i,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const a=this.pendingSegment_,o=xa(t);a[o]=a[o]||{},a[o][i]=r,this.logger_(`timinginfo: ${t} - ${i} - ${r}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():kt(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const r=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),a={};t.forEach(o=>{a[o.stream]=a[o.stream]||{startTime:1/0,captions:[],endTime:0};const d=a[o.stream];d.startTime=Math.min(d.startTime,o.startTime+r),d.endTime=Math.max(d.endTime,o.endTime+r),d.captions.push(o)}),Object.keys(a).forEach(o=>{const{startTime:d,endTime:m,captions:h}=a[o],g=this.inbandTextTracks_;this.logger_(`adding cues from ${d} -> ${m} for ${o}`),yp(g,this.vhs_.tech_,o),Ui(d,m,g[o]),_p({captionArray:h,inbandTextTracks:g,timestampOffset:r})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,i){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,i));return}this.addMetadataToTextTrack(i,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!Vr({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:i,hasVideo:r,isMuxed:a}=t;return!(r&&!e.videoTimingInfo||i&&!this.audioDisabled_&&!a&&!e.audioTimingInfo||Vr({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){kt(this),this.callQueue_.push(this.handleData_.bind(this,e,t));return}const i=this.pendingSegment_;if(this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.part||i.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),i.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),i.isFmp4=e.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4)this.trigger("fmp4"),i.timingInfo.start=i[xa(t.type)].start;else{const r=this.getCurrentMediaInfo_(),a=this.loaderType_==="main"&&r&&r.hasVideo;let o;a&&(o=i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:a,firstVideoFrameTimeForData:o,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(i,t.type),this.updateSourceBufferTimestampOffset_(i),i.isSyncRequest){this.updateTimingInfoEnd_(i),this.syncController_.saveSegmentTimingInfo({segmentInfo:i,shouldSaveTimelineMapping:this.loaderType_==="main"});const r=this.chooseNextRequest_();if(r.mediaIndex!==i.mediaIndex||r.partIndex!==i.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:i,playlist:r}){if(i){const a=Nn(i);if(this.activeInitSegmentId_===a)return null;t=this.initSegmentForMap(i,!0).bytes,this.activeInitSegmentId_=a}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i},r){const a=this.sourceUpdater_.audioBuffered(),o=this.sourceUpdater_.videoBuffered();a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Jt(a).join(", ")),o.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Jt(o).join(", "));const d=a.length?a.start(0):0,m=a.length?a.end(a.length-1):0,h=o.length?o.start(0):0,g=o.length?o.end(o.length-1):0;if(m-d<=Li&&g-h<=Li){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${i.byteLength}, audio buffer: ${Jt(a).join(", ")}, video buffer: ${Jt(o).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:i}));const S=this.currentTime_()-Li;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${S}`),this.remove(0,S,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${Li}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=W.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},Li*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:i},r){if(r){if(r.code===zo){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:i});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error({message:`${t} append of ${i.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:H.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:i,data:r,bytes:a}){if(!a){const d=[r];let m=r.byteLength;i&&(d.unshift(i),m+=i.byteLength),a=gp({bytes:m,segments:d})}const o={segmentInfo:Yt({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:o}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:a},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:a}))}handleSegmentTimingInfo_(e,t,i){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,a=`${e}TimingInfo`;r[a]||(r[a]={}),r[a].transmuxerPrependedSeconds=i.prependedContentDuration||0,r[a].transmuxedPresentationStart=i.start.presentation,r[a].transmuxedDecodeStart=i.start.decode,r[a].transmuxedPresentationEnd=i.end.presentation,r[a].transmuxedDecodeEnd=i.end.decode,r[a].baseMediaDecodeTime=i.baseMediaDecodeTime}appendData_(e,t){const{type:i,data:r}=t;if(!r||!r.byteLength||i==="audio"&&this.audioDisabled_)return;const a=this.getInitSegmentAndUpdateState_({type:i,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:i,initSegment:a,data:r})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){kt(this),this.loadQueue_.push(()=>{const t=ze({},e,{forceTimestampOffset:!0});ze(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),i=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=this.mediaIndex!==null,a=e.timeline!==this.currentTimeline_&&e.timeline>0,o=i||r&&a;this.logger_(`Requesting
${_l(e.uri)}
${ni(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=cp({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:o,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:d,level:m,stream:h})=>{this.logger_(`${ni(e)} logged from transmuxer stream ${h} as a ${m}: ${d}`)},triggerSegmentEventFn:({type:d,segment:m,keyInfo:h,trackInfo:g,timingInfo:y})=>{const x={segmentInfo:Yt({segment:m})};h&&(x.keyInfo=h),g&&(x.trackInfo=g),y&&(x.timingInfo=y),this.trigger({type:d,metadata:x})}})}trimBackBuffer_(e){const t=Lp(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,i=e.part,r=e.segment.key||e.segment.map&&e.segment.map.key,a=e.segment.map&&!e.segment.map.bytes,o={resolvedUri:i?i.resolvedUri:t.resolvedUri,byterange:i?i.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:r,isMediaInitialization:a},d=e.playlist.segments[e.mediaIndex-1];if(d&&d.timeline===t.timeline&&(d.videoTimingInfo?o.baseStartTime=d.videoTimingInfo.transmuxedDecodeEnd:d.audioTimingInfo&&(o.baseStartTime=d.audioTimingInfo.transmuxedDecodeEnd)),t.key){const m=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);o.key=this.segmentKey(t.key),o.key.iv=m}return t.map&&(o.map=this.initSegmentForMap(t.map)),o}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<wn){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${wn}`);return}const i={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:i}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,i){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,i));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===gt.ABORTED)return;if(this.pause(),e.code===gt.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=Pp(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:i,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:a,useVideoTimingInfo:o,videoTimingInfo:d,audioTimingInfo:m}){if(typeof e<"u")return e;if(!o)return m.start;const h=t.segments[i-1];return i===0||!h||typeof h.start>"u"||h.end!==r+a?r:d.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:i,hasVideo:r,isMuxed:a}=t,o=this.loaderType_==="main"&&r,d=!this.audioDisabled_&&i&&!a;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}o&&e.waitingOnAppends++,d&&e.waitingOnAppends++,o&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),d&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=Op(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:i}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:i.start:i.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),r=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;r&&(e.timingInfo.end=typeof r.end=="number"?r.end:r.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const m={segmentInfo:Yt({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:m})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=Bp(e,this.sourceType_);if(t&&(t.severity==="warn"?H.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${ni(e)}`);return}this.logger_(`Appended ${ni(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const i=e.segment,r=e.part,a=i.end&&this.currentTime_()-i.end>e.playlist.targetDuration*3,o=r&&r.end&&this.currentTime_()-r.end>e.playlist.partTargetDuration*3;if(a||o){this.logger_(`bad ${a?"segment":"part"} ${ni(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<wn){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${wn}`);return}const t=this.throughput.rate,i=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,i=t.start,r=t.end;if(!Ea(i)||!Ea(r))return;Ui(i,r,this.segmentMetadataTrack_);const a=W.WebKitDataCue||W.VTTCue,o={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:i,end:r},d=JSON.stringify(o),m=new a(i,r,d);m.value=o,this.segmentMetadataTrack_.addCue(m)}}function Dt(){}const vl=function(n){return typeof n!="string"?n:n.replace(/./,e=>e.toUpperCase())},Np=["video","audio"],Gr=(n,e)=>{const t=e[`${n}Buffer`];return t&&t.updating||e.queuePending[n]},Fp=(n,e)=>{for(let t=0;t<e.length;t++){const i=e[t];if(i.type==="mediaSource")return null;if(i.type===n)return t}return null},ui=(n,e)=>{if(e.queue.length===0)return;let t=0,i=e.queue[t];if(i.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),i.action(e),i.doneFn&&i.doneFn(),ui("audio",e),ui("video",e));return}if(n!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||Gr(n,e))){if(i.type!==n){if(t=Fp(n,e.queue),t===null)return;i=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[n]=i,i.action(n,e),!i.doneFn){e.queuePending[n]=null,ui(n,e);return}}},bl=(n,e)=>{const t=e[`${n}Buffer`],i=vl(n);t&&(t.removeEventListener("updateend",e[`on${i}UpdateEnd_`]),t.removeEventListener("error",e[`on${i}Error_`]),e.codecs[n]=null,e[`${n}Buffer`]=null)},ft=(n,e)=>n&&e&&Array.prototype.indexOf.call(n.sourceBuffers,e)!==-1,Ze={appendBuffer:(n,e,t)=>(i,r)=>{const a=r[`${i}Buffer`];if(ft(r.mediaSource,a)){r.logger_(`Appending segment ${e.mediaIndex}'s ${n.length} bytes to ${i}Buffer`);try{a.appendBuffer(n)}catch(o){r.logger_(`Error with code ${o.code} `+(o.code===zo?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${i}Buffer`),r.queuePending[i]=null,t(o)}}},remove:(n,e)=>(t,i)=>{const r=i[`${t}Buffer`];if(ft(i.mediaSource,r)){i.logger_(`Removing ${n} to ${e} from ${t}Buffer`);try{r.remove(n,e)}catch{i.logger_(`Remove ${n} to ${e} from ${t}Buffer failed`)}}},timestampOffset:n=>(e,t)=>{const i=t[`${e}Buffer`];ft(t.mediaSource,i)&&(t.logger_(`Setting ${e}timestampOffset to ${n}`),i.timestampOffset=n)},callback:n=>(e,t)=>{n()},endOfStream:n=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${n||""})`);try{e.mediaSource.endOfStream(n)}catch(t){H.log.warn("Failed to call media source endOfStream",t)}}},duration:n=>e=>{e.logger_(`Setting mediaSource duration to ${n}`);try{e.mediaSource.duration=n}catch(t){H.log.warn("Failed to set media source duration",t)}},abort:()=>(n,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${n}Buffer`];if(ft(e.mediaSource,t)){e.logger_(`calling abort on ${n}Buffer`);try{t.abort()}catch(i){H.log.warn(`Failed to abort on ${n}Buffer`,i)}}},addSourceBuffer:(n,e)=>t=>{const i=vl(n),r=Un(e);t.logger_(`Adding ${n}Buffer with codec ${e} to mediaSource`);const a=t.mediaSource.addSourceBuffer(r);a.addEventListener("updateend",t[`on${i}UpdateEnd_`]),a.addEventListener("error",t[`on${i}Error_`]),t.codecs[n]=e,t[`${n}Buffer`]=a},removeSourceBuffer:n=>e=>{const t=e[`${n}Buffer`];if(bl(n,e),!!ft(e.mediaSource,t)){e.logger_(`Removing ${n}Buffer with codec ${e.codecs[n]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(i){H.log.warn(`Failed to removeSourceBuffer ${n}Buffer`,i)}}},changeType:n=>(e,t)=>{const i=t[`${e}Buffer`],r=Un(n);if(!ft(t.mediaSource,i))return;const a=n.substring(0,n.indexOf(".")),o=t.codecs[e];if(o.substring(0,o.indexOf("."))===a)return;const m={codecsChangeInfo:{from:o,to:n}};t.trigger({type:"codecschange",metadata:m}),t.logger_(`changing ${e}Buffer codec from ${o} to ${n}`);try{i.changeType(r),t.codecs[e]=n}catch(h){m.errorType=H.Error.StreamingCodecsChangeError,m.error=h,h.metadata=m,t.error_=h,t.trigger("error"),H.log.warn(`Failed to changeType on ${e}Buffer`,h)}}},et=({type:n,sourceUpdater:e,action:t,doneFn:i,name:r})=>{e.queue.push({type:n,action:t,doneFn:i,name:r}),ui(n,e)},Ca=(n,e)=>t=>{const i=e[`${n}Buffered`](),r=Jf(i);if(e.logger_(`received "updateend" event for ${n} Source Buffer: `,r),e.queuePending[n]){const a=e.queuePending[n].doneFn;e.queuePending[n]=null,a&&a(e[`${n}Error_`])}ui(n,e)};class Tl extends H.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>ui("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=nt("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=Ca("video",this),this.onAudioUpdateEnd_=Ca("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){et({type:"mediaSource",sourceUpdater:this,action:Ze.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){et({type:e,sourceUpdater:this,action:Ze.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){H.log.error("removeSourceBuffer is not supported!");return}et({type:"mediaSource",sourceUpdater:this,action:Ze.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!H.browser.IS_FIREFOX&&W.MediaSource&&W.MediaSource.prototype&&typeof W.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return W.SourceBuffer&&W.SourceBuffer.prototype&&typeof W.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){H.log.error("changeType is not supported!");return}et({type:e,sourceUpdater:this,action:Ze.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const i=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,i);this.canChangeType()&&this.changeType(t,i)})}appendBuffer(e,t){const{segmentInfo:i,type:r,bytes:a}=e;if(this.processedAppend_=!0,r==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${a.length} until video append`);return}const o=t;if(et({type:r,sourceUpdater:this,action:Ze.appendBuffer(a,i||{mediaIndex:-1},o),doneFn:t,name:"appendBuffer"}),r==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const d=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${d.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,d.forEach(m=>{this.appendBuffer.apply(this,m)})}}audioBuffered(){return ft(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:Re()}videoBuffered(){return ft(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:Re()}buffered(){const e=ft(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=ft(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():em(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=Dt){et({type:"mediaSource",sourceUpdater:this,action:Ze.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=Dt){typeof e!="string"&&(e=void 0),et({type:"mediaSource",sourceUpdater:this,action:Ze.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,i=Dt){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){i();return}et({type:"audio",sourceUpdater:this,action:Ze.remove(e,t),doneFn:i,name:"remove"})}removeVideo(e,t,i=Dt){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){i();return}et({type:"video",sourceUpdater:this,action:Ze.remove(e,t),doneFn:i,name:"remove"})}updating(){return!!(Gr("audio",this)||Gr("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(et({type:"audio",sourceUpdater:this,action:Ze.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(et({type:"video",sourceUpdater:this,action:Ze.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&et({type:"audio",sourceUpdater:this,action:Ze.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&et({type:"video",sourceUpdater:this,action:Ze.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),Np.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>bl(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const Ia=n=>decodeURIComponent(escape(String.fromCharCode.apply(null,n))),$p=n=>{const e=new Uint8Array(n);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},Da=new Uint8Array(`

`.split("").map(n=>n.charCodeAt(0)));class jp extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class qp extends Hr{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return Re();const e=this.subtitlesTrack_.cues,t=e[0].startTime,i=e[e.length-1].startTime;return Re([[t,i]])}initSegmentForMap(e,t=!1){if(!e)return null;const i=Nn(e);let r=this.initSegments_[i];if(t&&!r&&e.bytes){const a=Da.byteLength+e.bytes.byteLength,o=new Uint8Array(a);o.set(e.bytes),o.set(Da,e.bytes.byteLength),this.initSegments_[i]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:o}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){Ui(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,i){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===gt.TIMEOUT&&this.handleTimeout_(),e.code===gt.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const r=this.pendingSegment_,a=i.mp4VttCues&&i.mp4VttCues.length;a&&(r.mp4VttCues=i.mp4VttCues),this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const o=r.segment;if(o.map&&(o.map.bytes=t.map.bytes),r.bytes=t.bytes,typeof W.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,i),()=>this.stopForError({message:"Error loading vtt.js"}));return}o.requested=!0;try{this.parseVTTCues_(r)}catch(d){this.stopForError({message:d.message,metadata:{errorType:H.Error.StreamingVttParserError,error:d}});return}if(a||this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=o.duration,r.cues.forEach(d=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new W.VTTCue(d.startTime,d.endTime,d.text):d)}),Ep(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const i=e&&e.type==="vtt",r=t&&t.type==="text";i&&r&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(i=>{const r=i.start+t,a=i.end+t,o=new W.VTTCue(r,a,i.cueText);i.settings&&i.settings.split(" ").forEach(d=>{const m=d.split(":"),h=m[0],g=m[1];o[h]=isNaN(g)?g:Number(g)}),e.cues.push(o)})}parseVTTCues_(e){let t,i=!1;if(typeof W.WebVTT!="function")throw new jp;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues){this.parseMp4VttCues_(e);return}typeof W.TextDecoder=="function"?t=new W.TextDecoder("utf8"):(t=W.WebVTT.StringDecoder(),i=!0);const r=new W.WebVTT.Parser(W,W.vttjs,t);if(r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=o=>{e.timestampmap=o},r.onparsingerror=o=>{H.log.warn("Error encountered when parsing cues: "+o.message)},e.segment.map){let o=e.segment.map.bytes;i&&(o=Ia(o)),r.parse(o)}let a=e.bytes;i&&(a=Ia(a)),r.parse(a),r.flush()}updateTimeMapping_(e,t,i){const r=e.segment;if(!t)return;if(!e.cues.length){r.empty=!0;return}const{MPEGTS:a,LOCAL:o}=e.timestampmap,m=a/Kt.ONE_SECOND_IN_TS-o+t.mapping;if(e.cues.forEach(h=>{const g=h.endTime-h.startTime,y=this.handleRollover_(h.startTime+m,t.time);h.startTime=Math.max(y,0),h.endTime=Math.max(y+g,0)}),!i.syncInfo){const h=e.cues[0].startTime,g=e.cues[e.cues.length-1].startTime;i.syncInfo={mediaSequence:i.mediaSequence+e.mediaIndex,time:Math.min(h,g-r.duration)}}}handleRollover_(e,t){if(t===null)return e;let i=e*Kt.ONE_SECOND_IN_TS;const r=t*Kt.ONE_SECOND_IN_TS;let a;for(r<i?a=-8589934592:a=8589934592;Math.abs(i-r)>4294967296;)i+=a;return i/Kt.ONE_SECOND_IN_TS}}const Wp=function(n,e){const t=n.cues;for(let i=0;i<t.length;i++){const r=t[i];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},Vp=function(n,e,t=0){if(!n.segments)return;let i=t,r;for(let a=0;a<n.segments.length;a++){const o=n.segments[a];if(r||(r=Wp(e,i+o.duration/2)),r){if("cueIn"in o){r.endTime=i,r.adEndTime=i,i+=o.duration,r=null;continue}if(i<r.endTime){i+=o.duration;continue}r.endTime+=o.duration}else if("cueOut"in o&&(r=new W.VTTCue(i,i+o.duration,o.cueOut),r.adStartTime=i,r.adEndTime=i+parseFloat(o.cueOut),e.addCue(r)),"cueOutCont"in o){const[d,m]=o.cueOutCont.split("/").map(parseFloat);r=new W.VTTCue(i,i+o.duration,""),r.adStartTime=i-d,r.adEndTime=r.adStartTime+m,e.addCue(r)}i+=o.duration}};class Aa{constructor({start:e,end:t,segmentIndex:i,partIndex:r=null,appended:a=!1}){this.start_=e,this.end_=t,this.segmentIndex_=i,this.partIndex_=r,this.appended_=a}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class Hp{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class Sl{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:i,segments:r}=e;if(this.isReliable_=this.isReliablePlaylist_(i,r),!!this.isReliable_)return this.updateStorage_(r,i,this.calculateBaseTime_(i,r,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:i}of this.storage_.values())if(i.length){for(const r of i)if(r.isInRange(e))return r}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,i){const r=new Map;let a=`
`,o=i,d=t;this.start_=o,e.forEach((m,h)=>{const g=this.storage_.get(d),y=o,S=y+m.duration,x=!!(g&&g.segmentSyncInfo&&g.segmentSyncInfo.isAppended),_=new Aa({start:y,end:S,appended:x,segmentIndex:h});m.syncInfo=_;let T=o;const v=(m.parts||[]).map((E,P)=>{const O=T,A=T+E.duration,k=!!(g&&g.partsSyncInfo&&g.partsSyncInfo[P]&&g.partsSyncInfo[P].isAppended),U=new Aa({start:O,end:A,appended:k,segmentIndex:h,partIndex:P});return T=A,a+=`Media Sequence: ${d}.${P} | Range: ${O} --> ${A} | Appended: ${k}
`,E.syncInfo=U,U});r.set(d,new Hp(_,v)),a+=`${_l(m.resolvedUri)} | Media Sequence: ${d} | Range: ${y} --> ${S} | Appended: ${x}
`,d++,o=S}),this.end_=o,this.storage_=r,this.diagnostics_=a}calculateBaseTime_(e,t,i){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const r=Math.min(...this.storage_.keys());if(e<r){const a=r-e;let o=this.storage_.get(r).segmentSyncInfo.start;for(let d=0;d<a;d++){const m=t[d];o-=m.duration}return o}return i}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}class Oa extends Sl{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,i){if(!this.storage_.size){const r=this.parent_.getSyncInfoForMediaSequence(e);return r?r.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,i)}}const Gp=86400,_r=[{name:"VOD",run:(n,e,t,i,r)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(n,e,t,i,r,a)=>{const o=n.getMediaSequenceSync(a);if(!o||!o.isReliable)return null;const d=o.getSyncInfoForTime(r);return d?{time:d.start,partIndex:d.partIndex,segmentIndex:d.segmentIndex}:null}},{name:"ProgramDateTime",run:(n,e,t,i,r)=>{if(!Object.keys(n.timelineToDatetimeMappings).length)return null;let a=null,o=null;const d=Ur(e);r=r||0;for(let m=0;m<d.length;m++){const h=e.endList||r===0?m:d.length-(m+1),g=d[h],y=g.segment,S=n.timelineToDatetimeMappings[y.timeline];if(!S||!y.dateTimeObject)continue;let _=y.dateTimeObject.getTime()/1e3+S;if(y.parts&&typeof g.partIndex=="number")for(let v=0;v<g.partIndex;v++)_+=y.parts[v].duration;const T=Math.abs(r-_);if(o!==null&&(T===0||o<T))break;o=T,a={time:_,segmentIndex:g.segmentIndex,partIndex:g.partIndex}}return a}},{name:"Segment",run:(n,e,t,i,r)=>{let a=null,o=null;r=r||0;const d=Ur(e);for(let m=0;m<d.length;m++){const h=e.endList||r===0?m:d.length-(m+1),g=d[h],y=g.segment,S=g.part&&g.part.start||y&&y.start;if(y.timeline===i&&typeof S<"u"){const x=Math.abs(r-S);if(o!==null&&o<x)break;(!a||o===null||o>=x)&&(o=x,a={time:S,segmentIndex:g.segmentIndex,partIndex:g.partIndex})}}return a}},{name:"Discontinuity",run:(n,e,t,i,r)=>{let a=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length){let o=null;for(let d=0;d<e.discontinuityStarts.length;d++){const m=e.discontinuityStarts[d],h=e.discontinuitySequence+d+1,g=n.discontinuities[h];if(g){const y=Math.abs(r-g.time);if(o!==null&&o<y)break;(!a||o===null||o>=y)&&(o=y,a={time:g.time,segmentIndex:m,partIndex:null})}}}return a}},{name:"Playlist",run:(n,e,t,i,r)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class zp extends H.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new Sl,i=new Oa(t),r=new Oa(t);this.mediaSequenceStorage_={main:t,audio:i,vtt:r},this.logger_=nt("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,i,r,a){if(t!==1/0)return _r.find(({name:m})=>m==="VOD").run(this,e,t);const o=this.runStrategies_(e,t,i,r,a);if(!o.length)return null;for(const d of o){const{syncPoint:m,strategy:h}=d,{segmentIndex:g,time:y}=m;if(g<0)continue;const S=e.segments[g],x=y,_=x+S.duration;if(this.logger_(`Strategy: ${h}. Current time: ${r}. selected segment: ${g}. Time: [${x} -> ${_}]}`),r>=x&&r<_)return this.logger_("Found sync point with exact match: ",m),m}return this.selectSyncPoint_(o,{key:"time",value:r})}getExpiredTime(e,t){if(!e||!e.segments)return null;const i=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!i.length)return null;const r=this.selectSyncPoint_(i,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+Ni({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,i,r,a){const o=[];for(let d=0;d<_r.length;d++){const m=_r[d],h=m.run(this,e,t,i,r,a);h&&(h.strategy=m.name,o.push({strategy:m.name,syncPoint:h}))}return o}selectSyncPoint_(e,t){let i=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),a=e[0].strategy;for(let o=1;o<e.length;o++){const d=Math.abs(e[o].syncPoint[t.key]-t.value);d<r&&(r=d,i=e[o].syncPoint,a=e[o].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${a}]: [time:${i.time}, segmentIndex:${i.segmentIndex}`+(typeof i.partIndex=="number"?`,partIndex:${i.partIndex}`:"")+"]"),i}saveExpiredSegmentInfo(e,t){const i=t.mediaSequence-e.mediaSequence;if(i>Gp){H.log.warn(`Not saving expired segment info. Media sequence gap ${i} is too large.`);return}for(let r=i-1;r>=0;r--){const a=e.segments[r];if(a&&typeof a.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:a.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],i=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-i}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const i=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;i&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const a=r.dateTimeObject;r.discontinuity&&t&&a&&(this.timelineToDatetimeMappings[r.timeline]=-(a.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,i){const r=e.segment,a=e.part;let o=this.timelines[e.timeline],d,m;if(typeof e.timestampOffset=="number")o={time:e.startOfSegment,mapping:e.startOfSegment-t.start},i&&(this.timelines[e.timeline]=o,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${o.time}] [mapping: ${o.mapping}]`)),d=e.startOfSegment,m=t.end+o.mapping;else if(o)d=t.start+o.mapping,m=t.end+o.mapping;else return!1;return a&&(a.start=d,a.end=m),(!r.start||d<r.start)&&(r.start=d),r.end=m,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,i=e.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const a=t.discontinuityStarts[r],o=t.discontinuitySequence+r+1,d=a-e.mediaIndex,m=Math.abs(d);if(!this.discontinuities[o]||this.discontinuities[o].accuracy>m){let h;d<0?h=i.start-Ni({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:a}):h=i.end+Ni({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:a}),this.discontinuities[o]={time:h,accuracy:m}}}}dispose(){this.trigger("dispose"),this.off()}}class Qp extends H.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:i}){return typeof t=="number"&&typeof i=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:i},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:i}){if(typeof t=="number"&&typeof i=="number"){this.lastTimelineChanges_[e]={type:e,from:t,to:i},delete this.pendingTimelineChanges_[e];const r={timelineChangeInfo:{from:t,to:i}};this.trigger({type:"timelinechange",metadata:r})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const Yp=ol(ll(function(){var n=(function(){function T(){this.listeners={}}var v=T.prototype;return v.on=function(P,O){this.listeners[P]||(this.listeners[P]=[]),this.listeners[P].push(O)},v.off=function(P,O){if(!this.listeners[P])return!1;var A=this.listeners[P].indexOf(O);return this.listeners[P]=this.listeners[P].slice(0),this.listeners[P].splice(A,1),A>-1},v.trigger=function(P){var O=this.listeners[P];if(O)if(arguments.length===2)for(var A=O.length,k=0;k<A;++k)O[k].call(this,arguments[1]);else for(var U=Array.prototype.slice.call(arguments,1),L=O.length,M=0;M<L;++M)O[M].apply(this,U)},v.dispose=function(){this.listeners={}},v.pipe=function(P){this.on("data",function(O){P.push(O)})},T})();/*! @name pkcs7 @version 1.0.4 @license Apache-2.0 */function e(T){return T.subarray(0,T.byteLength-T[T.byteLength-1])}/*! @name aes-decrypter @version 4.0.2 @license Apache-2.0 */const t=function(){const T=[[[],[],[],[],[]],[[],[],[],[],[]]],v=T[0],E=T[1],P=v[4],O=E[4];let A,k,U;const L=[],M=[];let B,$,q,V,F,Q;for(A=0;A<256;A++)M[(L[A]=A<<1^(A>>7)*283)^A]=A;for(k=U=0;!P[k];k^=B||1,U=M[U]||1)for(V=U^U<<1^U<<2^U<<3^U<<4,V=V>>8^V&255^99,P[k]=V,O[V]=k,q=L[$=L[B=L[k]]],Q=q*16843009^$*65537^B*257^k*16843008,F=L[V]*257^V*16843008,A=0;A<4;A++)v[A][k]=F=F<<24^F>>>8,E[A][V]=Q=Q<<24^Q>>>8;for(A=0;A<5;A++)v[A]=v[A].slice(0),E[A]=E[A].slice(0);return T};let i=null;class r{constructor(v){i||(i=t()),this._tables=[[i[0][0].slice(),i[0][1].slice(),i[0][2].slice(),i[0][3].slice(),i[0][4].slice()],[i[1][0].slice(),i[1][1].slice(),i[1][2].slice(),i[1][3].slice(),i[1][4].slice()]];let E,P,O;const A=this._tables[0][4],k=this._tables[1],U=v.length;let L=1;if(U!==4&&U!==6&&U!==8)throw new Error("Invalid aes key size");const M=v.slice(0),B=[];for(this._key=[M,B],E=U;E<4*U+28;E++)O=M[E-1],(E%U===0||U===8&&E%U===4)&&(O=A[O>>>24]<<24^A[O>>16&255]<<16^A[O>>8&255]<<8^A[O&255],E%U===0&&(O=O<<8^O>>>24^L<<24,L=L<<1^(L>>7)*283)),M[E]=M[E-U]^O;for(P=0;E;P++,E--)O=M[P&3?E:E-4],E<=4||P<4?B[P]=O:B[P]=k[0][A[O>>>24]]^k[1][A[O>>16&255]]^k[2][A[O>>8&255]]^k[3][A[O&255]]}decrypt(v,E,P,O,A,k){const U=this._key[1];let L=v^U[0],M=O^U[1],B=P^U[2],$=E^U[3],q,V,F;const Q=U.length/4-2;let K,Z=4;const ie=this._tables[1],ae=ie[0],ne=ie[1],he=ie[2],fe=ie[3],X=ie[4];for(K=0;K<Q;K++)q=ae[L>>>24]^ne[M>>16&255]^he[B>>8&255]^fe[$&255]^U[Z],V=ae[M>>>24]^ne[B>>16&255]^he[$>>8&255]^fe[L&255]^U[Z+1],F=ae[B>>>24]^ne[$>>16&255]^he[L>>8&255]^fe[M&255]^U[Z+2],$=ae[$>>>24]^ne[L>>16&255]^he[M>>8&255]^fe[B&255]^U[Z+3],Z+=4,L=q,M=V,B=F;for(K=0;K<4;K++)A[(3&-K)+k]=X[L>>>24]<<24^X[M>>16&255]<<16^X[B>>8&255]<<8^X[$&255]^U[Z++],q=L,L=M,M=B,B=$,$=q}}class a extends n{constructor(){super(n),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(v){this.jobs.push(v),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const o=function(T){return T<<24|(T&65280)<<8|(T&16711680)>>8|T>>>24},d=function(T,v,E){const P=new Int32Array(T.buffer,T.byteOffset,T.byteLength>>2),O=new r(Array.prototype.slice.call(v)),A=new Uint8Array(T.byteLength),k=new Int32Array(A.buffer);let U,L,M,B,$,q,V,F,Q;for(U=E[0],L=E[1],M=E[2],B=E[3],Q=0;Q<P.length;Q+=4)$=o(P[Q]),q=o(P[Q+1]),V=o(P[Q+2]),F=o(P[Q+3]),O.decrypt($,q,V,F,k,Q),k[Q]=o(k[Q]^U),k[Q+1]=o(k[Q+1]^L),k[Q+2]=o(k[Q+2]^M),k[Q+3]=o(k[Q+3]^B),U=$,L=q,M=V,B=F;return A};class m{constructor(v,E,P,O){const A=m.STEP,k=new Int32Array(v.buffer),U=new Uint8Array(v.byteLength);let L=0;for(this.asyncStream_=new a,this.asyncStream_.push(this.decryptChunk_(k.subarray(L,L+A),E,P,U)),L=A;L<k.length;L+=A)P=new Uint32Array([o(k[L-4]),o(k[L-3]),o(k[L-2]),o(k[L-1])]),this.asyncStream_.push(this.decryptChunk_(k.subarray(L,L+A),E,P,U));this.asyncStream_.push(function(){O(null,e(U))})}static get STEP(){return 32e3}decryptChunk_(v,E,P,O){return function(){const A=d(v,E,P);O.set(A,v.byteOffset)}}}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g;typeof window<"u"?g=window:typeof h<"u"?g=h:typeof self<"u"?g=self:g={};var y=g,S=function(v){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(v):v&&v.buffer instanceof ArrayBuffer},x=y.BigInt||Number;x("0x1"),x("0x100"),x("0x10000"),x("0x1000000"),x("0x100000000"),x("0x10000000000"),x("0x1000000000000"),x("0x100000000000000"),x("0x10000000000000000"),(function(){var T=new Uint16Array([65484]),v=new Uint8Array(T.buffer,T.byteOffset,T.byteLength);return v[0]===255?"big":v[0]===204?"little":"unknown"})();const _=function(T){const v={};return Object.keys(T).forEach(E=>{const P=T[E];S(P)?v[E]={bytes:P.buffer,byteOffset:P.byteOffset,byteLength:P.byteLength}:v[E]=P}),v};self.onmessage=function(T){const v=T.data,E=new Uint8Array(v.encrypted.bytes,v.encrypted.byteOffset,v.encrypted.byteLength),P=new Uint32Array(v.key.bytes,v.key.byteOffset,v.key.byteLength/4),O=new Uint32Array(v.iv.bytes,v.iv.byteOffset,v.iv.byteLength/4);new m(E,P,O,function(A,k){self.postMessage(_({source:v.source,decrypted:k}),[k.buffer])})}}));var Xp=al(Yp);const Kp=n=>{let e=n.default?"main":"alternative";return n.characteristics&&n.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},wl=(n,e)=>{n.abort(),n.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},zr=(n,e)=>{e.activePlaylistLoader=n,n.load()},Jp=(n,e)=>()=>{const{segmentLoaders:{[n]:t,main:i},mediaTypes:{[n]:r}}=e,a=r.activeTrack(),o=r.getActiveGroup(),d=r.activePlaylistLoader,m=r.lastGroup_;if(!(o&&m&&o.id===m.id)&&(r.lastGroup_=o,r.lastTrack_=a,wl(t,r),!(!o||o.isMainPlaylist))){if(!o.playlistLoader){d&&i.resetEverything();return}t.resyncLoader(),zr(o.playlistLoader,r)}},Zp=(n,e)=>()=>{const{segmentLoaders:{[n]:t},mediaTypes:{[n]:i}}=e;i.lastGroup_=null,t.abort(),t.pause()},eg=(n,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[n]:i,main:r},mediaTypes:{[n]:a}}=e,o=a.activeTrack(),d=a.getActiveGroup(),m=a.activePlaylistLoader,h=a.lastTrack_;if(!(h&&o&&h.id===o.id)&&(a.lastGroup_=d,a.lastTrack_=o,wl(i,a),!!d)){if(d.isMainPlaylist){if(!o||!h||o.id===h.id)return;const g=e.vhs.playlistController_,y=g.selectPlaylist();if(g.media()===y)return;a.logger_(`track change. Switching main audio from ${h.id} to ${o.id}`),t.pause(),r.resetEverything(),g.fastQualityChange_(y);return}if(n==="AUDIO"){if(!d.playlistLoader){r.setAudio(!0),r.resetEverything();return}i.setAudio(!0),r.setAudio(!1)}if(m===d.playlistLoader){zr(d.playlistLoader,a);return}i.track&&i.track(o),i.resetEverything(),zr(d.playlistLoader,a)}},Fn={AUDIO:(n,e)=>()=>{const{mediaTypes:{[n]:t},excludePlaylist:i}=e,r=t.activeTrack(),a=t.activeGroup(),o=(a.filter(m=>m.default)[0]||a[0]).id,d=t.tracks[o];if(r===d){i({error:{message:"Problem encountered loading the default audio track."}});return}H.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const m in t.tracks)t.tracks[m].enabled=t.tracks[m]===d;t.onTrackChanged()},SUBTITLES:(n,e)=>()=>{const{mediaTypes:{[n]:t}}=e;H.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const i=t.activeTrack();i&&(i.mode="disabled"),t.onTrackChanged()}},La={AUDIO:(n,e,t)=>{if(!e)return;const{tech:i,requestOptions:r,segmentLoaders:{[n]:a}}=t;e.on("loadedmetadata",()=>{const o=e.media();a.playlist(o,r),(!i.paused()||o.endList&&i.preload()!=="none")&&a.load()}),e.on("loadedplaylist",()=>{a.playlist(e.media(),r),i.paused()||a.load()}),e.on("error",Fn[n](n,t))},SUBTITLES:(n,e,t)=>{const{tech:i,requestOptions:r,segmentLoaders:{[n]:a},mediaTypes:{[n]:o}}=t;e.on("loadedmetadata",()=>{const d=e.media();a.playlist(d,r),a.track(o.activeTrack()),(!i.paused()||d.endList&&i.preload()!=="none")&&a.load()}),e.on("loadedplaylist",()=>{a.playlist(e.media(),r),i.paused()||a.load()}),e.on("error",Fn[n](n,t))}},tg={AUDIO:(n,e)=>{const{vhs:t,sourceType:i,segmentLoaders:{[n]:r},requestOptions:a,main:{mediaGroups:o},mediaTypes:{[n]:{groups:d,tracks:m,logger_:h}},mainPlaylistLoader:g}=e,y=Wi(g.main);(!o[n]||Object.keys(o[n]).length===0)&&(o[n]={main:{default:{default:!0}}},y&&(o[n].main.default.playlists=g.main.playlists));for(const S in o[n]){d[S]||(d[S]=[]);for(const x in o[n][S]){let _=o[n][S][x],T;if(y?(h(`AUDIO group '${S}' label '${x}' is a main playlist`),_.isMainPlaylist=!0,T=null):i==="vhs-json"&&_.playlists?T=new si(_.playlists[0],t,a):_.resolvedUri?T=new si(_.resolvedUri,t,a):_.playlists&&i==="dash"?T=new qr(_.playlists[0],t,a,g):T=null,_=de({id:x,playlistLoader:T},_),La[n](n,_.playlistLoader,e),d[S].push(_),typeof m[x]>"u"){const v=new H.AudioTrack({id:x,kind:Kp(_),enabled:!1,language:_.language,default:_.default,label:x});m[x]=v}}}r.on("error",Fn[n](n,e))},SUBTITLES:(n,e)=>{const{tech:t,vhs:i,sourceType:r,segmentLoaders:{[n]:a},requestOptions:o,main:{mediaGroups:d},mediaTypes:{[n]:{groups:m,tracks:h}},mainPlaylistLoader:g}=e;for(const y in d[n]){m[y]||(m[y]=[]);for(const S in d[n][y]){if(!i.options_.useForcedSubtitles&&d[n][y][S].forced)continue;let x=d[n][y][S],_;if(r==="hls")_=new si(x.resolvedUri,i,o);else if(r==="dash"){if(!x.playlists.filter(v=>v.excludeUntil!==1/0).length)return;_=new qr(x.playlists[0],i,o,g)}else r==="vhs-json"&&(_=new si(x.playlists?x.playlists[0]:x.resolvedUri,i,o));if(x=de({id:S,playlistLoader:_},x),La[n](n,x.playlistLoader,e),m[y].push(x),typeof h[S]>"u"){const T=t.addRemoteTextTrack({id:S,kind:"subtitles",default:x.default&&x.autoselect,language:x.language,label:S},!1).track;h[S]=T}}}a.on("error",Fn[n](n,e))},"CLOSED-CAPTIONS":(n,e)=>{const{tech:t,main:{mediaGroups:i},mediaTypes:{[n]:{groups:r,tracks:a}}}=e;for(const o in i[n]){r[o]||(r[o]=[]);for(const d in i[n][o]){const m=i[n][o][d];if(!/^(?:CC|SERVICE)/.test(m.instreamId))continue;const h=t.options_.vhs&&t.options_.vhs.captionServices||{};let g={label:d,language:m.language,instreamId:m.instreamId,default:m.default&&m.autoselect};if(h[g.instreamId]&&(g=de(g,h[g.instreamId])),g.default===void 0&&delete g.default,r[o].push(de({id:d},m)),typeof a[d]>"u"){const y=t.addRemoteTextTrack({id:g.instreamId,kind:"captions",default:g.default,language:g.language,label:g.label},!1).track;a[d]=y}}}}},El=(n,e)=>{for(let t=0;t<n.length;t++)if(os(e,n[t])||n[t].playlists&&El(n[t].playlists,e))return!0;return!1},ig=(n,e)=>t=>{const{mainPlaylistLoader:i,mediaTypes:{[n]:{groups:r}}}=e,a=i.media();if(!a)return null;let o=null;a.attributes[n]&&(o=r[a.attributes[n]]);const d=Object.keys(r);if(!o)if(n==="AUDIO"&&d.length>1&&Wi(e.main))for(let m=0;m<d.length;m++){const h=r[d[m]];if(El(h,a)){o=h;break}}else r.main?o=r.main:d.length===1&&(o=r[d[0]]);return typeof t>"u"?o:t===null||!o?null:o.filter(m=>m.id===t.id)[0]||null},ng={AUDIO:(n,e)=>()=>{const{mediaTypes:{[n]:{tracks:t}}}=e;for(const i in t)if(t[i].enabled)return t[i];return null},SUBTITLES:(n,e)=>()=>{const{mediaTypes:{[n]:{tracks:t}}}=e;for(const i in t)if(t[i].mode==="showing"||t[i].mode==="hidden")return t[i];return null}},rg=(n,{mediaTypes:e})=>()=>{const t=e[n].activeTrack();return t?e[n].activeGroup(t):null},sg=n=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(h=>{tg[h](h,n)});const{mediaTypes:e,mainPlaylistLoader:t,tech:i,vhs:r,segmentLoaders:{["AUDIO"]:a,main:o}}=n;["AUDIO","SUBTITLES"].forEach(h=>{e[h].activeGroup=ig(h,n),e[h].activeTrack=ng[h](h,n),e[h].onGroupChanged=Jp(h,n),e[h].onGroupChanging=Zp(h,n),e[h].onTrackChanged=eg(h,n),e[h].getActiveGroup=rg(h,n)});const d=e.AUDIO.activeGroup();if(d){const h=(d.filter(y=>y.default)[0]||d[0]).id;e.AUDIO.tracks[h].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(o.setAudio(!1),a.setAudio(!0)):o.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(h=>e[h].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(h=>e[h].onGroupChanging())});const m=()=>{e.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"vhs-audio-change"})};i.audioTracks().addEventListener("change",m),i.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",()=>{i.audioTracks().removeEventListener("change",m),i.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),i.clearTracks("audio");for(const h in e.AUDIO.tracks)i.audioTracks().addTrack(e.AUDIO.tracks[h])},ag=()=>{const n={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{n[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:Dt,activeTrack:Dt,getActiveGroup:Dt,onGroupChanged:Dt,onTrackChanged:Dt,lastTrack_:null,logger_:nt(`MediaGroups[${e}]`)}}),n};class Ma{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=Xe(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class og extends H.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new Ma,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=nt("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const i=t.serverUri||t.serverURL;if(!i){this.logger_(`steering manifest URL is ${i}, cannot request steering manifest.`),this.trigger("error");return}if(i.startsWith("data:")){this.decodeDataUriManifest_(i.substring(i.indexOf(",")+1));return}this.steeringManifest.reloadUri=Xe(e,i),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const i=e?t:this.getRequestURI(t);if(!i){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const r={contentSteeringInfo:{uri:i}};this.trigger({type:"contentsteeringloadstart",metadata:r}),this.request_=this.xhr_({uri:i,requestType:"content-steering-manifest"},(a,o)=>{if(a){if(o.status===410){this.logger_(`manifest request 410 ${a}.`),this.logger_(`There will be no more content steering requests to ${i} this session.`),this.excludedSteeringManifestURLs.add(i);return}if(o.status===429){const h=o.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${a}.`),this.logger_(`content steering will retry in ${h} seconds.`),this.startTTLTimeout_(parseInt(h,10));return}this.logger_(`manifest failed to load ${a}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:r});let d;try{d=JSON.parse(this.request_.responseText)}catch(h){const g={errorType:H.Error.StreamingContentSteeringParserError,error:h};this.trigger({type:"error",metadata:g})}this.assignSteeringProperties_(d);const m={contentSteeringInfo:r.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:m}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new W.URL(e),i=new W.URL(this.proxyServerUrl_);return i.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(i.toString())}decodeDataUriManifest_(e){const t=JSON.parse(W.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new W.URL(e),i=this.getPathway(),r=this.getBandwidth_();if(i){const a=`_${this.manifestType_}_pathway`;t.searchParams.set(a,i)}if(r){const a=`_${this.manifestType_}_throughput`;t.searchParams.set(a,r)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const i=(r=>{for(const a of r)if(this.availablePathways_.has(a))return a;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==i&&(this.currentPathway=i,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=r=>this.excludedSteeringManifestURLs.has(r);if(this.proxyServerUrl_){const r=this.setProxyServerUrl_(e);if(!t(r))return r}const i=this.setSteeringParams_(e);return t(i)?null:i}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=W.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){W.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new Ma}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(Xe(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const lg=(n,e)=>{let t=null;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{n.apply(null,i)},e)}},dg=10;let Ut;const ug=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],cg=function(n){return this.audioSegmentLoader_[n]+this.mainSegmentLoader_[n]},hg=function({currentPlaylist:n,buffered:e,currentTime:t,nextPlaylist:i,bufferLowWaterLine:r,bufferHighWaterLine:a,duration:o,bufferBasedABR:d,log:m}){if(!i)return H.log.warn("We received no playlist to switch to. Please check your stream."),!1;const h=`allowing switch ${n&&n.id||"null"} -> ${i.id}`;if(!n)return m(`${h} as current playlist is not set`),!0;if(i.id===n.id)return!1;const g=!!ri(e,t).length;if(!n.endList)return!g&&typeof n.partTargetDuration=="number"?(m(`not ${h} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(m(`${h} as current playlist is live`),!0);const y=rs(e,t),S=d?Me.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Me.MAX_BUFFER_LOW_WATER_LINE;if(o<S)return m(`${h} as duration < max low water line (${o} < ${S})`),!0;const x=i.attributes.BANDWIDTH,_=n.attributes.BANDWIDTH;if(x<_&&(!d||y<a)){let T=`${h} as next bandwidth < current bandwidth (${x} < ${_})`;return d&&(T+=` and forwardBuffer < bufferHighWaterLine (${y} < ${a})`),m(T),!0}if((!d||x>_)&&y>=r){let T=`${h} as forwardBuffer >= bufferLowWaterLine (${y} >= ${r})`;return d&&(T+=` and next bandwidth > current bandwidth (${x} > ${_})`),m(T),!0}return m(`not ${h} as no switching criteria met`),!1};class fg extends H.EventTarget{constructor(e){super(),this.fastQualityChange_=lg(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:i,tech:r,bandwidth:a,externVhs:o,useCueTags:d,playlistExclusionDuration:m,enableLowInitialPlaylist:h,sourceType:g,cacheEncryptionKeys:y,bufferBasedABR:S,leastPixelDiffSelector:x,captionServices:_,experimentalUseMMS:T}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:v}=e;(v===null||typeof v>"u")&&(v=1/0),Ut=o,this.bufferBasedABR=!!S,this.leastPixelDiffSelector=!!x,this.withCredentials=i,this.tech_=r,this.vhs_=r.vhs,this.player_=e.player_,this.sourceType_=g,this.useCueTags_=d,this.playlistExclusionDuration=m,this.maxPlaylistRetries=v,this.enableLowInitialPlaylist=h,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:i,maxPlaylistRetries:v,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=ag(),T&&W.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new W.ManagedMediaSource,this.usingManagedMediaSource_=!0,H.log("Using ManagedMediaSource")):W.MediaSource&&(this.mediaSource=new W.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=Re(),this.hasPlayed_=!1,this.syncController_=new zp(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new Xp,this.sourceUpdater_=new Tl(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new Qp,this.keyStatusMap_=new Map;const E={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:a,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:y,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new qr(t,this.vhs_,de(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new si(t,this.vhs_,de(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new Hr(de(E,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new Hr(de(E,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new qp(de(E,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((A,k)=>{function U(){r.off("vttjserror",L),A()}function L(){r.off("vttjsloaded",U),k()}r.one("vttjsloaded",U),r.one("vttjserror",L),r.addWebVttScript_()})}),e);const P=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new og(this.vhs_.xhr,P),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),ug.forEach(A=>{this[A+"_"]=cg.bind(this,A)}),this.logger_=nt("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const O=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(O,()=>{const A=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-A,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,i){const r=this.media(),a=r&&(r.id||r.uri),o=e&&(e.id||e.uri);if(a&&a!==o){this.logger_(`switch media ${a} -> ${o} from ${t}`);const d={renditionInfo:{id:o,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:d}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,i)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],i=t?t.activeGroup():null,r=this.contentSteeringController_.getPathway();if(i&&r){const o=(i.length?i[0].playlists:i.playlists).filter(d=>d.attributes.serviceLocation===r);o.length&&this.mediaTypes_[e].activePlaylistLoader.media(o[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=W.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(W.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const i=e.mediaGroups.AUDIO,r=Object.keys(i);let a;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)a=this.mediaTypes_.AUDIO.activeTrack();else{const d=i.main||r.length&&i[r[0]];for(const m in d)if(d[m].default){a={label:m};break}}if(!a)return t;const o=[];for(const d in i)if(i[d][a.label]){const m=i[d][a.label];if(m.playlists&&m.playlists.length)o.push.apply(o,m.playlists);else if(m.uri)o.push(m);else if(e.playlists.length)for(let h=0;h<e.playlists.length;h++){const g=e.playlists[h];g.attributes&&g.attributes.AUDIO&&g.attributes.AUDIO===d&&o.push(g)}}return o.length?o:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const t=this.mainPlaylistLoader_.media(),i=t.targetDuration*1.5*1e3;Br(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=i,t.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.mainSegmentLoader_.load()),sg({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),t),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let t=this.mainPlaylistLoader_.media();if(!t){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let i;if(this.enableLowInitialPlaylist&&(i=this.selectInitialPlaylist()),i||(i=this.selectPlaylist()),!i||!this.shouldSwitchToMedia_(i)||(this.initialMedia_=i,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;t=this.initialMedia_}this.handleUpdatedMediaPlaylist(t)}),this.mainPlaylistLoader_.on("error",()=>{const t=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const t=this.mainPlaylistLoader_.media(),i=t.targetDuration*1.5*1e3;Br(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=i,this.sourceType_==="dash"&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const t=this.mainPlaylistLoader_.media();if(t.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(t)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(t=>{this.mainPlaylistLoader_.on(t,i=>{this.player_.trigger(ze({},i))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const i=e.mediaGroups||{};let r=!0;const a=Object.keys(i.AUDIO);for(const o in i.AUDIO)for(const d in i.AUDIO[o])i.AUDIO[o][d].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Ut.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),a.length&&Object.keys(i.AUDIO[a[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,i=this.tech_.currentTime(),r=this.bufferLowWaterLine(),a=this.bufferHighWaterLine(),o=this.tech_.buffered();return hg({buffered:o,currentTime:i,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:a,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const i=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:i.playlist,error:i})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const i=this.audioSegmentLoader_.pendingSegment_;if(!i||!i.segment||!i.segment.syncInfo)return;const r=i.segment.syncInfo.end+.01;this.tech_.setCurrentTime(r)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",i=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:dg}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const i=this.getCodecsOrExclude_();i&&this.sourceUpdater_.addOrChangeSourceBuffers(i)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(i=>{this.mainSegmentLoader_.on(i,r=>{this.player_.trigger(ze({},r))}),this.audioSegmentLoader_.on(i,r=>{this.player_.trigger(ze({},r))}),this.subtitleSegmentLoader_.on(i,r=>{this.player_.trigger(ze({},r))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const i=t.end(0);let r=i;if(e.start){const a=e.start.timeOffset;a<0?r=Math.max(i+a,t.start(0)):r=Math.min(i,a)}this.trigger("firstplay"),this.tech_.setCurrentTime(r)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const i=this.syncController_.getExpiredTime(e,this.duration());if(i===null)return!1;const r=Ut.Playlist.playlistEnd(e,i),a=this.tech_.currentTime(),o=this.tech_.buffered();if(!o.length)return r-a<=pt;const d=o.end(o.length-1);return d-a<=pt&&r-d<=pt}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:i}){if(e=e||this.mainPlaylistLoader_.media(),i=i||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,a=r.filter(Wn),o=a.length===1&&a[0]===e;if(r.length===1&&i!==1/0)return H.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(o);if(o){if(this.main().contentSteering){const _=this.pathwayAttribute_(e),T=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(_),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(_)},T);return}let x=!1;r.forEach(_=>{if(_===e)return;const T=_.excludeUntil;typeof T<"u"&&T!==1/0&&(x=!0,delete _.excludeUntil)}),x&&(H.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let d;e.playlistErrors_>this.maxPlaylistRetries?d=1/0:d=Date.now()+i*1e3,e.excludeUntil=d,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const m=this.selectPlaylist();if(!m){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const h=t.internal?this.logger_:H.log.warn,g=t.message?" "+t.message:"";h(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${g} Switching to playlist ${m.id}.`),m.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),m.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const y=m.targetDuration/2*1e3||5*1e3,S=typeof m.lastRequest=="number"&&Date.now()-m.lastRequest<=y;return this.switchMedia_(m,"exclude",o||S)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const i=[],r=e==="all";(r||e==="main")&&i.push(this.mainPlaylistLoader_);const a=[];(r||e==="audio")&&a.push("AUDIO"),(r||e==="subtitle")&&(a.push("CLOSED-CAPTIONS"),a.push("SUBTITLES")),a.forEach(o=>{const d=this.mediaTypes_[o]&&this.mediaTypes_[o].activePlaylistLoader;d&&i.push(d)}),["main","audio","subtitle"].forEach(o=>{const d=this[`${o}SegmentLoader_`];d&&(e===o||e==="all")&&i.push(d)}),i.forEach(o=>t.forEach(d=>{typeof o[d]=="function"&&o[d]()}))}setCurrentTime(e){const t=ri(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Ut.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const i=e.media();if(!i)return null;const r=this.syncController_.getMediaSequenceSync(t);if(r&&r.isReliable){const d=r.start,m=r.end;if(!isFinite(d)||!isFinite(m))return null;const h=Ut.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i),g=Math.max(d,m-h);return Re([[d,g]])}const a=this.syncController_.getExpiredTime(i,this.duration());if(a===null)return null;const o=Ut.Playlist.seekable(i,a,Ut.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,i));return o.length?o:null}computeFinalSeekable_(e,t){if(!t)return e;const i=e.start(0),r=e.end(0),a=t.start(0),o=t.end(0);return a>r||i>o?e:Re([[Math.max(i,a),Math.min(r,o)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const i=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_||i&&i.length&&this.seekable_.length&&i.start(0)===this.seekable_.start(0)&&i.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${Ro(this.seekable_)}]`);const r={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:r}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}const t=this.tech_.buffered();let i=Ut.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(i=Math.max(i,t.end(t.length-1))),this.mediaSource.duration!==i&&this.sourceUpdater_.setDuration(i)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const i in t)t[i].forEach(r=>{r.playlistLoader&&r.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),i=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!i)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const i=Fi(this.main(),t),r={},a=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=i.video||e.main.videoCodec||Oc),e.main.isMuxed&&(r.video+=`,${i.audio||e.main.audioCodec||ua}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||a)&&(r.audio=i.audio||e.main.audioCodec||e.audio.audioCodec||ua,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const o=(h,g)=>h?Bi(g,this.usingManagedMediaSource_):ur(g),d={};let m;if(["video","audio"].forEach(function(h){if(r.hasOwnProperty(h)&&!o(e[h].isFmp4,r[h])){const g=e[h].isFmp4?"browser":"muxer";d[g]=d[g]||[],d[g].push(r[h]),h==="audio"&&(m=g)}}),a&&m&&t.attributes.AUDIO){const h=t.attributes.AUDIO;this.main().playlists.forEach(g=>{(g.attributes&&g.attributes.AUDIO)===h&&g!==t&&(g.excludeUntil=1/0)}),this.logger_(`excluding audio group ${h} as ${m} does not support codec(s): "${r.audio}"`)}if(Object.keys(d).length){const h=Object.keys(d).reduce((g,y)=>(g&&(g+=", "),g+=`${y} does not support codec(s): "${d[y].join(",")}"`,g),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:h},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const h=[];if(["video","audio"].forEach(g=>{const y=(It(this.sourceUpdater_.codecs[g]||"")[0]||{}).type,S=(It(r[g]||"")[0]||{}).type;y&&S&&y.toLowerCase()!==S.toLowerCase()&&h.push(`"${this.sourceUpdater_.codecs[g]}" -> "${r[g]}"`)}),h.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${h.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return r}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(i=>{const r=e[i];if(t.indexOf(r.id)!==-1)return;t.push(r.id);const a=Fi(this.main,r),o=[];a.audio&&!ur(a.audio)&&!Bi(a.audio,this.usingManagedMediaSource_)&&o.push(`audio codec ${a.audio}`),a.video&&!ur(a.video)&&!Bi(a.video,this.usingManagedMediaSource_)&&o.push(`video codec ${a.video}`),a.text&&a.text==="stpp.ttml.im1t"&&o.push(`text codec ${a.text}`),o.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${o.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],i=this.main().playlists,r=ji(It(e)),a=pa(r),o=r.video&&It(r.video)[0]||null,d=r.audio&&It(r.audio)[0]||null;Object.keys(i).forEach(m=>{const h=i[m];if(t.indexOf(h.id)!==-1||h.excludeUntil===1/0)return;t.push(h.id);const g=[],y=Fi(this.mainPlaylistLoader_.main,h),S=pa(y);if(!(!y.audio&&!y.video)){if(S!==a&&g.push(`codec count "${S}" !== "${a}"`),!this.sourceUpdater_.canChangeType()){const x=y.video&&It(y.video)[0]||null,_=y.audio&&It(y.audio)[0]||null;x&&o&&x.type.toLowerCase()!==o.type.toLowerCase()&&g.push(`video codec "${x.type}" !== "${o.type}"`),_&&d&&_.type.toLowerCase()!==d.type.toLowerCase()&&g.push(`audio codec "${_.type}" !== "${d.type}"`)}g.length&&(h.excludeUntil=1/0,this.logger_(`excluding ${h.id}: ${g.join(" && ")}`))}})}updateAdCues_(e){let t=0;const i=this.seekable();i.length&&(t=i.start(0)),Vp(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Me.GOAL_BUFFER_LENGTH,i=Me.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Me.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*i,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Me.BUFFER_LOW_WATER_LINE,i=Me.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Me.MAX_BUFFER_LOW_WATER_LINE),a=Math.max(t,Me.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*i,this.bufferBasedABR?a:r)}bufferHighWaterLine(){return Me.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){wa(this.inbandTextTracks_,"com.apple.streaming",this.tech_),wp({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,i){const r=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();wa(this.inbandTextTracks_,e,this.tech_),bp({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:r,videoDuration:i})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(t=>{this.contentSteeringController_.on(t,i=>{this.trigger(ze({},i))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const t=this.main();(this.contentSteeringController_.didDASHTagChange(t.uri,t.contentSteering)||(()=>{const a=this.contentSteeringController_.getAvailablePathways(),o=[];for(const d of t.playlists){const m=d.attributes.serviceLocation;if(m&&(o.push(m),!a.has(m)))return!0}return!!(!o.length&&a.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const i=this.main().playlists,r=new Set;let a=!1;Object.keys(i).forEach(o=>{const d=i[o],m=this.pathwayAttribute_(d),h=m&&e!==m;d.excludeUntil===1/0&&d.lastExcludeReason_==="content-steering"&&!h&&(delete d.excludeUntil,delete d.lastExcludeReason_,a=!0);const y=!d.excludeUntil&&d.excludeUntil!==1/0;!r.has(d.id)&&h&&y&&(r.add(d.id),d.excludeUntil=1/0,d.lastExcludeReason_="content-steering",this.logger_(`excluding ${d.id} for ${d.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(o=>{const d=this.mediaTypes_[o];if(d.activePlaylistLoader){const m=d.activePlaylistLoader.media_;m&&m.attributes.serviceLocation!==e&&(a=!0)}}),a&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,i=this.contentSteeringController_.currentPathwayClones,r=this.contentSteeringController_.nextPathwayClones;if(i&&i.size||r&&r.size){for(const[o,d]of i.entries())r.get(o)||(this.mainPlaylistLoader_.updateOrDeleteClone(d),this.contentSteeringController_.excludePathway(o));for(const[o,d]of r.entries()){const m=i.get(o);if(!m){t.filter(g=>g.attributes["PATHWAY-ID"]===d["BASE-ID"]).forEach(g=>{this.mainPlaylistLoader_.addClonePathway(d,g)}),this.contentSteeringController_.addAvailablePathway(o);continue}this.equalPathwayClones_(m,d)||(this.mainPlaylistLoader_.updateOrDeleteClone(d,!0),this.contentSteeringController_.addAvailablePathway(o))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...r])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const i=e["URI-REPLACEMENT"].PARAMS,r=t["URI-REPLACEMENT"].PARAMS;for(const a in i)if(i[a]!==r[a])return!1;for(const a in r)if(i[a]!==r[a])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(i=>{const r=this.mainPlaylistLoader_.getKeyIdSet(i);!r||!r.size||r.forEach(a=>{const o="usable",d=this.keyStatusMap_.has(a)&&this.keyStatusMap_.get(a)===o,m=i.lastExcludeReason_===t&&i.excludeUntil===1/0;d?d&&m&&(delete i.excludeUntil,delete i.lastExcludeReason_,this.logger_(`enabling playlist ${i.id} because key ID ${a} is ${o}`)):(i.excludeUntil!==1/0&&i.lastExcludeReason_!==t&&(i.excludeUntil=1/0,i.lastExcludeReason_=t,this.logger_(`excluding playlist ${i.id} because the key ID ${a} doesn't exist in the keyStatusMap or is not ${o}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(i=>{const r=i&&i.attributes&&i.attributes.RESOLUTION&&i.attributes.RESOLUTION.height<720,a=i.excludeUntil===1/0&&i.lastExcludeReason_===t;r&&a&&(delete i.excludeUntil,H.log.warn(`enabling non-HD playlist ${i.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const a=(typeof e=="string"?e:$p(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${a} added to the keyStatusMap`),this.keyStatusMap_.set(a,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const mg=(n,e,t)=>i=>{const r=n.main.playlists[e],a=as(r),o=Wn(r);if(typeof i>"u")return o;i?delete r.disabled:r.disabled=!0;const d={renditionInfo:{id:e,bandwidth:r.attributes.BANDWIDTH,resolution:r.attributes.RESOLUTION,codecs:r.attributes.CODECS},cause:"fast-quality"};return i!==o&&!a&&(i?(t(r),n.trigger({type:"renditionenabled",metadata:d})):n.trigger({type:"renditiondisabled",metadata:d})),i};class pg{constructor(e,t,i){const{playlistController_:r}=e,a=r.fastQualityChange_.bind(r);if(t.attributes){const o=t.attributes.RESOLUTION;this.width=o&&o.width,this.height=o&&o.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=Fi(r.main(),t),this.playlist=t,this.id=i,this.enabled=mg(e.playlists,t.id,a)}}const gg=function(n){n.representations=()=>{const e=n.playlistController_.main(),t=Wi(e)?n.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(i=>!as(i)).map((i,r)=>new pg(n,i,i.id)):[]}},Ra=["seeking","seeked","pause","playing","error"];class yg extends H.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=nt("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),i=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),a=()=>this.resetTimeUpdate_(),o=this.playlistController_,d=["main","subtitle","audio"],m={};d.forEach(g=>{m[g]={reset:()=>this.resetSegmentDownloads_(g),updateend:()=>this.checkSegmentDownloads_(g)},o[`${g}SegmentLoader_`].on("appendsdone",m[g].updateend),o[`${g}SegmentLoader_`].on("playlistupdate",m[g].reset),this.tech_.on(["seeked","seeking"],m[g].reset)});const h=g=>{["main","audio"].forEach(y=>{o[`${y}SegmentLoader_`][g]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),h("off"))},this.clearSeekingAppendCheck_=()=>h("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),h("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(Ra,a),this.tech_.on("canplay",i),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(Ra,a),this.tech_.off("canplay",i),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),d.forEach(g=>{o[`${g}SegmentLoader_`].off("appendsdone",m[g].updateend),o[`${g}SegmentLoader_`].off("playlistupdate",m[g].reset),this.tech_.off(["seeked","seeking"],m[g].reset)}),this.checkCurrentTimeTimeout_&&W.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&W.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=W.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,i=t[`${e}SegmentLoader_`],r=i.buffered_(),a=im(this[`${e}Buffered_`],r);if(this[`${e}Buffered_`]=r,a){const o={bufferedRanges:r};t.trigger({type:"bufferedrangeschanged",metadata:o}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:i.playlist_&&i.playlist_.id,buffered:Jt(r)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+pt>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(Re([this.lastRecordedTime,e]));const i={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:i}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),i=this.tech_.currentTime(),r=this.afterSeekableWindow_(t,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let a;if(r&&(a=t.end(t.length-1)),this.beforeSeekableWindow_(t,i)){const _=t.start(0);a=_+(_===t.end(0)?0:pt)}if(typeof a<"u")return this.logger_(`Trying to seek outside of seekable at time ${i} with seekable range ${Ro(t)}. Seeking to ${a}.`),this.tech_.setCurrentTime(a),!0;const o=this.playlistController_.sourceUpdater_,d=this.tech_.buffered(),m=o.audioBuffer?o.audioBuffered():null,h=o.videoBuffer?o.videoBuffered():null,g=this.media(),y=g.partTargetDuration?g.partTargetDuration:(g.targetDuration-mt)*2,S=[m,h];for(let _=0;_<S.length;_++){if(!S[_])continue;if(rs(S[_],i)<y)return!1}const x=Tn(d,i);return x.length===0?!1:(a=x.start(0)+pt,this.logger_(`Buffered region starts (${x.start(0)})  just beyond seek point (${i}). Seeking to ${a}.`),this.tech_.setCurrentTime(a),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),i=ri(t,e);if(i.length&&e+3<=i.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${i.start(0)} -> ${i.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const d=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${d}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(d),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const i=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:i.audioBuffered(),videoBuffered:i.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const o=Tn(r,t);return o.length>0?(this.logger_(`Stopped at ${t} and seeking to ${o.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,i,r=!1){if(!e.length)return!1;let a=e.end(e.length-1)+pt;const o=!i.endList,d=typeof i.partTargetDuration=="number";return o&&(d||r)&&(a=e.end(e.length-1)+i.targetDuration*3),t>a}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:i}){if(!e)return;let r;if(e.length&&t.length){const a=ri(e,i-3),o=ri(e,i),d=ri(t,i);d.length&&!o.length&&a.length&&(r={start:a.end(0),end:d.end(0)})}else Tn(e,i).length||(r=this.gapFromVideoUnderflow_(e,i));return r?(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${i}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),i=this.tech_.currentTime(),r=Tn(t,i);if(this.resetTimeUpdate_(),r.length===0||i!==e)return;this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+mt);const a={gapInfo:{from:i,to:r.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:a}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const i=Zf(e);for(let r=0;r<i.length;r++){const a=i.start(r),o=i.end(r);if(t-a<4&&t-a>2)return{start:a,end:o}}return null}}const _g={errorInterval:30,getSource(n){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return n(t)}},xl=function(n,e){let t=0,i=0;const r=de(_g,e);n.ready(()=>{n.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const a=function(){i&&n.currentTime(i)},o=function(g){g!=null&&(i=n.duration()!==1/0&&n.currentTime()||0,n.one("loadedmetadata",a),n.src(g),n.trigger({type:"usage",name:"vhs-error-reload"}),n.play())},d=function(){if(Date.now()-t<r.errorInterval*1e3){n.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){H.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),r.getSource.call(n,o)},m=function(){n.off("loadedmetadata",a),n.off("error",d),n.off("dispose",m)},h=function(g){m(),xl(n,g)};n.on("error",d),n.on("dispose",m),n.reloadSourceOnError=h},vg=function(n){xl(this,n)};var Pl="3.17.2",bg="7.1.0",Tg="1.3.1",Sg="7.2.0",wg="4.0.2";const Ee={PlaylistLoader:si,Playlist:Ke,utils:Im,STANDARD_PLAYLIST_SELECTOR:Sa,INITIAL_PLAYLIST_SELECTOR:pp,lastBandwidthSelector:Sa,movingAverageBandwidthSelector:fp,comparePlaylistBandwidth:ds,comparePlaylistResolution:hp,xhr:Zo()};Object.keys(Me).forEach(n=>{Object.defineProperty(Ee,n,{get(){return H.log.warn(`using Vhs.${n} is UNSAFE be sure you know what you are doing`),Me[n]},set(e){if(H.log.warn(`using Vhs.${n} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){H.log.warn(`value of Vhs.${n} must be greater than or equal to 0`);return}Me[n]=e}})});const Cl="videojs-vhs",Il=function(n,e){const t=e.media();let i=-1;for(let r=0;r<n.length;r++)if(n[r].id===t.id){i=r;break}n.selectedIndex_=i,n.trigger({selectedIndex:i,type:"change"})},Eg=function(n,e){e.representations().forEach(t=>{n.addQualityLevel(t)}),Il(n,e.playlists)};Ee.canPlaySource=function(){return H.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const xg=(n,e,t)=>{if(!n)return n;let i={};e&&e.attributes&&e.attributes.CODECS&&(i=ji(It(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(i.audio=t.attributes.CODECS);const r=Un(i.video),a=Un(i.audio),o={};for(const d in n)o[d]={},a&&(o[d].audioContentType=a),r&&(o[d].videoContentType=r),e.contentProtection&&e.contentProtection[d]&&e.contentProtection[d].pssh&&(o[d].pssh=e.contentProtection[d].pssh),typeof n[d]=="string"&&(o[d].url=n[d]);return de(n,o)},Pg=(n,e)=>n.reduce((t,i)=>{if(!i.contentProtection)return t;const r=e.reduce((a,o)=>{const d=i.contentProtection[o];return d&&d.pssh&&(a[o]={pssh:d.pssh}),a},{});return Object.keys(r).length&&t.push(r),t},[]),Cg=({player:n,sourceKeySystems:e,audioMedia:t,mainPlaylists:i})=>{if(!n.eme.initializeMediaKeys)return Promise.resolve();const r=t?i.concat([t]):i,a=Pg(r,Object.keys(e)),o=[],d=[];return a.forEach(m=>{d.push(new Promise((h,g)=>{n.tech_.one("keysessioncreated",h)})),o.push(new Promise((h,g)=>{n.eme.initializeMediaKeys({keySystems:m},y=>{if(y){g(y);return}h()})}))}),Promise.race([Promise.all(o),Promise.race(d)])},Ig=({player:n,sourceKeySystems:e,media:t,audioMedia:i})=>{const r=xg(e,t,i);return r?(n.currentSource().keySystems=r,r&&!n.eme?(H.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},Dl=()=>{if(!W.localStorage)return null;const n=W.localStorage.getItem(Cl);if(!n)return null;try{return JSON.parse(n)}catch{return null}},Dg=n=>{if(!W.localStorage)return!1;let e=Dl();e=e?de(e,n):n;try{W.localStorage.setItem(Cl,JSON.stringify(e))}catch{return!1}return e},Ag=n=>n.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(n.substring(n.indexOf(",")+1)):n,Al=(n,e)=>{n._requestCallbackSet||(n._requestCallbackSet=new Set),n._requestCallbackSet.add(e)},Ol=(n,e)=>{n._responseCallbackSet||(n._responseCallbackSet=new Set),n._responseCallbackSet.add(e)},Ll=(n,e)=>{n._requestCallbackSet&&(n._requestCallbackSet.delete(e),n._requestCallbackSet.size||delete n._requestCallbackSet)},Ml=(n,e)=>{n._responseCallbackSet&&(n._responseCallbackSet.delete(e),n._responseCallbackSet.size||delete n._responseCallbackSet)};Ee.supportsNativeHls=(function(){if(!lt||!lt.createElement)return!1;const n=lt.createElement("video");return H.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(n.canPlayType(t))}):!1})();Ee.supportsNativeDash=(function(){return!lt||!lt.createElement||!H.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(lt.createElement("video").canPlayType("application/dash+xml"))})();Ee.supportsTypeNatively=n=>n==="hls"?Ee.supportsNativeHls:n==="dash"?Ee.supportsNativeDash:!1;Ee.isSupported=function(){return H.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};Ee.xhr.onRequest=function(n){Al(Ee.xhr,n)};Ee.xhr.onResponse=function(n){Ol(Ee.xhr,n)};Ee.xhr.offRequest=function(n){Ll(Ee.xhr,n)};Ee.xhr.offResponse=function(n){Ml(Ee.xhr,n)};const Og=H.getComponent("Component");class Rl extends Og{constructor(e,t,i){if(super(t,i.vhs),typeof i.initialBandwidth=="number"&&(this.options_.bandwidth=i.initialBandwidth),this.logger_=nt("VhsHandler"),t.options_&&t.options_.playerId){const r=H.getPlayer(t.options_.playerId);this.player_=r}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(lt,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],r=>{const a=lt.fullscreenElement||lt.webkitFullscreenElement||lt.mozFullScreenElement||lt.msFullscreenElement;a&&a.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=de(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=typeof this.options_.useNetworkInformationApi<"u"?this.options_.useNetworkInformationApi:!0,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const i=Dl();i&&i.bandwidth&&(this.options_.bandwidth=i.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),i&&i.throughput&&(this.options_.throughput=i.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=Me.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Me.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(i=>{typeof this.source_[i]<"u"&&(this.options_[i]=this.source_[i])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=Ag(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Ee,this.options_.sourceType=xo(t),this.options_.seekTo=a=>{this.tech_.setCurrentTime(a)},this.options_.player_=this.player_,this.playlistController_=new fg(this.options_);const i=de({liveRangeSafeTimeDelta:pt},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new yg(i),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const a=H.players[this.tech_.options_.playerId];let o=this.playlistController_.error;typeof o=="object"&&!o.code?o.code=3:typeof o=="string"&&(o={message:o,code:3}),a.error(o)});const r=this.options_.bufferBasedABR?Ee.movingAverageBandwidthSelector(.55):Ee.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=Ee.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(a){this.playlistController_.selectPlaylist=a.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(a){this.playlistController_.mainSegmentLoader_.throughput.rate=a,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let a=this.playlistController_.mainSegmentLoader_.bandwidth;const o=W.navigator.connection||W.navigator.mozConnection||W.navigator.webkitConnection,d=1e7;if(this.options_.useNetworkInformationApi&&o){const m=o.downlink*1e3*1e3;m>=d&&a>=d?a=Math.max(a,m):a=m}return a},set(a){this.playlistController_.mainSegmentLoader_.bandwidth=a,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const a=1/(this.bandwidth||1);let o;return this.throughput>0?o=1/this.throughput:o=0,Math.floor(1/(a+o))},set(){H.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>Jt(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>Jt(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&Dg({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{gg(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=W.URL.createObjectURL(this.playlistController_.mediaSource),(H.browser.IS_ANY_SAFARI||H.browser.IS_IOS)&&this.options_.overrideNative&&this.options_.sourceType==="hls"&&typeof this.tech_.addSourceElement=="function"?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),Cg({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=Ig({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",i=>{this.playlistController_.updatePlaylistByKeyStatus(i.keyId,i.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=H.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{Eg(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{Il(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":Pl,"mux.js":bg,"mpd-parser":Tg,"m3u8-parser":Sg,"aes-decrypter":wg}}version(){return this.constructor.version()}canChangeType(){return Tl.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&W.URL.revokeObjectURL&&(W.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return km({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,i=!0,r=2){return rl({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{Al(this.xhr,e)},this.xhr.onResponse=e=>{Ol(this.xhr,e)},this.xhr.offRequest=e=>{Ll(this.xhr,e)},this.xhr.offResponse=e=>{Ml(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(i=>{this.playlistController_.on(i,r=>{this.player_.trigger(ze({},r))})}),t.forEach(i=>{this.playbackWatcher_.on(i,r=>{this.player_.trigger(ze({},r))})})}}const $n={name:"videojs-http-streaming",VERSION:Pl,canHandleSource(n,e={}){const t=de(H.options,e);return!t.vhs.experimentalUseMMS&&!Bi("avc1.4d400d,mp4a.40.2",!1)?!1:$n.canPlayType(n.type,t)},handleSource(n,e,t={}){const i=de(H.options,t);return e.vhs=new Rl(n,e,i),e.vhs.xhr=Zo(),e.vhs.setupXhrHooks_(),e.vhs.src(n.src,n.type),e.vhs},canPlayType(n,e){const t=xo(n);if(!t)return"";const i=$n.getOverrideNative(e);return!Ee.supportsTypeNatively(t)||i?"maybe":""},getOverrideNative(n={}){const{vhs:e={}}=n,t=!(H.browser.IS_ANY_SAFARI||H.browser.IS_IOS),{overrideNative:i=t}=e;return i}},Lg=()=>Bi("avc1.4d400d,mp4a.40.2",!0);Lg()&&H.getTech("Html5").registerSourceHandler($n,0);H.VhsHandler=Rl;H.VhsSourceHandler=$n;H.Vhs=Ee;H.use||H.registerComponent("Vhs",Ee);H.options.vhs=H.options.vhs||{};(!H.getPlugin||!H.getPlugin("reloadSourceOnError"))&&H.registerPlugin("reloadSourceOnError",vg);Hc();const Rn=({src:n,onEnded:e})=>{const t=le.useRef(null),i=le.useRef(null),r=le.useRef(null),a=mc(),o=pc(d=>d.settings.volume);return le.useEffect(()=>{if(!t.current||!n)return;const d=n.includes("youtube.com")||n.includes("youtu.be");i.current=H(t.current,{controls:!0,autoplay:!0,fluid:!0,responsive:!0,aspectRatio:"16:9",bigPlayButton:!1,preload:"auto",sources:d?[{src:n,type:"video/youtube"}]:[{src:n,type:n.includes(".m3u8")?"application/x-mpegURL":"video/mp4"}],techOrder:d?["youtube","html5"]:["html5"]});const m=i.current;return m&&(m.fill(!0),m.volume(o),m.on("volumechange",()=>{const h=m.volume();a(gc(h))}),m.on("error",h=>{console.error("Video player error:",h)}),m.on("loadedmetadata",()=>{m.paused()&&m.play()?.catch(h=>{console.warn("Play failed:",h)})}),e&&m.on("ended",e)),()=>{if(r.current&&(clearTimeout(r.current),r.current=null),i.current&&!i.current.isDisposed())try{try{i.current.pause()}catch{}r.current=window.setTimeout(()=>{try{i.current&&!i.current.isDisposed()&&i.current.dispose()}catch(h){console.warn("Error during Video.js dispose:",h)}i.current=null,r.current=null},50)}catch(h){console.warn("Error during Video.js dispose scheduling:",h);try{i.current.dispose()}catch{}i.current=null}}},[n]),n?D.jsx("div",{"data-vjs-player":!0,children:D.jsx("video",{ref:t,className:"video-js vjs-default-skin"})}):null},Mg=({src:n,title:e="TikTok Video",autoplayEnabled:t=!1})=>{const i=le.useRef(null),r=yt();return le.useEffect(()=>{const a=o=>{if(o.origin!=="https://www.tiktok.com"||!o.data||typeof o.data!="object")return;const{type:d,value:m,["x-tiktok-player"]:h}=o.data;h&&d==="onStateChange"&&(m===0&&t&&r(dt({set:!0})),i.current?.contentWindow?.postMessage({type:"unMute","x-tiktok-player":!0},"*"))};return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},[r,t]),D.jsx("iframe",{ref:i,src:n,title:e,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay; fullscreen",allowFullScreen:!0})};function Rg(n){const e=ke.c(8),{src:t,title:i,autoplayEnabled:r,dispatch:a}=n;let o,d;e[0]!==r||e[1]!==a?(o=()=>{if(r){const g=setTimeout(()=>{a(dt({set:!0}))},5e3);return()=>clearTimeout(g)}},d=[r,a],e[0]=r,e[1]=a,e[2]=o,e[3]=d):(o=e[2],d=e[3]),le.useEffect(o,d);let m;e[4]===Symbol.for("react.memo_cache_sentinel")?(m={width:"100%",height:"100%",objectFit:"contain",display:"block",background:"black"},e[4]=m):m=e[4];let h;return e[5]!==t||e[6]!==i?(h=D.jsx("img",{src:t,alt:i,style:m}),e[5]=t,e[6]=i,e[7]=h):h=e[7],h}var Ht={},St={},vr={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var ka;function rt(){return ka||(ka=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var a="",o=0;o<arguments.length;o++){var d=arguments[o];d&&(a=r(a,i(d)))}return a}function i(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return t.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var d in a)e.call(a,d)&&a[d]&&(o=r(o,d));return o}function r(a,o){return o?a?a+" "+o:a+o:a}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(vr)),vr.exports}var Gt={},Ua;function us(){if(Ua)return Gt;Ua=1;var n=Gt&&Gt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.useFrame=void 0;const e=n(tt()),t=i=>e.default.useMemo(()=>i||{document:typeof document<"u"?document:void 0,window:typeof window<"u"?window:void 0},[i]);return Gt.useFrame=t,Gt}var wt={},Et={},Ba;function $t(){if(Ba)return Et;Ba=1;var n=Et&&Et.__rest||function(a,o){var d={};for(var m in a)Object.prototype.hasOwnProperty.call(a,m)&&o.indexOf(m)<0&&(d[m]=a[m]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,m=Object.getOwnPropertySymbols(a);h<m.length;h++)o.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(a,m[h])&&(d[m[h]]=a[m[h]]);return d},e=Et&&Et.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Et,"__esModule",{value:!0}),Et.EmbedStyle=void 0;const t=e(rt()),i=e(tt()),r=a=>{var o=n(a,[]);return i.default.createElement("style",Object.assign({},o,{className:(0,t.default)(o.className),style:Object.assign({},o.style)}),`
        .rsme-embed .rsme-d-none {
          display: none;
        }
    
        .rsme-embed .twitter-tweet {
          margin: 0 !important;
        }
    
        .rsme-embed blockquote {
          margin: 0 !important;
          padding: 0 !important;
        }

        .rsme-embed.rsme-facebook-embed .fb-post iframe {
          width: 100% !important;
        }

        .rsme-embed.rsme-facebook-embed .fb-post span {
          width: 100% !important;
        }
      `)};return Et.EmbedStyle=r,Et}var xt={},Na;function kl(){if(Na)return xt;Na=1;var n=xt&&xt.__rest||function(a,o){var d={};for(var m in a)Object.prototype.hasOwnProperty.call(a,m)&&o.indexOf(m)<0&&(d[m]=a[m]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,m=Object.getOwnPropertySymbols(a);h<m.length;h++)o.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(a,m[h])&&(d[m[h]]=a[m[h]]);return d},e=xt&&xt.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(xt,"__esModule",{value:!0}),xt.BorderSpinner=void 0;const t=e(rt()),i=e(tt()),r=a=>{var o=n(a,[]);return i.default.createElement(i.default.Fragment,null,i.default.createElement("style",null,`
        .rsme-spinner {
          border: 3px solid rgba(0,0,0,0.75);
          border-right-color: transparent;
          border-radius: 50%;
          animation: rsme-spin 1s linear infinite;
        }
        @keyframes rsme-spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }  
      `),i.default.createElement("div",Object.assign({},o,{className:(0,t.default)("rsme-spinner",o.className),style:Object.assign({width:10,height:10},o.style)})))};return xt.BorderSpinner=r,xt}var zt={},Fa;function kg(){return Fa||(Fa=1,(function(n){var e=zt&&zt.__rest||function(h,g){var y={};for(var S in h)Object.prototype.hasOwnProperty.call(h,S)&&g.indexOf(S)<0&&(y[S]=h[S]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var x=0,S=Object.getOwnPropertySymbols(h);x<S.length;x++)g.indexOf(S[x])<0&&Object.prototype.propertyIsEnumerable.call(h,S[x])&&(y[S[x]]=h[S[x]]);return y},t=zt&&zt.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(n,"__esModule",{value:!0}),n.ShareArrowIcon=n.ChatBubbleIcon=n.HeartIcon=n.EngagementIconsPlaceholder=void 0;const i=t(rt()),r=t(tt()),a=h=>{var g=e(h,[]);return r.default.createElement("div",Object.assign({},g,{className:(0,i.default)(g.className),style:Object.assign({display:"flex",alignItems:"center",columnGap:14},g.style)}),r.default.createElement(n.HeartIcon,null),r.default.createElement(n.ChatBubbleIcon,null),r.default.createElement(n.ShareArrowIcon,null))};n.EngagementIconsPlaceholder=a;const o=h=>r.default.createElement("div",Object.assign({},h),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"12.5px",width:"12.5px",transform:"translateX(0px) translateY(7px)"}}),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",height:"12.5px",transform:"rotate(-45deg) translateX(3px) translateY(1px)",width:"12.5px",flexGrow:0,marginRight:"6px",marginLeft:"2px"}}),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"12.5px",width:"12.5px",transform:"translateX(9px) translateY(-18px)"}}));n.HeartIcon=o;const d=h=>r.default.createElement("div",Object.assign({},h),r.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",height:"20px",width:"20px"}}),r.default.createElement("div",{style:{width:0,height:0,borderTop:"2px solid transparent",borderLeft:"6px solid #f4f4f4",borderBottom:"2px solid transparent",transform:"translateX(16px) translateY(-4px) rotate(30deg)"}}));n.ChatBubbleIcon=d;const m=h=>r.default.createElement("div",Object.assign({},h,{style:{height:25,width:25,transform:"translateX(0px) translateY(-2px)"}}),r.default.createElement("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512",xmlSpace:"preserve"},r.default.createElement("path",{style:{fill:"#F4F4F4"},d:`M295.204,180.593C132.168,180.593,0,312.759,0,475.796
c51.398-130.047,184.869-203.22,317.483-183.603L295.204,180.593z`}),r.default.createElement("path",{style:{fill:"#F4F4F4"},d:`M512,253L295.204,36.204v217.818C159.946,249.655,34.992,339.262,0,475.794
c59.905-109.171,178.724-165.463,295.204-151.033v145.035L512,253z`})));n.ShareArrowIcon=m})(zt)),zt}var Pt={},$a;function Ug(){if($a)return Pt;$a=1;var n=Pt&&Pt.__rest||function(a,o){var d={};for(var m in a)Object.prototype.hasOwnProperty.call(a,m)&&o.indexOf(m)<0&&(d[m]=a[m]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,m=Object.getOwnPropertySymbols(a);h<m.length;h++)o.indexOf(m[h])<0&&Object.prototype.propertyIsEnumerable.call(a,m[h])&&(d[m[h]]=a[m[h]]);return d},e=Pt&&Pt.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.ProfilePlaceholder=void 0;const t=e(rt()),i=e(tt()),r=a=>{var o=n(a,[]);return i.default.createElement("div",Object.assign({},o,{className:(0,t.default)(o.className),style:Object.assign({},o.style)}),i.default.createElement("div",{style:{display:"flex",columnGap:14}},i.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:"50%",width:40,height:40}}),i.default.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",rowGap:6}},i.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:4,width:100,height:14}}),i.default.createElement("div",{style:{backgroundColor:"#F4F4F4",borderRadius:4,width:60,height:14}}))))};return Pt.ProfilePlaceholder=r,Pt}var ja;function jt(){if(ja)return wt;ja=1;var n=wt&&wt.__rest||function(g,y){var S={};for(var x in g)Object.prototype.hasOwnProperty.call(g,x)&&y.indexOf(x)<0&&(S[x]=g[x]);if(g!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,x=Object.getOwnPropertySymbols(g);_<x.length;_++)y.indexOf(x[_])<0&&Object.prototype.propertyIsEnumerable.call(g,x[_])&&(S[x[_]]=g[x[_]]);return S},e=wt&&wt.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(wt,"__esModule",{value:!0}),wt.PlaceholderEmbed=void 0;const t=e(rt()),i=e(tt()),r=$t(),a=kl(),o=kg(),d=Ug(),m=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,h=g=>{var y,{url:S,linkText:x="View post",imageUrl:_,spinner:T=i.default.createElement(a.BorderSpinner,null),allowJavaScriptUrls:v=!0,spinnerDisabled:E}=g,P=n(g,["url","linkText","imageUrl","spinner","allowJavaScriptUrls","spinnerDisabled"]);return m.test(S)&&!v?(console.warn("PlaceholderEmbed has blocked a javascript: URL as a security precaution"),null):i.default.createElement("div",Object.assign({},P,{className:(0,t.default)(P.className),style:Object.assign({overflow:"hidden",border:"1px solid #dee2e6",backgroundColor:"#ffffff",borderRadius:0,boxSizing:"border-box",position:"relative"},P.style)}),i.default.createElement(r.EmbedStyle,null),i.default.createElement("a",{href:S,style:{textDecoration:"none"},target:"_blank",rel:"noopener noreferrer"},!_&&i.default.createElement("div",{style:{position:"absolute",top:0,left:0,display:"flex",justifyContent:"space-between",alignItems:"start",paddingLeft:16,paddingRight:16,paddingTop:16,paddingBottom:16,zIndex:2,backgroundColor:"#ffffff"}},i.default.createElement(d.ProfilePlaceholder,null)),i.default.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:_?"start":"center",height:"100%",width:"100%"}},!_&&i.default.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",rowGap:16,zIndex:3,padding:8,backgroundColor:"#ffffff"}},!E&&T,!!x&&i.default.createElement("div",{style:{color:"#000000",fontFamily:"Arial,sans-serif",fontSize:"14px",fontStyle:"normal",fontWeight:550,lineHeight:"18px",textAlign:"center"}},x)),_&&(typeof((y=P.style)===null||y===void 0?void 0:y.height)<"u"?i.default.createElement("div",{style:{width:"100%",height:"100%",background:`url("${_}")`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center",marginBottom:"40"}}):i.default.createElement("div",{style:{width:"100%",marginBottom:40}},i.default.createElement("img",{src:_,style:{width:"100%"}})))),i.default.createElement("div",{style:{position:"absolute",bottom:0,left:0,height:40,width:"100%",backgroundColor:"#ffffff",zIndex:1}},!_&&i.default.createElement(o.EngagementIconsPlaceholder,{style:{marginLeft:16}}),_&&i.default.createElement("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"space-between",columnGap:16}},i.default.createElement("div",{style:{color:"#0095f6",fontWeight:600,fontFamily:"Arial,sans-serif",fontSize:"14px",fontStyle:"normal",whiteSpace:"nowrap",marginLeft:16}},x),!E&&i.default.createElement("div",{style:{marginRight:16}},T)))))};return wt.PlaceholderEmbed=h,wt}var Mi={},qa;function cs(){if(qa)return Mi;qa=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.generateUUID=void 0;const n=()=>{let e=new Date().getTime(),t=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){let r=Math.random()*16;return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),(i==="x"?r:r&3|8).toString(16)})};return Mi.generateUUID=n,Mi}var Qt={},Wa;function hs(){if(Wa)return Qt;Wa=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.Subs=Qt.Subscribe=void 0;class n{static subscribe(i){try{return i()}catch(r){console.error(r)}return()=>{}}static subscribeEvent(i,r,a){return i.addListener(r,a),()=>{i.removeListener(r,a)}}static subscribeDOMEvent(i,r,a,o){return i.addEventListener(r,a,o),()=>{i.removeEventListener(r,a,o)}}static setTimeout(i,r,...a){const o=setTimeout(i,r,a);return()=>clearTimeout(o)}static setInterval(i,r,...a){const o=setInterval(i,r,a);return()=>clearInterval(o)}static unsubAll(i){if(Array.isArray(i))i.forEach(r=>{try{r()}catch(a){console.error(a)}});else try{i()}catch(r){console.error(r)}}static createCleanup(i){return()=>n.unsubAll(i)}}Qt.Subscribe=n;class e{constructor(i=[]){this.list=i}subscribe(i){const r=n.subscribe(i);return this.push(r),r}subscribeEvent(i,r,a){const o=n.subscribeEvent(i,r,a);return this.push(o),o}subscribeDOMEvent(i,r,a){const o=n.subscribeDOMEvent(i,r,a);return this.push(o),o}setTimeout(i,r,...a){const o=setTimeout(i,r,a),d=()=>clearTimeout(o);return this.push(d),d}setInterval(i,r,...a){const o=setInterval(i,r,a),d=()=>clearInterval(o);return this.push(d),d}push(i){this.list.push(i)}unsubAll(){n.unsubAll(this.list),this.list.splice(0,this.list.length)}createCleanup(){return()=>{this.unsubAll()}}}return Qt.Subs=e,Qt}var Va;function Bg(){if(Va)return St;Va=1;var n=St&&St.__rest||function(U,L){var M={};for(var B in U)Object.prototype.hasOwnProperty.call(U,B)&&L.indexOf(B)<0&&(M[B]=U[B]);if(U!=null&&typeof Object.getOwnPropertySymbols=="function")for(var $=0,B=Object.getOwnPropertySymbols(U);$<B.length;$++)L.indexOf(B[$])<0&&Object.prototype.propertyIsEnumerable.call(U,B[$])&&(M[B[$]]=U[B[$]]);return M},e=St&&St.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(St,"__esModule",{value:!0}),St.FacebookEmbed=void 0;const t=e(rt()),i=e(tt()),r=us(),a=jt(),o=cs(),d=$t(),m=hs(),h="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v16.0",g=550,y=g,S=372,x=3,_="check-script",T="load-script",v="confirm-script-loaded",E="process-embed",P="confirm-embed-success",O="retrying",A="embed-success",k=U=>{var L,M,{url:B,width:$,height:q,linkText:V="View post on Facebook",placeholderImageUrl:F,placeholderSpinner:Q,placeholderSpinnerDisabled:K=!1,placeholderProps:Z,embedPlaceholder:ie,placeholderDisabled:ae=!1,scriptLoadDisabled:ne=!1,retryDelay:he=5e3,retryDisabled:fe=!1,frame:X=void 0,debug:ye=!1}=U,ge=n(U,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","frame","debug"]);const[re,Se]=i.default.useState(_),Oe=i.default.useMemo(()=>re===A,[re]),ue=i.default.useRef((0,o.generateUUID)()),[oe,we]=i.default.useState(Date.now()),Ce=i.default.useMemo(()=>`${ue.current}-${oe}`,[oe]),te=(0,r.useFrame)(X);i.default.useEffect(()=>{ye&&console.log(`[${new Date().toISOString()}]: ${re}`)},[ye,re]),i.default.useEffect(()=>{var be,me,Ie;re===_&&(!((Ie=(me=(be=te.window)===null||be===void 0?void 0:be.FB)===null||me===void 0?void 0:me.XFBML)===null||Ie===void 0)&&Ie.parse?Se(E):ne?console.error("Facebook embed script not found. Unable to process Facebook embed:",B):Se(T))},[ne,re,B,te.window]),i.default.useEffect(()=>{if(re===T&&te.document){const be=te.document.createElement("script");be.setAttribute("src",h),te.document.head.appendChild(be),Se(v)}},[re,te.document]),i.default.useEffect(()=>{const be=new m.Subs;return re===v&&be.setInterval(()=>{var me,Ie,ee;!((ee=(Ie=(me=te.window)===null||me===void 0?void 0:me.FB)===null||Ie===void 0?void 0:Ie.XFBML)===null||ee===void 0)&&ee.parse&&Se(E)},1),be.createCleanup()},[re,te.window]),i.default.useEffect(()=>{var be,me,Ie;if(re===E){const ee=(Ie=(me=(be=te.window)===null||be===void 0?void 0:be.FB)===null||me===void 0?void 0:me.XFBML)===null||Ie===void 0?void 0:Ie.parse;ee?(ee(),Se(P)):console.error("Facebook embed script not found. Unable to process Facebook embed:",B)}},[re,B,te.window]),i.default.useEffect(()=>{const be=new m.Subs;return re===P&&(be.setInterval(()=>{if(te.document){const me=te.document.getElementById(ue.current);if(me){const Ie=me.getElementsByClassName("fb-post")[0];Ie&&Ie.children.length>0&&Se(A)}}},1),fe||be.setTimeout(()=>{Se(O)},he)),be.createCleanup()},[fe,he,re,te.document]),i.default.useEffect(()=>{re===O&&(we(Date.now()),Se(E))},[re]);const Ue=!!$?.toString().includes("%"),Be=!!q?.toString().includes("%"),De={maxWidth:Ue?void 0:y,width:typeof $<"u"?Ue?"100%":$:"100%",height:Be?"100%":typeof q<"u"?q:typeof((L=ge.style)===null||L===void 0?void 0:L.height)<"u"||typeof((M=ge.style)===null||M===void 0?void 0:M.maxHeight)<"u"?"100%":S,border:"1px solid #dee2e6",borderRadius:x},Ot=ie??i.default.createElement(a.PlaceholderEmbed,Object.assign({url:B,imageUrl:F,linkText:V,spinner:Q,spinnerDisabled:K},Z,{style:Object.assign(Object.assign({},De),Z?.style)}));return i.default.createElement("div",Object.assign({},ge,{className:(0,t.default)("rsme-embed rsme-facebook-embed",ge.className),style:Object.assign({overflow:"hidden",width:$??void 0,height:q??void 0,borderRadius:x},ge.style)}),i.default.createElement(d.EmbedStyle,null),i.default.createElement("div",{id:ue.current,className:(0,t.default)(!Oe&&"rsme-d-none")},i.default.createElement("div",{key:Ce,className:"fb-post","data-href":B,"data-width":Ue?"100%":$??g,style:{width:Ue?"100%":$??g,height:Be?"100%":q??void 0}})),!Oe&&!ae&&Ot)};return St.FacebookEmbed=k,St}var qe={},Ha;function Ng(){if(Ha)return qe;Ha=1;var n=qe&&qe.__createBinding||(Object.create?(function(M,B,$,q){q===void 0&&(q=$);var V=Object.getOwnPropertyDescriptor(B,$);(!V||("get"in V?!B.__esModule:V.writable||V.configurable))&&(V={enumerable:!0,get:function(){return B[$]}}),Object.defineProperty(M,q,V)}):(function(M,B,$,q){q===void 0&&(q=$),M[q]=B[$]})),e=qe&&qe.__setModuleDefault||(Object.create?(function(M,B){Object.defineProperty(M,"default",{enumerable:!0,value:B})}):function(M,B){M.default=B}),t=qe&&qe.__importStar||function(M){if(M&&M.__esModule)return M;var B={};if(M!=null)for(var $ in M)$!=="default"&&Object.prototype.hasOwnProperty.call(M,$)&&n(B,M,$);return e(B,M),B},i=qe&&qe.__rest||function(M,B){var $={};for(var q in M)Object.prototype.hasOwnProperty.call(M,q)&&B.indexOf(q)<0&&($[q]=M[q]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,q=Object.getOwnPropertySymbols(M);V<q.length;V++)B.indexOf(q[V])<0&&Object.prototype.propertyIsEnumerable.call(M,q[V])&&($[q[V]]=M[q[V]]);return $},r=qe&&qe.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(qe,"__esModule",{value:!0}),qe.InstagramEmbed=void 0;const a=r(rt()),o=t(tt()),d=hs(),m=us(),h=jt(),g=cs(),y=$t(),S="https://www.instagram.com/embed.js",x=328,_=372,T=3,v="check-script",E="load-script",P="confirm-script-loaded",O="process-embed",A="confirm-embed-success",k="retrying",U="embed-success",L=M=>{var B,$,{url:q,width:V,height:F,linkText:Q="View post on Instagram",captioned:K=!1,placeholderImageUrl:Z,placeholderSpinner:ie,placeholderSpinnerDisabled:ae=!1,placeholderProps:ne,embedPlaceholder:he,placeholderDisabled:fe=!1,scriptLoadDisabled:X=!1,retryDelay:ye=5e3,retryDisabled:ge=!1,igVersion:re="14",frame:Se=void 0,debug:Oe=!1}=M,ue=i(M,["url","width","height","linkText","captioned","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","igVersion","frame","debug"]);const[oe,we]=o.useState(v),Ce=o.useRef((0,g.generateUUID)()),[te,Ue]=o.useState(Date.now()),Be=o.useMemo(()=>`${Ce.current}-${te}`,[te]),De=(0,m.useFrame)(Se);o.useEffect(()=>{Oe&&console.log(`[${new Date().toISOString()}]: ${oe}`)},[Oe,oe]),o.useEffect(()=>{var xe,Qe,$e;oe===v&&(!(($e=(Qe=(xe=De.window)===null||xe===void 0?void 0:xe.instgrm)===null||Qe===void 0?void 0:Qe.Embeds)===null||$e===void 0)&&$e.process?we(O):X?console.error("Instagram embed script not found. Unable to process Instagram embed:",q):we(E))},[X,oe,q,De.window]),o.useEffect(()=>{if(oe===E&&De.document){const xe=De.document.createElement("script");xe.setAttribute("src",S),De.document.head.appendChild(xe),we(P)}},[oe,De.document]),o.useEffect(()=>{const xe=new d.Subs;return oe===P&&xe.setInterval(()=>{var Qe,$e,ct;!((ct=($e=(Qe=De.window)===null||Qe===void 0?void 0:Qe.instgrm)===null||$e===void 0?void 0:$e.Embeds)===null||ct===void 0)&&ct.process&&we(O)},1),xe.createCleanup()},[oe,De.window]),o.useEffect(()=>{var xe,Qe,$e;if(oe===O){const ct=($e=(Qe=(xe=De.window)===null||xe===void 0?void 0:xe.instgrm)===null||Qe===void 0?void 0:Qe.Embeds)===null||$e===void 0?void 0:$e.process;ct?(ct(),we(A)):console.error("Instagram embed script not found. Unable to process Instagram embed:",q)}},[oe,De.window,q]),o.useEffect(()=>{const xe=new d.Subs;return oe===A&&(xe.setInterval(()=>{De.document&&(De.document.getElementById(Ce.current)||we(U))},1),ge||xe.setTimeout(()=>{we(k)},ye)),xe.createCleanup()},[ye,ge,oe,De.document]),o.useEffect(()=>{oe===k&&(Ue(Date.now()),we(O))},[oe]);const Ot=q.split(/[?#]/)[0].replace(/\.com\/.*?\/p/,".com/p").replace(/\.com\/.*?\/reel/,".com/reel"),be=`${Ot}${Ot.endsWith("/")?"":"/"}`,me=!!V?.toString().includes("%"),Ie=!!F?.toString().includes("%"),ee={minWidth:me?void 0:x,width:typeof V<"u"?me?"100%":V:"100%",height:Ie?"100%":typeof F<"u"?F:typeof((B=ue.style)===null||B===void 0?void 0:B.height)<"u"||typeof(($=ue.style)===null||$===void 0?void 0:$.maxHeight)<"u"?"100%":_,border:"1px solid #dee2e6",borderRadius:T},Hn=he??o.createElement(h.PlaceholderEmbed,Object.assign({url:be,imageUrl:Z,linkText:Q,spinner:ie,spinnerDisabled:ae},ne,{style:Object.assign(Object.assign({},ee),ne?.style)}));return o.createElement("div",Object.assign({},ue,{className:(0,a.default)("rsme-embed rsme-instagram-embed",Ce.current,ue.className),style:Object.assign(Object.assign({overflow:"hidden",width:V??void 0,height:F??void 0,borderRadius:T},ue.style),{position:"relative"})}),o.createElement(y.EmbedStyle,null),o.createElement("blockquote",{key:Be,className:"instagram-media","data-instgrm-permalink":`${be}?utm_source=ig_embed&utm_campaign=loading`,"data-instgrm-version":re,"data-instgrm-captioned":K||void 0,"data-width":me?"100%":V??void 0,style:{width:"calc(100% - 2px)"}},!fe&&Hn,o.createElement("div",{id:Ce.current,className:"instagram-media-pre-embed rsme-d-none"}," ")))};return qe.InstagramEmbed=L,qe}var We={},Ga;function Fg(){if(Ga)return We;Ga=1;var n=We&&We.__createBinding||(Object.create?(function(_,T,v,E){E===void 0&&(E=v);var P=Object.getOwnPropertyDescriptor(T,v);(!P||("get"in P?!T.__esModule:P.writable||P.configurable))&&(P={enumerable:!0,get:function(){return T[v]}}),Object.defineProperty(_,E,P)}):(function(_,T,v,E){E===void 0&&(E=v),_[E]=T[v]})),e=We&&We.__setModuleDefault||(Object.create?(function(_,T){Object.defineProperty(_,"default",{enumerable:!0,value:T})}):function(_,T){_.default=T}),t=We&&We.__importStar||function(_){if(_&&_.__esModule)return _;var T={};if(_!=null)for(var v in _)v!=="default"&&Object.prototype.hasOwnProperty.call(_,v)&&n(T,_,v);return e(T,_),T},i=We&&We.__rest||function(_,T){var v={};for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&T.indexOf(E)<0&&(v[E]=_[E]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,E=Object.getOwnPropertySymbols(_);P<E.length;P++)T.indexOf(E[P])<0&&Object.prototype.propertyIsEnumerable.call(_,E[P])&&(v[E[P]]=_[E[P]]);return v},r=We&&We.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(We,"__esModule",{value:!0}),We.LinkedInEmbed=void 0;const a=r(rt()),o=t(tt()),d=jt(),m=$t(),h=250,g=550,y=550,S=8,x=_=>{var T,v,{url:E,postUrl:P,width:O,height:A=500,linkText:k="View post on LinkedIn",placeholderImageUrl:U,placeholderSpinner:L,placeholderSpinnerDisabled:M=!1,placeholderProps:B,embedPlaceholder:$,placeholderDisabled:q=!1}=_,V=i(_,["url","postUrl","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled"]);const[F,Q]=o.useState(!1),K={minWidth:h,maxWidth:g,width:typeof O<"u"?O:"100%",height:typeof A<"u"?A:typeof((T=V.style)===null||T===void 0?void 0:T.height)<"u"||typeof((v=V.style)===null||v===void 0?void 0:v.maxHeight)<"u"?"100%":y,border:"solid 1px rgba(0, 0, 0, 0.15)",borderRadius:S},Z=$??o.createElement(d.PlaceholderEmbed,Object.assign({url:P??E,imageUrl:U,linkText:k,spinner:L,spinnerDisabled:M},B,{style:Object.assign(Object.assign({},K),B?.style)}));return o.createElement("div",Object.assign({},V,{className:(0,a.default)("rsme-embed rsme-linkedin-embed",V.className),style:Object.assign({overflow:"hidden",width:O??void 0,height:A??void 0,borderRadius:S},V.style)}),o.createElement(m.EmbedStyle,null),o.createElement("iframe",{className:(0,a.default)("linkedin-post",!F&&"rsme-d-none"),src:E,width:"100%",height:F?A:0,frameBorder:"0",onLoad:()=>Q(!0)}),!F&&!q&&Z)};return We.LinkedInEmbed=x,We}var Ve={},za;function $g(){if(za)return Ve;za=1;var n=Ve&&Ve.__createBinding||(Object.create?(function(_,T,v,E){E===void 0&&(E=v);var P=Object.getOwnPropertyDescriptor(T,v);(!P||("get"in P?!T.__esModule:P.writable||P.configurable))&&(P={enumerable:!0,get:function(){return T[v]}}),Object.defineProperty(_,E,P)}):(function(_,T,v,E){E===void 0&&(E=v),_[E]=T[v]})),e=Ve&&Ve.__setModuleDefault||(Object.create?(function(_,T){Object.defineProperty(_,"default",{enumerable:!0,value:T})}):function(_,T){_.default=T}),t=Ve&&Ve.__importStar||function(_){if(_&&_.__esModule)return _;var T={};if(_!=null)for(var v in _)v!=="default"&&Object.prototype.hasOwnProperty.call(_,v)&&n(T,_,v);return e(T,_),T},i=Ve&&Ve.__rest||function(_,T){var v={};for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&T.indexOf(E)<0&&(v[E]=_[E]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,E=Object.getOwnPropertySymbols(_);P<E.length;P++)T.indexOf(E[P])<0&&Object.prototype.propertyIsEnumerable.call(_,E[P])&&(v[E[P]]=_[E[P]]);return v},r=Ve&&Ve.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.PinterestEmbed=void 0;const a=r(rt()),o=t(tt()),d=jt(),m=$t(),h=250,g=550,y=550,S=8,x=_=>{var T,v,E,{url:P,postUrl:O,width:A,height:k=500,linkText:U="View post on Pinterest",placeholderImageUrl:L,placeholderSpinner:M,placeholderSpinnerDisabled:B=!1,placeholderProps:$,embedPlaceholder:q,placeholderDisabled:V=!1}=_,F=i(_,["url","postUrl","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled"]);const[Q,K]=o.useState(!1),Z={minWidth:h,maxWidth:g,width:typeof A<"u"?A:"100%",height:typeof k<"u"?k:typeof((T=F.style)===null||T===void 0?void 0:T.height)<"u"||typeof((v=F.style)===null||v===void 0?void 0:v.maxHeight)<"u"?"100%":y,border:"solid 1px rgba(0, 0, 0, 0.15)",borderRadius:S},ie=q??o.createElement(d.PlaceholderEmbed,Object.assign({url:O??P,imageUrl:L,linkText:U,spinner:M,spinnerDisabled:B},$,{style:Object.assign(Object.assign({},Z),$?.style)})),ae=(E=P.match(/pin\/([\w\d_-]+)/))===null||E===void 0?void 0:E[1],ne=ae??"000000000000000000";return o.createElement("div",Object.assign({},F,{className:(0,a.default)("rsme-embed rsme-pinterest-embed",F.className),style:Object.assign({overflow:"hidden",width:A??void 0,height:k??void 0,borderRadius:S},F.style)}),o.createElement(m.EmbedStyle,null),o.createElement("iframe",{className:(0,a.default)("pinterest-post",!Q&&"rsme-d-none"),src:`https://assets.pinterest.com/ext/embed.html?id=${ne}`,width:"100%",height:Q?k:0,frameBorder:"0",scrolling:"no",onLoad:()=>K(!0)}),!Q&&!V&&ie)};return Ve.PinterestEmbed=x,Ve}var Ct={},Qa;function jg(){if(Qa)return Ct;Qa=1;var n=Ct&&Ct.__rest||function(O,A){var k={};for(var U in O)Object.prototype.hasOwnProperty.call(O,U)&&A.indexOf(U)<0&&(k[U]=O[U]);if(O!=null&&typeof Object.getOwnPropertySymbols=="function")for(var L=0,U=Object.getOwnPropertySymbols(O);L<U.length;L++)A.indexOf(U[L])<0&&Object.prototype.propertyIsEnumerable.call(O,U[L])&&(k[U[L]]=O[U[L]]);return k},e=Ct&&Ct.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.TikTokEmbed=void 0;const t=e(rt()),i=e(tt()),r=hs(),a=us(),o=jt(),d=cs(),m=$t(),h="https://www.tiktok.com/embed.js",g=325,y=480,S=550,x=8,_="process-embed",T="confirm-embed-success",v="retrying",E="embed-success",P=O=>{var A,k,{url:U,width:L,height:M,linkText:B="View post on TikTok",placeholderImageUrl:$,placeholderSpinner:q,placeholderSpinnerDisabled:V=!1,placeholderProps:F,embedPlaceholder:Q,placeholderDisabled:K=!1,scriptLoadDisabled:Z=!1,retryDelay:ie=5e3,retryDisabled:ae=!1,frame:ne=void 0,debug:he=!1}=O,fe=n(O,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","scriptLoadDisabled","retryDelay","retryDisabled","frame","debug"]);const[X,ye]=i.default.useState(_),ge=i.default.useRef((0,d.generateUUID)()),[re,Se]=i.default.useState(Date.now()),Oe=i.default.useMemo(()=>`${ge.current}-${re}`,[re]),ue=(0,a.useFrame)(ne);i.default.useEffect(()=>{he&&console.log(`[${new Date().toISOString()}]: ${X}`)},[he,X]),i.default.useEffect(()=>{if(X===_&&ue.document&&!Z){const te="tiktok-embed-script",Ue=ue.document.getElementById(te);Ue&&Ue.remove();const Be=ue.document.createElement("script");Be.setAttribute("src",`${h}?t=${Date.now()}`),Be.setAttribute("id",te),ue.document.head.appendChild(Be),ye(T)}},[Z,X,ue.document]),i.default.useEffect(()=>{const te=new r.Subs;return X===T&&(te.setInterval(()=>{ue.document&&(ue.document.getElementById(ge.current)||ye(E))},1),ae||te.setTimeout(()=>{ye(v)},ie)),te.createCleanup()},[ie,ae,X,ue.document]),i.default.useEffect(()=>{X===v&&(Se(Date.now()),ye(_))},[X]);const oe=U.replace(/[?].*$/,"").replace(/^.+\//,""),we={minWidth:g,maxWidth:y,width:typeof L<"u"?L:"100%",height:typeof M<"u"?M:typeof((A=fe.style)===null||A===void 0?void 0:A.height)<"u"||typeof((k=fe.style)===null||k===void 0?void 0:k.maxHeight)<"u"?"100%":S,border:"solid 1px rgba(22,24,35,0.12)",borderRadius:x},Ce=Q??i.default.createElement(o.PlaceholderEmbed,Object.assign({url:U,imageUrl:$,linkText:B,spinner:q,spinnerDisabled:V},F,{style:Object.assign(Object.assign({},we),F?.style)}));return i.default.createElement("div",Object.assign({},fe,{className:(0,t.default)("rsme-embed rsme-tiktok-embed",fe.className),style:Object.assign({overflow:"hidden",width:L??void 0,height:M??void 0,borderRadius:x},fe.style)}),i.default.createElement(m.EmbedStyle,null),i.default.createElement("div",{className:"tiktok-embed-container"},i.default.createElement("blockquote",{key:Oe,className:"tiktok-embed",cite:U,"data-video-id":oe},K?i.default.createElement("div",{id:ge.current,style:{display:"none"}}," "):i.default.createElement("div",{id:ge.current,style:{display:"flex",justifyContent:"center"}},Ce))))};return Ct.TikTokEmbed=P,Ct}var Ri={},He={},br={exports:{}};/*!
  * $script.js JS loader & dependency manager
  * https://github.com/ded/script.js
  * (c) Dustin Diaz 2014 | License MIT
  */var Ya;function _t(){return Ya||(Ya=1,(function(n){(function(e,t){n.exports?n.exports=t():this[e]=t()})("$script",function(){var e=document,t=e.getElementsByTagName("head")[0],i=!1,r="push",a="readyState",o="onreadystatechange",d={},m={},h={},g,y;function S(v,E){for(var P=0,O=v.length;P<O;++P)if(!E(v[P]))return i;return 1}function x(v,E){S(v,function(P){return E(P),1})}function _(v,E,P){v=v[r]?v:[v];var O=E&&E.call,A=O?E:P,k=O?v.join(""):E,U=v.length;function L(B){return B.call?B():d[B]}function M(){if(!--U){d[k]=1,A&&A();for(var B in m)S(B.split("|"),L)&&!x(m[B],L)&&(m[B]=[])}}return setTimeout(function(){x(v,function B($,q){if($===null)return M();if(!q&&!/^https?:\/\//.test($)&&g&&($=$.indexOf(".js")===-1?g+$+".js":g+$),h[$])return h[$]==2?M():setTimeout(function(){B($,!0)},0);h[$]=1,T($,M)})},0),_}function T(v,E){var P=e.createElement("script"),O;P.onload=P.onerror=P[o]=function(){P[a]&&!/^c|loade/.test(P[a])||O||(P.onload=P[o]=null,O=1,h[v]=2,E())},P.async=1,P.src=y?v+(v.indexOf("?")===-1?"?":"&")+y:v,t.insertBefore(P,t.lastChild)}return _.get=T,_.order=function(v,E,P){(function O(A){A=v.shift(),v.length?_(A,O):_(A,E,P)})()},_.path=function(v){g=v},_.urlArgs=function(v){y=v},_.ready=function(v,E,P){v=v[r]?v:[v];var O=[];return!x(v,function(A){d[A]||O[r](A)})&&S(v,function(A){return d[A]})?E():(function(A){m[A]=m[A]||[],m[A][r](E),P&&P(O)})(v.join("|")),_},_.done=function(v){_([null],v)},_})})(br)),br.exports}var vt="https://platform.twitter.com/widgets.js",Tr="createTimeline",qg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1],o=function(){var h=Object.assign({},e.options);if(e!=null&&e.autoHeight){var g,y;h.height=(g=t.current)===null||g===void 0||(y=g.parentNode)===null||y===void 0?void 0:y.offsetHeight}return h=Object.assign({},h,{theme:e?.theme,linkColor:e?.linkColor,borderColor:e?.borderColor,lang:e?.lang,tweetLimit:e?.tweetLimit,ariaPolite:e?.ariaPolite}),h},d=function(h){return h.chrome="",e.noHeader&&(h.chrome=h.chrome+" noheader"),e.noFooter&&(h.chrome=h.chrome+" nofooter"),e.noBorders&&(h.chrome=h.chrome+" noborders"),e.noScrollbar&&(h.chrome=h.chrome+" noscrollbar"),e.transparent&&(h.chrome=h.chrome+" transparent"),h};return G.useEffect(function(){var m=!0,h=_t();return h(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(m){if(!window.twttr.widgets[Tr]){console.error("Method "+Tr+" is not present anymore in twttr.widget api");return}var g=o();g=d(g),window.twttr.widgets[Tr]({sourceType:e.sourceType,screenName:e.screenName,userId:e.userId,ownerScreenName:e.ownerScreenName,slug:e.slug,id:e.id||e.widgetId,url:e.url},t?.current,g).then(function(y){a(!1),e.onLoad&&e.onLoad(y)})}}),function(){m=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Sr="createShareButton",Wg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Sr]){console.error("Method "+Sr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Sr](e.url,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},wr="createFollowButton",Vg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[wr]){console.error("Method "+wr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[wr](e.screenName,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Er="createHashtagButton",Hg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Er]){console.error("Method "+Er+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Er](e.tag,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},xr="createMentionButton",Gg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[xr]){console.error("Method "+xr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[xr](e.screenName,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Pr="createTweet",zg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Pr]){console.error("Method "+Pr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Pr](e.tweetId,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Cr="createMoment",Qg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Cr]){console.error("Method "+Cr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Cr](e.momentId,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Ir="createDMButton",Yg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Ir]){console.error("Method "+Ir+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Ir](e.id,t?.current,e.options).then(function(m){o&&(a(!1),e.onLoad&&e.onLoad(m))})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Dr="createVideo",Xg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Dr]){console.error("Method "+Dr+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Dr](e.id,t?.current).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))},Ar="createPeriscopeOnAirButton",Kg=function(e){var t=G.useRef(null),i=G.useState(!0),r=i[0],a=i[1];return G.useEffect(function(){var o=!0,d=_t();return d(vt,"twitter-embed",function(){if(!window.twttr){console.error("Failure to load window.twttr, aborting load");return}if(o){if(!window.twttr.widgets[Ar]){console.error("Method "+Ar+" is not present anymore in twttr.widget api");return}window.twttr.widgets[Ar](e.username,t?.current,e.options).then(function(m){a(!1),e.onLoad&&e.onLoad(m)})}}),function(){o=!1}},[]),G.createElement(G.Fragment,null,r&&G.createElement(G.Fragment,null,e.placeholder),G.createElement("div",{ref:t}))};const Jg=Object.freeze(Object.defineProperty({__proto__:null,TwitterDMButton:Yg,TwitterFollowButton:Vg,TwitterHashtagButton:Hg,TwitterMentionButton:Gg,TwitterMomentShare:Qg,TwitterOnAirButton:Kg,TwitterShareButton:Wg,TwitterTimelineEmbed:qg,TwitterTweetEmbed:zg,TwitterVideoEmbed:Xg},Symbol.toStringTag,{value:"Module"})),Zg=Co(Jg);var Xa;function Ul(){if(Xa)return He;Xa=1;var n=He&&He.__createBinding||(Object.create?(function(T,v,E,P){P===void 0&&(P=E);var O=Object.getOwnPropertyDescriptor(v,E);(!O||("get"in O?!v.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return v[E]}}),Object.defineProperty(T,P,O)}):(function(T,v,E,P){P===void 0&&(P=E),T[P]=v[E]})),e=He&&He.__setModuleDefault||(Object.create?(function(T,v){Object.defineProperty(T,"default",{enumerable:!0,value:v})}):function(T,v){T.default=v}),t=He&&He.__importStar||function(T){if(T&&T.__esModule)return T;var v={};if(T!=null)for(var E in T)E!=="default"&&Object.prototype.hasOwnProperty.call(T,E)&&n(v,T,E);return e(v,T),v},i=He&&He.__rest||function(T,v){var E={};for(var P in T)Object.prototype.hasOwnProperty.call(T,P)&&v.indexOf(P)<0&&(E[P]=T[P]);if(T!=null&&typeof Object.getOwnPropertySymbols=="function")for(var O=0,P=Object.getOwnPropertySymbols(T);O<P.length;O++)v.indexOf(P[O])<0&&Object.prototype.propertyIsEnumerable.call(T,P[O])&&(E[P[O]]=T[P[O]]);return E},r=He&&He.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(He,"__esModule",{value:!0}),He.XEmbed=void 0;const a=r(rt()),o=t(tt()),d=Zg,m=jt(),h=$t(),g=250,y=550,S=350,x=12,_=T=>{var v,E,{url:P,width:O,height:A,linkText:k="View post on X",placeholderImageUrl:U,placeholderSpinner:L,placeholderSpinnerDisabled:M=!1,placeholderProps:B,embedPlaceholder:$,placeholderDisabled:q,twitterTweetEmbedProps:V}=T,F=i(T,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","twitterTweetEmbedProps"]);const Q=P.substring(P.lastIndexOf("/")+1).replace(/[?].*$/,""),K=!!O?.toString().includes("%"),Z=!!A?.toString().includes("%"),ie={minWidth:g,maxWidth:y,width:typeof O<"u"?K?"100%":O:"100%",height:Z?"100%":typeof A<"u"?A:typeof((v=F.style)===null||v===void 0?void 0:v.height)<"u"||typeof((E=F.style)===null||E===void 0?void 0:E.maxHeight)<"u"?"100%":S,border:"solid 1px #c9d4d9",borderRadius:x},ae=$??o.createElement(m.PlaceholderEmbed,Object.assign({url:P,imageUrl:U,linkText:k,spinner:L,spinnerDisabled:M},B,{style:Object.assign(Object.assign({},ie),B?.style)}));return o.createElement("div",Object.assign({},F,{className:(0,a.default)("rsme-embed rsme-twitter-embed",F.className),style:Object.assign({overflow:"hidden",width:O??void 0,height:A??void 0,borderRadius:x},F.style)}),o.createElement(h.EmbedStyle,null),o.createElement(d.TwitterTweetEmbed,Object.assign({tweetId:Q,placeholder:q?void 0:ae},V)))};return He.XEmbed=_,He}var Ka;function ey(){if(Ka)return Ri;Ka=1,Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.TwitterEmbed=void 0;const n=Ul();return Ri.TwitterEmbed=n.XEmbed,Ri}var Ge={},Or,Ja;function ty(){return Ja||(Ja=1,Or=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,r,a;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(r=i;r--!==0;)if(!n(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),i=a.length,i!==Object.keys(t).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[r]))return!1;for(r=i;r--!==0;){var o=a[r];if(!n(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}),Or}var iy=ty();const ny=Io(iy);var En={exports:{}},Lr,Za;function ry(){if(Za)return Lr;Za=1;var n;/**
* @link https://github.com/gajus/sister for the canonical source repository
* @license https://github.com/gajus/sister/blob/master/LICENSE BSD 3-Clause
*/return n=function(){var e={},t={};return e.on=function(i,r){var a={name:i,handler:r};return t[i]=t[i]||[],t[i].unshift(a),a},e.off=function(i){var r=t[i.name].indexOf(i);r!==-1&&t[i.name].splice(r,1)},e.trigger=function(i,r){var a=t[i],o;if(a)for(o=a.length;o--;)a[o].handler(r)},e},Lr=n,Lr}var xn={exports:{}},Mr,eo;function sy(){if(eo)return Mr;eo=1,Mr=function(r,a,o){var d=document.head||document.getElementsByTagName("head")[0],m=document.createElement("script");typeof a=="function"&&(o=a,a={}),a=a||{},o=o||function(){},m.type=a.type||"text/javascript",m.charset=a.charset||"utf8",m.async="async"in a?!!a.async:!0,m.src=r,a.attrs&&n(m,a.attrs),a.text&&(m.text=""+a.text);var h="onload"in m?e:t;h(m,o),m.onload||e(m,o),d.appendChild(m)};function n(i,r){for(var a in r)i.setAttribute(a,r[a])}function e(i,r){i.onload=function(){this.onerror=this.onload=null,r(null,i)},i.onerror=function(){this.onerror=this.onload=null,r(new Error("Failed to load "+this.src),i)}}function t(i,r){i.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,r(null,i))}}return Mr}var to;function ay(){return to||(to=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=sy(),i=r(t);function r(a){return a&&a.__esModule?a:{default:a}}e.default=function(a){var o=new Promise(function(d){if(window.YT&&window.YT.Player&&window.YT.Player instanceof Function){d(window.YT);return}else{var m=window.location.protocol==="http:"?"http:":"https:";(0,i.default)(m+"//www.youtube.com/iframe_api",function(g){g&&a.trigger("error",g)})}var h=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){h&&h(),d(window.YT)}});return o},n.exports=e.default})(xn,xn.exports)),xn.exports}var Pn={exports:{}},Cn={exports:{}},In={exports:{}},Rr,io;function oy(){if(io)return Rr;io=1;var n=1e3,e=n*60,t=e*60,i=t*24,r=i*365.25;Rr=function(h,g){g=g||{};var y=typeof h;if(y==="string"&&h.length>0)return a(h);if(y==="number"&&isNaN(h)===!1)return g.long?d(h):o(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function a(h){if(h=String(h),!(h.length>100)){var g=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(h);if(g){var y=parseFloat(g[1]),S=(g[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return y*r;case"days":case"day":case"d":return y*i;case"hours":case"hour":case"hrs":case"hr":case"h":return y*t;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function o(h){return h>=i?Math.round(h/i)+"d":h>=t?Math.round(h/t)+"h":h>=e?Math.round(h/e)+"m":h>=n?Math.round(h/n)+"s":h+"ms"}function d(h){return m(h,i,"day")||m(h,t,"hour")||m(h,e,"minute")||m(h,n,"second")||h+" ms"}function m(h,g,y){if(!(h<g))return h<g*1.5?Math.floor(h/g)+" "+y:Math.ceil(h/g)+" "+y+"s"}return Rr}var no;function ly(){return no||(no=1,(function(n,e){e=n.exports=r.debug=r.default=r,e.coerce=m,e.disable=o,e.enable=a,e.enabled=d,e.humanize=oy(),e.names=[],e.skips=[],e.formatters={};var t;function i(h){var g=0,y;for(y in h)g=(g<<5)-g+h.charCodeAt(y),g|=0;return e.colors[Math.abs(g)%e.colors.length]}function r(h){function g(){if(g.enabled){var y=g,S=+new Date,x=S-(t||S);y.diff=x,y.prev=t,y.curr=S,t=S;for(var _=new Array(arguments.length),T=0;T<_.length;T++)_[T]=arguments[T];_[0]=e.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");var v=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,function(P,O){if(P==="%%")return P;v++;var A=e.formatters[O];if(typeof A=="function"){var k=_[v];P=A.call(y,k),_.splice(v,1),v--}return P}),e.formatArgs.call(y,_);var E=g.log||e.log||console.log.bind(console);E.apply(y,_)}}return g.namespace=h,g.enabled=e.enabled(h),g.useColors=e.useColors(),g.color=i(h),typeof e.init=="function"&&e.init(g),g}function a(h){e.save(h),e.names=[],e.skips=[];for(var g=(typeof h=="string"?h:"").split(/[\s,]+/),y=g.length,S=0;S<y;S++)g[S]&&(h=g[S].replace(/\*/g,".*?"),h[0]==="-"?e.skips.push(new RegExp("^"+h.substr(1)+"$")):e.names.push(new RegExp("^"+h+"$")))}function o(){e.enable("")}function d(h){var g,y;for(g=0,y=e.skips.length;g<y;g++)if(e.skips[g].test(h))return!1;for(g=0,y=e.names.length;g<y;g++)if(e.names[g].test(h))return!0;return!1}function m(h){return h instanceof Error?h.stack||h.message:h}})(In,In.exports)),In.exports}var ro;function dy(){return ro||(ro=1,(function(n,e){var t={};e=n.exports=ly(),e.log=a,e.formatArgs=r,e.save=o,e.load=d,e.useColors=i,e.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:m(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function i(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(h){try{return JSON.stringify(h)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}};function r(h){var g=this.useColors;if(h[0]=(g?"%c":"")+this.namespace+(g?" %c":" ")+h[0]+(g?"%c ":" ")+"+"+e.humanize(this.diff),!!g){var y="color: "+this.color;h.splice(1,0,y,"color: inherit");var S=0,x=0;h[0].replace(/%[a-zA-Z%]/g,function(_){_!=="%%"&&(S++,_==="%c"&&(x=S))}),h.splice(x,0,y)}}function a(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(h){try{h==null?e.storage.removeItem("debug"):e.storage.debug=h}catch{}}function d(){var h;try{h=e.storage.debug}catch{}return!h&&typeof process<"u"&&"env"in process&&(h=t.DEBUG),h}e.enable(d());function m(){try{return window.localStorage}catch{}}})(Cn,Cn.exports)),Cn.exports}var Dn={exports:{}},so;function uy(){return so||(so=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=["cueVideoById","loadVideoById","cueVideoByUrl","loadVideoByUrl","playVideo","pauseVideo","stopVideo","getVideoLoadedFraction","cuePlaylist","loadPlaylist","nextVideo","previousVideo","playVideoAt","setShuffle","setLoop","getPlaylist","getPlaylistIndex","setOption","mute","unMute","isMuted","setVolume","getVolume","seekTo","getPlayerState","getPlaybackRate","setPlaybackRate","getAvailablePlaybackRates","getPlaybackQuality","setPlaybackQuality","getAvailableQualityLevels","getCurrentTime","getDuration","removeEventListener","getVideoUrl","getVideoEmbedCode","getOptions","getOption","addEventListener","destroy","setSize","getIframe"],n.exports=e.default})(Dn,Dn.exports)),Dn.exports}var An={exports:{}},ao;function cy(){return ao||(ao=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=["ready","stateChange","playbackQualityChange","playbackRateChange","error","apiChange","volumeChange"],n.exports=e.default})(An,An.exports)),An.exports}var On={exports:{}},Ln={exports:{}},oo;function hy(){return oo||(oo=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default={BUFFERING:3,ENDED:0,PAUSED:2,PLAYING:1,UNSTARTED:-1,VIDEO_CUED:5},n.exports=e.default})(Ln,Ln.exports)),Ln.exports}var lo;function fy(){return lo||(lo=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=hy(),i=r(t);function r(a){return a&&a.__esModule?a:{default:a}}e.default={pauseVideo:{acceptableStates:[i.default.ENDED,i.default.PAUSED],stateChangeRequired:!1},playVideo:{acceptableStates:[i.default.ENDED,i.default.PLAYING],stateChangeRequired:!1},seekTo:{acceptableStates:[i.default.ENDED,i.default.PLAYING,i.default.PAUSED],stateChangeRequired:!0,timeout:3e3}},n.exports=e.default})(On,On.exports)),On.exports}var uo;function my(){return uo||(uo=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=dy(),i=g(t),r=uy(),a=g(r),o=cy(),d=g(o),m=fy(),h=g(m);function g(x){return x&&x.__esModule?x:{default:x}}var y=(0,i.default)("youtube-player"),S={};S.proxyEvents=function(x){var _={},T=function(L){var M="on"+L.slice(0,1).toUpperCase()+L.slice(1);_[M]=function(B){y('event "%s"',M,B),x.trigger(L,B)}},v=!0,E=!1,P=void 0;try{for(var O=d.default[Symbol.iterator](),A;!(v=(A=O.next()).done);v=!0){var k=A.value;T(k)}}catch(U){E=!0,P=U}finally{try{!v&&O.return&&O.return()}finally{if(E)throw P}}return _},S.promisifyPlayer=function(x){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,T={},v=function(M){_&&h.default[M]?T[M]=function(){for(var B=arguments.length,$=Array(B),q=0;q<B;q++)$[q]=arguments[q];return x.then(function(V){var F=h.default[M],Q=V.getPlayerState(),K=V[M].apply(V,$);return F.stateChangeRequired||Array.isArray(F.acceptableStates)&&F.acceptableStates.indexOf(Q)===-1?new Promise(function(Z){var ie=function ae(){var ne=V.getPlayerState(),he=void 0;typeof F.timeout=="number"&&(he=setTimeout(function(){V.removeEventListener("onStateChange",ae),Z()},F.timeout)),Array.isArray(F.acceptableStates)&&F.acceptableStates.indexOf(ne)!==-1&&(V.removeEventListener("onStateChange",ae),clearTimeout(he),Z())};V.addEventListener("onStateChange",ie)}).then(function(){return K}):K})}:T[M]=function(){for(var B=arguments.length,$=Array(B),q=0;q<B;q++)$[q]=arguments[q];return x.then(function(V){return V[M].apply(V,$)})}},E=!0,P=!1,O=void 0;try{for(var A=a.default[Symbol.iterator](),k;!(E=(k=A.next()).done);E=!0){var U=k.value;v(U)}}catch(L){P=!0,O=L}finally{try{!E&&A.return&&A.return()}finally{if(P)throw O}}return T},e.default=S,n.exports=e.default})(Pn,Pn.exports)),Pn.exports}var co;function py(){return co||(co=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},i=ry(),r=h(i),a=ay(),o=h(a),d=my(),m=h(d);function h(y){return y&&y.__esModule?y:{default:y}}var g=void 0;e.default=function(y){var S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=(0,r.default)();if(g||(g=(0,o.default)(_)),S.events)throw new Error("Event handlers cannot be overwritten.");if(typeof y=="string"&&!document.getElementById(y))throw new Error('Element "'+y+'" does not exist.');S.events=m.default.proxyEvents(_);var T=new Promise(function(E){if((typeof y>"u"?"undefined":t(y))==="object"&&y.playVideo instanceof Function){var P=y;E(P)}else g.then(function(O){var A=new O.Player(y,S);return _.on("ready",function(){E(A)}),null})}),v=m.default.promisifyPlayer(T,x);return v.on=_.on,v.off=_.off,v},n.exports=e.default})(En,En.exports)),En.exports}var gy=py();const yy=Io(gy);var _y=Object.defineProperty,vy=Object.defineProperties,by=Object.getOwnPropertyDescriptors,ho=Object.getOwnPropertySymbols,Ty=Object.prototype.hasOwnProperty,Sy=Object.prototype.propertyIsEnumerable,fo=(n,e,t)=>e in n?_y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Qr=(n,e)=>{for(var t in e||(e={}))Ty.call(e,t)&&fo(n,t,e[t]);if(ho)for(var t of ho(e))Sy.call(e,t)&&fo(n,t,e[t]);return n},Yr=(n,e)=>vy(n,by(e)),wy=(n,e,t)=>new Promise((i,r)=>{var a=m=>{try{d(t.next(m))}catch(h){r(h)}},o=m=>{try{d(t.throw(m))}catch(h){r(h)}},d=m=>m.done?i(m.value):Promise.resolve(m.value).then(a,o);d((t=t.apply(n,e)).next())});function Ey(n,e){var t,i;if(n.videoId!==e.videoId)return!0;const r=((t=n.opts)==null?void 0:t.playerVars)||{},a=((i=e.opts)==null?void 0:i.playerVars)||{};return r.start!==a.start||r.end!==a.end}function mo(n={}){return Yr(Qr({},n),{height:0,width:0,playerVars:Yr(Qr({},n.playerVars),{autoplay:0,start:0,end:0})})}function xy(n,e){return n.videoId!==e.videoId||!ny(mo(n.opts),mo(e.opts))}function Py(n,e){var t,i,r,a;return n.id!==e.id||n.className!==e.className||((t=n.opts)==null?void 0:t.width)!==((i=e.opts)==null?void 0:i.width)||((r=n.opts)==null?void 0:r.height)!==((a=e.opts)==null?void 0:a.height)||n.iframeClassName!==e.iframeClassName||n.title!==e.title}var Cy={videoId:"",id:"",className:"",iframeClassName:"",style:{},title:"",loading:void 0,opts:{},onReady:()=>{},onError:()=>{},onPlay:()=>{},onPause:()=>{},onEnd:()=>{},onStateChange:()=>{},onPlaybackRateChange:()=>{},onPlaybackQualityChange:()=>{}},Iy={videoId:Ne.string,id:Ne.string,className:Ne.string,iframeClassName:Ne.string,style:Ne.object,title:Ne.string,loading:Ne.oneOf(["lazy","eager"]),opts:Ne.objectOf(Ne.any),onReady:Ne.func,onError:Ne.func,onPlay:Ne.func,onPause:Ne.func,onEnd:Ne.func,onStateChange:Ne.func,onPlaybackRateChange:Ne.func,onPlaybackQualityChange:Ne.func},kn=class extends G.Component{constructor(n){super(n),this.destroyPlayerPromise=void 0,this.onPlayerReady=e=>{var t,i;return(i=(t=this.props).onReady)==null?void 0:i.call(t,e)},this.onPlayerError=e=>{var t,i;return(i=(t=this.props).onError)==null?void 0:i.call(t,e)},this.onPlayerStateChange=e=>{var t,i,r,a,o,d,m,h;switch((i=(t=this.props).onStateChange)==null||i.call(t,e),e.data){case kn.PlayerState.ENDED:(a=(r=this.props).onEnd)==null||a.call(r,e);break;case kn.PlayerState.PLAYING:(d=(o=this.props).onPlay)==null||d.call(o,e);break;case kn.PlayerState.PAUSED:(h=(m=this.props).onPause)==null||h.call(m,e);break}},this.onPlayerPlaybackRateChange=e=>{var t,i;return(i=(t=this.props).onPlaybackRateChange)==null?void 0:i.call(t,e)},this.onPlayerPlaybackQualityChange=e=>{var t,i;return(i=(t=this.props).onPlaybackQualityChange)==null?void 0:i.call(t,e)},this.destroyPlayer=()=>this.internalPlayer?(this.destroyPlayerPromise=this.internalPlayer.destroy().then(()=>this.destroyPlayerPromise=void 0),this.destroyPlayerPromise):Promise.resolve(),this.createPlayer=()=>{if(typeof document>"u")return;if(this.destroyPlayerPromise){this.destroyPlayerPromise.then(this.createPlayer);return}const e=Yr(Qr({},this.props.opts),{videoId:this.props.videoId});this.internalPlayer=yy(this.container,e),this.internalPlayer.on("ready",this.onPlayerReady),this.internalPlayer.on("error",this.onPlayerError),this.internalPlayer.on("stateChange",this.onPlayerStateChange),this.internalPlayer.on("playbackRateChange",this.onPlayerPlaybackRateChange),this.internalPlayer.on("playbackQualityChange",this.onPlayerPlaybackQualityChange),(this.props.title||this.props.loading)&&this.internalPlayer.getIframe().then(t=>{this.props.title&&t.setAttribute("title",this.props.title),this.props.loading&&t.setAttribute("loading",this.props.loading)})},this.resetPlayer=()=>this.destroyPlayer().then(this.createPlayer),this.updatePlayer=()=>{var e;(e=this.internalPlayer)==null||e.getIframe().then(t=>{this.props.id?t.setAttribute("id",this.props.id):t.removeAttribute("id"),this.props.iframeClassName?t.setAttribute("class",this.props.iframeClassName):t.removeAttribute("class"),this.props.opts&&this.props.opts.width?t.setAttribute("width",this.props.opts.width.toString()):t.removeAttribute("width"),this.props.opts&&this.props.opts.height?t.setAttribute("height",this.props.opts.height.toString()):t.removeAttribute("height"),this.props.title?t.setAttribute("title",this.props.title):t.setAttribute("title","YouTube video player"),this.props.loading?t.setAttribute("loading",this.props.loading):t.removeAttribute("loading")})},this.getInternalPlayer=()=>this.internalPlayer,this.updateVideo=()=>{var e,t,i,r;if(typeof this.props.videoId>"u"||this.props.videoId===null){(e=this.internalPlayer)==null||e.stopVideo();return}let a=!1;const o={videoId:this.props.videoId};if((t=this.props.opts)!=null&&t.playerVars&&(a=this.props.opts.playerVars.autoplay===1,"start"in this.props.opts.playerVars&&(o.startSeconds=this.props.opts.playerVars.start),"end"in this.props.opts.playerVars&&(o.endSeconds=this.props.opts.playerVars.end)),a){(i=this.internalPlayer)==null||i.loadVideoById(o);return}(r=this.internalPlayer)==null||r.cueVideoById(o)},this.refContainer=e=>{this.container=e},this.container=null,this.internalPlayer=null}componentDidMount(){this.createPlayer()}componentDidUpdate(n){return wy(this,null,function*(){Py(n,this.props)&&this.updatePlayer(),xy(n,this.props)&&(yield this.resetPlayer()),Ey(n,this.props)&&this.updateVideo()})}componentWillUnmount(){this.destroyPlayer()}render(){return G.createElement("div",{className:this.props.className,style:this.props.style},G.createElement("div",{id:this.props.id,className:this.props.iframeClassName,ref:this.refContainer}))}},Vn=kn;Vn.propTypes=Iy;Vn.defaultProps=Cy;Vn.PlayerState={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:5};var Dy=Vn;const Ay=Object.freeze(Object.defineProperty({__proto__:null,default:Dy},Symbol.toStringTag,{value:"Module"})),Oy=Co(Ay);var po;function Ly(){if(po)return Ge;po=1;var n=Ge&&Ge.__createBinding||(Object.create?(function(_,T,v,E){E===void 0&&(E=v);var P=Object.getOwnPropertyDescriptor(T,v);(!P||("get"in P?!T.__esModule:P.writable||P.configurable))&&(P={enumerable:!0,get:function(){return T[v]}}),Object.defineProperty(_,E,P)}):(function(_,T,v,E){E===void 0&&(E=v),_[E]=T[v]})),e=Ge&&Ge.__setModuleDefault||(Object.create?(function(_,T){Object.defineProperty(_,"default",{enumerable:!0,value:T})}):function(_,T){_.default=T}),t=Ge&&Ge.__importStar||function(_){if(_&&_.__esModule)return _;var T={};if(_!=null)for(var v in _)v!=="default"&&Object.prototype.hasOwnProperty.call(_,v)&&n(T,_,v);return e(T,_),T},i=Ge&&Ge.__rest||function(_,T){var v={};for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&T.indexOf(E)<0&&(v[E]=_[E]);if(_!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,E=Object.getOwnPropertySymbols(_);P<E.length;P++)T.indexOf(E[P])<0&&Object.prototype.propertyIsEnumerable.call(_,E[P])&&(v[E[P]]=_[E[P]]);return v},r=Ge&&Ge.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.YouTubeEmbed=void 0;const a=r(rt()),o=t(tt()),d=r(Oy),m=jt(),h=$t(),g=640,y=360,S=0,x=_=>{var T,v,E,P,O,A,k,U,L,M,B,$,q,{url:V,width:F,height:Q,linkText:K="Watch on YouTube",placeholderImageUrl:Z,placeholderSpinner:ie,placeholderSpinnerDisabled:ae=!1,placeholderProps:ne,embedPlaceholder:he,placeholderDisabled:fe,youTubeProps:X}=_,ye=i(_,["url","width","height","linkText","placeholderImageUrl","placeholderSpinner","placeholderSpinnerDisabled","placeholderProps","embedPlaceholder","placeholderDisabled","youTubeProps"]);const[ge,re]=o.useState(!1),Se=(T=V.match(/[?&]v=(.+?)(?:$|[&?])/))===null||T===void 0?void 0:T[1],Oe=(v=V.match(/https:\/\/(?:www\.)?youtube\.com\/shorts\/(.+?)(?:$|[&?])/))===null||v===void 0?void 0:v[1],ue=(E=V.match(/https:\/\/youtu\.be\/(.+?)(?:$|[&?])/))===null||E===void 0?void 0:E[1],oe=(P=V.match(/https:\/\/(?:www\.)youtube(-nocookie)?\.com\/embed\/(.+?)(?:$|[&?])/))===null||P===void 0?void 0:P[2],we=(k=(A=(O=Se??Oe)!==null&&O!==void 0?O:ue)!==null&&A!==void 0?A:oe)!==null&&k!==void 0?k:"00000000",Ce=+((L=(U=V.match(/(.+?)(?:$|[&?])start=(\d+)/))===null||U===void 0?void 0:U[2])!==null&&L!==void 0?L:0),te=!!F?.toString().includes("%"),Ue=!!Q?.toString().includes("%");let Be={};Ce&&(Be.playerVars={start:Ce}),typeof F<"u"&&(Be.width=te?"100%":`${F}`),typeof Q<"u"&&(Be.height=Ue?"100%":`${Q}`),Be=Object.assign(Object.assign({},Be),X?.opts);const De={maxWidth:te?void 0:g,width:typeof F<"u"?te?"100%":F:"100%",height:Ue?"100%":typeof Q<"u"?Q:typeof((M=ye.style)===null||M===void 0?void 0:M.height)<"u"||typeof((B=ye.style)===null||B===void 0?void 0:B.maxHeight)<"u"?"100%":y,border:"1px solid #dee2e6",borderRadius:S},Ot=he??o.createElement(m.PlaceholderEmbed,Object.assign({url:V,imageUrl:Z,linkText:K,spinner:ie,spinnerDisabled:ae},ne,{style:Object.assign(Object.assign({},De),ne?.style)}));return o.createElement("div",Object.assign({},ye,{className:(0,a.default)("rsme-embed rsme-youtube-embed",ye.className),style:Object.assign({overflow:"hidden",width:F??void 0,height:Q??void 0,borderRadius:S},ye.style)}),o.createElement(h.EmbedStyle,null),o.createElement("div",{className:(0,a.default)(!ge&&"rsme-d-none")},o.createElement(d.default,Object.assign({},X,{className:($=X?.className)!==null&&$!==void 0?$:"youtube-iframe",videoId:(q=X?.videoId)!==null&&q!==void 0?q:we,opts:Be,onReady:be=>{re(!0),X&&X.onReady&&X?.onReady(be)}}))),!ge&&!fe&&Ot)};return Ge.YouTubeEmbed=x,Ge}var go;function My(){return go||(go=1,(function(n){var e=Ht&&Ht.__createBinding||(Object.create?(function(i,r,a,o){o===void 0&&(o=a);var d=Object.getOwnPropertyDescriptor(r,a);(!d||("get"in d?!r.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return r[a]}}),Object.defineProperty(i,o,d)}):(function(i,r,a,o){o===void 0&&(o=a),i[o]=r[a]})),t=Ht&&Ht.__exportStar||function(i,r){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(r,a)&&e(r,i,a)};Object.defineProperty(n,"__esModule",{value:!0}),t(Bg(),n),t(Ng(),n),t(Fg(),n),t($g(),n),t(jg(),n),t(ey(),n),t(Ul(),n),t(Ly(),n),t(jt(),n),t(kl(),n)})(Ht)),Ht}var Bl=My();function Ry(n){const e=ke.c(14);let t,i,r,a,o;e[0]!==n?({url:o,autoplayEnabled:t,dispatch:i,timeout:a,...r}=n,e[0]=n,e[1]=t,e[2]=i,e[3]=r,e[4]=a,e[5]=o):(t=e[1],i=e[2],r=e[3],a=e[4],o=e[5]);const d=a===void 0?5e3:a;let m,h;e[6]!==t||e[7]!==i||e[8]!==d?(m=()=>{if(t){const y=setTimeout(()=>{i(dt({set:!0}))},d);return()=>clearTimeout(y)}},h=[t,i,d],e[6]=t,e[7]=i,e[8]=d,e[9]=m,e[10]=h):(m=e[9],h=e[10]),le.useEffect(m,h);let g;return e[11]!==r||e[12]!==o?(g=D.jsx(Bl.InstagramEmbed,{url:o,...r}),e[11]=r,e[12]=o,e[13]=g):g=e[13],g}function ky(n){const e=ke.c(14);let t,i,r,a,o;e[0]!==n?({url:o,autoplayEnabled:t,dispatch:i,timeout:a,...r}=n,e[0]=n,e[1]=t,e[2]=i,e[3]=r,e[4]=a,e[5]=o):(t=e[1],i=e[2],r=e[3],a=e[4],o=e[5]);const d=a===void 0?5e3:a;let m,h;e[6]!==t||e[7]!==i||e[8]!==d?(m=()=>{if(t){const y=setTimeout(()=>{i(dt({set:!0}))},d);return()=>clearTimeout(y)}},h=[t,i,d],e[6]=t,e[7]=i,e[8]=d,e[9]=m,e[10]=h):(m=e[9],h=e[10]),le.useEffect(m,h);let g;return e[11]!==r||e[12]!==o?(g=D.jsx(Bl.XEmbed,{url:o,...r}),e[11]=r,e[12]=o,e[13]=g):g=e[13],g}function Uy(n){const e=ke.c(3),{src:t,autoplayEnabled:i,onEnded:r}=n,a=i?r:void 0;let o;return e[0]!==t||e[1]!==a?(o=D.jsx(Rn,{src:t,onEnded:a}),e[0]=t,e[1]=a,e[2]=o):o=e[2],o}const By=(n,e,t,i,r,a)=>{if(!n)return null;const{Platform:o,id:d,title:m}=n;if(!d)return null;const h=e||ki.getEmbedUrl(d)||"",g=t&&i?()=>{r||a(dt({set:!0}))}:void 0;switch(o){case"YouTube":case"Twitch":return t?D.jsx(Rn,{src:e,onEnded:g},`${d}-${e}-${t}`):D.jsx("iframe",{src:ki.getEmbedUrl(d)||h,title:m,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`);case"Streamable":return t?D.jsx(Uy,{src:h,title:m||"Streamable Video",autoplayEnabled:t&&!!i,onEnded:g},`${d}-${t}`):D.jsx("iframe",{src:ki.getEmbedUrl(d)+"?autoplay=1&loop=0"||h+"?autoplay=1&loop=0",title:m,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`);case"Kick":return D.jsx(Rn,{src:h,onEnded:g},`${n.id}-${e}-${t}`);case"Instagram":return D.jsx(Ry,{url:h,autoplayEnabled:t&&!!i,dispatch:a,height:"100%",captioned:!0},d);case"TikTok":return D.jsx(Mg,{src:e?e+"?autoplay=1&rel=0":ki.getEmbedUrl(d)+"?autoplay=1&rel=0",title:m,autoplayEnabled:t&&!!i},`${d}-${e}-${t}`);case"Twitter":return e?.endsWith(".jpg")||e?.endsWith(".png")?D.jsx(Rg,{src:e,title:m,autoplayEnabled:t&&!!i,dispatch:a},`${d}-${e}-${t}`):e?.endsWith(".mp4")?D.jsx(Rn,{src:e,onEnded:g},`${d}-${e}-${t}`):D.jsx(ky,{url:h,style:{maxWidth:"100%",maxHeight:"100%",width:500,height:"100%"},autoplayEnabled:t&&!!i,dispatch:a},`${d}-${e}-${t}`);default:return D.jsx("iframe",{src:h,title:m,style:{height:"100%",width:"100%"},frameBorder:"0",allow:"autoplay",allowFullScreen:!0},`${d}-${t}`)}};function fs(n){const e=ke.c(28),{className:t}=n,i=yt(),r=se(To),a=se(Xr),o=se(Kr),d=se(yc),[m,h]=le.useState(void 0),[g,y]=le.useState(null),S=se(_c);let x;e[0]!==i?(x=()=>{i(dt({set:!1})),i(vc())},e[0]=i,e[1]=x):x=e[1];const _=x;let T,v;e[2]!==r?(T=()=>{if(!r){h(void 0),y(null);return}h(void 0);let B=!0;return(async()=>{try{const q=await ki.getAutoplayUrl(r.id);B&&(h(q),y(null))}catch{B&&(y("Failed to load video"),h(void 0))}})(),()=>{B=!1}},v=[r],e[2]=r,e[3]=T,e[4]=v):(T=e[3],v=e[4]),le.useEffect(T,v);let E;e[5]!==o||e[6]!==d||e[7]!==r||e[8]!==i||e[9]!==a||e[10]!==m?(E=By(r,m,o,a,d,i),e[5]=o,e[6]=d,e[7]=r,e[8]=i,e[9]=a,e[10]=m,e[11]=E):E=e[11];const P=E;let O;e[12]===Symbol.for("react.memo_cache_sentinel")?(O={background:"black",width:"100%",aspectRatio:"16 / 9",position:"relative",flex:"0 0 auto"},e[12]=O):O=e[12];let A;e[13]!==o||e[14]!==g||e[15]!==P||e[16]!==m?(A=g?D.jsx("div",{style:{color:"red"},children:g}):m||!o?P:D.jsx("div",{}),e[13]=o,e[14]=g,e[15]=P,e[16]=m,e[17]=A):A=e[17];let k;e[18]!==S?(k=S>0&&D.jsxs("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",zIndex:3,background:"rgba(0, 0, 0, 0.6)",color:"white",padding:"6px 10px",borderRadius:"0 0 12px 12px",fontWeight:600,fontSize:12},"aria-live":"polite",children:["Skip votes: ",S]}),e[18]=S,e[19]=k):k=e[19];const U=!!d;let L;e[20]!==_||e[21]!==U?(L=D.jsx(Xf,{visible:U,onCancel:_}),e[20]=_,e[21]=U,e[22]=L):L=e[22];let M;return e[23]!==t||e[24]!==A||e[25]!==k||e[26]!==L?(M=D.jsxs(Ft,{align:"center",sx:O,className:t,children:[A,k,L]}),e[23]=t,e[24]=A,e[25]=k,e[26]=L,e[27]=M):M=e[27],M}function yo(){const n=le.useRef(null),e=le.useRef(!1),t=le.useRef({left:0,width:0}),[i,r]=le.useState(79),a=30,o=85;le.useEffect(()=>{const m={pct:i},h={id:0},g=()=>{h.id=0,r(x=>m.pct)},y=x=>{if(!e.current||!t.current.width)return;const T=x.clientX-t.current.left,v=Math.max(a,Math.min(o,Math.round(T/t.current.width*100)));m.pct=v,h.id||(h.id=requestAnimationFrame(g))},S=()=>{e.current=!1,h.id&&(cancelAnimationFrame(h.id),h.id=0)};return window.addEventListener("pointermove",y),window.addEventListener("pointerup",S),()=>{window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",S),h.id&&cancelAnimationFrame(h.id)}},[a,o,i]);const d=m=>{const h=m.currentTarget;try{h.setPointerCapture&&h.setPointerCapture(m.pointerId)}catch{}if(e.current=!0,n.current){const g=n.current.getBoundingClientRect();t.current.left=g.left,t.current.width=g.width}m.preventDefault()};return D.jsx($i,{fluid:!0,py:"md",sx:{height:"100%"},className:"classic-layout",children:D.jsx(ci,{sx:{height:"100%"},columns:24,children:D.jsx(ci.Col,{span:24,sx:{height:"100%"},children:D.jsxs(it,{ref:n,className:"classic-layout-inner",sx:{display:"flex",height:"100%",gap:3},children:[D.jsx(it,{className:"player-area",sx:{flex:`0 0 ${i}%`,minWidth:0},children:D.jsxs(Ft,{justify:"flex-start",spacing:"xs",sx:{height:"100%"},children:[D.jsx(fs,{}),D.jsxs(At,{position:"apart",className:"player-meta-group",sx:{alignItems:"flex-start",width:"100%"},children:[D.jsx(qn,{className:"player-title"}),D.jsx(Lo,{className:"player-buttons"})]})]})}),D.jsx(it,{className:"classic-resizer",onPointerDown:d,sx:{width:8,touchAction:"none",cursor:"col-resize",display:"flex",alignItems:"center",justifyContent:"center"},children:D.jsx(it,{sx:{width:2,height:"40%",background:"rgba(0,0,0,0.25)",borderRadius:2}})}),D.jsx(it,{className:"queue-area",sx:{flex:1,minWidth:0},children:D.jsxs(Ft,{justify:"flex-start",sx:{height:"100%",maxHeight:"100%",gap:3},children:[D.jsx(ns,{}),D.jsx(Cc,{sx:{".mantine-ScrollArea-viewport > div":{display:"block !important"}},children:D.jsx(At,{direction:"column",sx:{height:"100%",gap:3},children:D.jsx(is,{})})})]})})]})})})})}function Ny(n,e){Array.from(n.styleSheets).forEach(t=>{if(t.cssRules){const i=n.createElement("style");Array.from(t.cssRules).forEach(r=>{i.appendChild(n.createTextNode(r.cssText))}),e.head.appendChild(i)}else if(t.href){const i=n.createElement("link");i.rel="stylesheet",i.href=t.href,e.head.appendChild(i)}})}function Fy({children:n}){const e=document.createElement("div");return le.useEffect(()=>{const t=window.open("","",`width=${window.outerWidth},height=${window.outerHeight},popup`);if(t){const i=()=>t.close();return window.addEventListener("unload",i),t.document.body.appendChild(e),t.document.title="Twitch Clip Queue — Player",setTimeout(()=>Ny(document,t.document),100),()=>{window.removeEventListener("unload",i),t.close()}}},[e]),D.jsx(Ic,{target:e,children:n})}function $y(){const n=ke.c(2);let e;n[0]===Symbol.for("react.memo_cache_sentinel")?(e={height:"100%"},n[0]=e):e=n[0];let t;return n[1]===Symbol.for("react.memo_cache_sentinel")?(t=D.jsx(bc,{noNav:!0,children:D.jsx($i,{fluid:!0,py:"md",sx:e,children:D.jsxs(Ft,{justify:"flex-start",sx:{height:"100%"},children:[D.jsx(fs,{}),D.jsx(qn,{})]})})}),n[1]=t):t=n[1],t}function jy(){const n=ke.c(8);let e;n[0]===Symbol.for("react.memo_cache_sentinel")?(e=da(),n[0]=e):e=n[0];const[t,i]=le.useState(e);let r;n[1]===Symbol.for("react.memo_cache_sentinel")?(r=D.jsx(Bt,{variant:"default",onClick:()=>i(da()),children:"Reload layout"}),n[1]=r):r=n[1];let a,o;n[2]===Symbol.for("react.memo_cache_sentinel")?(a=D.jsxs(At,{position:"apart",align:"flex-end",pb:"sm",children:[D.jsx(qn,{}),D.jsx(Lo,{})]}),o=D.jsx(ns,{}),n[2]=a,n[3]=o):(a=n[2],o=n[3]);let d;n[4]===Symbol.for("react.memo_cache_sentinel")?(d=D.jsxs($i,{fluid:!0,py:"md",children:[r,D.jsxs($i,{size:"xl",children:[a,o,D.jsx(ci,{pt:"sm",children:D.jsx(is,{card:!0,wrapper:qy})})]})]}),n[4]=d):d=n[4];let m;n[5]===Symbol.for("react.memo_cache_sentinel")?(m=D.jsx(Fy,{children:D.jsx($y,{})}),n[5]=m):m=n[5];let h;return n[6]!==t?(h=D.jsxs(le.Fragment,{children:[d,m]},t),n[6]=t,n[7]=h):h=n[7],h}function qy(n){const{children:e}=n;return D.jsx(ci.Col,{span:2,children:e})}function kr(n){const e=ke.c(17),{children:t,onClick:i,title:r,size:a,color:o,variant:d,className:m,style:h,clearWhenIdle:g}=n,y=a===void 0?"lg":a,S=d===void 0?"filled":d,x=g===void 0?!1:g,[_,T]=le.useState(!1);let v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=()=>T(!0),e[0]=v):v=e[0];const E=v;let P;e[1]===Symbol.for("react.memo_cache_sentinel")?(P=()=>T(!1),e[1]=P):P=e[1];const O=P,A=_?1:.25,k=_?"scale(1.02)":"none";let U;e[2]!==x||e[3]!==_||e[4]!==h||e[5]!==A||e[6]!==k?(U={borderRadius:"50%",transition:"opacity 160ms, transform 120ms",opacity:A,transform:k,pointerEvents:"auto",...h},x&&!_&&Object.assign(U,{backgroundColor:"transparent",boxShadow:"none",border:"none"}),e[2]=x,e[3]=_,e[4]=h,e[5]=A,e[6]=k,e[7]=U):U=e[7];const L=o;let M;return e[8]!==U||e[9]!==t||e[10]!==m||e[11]!==i||e[12]!==y||e[13]!==L||e[14]!==r||e[15]!==S?(M=D.jsx(Xt,{size:y,variant:S,color:L,title:r,onClick:i,style:U,className:m,onMouseEnter:E,onMouseLeave:O,children:t}),e[8]=U,e[9]=t,e[10]=m,e[11]=i,e[12]=y,e[13]=L,e[14]=r,e[15]=S,e[16]=M):M=e[16],M}function Wy(){const n=ke.c(14),[e,t]=le.useState(!1),i=qi();let r;n[0]===Symbol.for("react.memo_cache_sentinel")?(r={position:"fixed",bottom:20,left:20,zIndex:2e3},n[0]=r):r=n[0];const a=r;let o;n[1]===Symbol.for("react.memo_cache_sentinel")?(o={position:"relative",zIndex:50},n[1]=o):o=n[1];const d=o,m=i.colorScheme==="dark"?i.colors.dark[7]:i.white,h=i.colorScheme==="dark"?i.colors.gray[0]:void 0;let g;n[2]!==m||n[3]!==h?(g={position:"absolute",bottom:"calc(100% + 12px)",left:0,background:m,color:h,padding:"12px 14px",borderRadius:8,boxShadow:"0 8px 26px rgba(0, 0, 0, 0.45)",zIndex:60,minWidth:"50vw",maxWidth:"min(90vw, 560px)"},n[2]=m,n[3]=h,n[4]=g):g=n[4];const y=g;let S,x;n[5]===Symbol.for("react.memo_cache_sentinel")?(S=()=>t(!0),x=()=>t(!1),n[5]=S,n[6]=x):(S=n[5],x=n[6]);let _;n[7]===Symbol.for("react.memo_cache_sentinel")?(_={opacity:.3,transition:"opacity 120ms"},n[7]=_):_=n[7];let T;n[8]===Symbol.for("react.memo_cache_sentinel")?(T=D.jsx("div",{style:d,children:D.jsx(Xt,{variant:"filled",size:"md",title:"Show info",style:_,onMouseEnter:Hy,onMouseLeave:Vy,children:D.jsx(nh,{})})}),n[8]=T):T=n[8];let v;n[9]!==y||n[10]!==e?(v=e&&D.jsx("div",{style:y,children:D.jsx(qn,{})}),n[9]=y,n[10]=e,n[11]=v):v=n[11];let E;return n[12]!==v?(E=D.jsxs("div",{style:a,onMouseEnter:S,onMouseLeave:x,children:[T,v]}),n[12]=v,n[13]=E):E=n[13],E}function Vy(n){return n.currentTarget.style.opacity="0.3"}function Hy(n){return n.currentTarget.style.opacity="1"}function Gy(){const n=yt(),[e,t]=le.useState(!1),i=se(Kr),[r,a]=le.useState(60),o=qi(),d=`calc(100vh - ${r}px - 48px)`;le.useEffect(()=>{if(typeof window>"u")return;const S=document.querySelector("header");if(!S)return;let x=0,_=!0;const T=()=>{if(_)try{const P=S.offsetHeight||0;a(Math.round(P))}catch{}},v=()=>{try{cancelAnimationFrame(x)}catch{}x=requestAnimationFrame(T)};v(),window.addEventListener("resize",v),window.addEventListener("orientationchange",v);let E=null;try{E=new MutationObserver(()=>v()),E.observe(S,{attributes:!0,attributeFilter:["class","style"],childList:!0,subtree:!1})}catch{E=null}return()=>{_=!1;try{cancelAnimationFrame(x)}catch{}try{window.removeEventListener("resize",v)}catch{}try{window.removeEventListener("orientationchange",v)}catch{}try{E?.disconnect()}catch{}}},[]),le.useEffect(()=>{const S="etf-hide-scrollbar-style";if(document.getElementById(S))return;const x=document.createElement("style");return x.id=S,x.innerHTML=`
      html, body, #root, * { scrollbar-width: none !important; -ms-overflow-style: none !important; }
      *::-webkit-scrollbar { display: none !important; width: 0 !important; height: 0 !important; }
    `,document.head.appendChild(x),()=>{document.getElementById(S)?.remove()}},[]);const m=()=>{t(S=>!S)},h=()=>{n(vo())},g=()=>{n(bo())},y=S=>{n(dt({set:!1})),n(_o(S.currentTarget.checked))};return D.jsxs($i,{fluid:!0,pt:"md",className:"spotlight-layout",children:[D.jsx("div",{className:"content-container",children:D.jsxs("div",{className:"stage",children:[D.jsx("div",{className:"side-panel left",children:D.jsx(kr,{onClick:h,title:"Previous",color:"dark",size:96,children:D.jsx(zc,{size:48})})}),D.jsx("div",{className:"player-box",style:{height:d},children:D.jsx(fs,{})}),D.jsx("div",{className:"side-panel right",children:D.jsx(kr,{onClick:g,title:"Next",color:"dark",size:96,children:D.jsx(Yc,{size:48})})}),e&&D.jsxs("div",{className:"queue-popup",style:{background:o.colorScheme==="dark"?o.colors.dark[7]:o.white,color:o.colorScheme==="dark"?o.colors.gray[0]:void 0},children:[D.jsx("div",{className:"panel-section",children:D.jsx(ns,{})}),D.jsx("div",{className:"panel-section",children:D.jsx(ci,{pt:"sm",children:D.jsx(is,{card:!0,wrapper:({children:S})=>D.jsx(ci.Col,{span:2,children:S})})})})]})]})}),D.jsx("div",{className:"queue-toggle",children:D.jsx(kr,{onClick:m,title:e?"Hide queue":"Show queue",clearWhenIdle:!0,children:e?D.jsx(Dh,{}):D.jsx(sh,{})})}),D.jsx("div",{className:"autoplay-toggle",children:D.jsx(Jr,{size:"sm",label:"Autoplay",checked:i,onChange:y})}),D.jsx("div",{className:"info-toggle",children:D.jsx(Wy,{})})]})}const zy=()=>{const n=ke.c(4);switch(se(Tc)){case"classic":{let t;return n[0]===Symbol.for("react.memo_cache_sentinel")?(t=D.jsx(yo,{}),n[0]=t):t=n[0],t}case"spotlight":{let t;return n[1]===Symbol.for("react.memo_cache_sentinel")?(t=D.jsx(Gy,{}),n[1]=t):t=n[1],t}case"fullscreen":{let t;return n[2]===Symbol.for("react.memo_cache_sentinel")?(t=D.jsx(jy,{}),n[2]=t):t=n[2],t}default:{let t;return n[3]===Symbol.for("react.memo_cache_sentinel")?(t=D.jsx(yo,{}),n[3]=t):t=n[3],t}}};zy.displayName="QueuePage";export{zy as default};
